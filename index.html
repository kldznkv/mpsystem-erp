<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPSYSTEM Production ERP</title>
    <meta name="description" content="Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾Ð¼ Ð¿Ð»ÐµÐ½Ð¾Ñ‡Ð½Ñ‹Ñ… Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EðŸ­%3C/text%3E%3C/svg%3E">
          <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
                                                 /* Clean Service Platform Design System */
                 :root {
                     /* Core Design System Variables */
                     --font: "IBM Plex Sans";
                     --black: #040c15;
                     --grey: #93969a;
                     --grey-back: #f2f2f2;
                     --light: #e6e7e8;
                     --red: #de4040;
                     --orange: #ff8d47;
                     --blue: #f1f7ff;
                     
                     /* Layout Variables */
                     --sideoffset: 20px;
                     --leftcolumn: 300px;
                     --header_height: 70px;
                     
                     /* Responsive Typography */
                     --lineheight: 20px;
                     
                     /* Transitions */
                     --transition: 0.1s linear;
                     --transition-hover: 0.1s linear;
                 }

                 /* Responsive Layout Variables */
                 @media (min-width: 1280px) {
                     :root {
                         --sideoffset: 60px;
                         --leftcolumn: 372px;
                         --lineheight: 22px;
                     }
                 }

                 @media (min-width: 1536px) {
                     :root {
                         --leftcolumn: 458px;
                     }
                 }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-text-size-adjust: none;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }

        html, body {
            display: flex;
            margin: 0;
            min-height: 100%;
            overscroll-behavior: none;
            padding: 0;
            touch-action: manipulation;
            width: 100%;
        }

        body {
            color: var(--black);
            font-family: var(--font), sans-serif;
            font-style: normal;
            font-weight: 400;
            line-height: var(--lineheight);
            overflow-y: scroll;
            white-space: break-spaces;
            word-break: break-word;
            background: #fff;
            flex-direction: column;
        }

        /* Responsive Typography */
        @media (max-width: 1279px) {
            body {
                font-size: 14px;
            }
        }

        @media (min-width: 1280px) {
            body {
                font-size: 16px;
            }
        }

        /* Clean Header */
        .header {
            background: #fff;
            border-bottom: 1px solid var(--light);
            position: sticky;
            top: 0;
            z-index: 1000;
            height: var(--header_height);
            display: flex;
            align-items: center;
            box-sizing: border-box;
        }

        .header-content {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 var(--sideoffset);
            box-sizing: border-box;
            max-width: 1280px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            color: var(--black);
        }

        .logo span:first-child {
            font-size: 1.5rem;
            filter: grayscale(20%);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .storage-status {
            padding: 0.5rem 0.875rem;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 500;
            border: 1px solid var(--border-light);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .storage-status.connected {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary-color);
            border-color: rgba(16, 185, 129, 0.2);
        }

        /* Modern Navigation */
        .nav-container {
            background: var(--surface);
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .nav-tabs {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            padding: 0 2rem;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            flex: 0 0 auto;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.925rem;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--surface-hover);
        }

        .nav-tab:before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-tab.active:before {
            width: 100%;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            box-sizing: border-box;
            margin: auto;
            max-width: 1280px;
            width: 100%;
            padding: 0 var(--sideoffset);
        }

        /* Responsive Main Container */
        @media (max-width: 1279px) {
            .main-container {
                padding: 20px 14px 0;
            }
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(16px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        /* Clean Cards */
        .card {
            background: #fff;
            border-radius: 12px;
            border: 1px solid var(--light);
            padding: 24px;
            margin-bottom: 20px;
            transition: var(--transition);
            box-shadow: 0 1px 3px rgba(4,12,21,.05);
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(4,12,21,.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--light);
        }

        /* Utility Classes */
        .-flex {
            display: flex;
            flex-wrap: nowrap;
        }

        .-flex__xCenter {
            justify-content: center;
        }

        .-flex__yCenter {
            align-items: center;
        }

        .-flex__yEnd {
            align-items: flex-end;
        }

        .-flex__xSpace {
            justify-content: space-between;
        }

        .-flex__xEnd {
            justify-content: flex-end;
        }

        .-flex__column {
            flex-direction: column;
        }

        .-cur {
            cursor: pointer;
        }

        .-disabled {
            pointer-events: none;
        }

        .-text-grey {
            color: var(--grey);
        }

        /* Typography */
        .title {
            font-weight: 600;
            margin: 0;
        }

        .input__title {
            color: rgba(4,12,21,.4);
            margin-left: 10px;
        }

        /* Responsive Typography */
        @media (max-width: 1279px) {
            .title {
                font-size: 24px;
                line-height: 31px;
            }

            .input__title {
                font-size: 14px;
                line-height: 20px;
                margin-bottom: 8px;
            }
        }

        @media (min-width: 1280px) {
            .title {
                font-size: 34px;
                line-height: 44px;
            }

            .input__title {
                font-size: 16px;
                line-height: 22px;
                margin-bottom: 10px;
            }
        }

        .card-title {
            font-size: 1.375rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        /* Modern Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.925rem;
        }

        .form-input, .form-select, .form-textarea {
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-lg);
            font-size: 0.925rem;
            transition: var(--transition);
            background: var(--surface);
            color: var(--text-primary);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: var(--surface);
        }

        .form-input:hover, .form-select:hover, .form-textarea:hover {
            border-color: var(--border-dark);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }

        /* Clean Button System */
        .button__black, .button__orange, .button__white, .button__tag-border-black {
            align-items: center;
            box-sizing: border-box;
            cursor: pointer;
            display: flex;
            justify-content: center;
            position: relative;
            transition: var(--transition);
            white-space: nowrap;
            z-index: 0;
            border: none;
            text-decoration: none;
        }

        .button__black:after, .button__black:before,
        .button__orange:after, .button__orange:before,
        .button__white:after, .button__white:before,
        .button__tag-border-black:after, .button__tag-border-black:before {
            border-radius: inherit;
            content: "";
            height: 100%;
            left: 0;
            position: absolute;
            top: 0;
            transition: var(--transition);
            width: 100%;
            z-index: -1;
        }

        .button__black:after, .button__orange:after,
        .button__white:after, .button__tag-border-black:after {
            background: hsla(0,0%,100%,0);
            z-index: 0;
        }

        /* Primary Black Button */
        .button__black, .btn-primary {
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            height: 50px;
            line-height: 23px;
            padding: 0 32px;
            color: #fff;
        }

        .button__black:before, .btn-primary:before {
            background: var(--black);
        }

        .button__black:active:after, .btn-primary:active:after {
            background: hsla(0,0%,100%,.3) !important;
        }

        /* Orange Button */
        .button__orange, .btn-warning {
            background: var(--orange);
            border-radius: 20px;
            color: #fff;
            font-weight: 600;
            height: 40px;
        }

        .button__orange:active:after, .btn-warning:active:after {
            background: hsla(0,0%,100%,.3) !important;
        }

        /* White Button */
        .button__white, .btn-secondary {
            border: 1px solid var(--black);
            border-radius: 25px;
            font-size: 18px;
            font-weight: 600;
            height: 50px;
            line-height: 23px;
            padding: 0 32px;
            background: #fff;
            color: var(--black);
        }

        .button__white:before, .btn-secondary:before {
            background: #fff;
        }

        .button__white:active:after, .btn-secondary:active:after {
            background: rgba(4,12,21,.1) !important;
        }

        /* Tag Border Button */
        .button__tag-border-black, .btn-small {
            border: 1px solid var(--black);
            border-radius: 30px;
            height: 36px;
            padding: 0 14px;
            color: var(--black);
            background: transparent;
        }

        .button__tag-border-black:active:after, .btn-small:active:after {
            background: rgba(4,12,21,.1) !important;
        }

        /* Red Button */
        .btn-danger {
            border: 1px solid var(--red);
            border-radius: 25px;
            color: var(--red);
            font-weight: 600;
            height: 40px;
            background: transparent;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Success Button */
        .btn-success {
            background: #4cbb49;
            border-radius: 20px;
            color: #fff;
            font-weight: 600;
            height: 40px;
            padding: 0 20px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Hover Effects for Desktop */
        @media (min-width: 1280px) {
            .button__black:hover:after, .btn-primary:hover:after,
            .button__orange:hover:after, .btn-warning:hover:after {
                background: hsla(0,0%,100%,.15);
            }

            .button__white:hover:after, .btn-secondary:hover:after,
            .button__tag-border-black:hover:after, .btn-small:hover:after {
                background: rgb(4 12 21/5%);
            }
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text-secondary);
            border-color: var(--border-medium);
        }

        .btn-secondary:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
            border-color: var(--border-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: var(--text-inverse);
            box-shadow: var(--shadow-sm);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: var(--text-inverse);
            box-shadow: var(--shadow-sm);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: var(--text-inverse);
            box-shadow: var(--shadow-sm);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Modern Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            background: var(--surface);
            border: 1px solid var(--border-light);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table td {
            color: var(--text-primary);
            font-size: 0.925rem;
        }

        .table tr:hover {
            background: var(--surface-hover);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        /* Modern Status Badges */
        .badge {
            padding: 0.375rem 0.875rem;
            border-radius: var(--radius-lg);
            font-size: 0.8125rem;
            font-weight: 500;
            letter-spacing: 0.025em;
            border: 1px solid transparent;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary-color);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-color: rgba(239, 68, 68, 0.2);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
            border-color: rgba(59, 130, 246, 0.2);
        }

        /* Modern Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: 1.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: none;
            letter-spacing: 0;
        }

        /* Modern Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal.show {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--surface);
            border-radius: var(--radius-2xl);
            padding: 2rem;
            max-width: 640px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-light);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .modal-close {
            background: var(--surface-hover);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            width: 32px;
            height: 32px;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--border-light);
            color: var(--text-primary);
        }

        /* File upload */
        .file-upload {
            border: 2px dashed var(--gray-300);
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            background: var(--gray-50);
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.05);
        }

        .file-upload.dragover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                padding: 0 1rem;
            }

            .nav-tab {
                min-width: 120px;
            }

            .main-container {
                padding: 0 1rem 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 3000;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--danger-color);
        }

        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }

        /* Modern Search */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-lg);
            font-size: 0.925rem;
            background: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-input:hover {
            border-color: var(--border-dark);
        }

        .search-input::placeholder {
            color: var(--text-tertiary);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 1rem;
        }

        /* Action buttons in tables */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        /* Modern Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-tertiary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .empty-state p {
            font-size: 0.925rem;
            font-weight: 500;
        }

        /* Import Modal Styles */
        .import-step {
            min-height: 400px;
        }

        .import-section {
            margin-bottom: 2rem;
        }

        .import-section h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .entity-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .entity-option {
            cursor: pointer;
        }

        .entity-option input[type="radio"] {
            display: none;
        }

        .entity-card {
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            transition: var(--transition);
            background: var(--surface);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .entity-option input[type="radio"]:checked + .entity-card {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .entity-card:hover {
            border-color: var(--border-dark);
            background: var(--surface-hover);
        }

        .entity-icon {
            font-size: 2rem;
            opacity: 0.8;
        }

        .entity-info {
            flex: 1;
        }

        .entity-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .entity-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .file-upload-area {
            border: 2px dashed var(--border-medium);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--surface-hover);
        }

        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .upload-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .upload-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .file-info {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .template-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .preview-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .preview-stats {
            font-weight: 600;
            color: var(--text-primary);
        }

        .preview-table-container {
            max-height: 300px;
            overflow: auto;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
        }

        .import-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .modal-footer {
            border-top: 1px solid var(--border-light);
            padding-top: 1.5rem;
            margin-top: 2rem;
        }

        /* Simplified Interface Styles */
        .dashboard-widgets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .widget-content {
            padding: 1rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }

        .task-status.completed {
            background: var(--success-color);
            color: white;
        }

        .task-status.pending {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .alert {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 0.75rem;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            color: #92400e;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #1e40af;
        }

        /* Planning Timeline */
        .planning-timeline {
            background: var(--surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .timeline-header {
            display: grid;
            grid-template-columns: 200px repeat(5, 1fr);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-light);
        }

        .timeline-date {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid var(--border-light);
        }

        .timeline-content {
            display: flex;
            flex-direction: column;
        }

        .production-line {
            display: grid;
            grid-template-columns: 200px repeat(5, 1fr);
            border-bottom: 1px solid var(--border-light);
        }

        .production-line:last-child {
            border-bottom: none;
        }

        .line-name {
            padding: 1rem;
            font-weight: 600;
            background: var(--bg-tertiary);
            border-right: 1px solid var(--border-light);
            display: flex;
            align-items: center;
        }

        .timeline-slots {
            display: contents;
        }

        .time-slot {
            padding: 1rem;
            border-right: 1px solid var(--border-light);
            text-align: center;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .time-slot.busy {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .time-slot.available {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .time-slot.planned {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .time-slot.maintenance {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        /* Orders Grid */
        .orders-filter {
            margin-bottom: 2rem;
        }

        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .order-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: var(--transition);
        }

        .order-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .order-number {
            font-weight: 700;
            font-size: 1.125rem;
            color: var(--primary-color);
        }

        .order-info {
            margin-bottom: 1rem;
        }

        .order-customer {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .order-product {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .order-quantity {
            font-weight: 600;
            color: var(--primary-color);
        }

        .order-dates {
            color: var(--text-tertiary);
        }

        /* Warehouse */
        .warehouse-overview {
            margin-bottom: 2rem;
        }

        .warehouse-stats {
            display: flex;
            justify-content: space-around;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .warehouse-sections {
            display: grid;
            gap: 2rem;
        }

        .warehouse-section h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .material-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .material-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1rem;
        }

        .material-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .material-quantity {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .material-status {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .material-status.low {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .material-status.ok {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .finished-goods {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .goods-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
        }

        .quantity {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Production Lines */
        .production-lines {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .production-line-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .line-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .line-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .line-status {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .line-status.running {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .line-status.maintenance {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .line-details {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .current-order {
            font-weight: 600;
            color: var(--primary-color);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            transition: width 0.3s ease;
        }

        .line-metrics {
            display: flex;
            gap: 2rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .production-summary {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .production-summary h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .analytics-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .analytics-card h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart-placeholder {
            display: flex;
            align-items: end;
            height: 150px;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--primary-color), var(--primary-light));
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            min-height: 20px;
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .plan-progress {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .plan-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--primary-color) 87%, var(--bg-tertiary) 0);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .plan-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            background: var(--surface);
            border-radius: 50%;
            position: absolute;
        }

        .plan-percentage {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            z-index: 1;
            position: relative;
        }

        .plan-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .efficiency-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .efficiency-item {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .efficiency-item span:first-child {
            min-width: 80px;
            font-weight: 600;
        }

        .efficiency-bar {
            flex: 1;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
        }

        .efficiency-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #34d399);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: end;
            padding-right: 0.5rem;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .dashboard-widgets {
                grid-template-columns: 1fr;
            }

            .timeline-header,
            .production-line {
                grid-template-columns: 150px repeat(3, 1fr);
            }

            .orders-grid {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .plan-progress {
                flex-direction: column;
                                 text-align: center;
             }
         }

         /* Detail Modal Styles */
         .detail-content {
             padding: 0;
         }

         .detail-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
             gap: 2rem;
             margin-bottom: 2rem;
         }

         .detail-section {
             background: var(--bg-tertiary);
             border-radius: var(--radius-lg);
             padding: 1.5rem;
         }

         .detail-section.full-width {
             grid-column: 1 / -1;
         }

         .detail-section h4 {
             font-size: 1rem;
             font-weight: 600;
             color: var(--text-primary);
             margin-bottom: 1rem;
             display: flex;
             align-items: center;
             gap: 0.5rem;
         }

         .detail-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem 0;
             border-bottom: 1px solid var(--border-light);
         }

         .detail-item:last-child {
             border-bottom: none;
         }

         .detail-label {
             font-weight: 500;
             color: var(--text-secondary);
             min-width: 120px;
         }

         .detail-value {
             font-weight: 600;
             color: var(--text-primary);
             text-align: right;
             flex: 1;
         }

         .detail-actions {
             display: flex;
             gap: 1rem;
             justify-content: center;
             padding-top: 1.5rem;
             border-top: 1px solid var(--border-light);
             flex-wrap: wrap;
         }

         /* Line Schedule Styles */
         .line-schedule {
             display: flex;
             flex-direction: column;
             gap: 0.75rem;
         }

         .schedule-item {
             display: grid;
             grid-template-columns: 1fr 1fr 1fr;
             gap: 1rem;
             padding: 1rem;
             background: var(--surface);
             border: 1px solid var(--border-light);
             border-radius: var(--radius-lg);
             align-items: center;
         }

         .schedule-item.completed {
             border-left: 4px solid var(--success-color);
         }

         .schedule-item.current {
             border-left: 4px solid var(--primary-color);
             background: rgba(99, 102, 241, 0.05);
         }

         .schedule-item.planned {
             border-left: 4px solid var(--info-color);
         }

         .schedule-time {
             font-weight: 600;
         }

         .schedule-order {
             font-weight: 600;
             color: var(--primary-color);
         }

         .schedule-status {
             text-align: right;
             font-size: 0.875rem;
             font-weight: 500;
         }

         /* Clickable Cards */
         .order-card, 
         .material-card, 
         .production-line-card {
             cursor: pointer;
         }

         .order-card:hover, 
         .material-card:hover, 
         .production-line-card:hover {
             transform: translateY(-4px);
             box-shadow: var(--shadow-lg);
         }

         /* Procurement styles */
         .procurement-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 2rem;
             padding: 1.5rem;
             background: var(--surface);
             border-radius: var(--radius-lg);
             box-shadow: var(--shadow-sm);
         }

         .procurement-actions {
             display: flex;
             gap: 1rem;
             flex-wrap: wrap;
         }

         .filter-buttons {
             display: flex;
             gap: 0.5rem;
             flex-wrap: wrap;
         }

         .supplier-performance-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 1.5rem;
             margin-top: 1rem;
         }

         .performance-card {
             background: var(--surface);
             border-radius: var(--radius-lg);
             padding: 1.5rem;
             box-shadow: var(--shadow-sm);
             border: 1px solid var(--border-light);
         }

         .performance-card h4 {
             margin-bottom: 1rem;
             color: var(--text-primary);
             font-size: 1rem;
         }

         .performance-list {
             display: flex;
             flex-direction: column;
             gap: 0.75rem;
         }

         .performance-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem;
             background: var(--bg-tertiary);
             border-radius: var(--radius-md);
         }

         .supplier-name {
             font-weight: 500;
             color: var(--text-primary);
         }

         .performance-score {
             font-weight: 600;
             color: var(--success-color);
         }

         .alert-list {
             display: flex;
             flex-direction: column;
             gap: 0.5rem;
         }

         .alert-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem;
             background: rgba(239, 68, 68, 0.1);
             border-radius: var(--radius-md);
             border: 1px solid rgba(239, 68, 68, 0.2);
         }

         .alert-time {
             font-weight: 600;
             color: var(--danger-color);
         }

         .savings-info {
             display: flex;
             flex-direction: column;
             gap: 0.75rem;
         }

         .savings-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem;
             background: var(--bg-tertiary);
             border-radius: var(--radius-md);
         }

         .savings-label {
             font-weight: 500;
             color: var(--text-secondary);
         }

         .savings-value.positive {
             font-weight: 600;
             color: var(--success-color);
         }

         .savings-value.negative {
             font-weight: 600;
             color: var(--danger-color);
         }

         /* Order Management styles */
         .orders-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 2rem;
             padding: 1.5rem;
             background: var(--surface);
             border-radius: var(--radius-lg);
             box-shadow: var(--shadow-sm);
         }

         .orders-actions {
             display: flex;
             gap: 1rem;
             flex-wrap: wrap;
         }

         .pipeline-stats {
             display: flex;
             gap: 2rem;
             flex-wrap: wrap;
         }

         .stat-item {
             text-align: center;
         }

         .stat-number {
             display: block;
             font-size: 2rem;
             font-weight: 700;
             color: var(--primary-color);
             line-height: 1;
         }

         .stat-label {
             display: block;
             font-size: 0.875rem;
             color: var(--text-secondary);
             margin-top: 0.25rem;
         }

         .pipeline-container {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
             gap: 1.5rem;
             margin-top: 1.5rem;
         }

         .pipeline-stage {
             background: var(--bg-tertiary);
             border-radius: var(--radius-lg);
             padding: 1rem;
         }

         .stage-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 1rem;
             padding-bottom: 0.5rem;
             border-bottom: 2px solid var(--border-light);
         }

         .stage-header h4 {
             margin: 0;
             font-size: 0.9rem;
             color: var(--text-primary);
         }

         .stage-count {
             background: var(--primary-color);
             color: var(--text-inverse);
             padding: 0.25rem 0.5rem;
             border-radius: var(--radius-sm);
             font-size: 0.75rem;
             font-weight: 600;
         }

         .stage-orders {
             display: flex;
             flex-direction: column;
             gap: 0.75rem;
             min-height: 120px;
         }

         .pipeline-order {
             background: var(--surface);
             border-radius: var(--radius-md);
             padding: 1rem;
             cursor: pointer;
             transition: var(--transition);
             border: 1px solid var(--border-light);
         }

         .pipeline-order:hover {
             transform: translateY(-2px);
             box-shadow: var(--shadow-md);
         }

         .order-title {
             font-weight: 600;
             color: var(--text-primary);
             margin-bottom: 0.25rem;
         }

         .order-customer {
             font-size: 0.875rem;
             color: var(--text-secondary);
             margin-bottom: 0.5rem;
         }

         .order-value {
             font-weight: 600;
             color: var(--success-color);
             font-size: 0.9rem;
         }

         .order-progress {
             margin-top: 0.75rem;
         }

         .progress-bar {
             width: 100%;
             height: 6px;
             background: var(--bg-tertiary);
             border-radius: 3px;
             overflow: hidden;
             margin-bottom: 0.25rem;
         }

         .progress-fill {
             height: 100%;
             background: linear-gradient(90deg, var(--success-color), var(--primary-color));
             transition: var(--transition);
         }

         .progress-text {
             font-size: 0.75rem;
             color: var(--text-secondary);
         }

         .quick-access-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
             gap: 1.5rem;
             margin-top: 2rem;
         }

         .customer-list, .product-list {
             display: flex;
             flex-direction: column;
             gap: 0.75rem;
         }

         .customer-item, .product-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 1rem;
             background: var(--bg-tertiary);
             border-radius: var(--radius-md);
             cursor: pointer;
             transition: var(--transition);
             border: 1px solid var(--border-light);
         }

         .customer-item:hover, .product-item:hover {
             background: var(--surface-hover);
             transform: translateX(4px);
         }

         .customer-info, .product-info {
             flex: 1;
         }

         .customer-name, .product-name {
             display: block;
             font-weight: 600;
             color: var(--text-primary);
             margin-bottom: 0.25rem;
         }

         .customer-details, .product-details {
             font-size: 0.875rem;
             color: var(--text-secondary);
         }

         .customer-metrics, .product-metrics {
             text-align: right;
         }

         .customer-value, .product-revenue {
             display: block;
             font-weight: 600;
             color: var(--text-primary);
             margin-bottom: 0.25rem;
         }

         .customer-growth {
             font-size: 0.75rem;
             font-weight: 600;
             padding: 0.2rem 0.4rem;
             border-radius: var(--radius-sm);
         }

         .customer-growth.positive {
             background: rgba(16, 185, 129, 0.1);
             color: var(--success-color);
         }

         .customer-growth.neutral {
             background: rgba(107, 114, 128, 0.1);
             color: var(--text-secondary);
         }

         .product-orders {
             font-size: 0.875rem;
             color: var(--text-secondary);
         }

         .order-filters {
             display: flex;
             gap: 1rem;
             align-items: center;
             flex-wrap: wrap;
         }

         @media (max-width: 768px) {
             .detail-grid {
                 grid-template-columns: 1fr;
             }

             .detail-actions {
                 flex-direction: column;
             }

             .schedule-item {
                 grid-template-columns: 1fr;
                 text-align: center;
             }

             .procurement-header {
                 flex-direction: column;
                 gap: 1rem;
             }

             .procurement-actions {
                 width: 100%;
             }
         }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span>ðŸ­</span>
                <span>MPSYSTEM Production ERP</span>
            </div>
            <div class="header-actions">
                <div id="storageStatus" class="storage-status connected">
                    ðŸ’¾ Local Storage Active
                </div>
                <button class="btn btn-secondary" onclick="exportData()">
                    ðŸ“¤ Export Data
                </button>
                <button class="btn btn-secondary" onclick="showModal('importModal')">
                    ðŸ“¥ Import Data
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">
                ðŸ“Š Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´
            </button>
            <button class="nav-tab" onclick="showTab('planning')">
                                        ðŸ›’ Ð—Ð°ÐºÑƒÐ¿ÐºÐ¸
            </button>
            <button class="nav-tab" onclick="showTab('orders')">
                ðŸ“‘ Ð—Ð°ÐºÐ°Ð·Ñ‹
            </button>
            <button class="nav-tab" onclick="showTab('warehouse')">
                ðŸ­ Ð¡ÐºÐ»Ð°Ð´
            </button>
            <button class="nav-tab" onclick="showTab('production')">
                âš™ï¸ ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾
            </button>
            <button class="nav-tab" onclick="showTab('analytics')">
                ðŸ“ˆ ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">Ð—Ð°ÐºÐ°Ð·Ñ‹ Ð² Ñ€Ð°Ð±Ð¾Ñ‚Ðµ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="productionEfficiency">92%</div>
                    <div class="stat-label">Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="warehouseLoad">85%</div>
                    <div class="stat-label">Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐºÐ»Ð°Ð´Ð°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayProduction">2.5Ñ‚</div>
                    <div class="stat-label">ÐŸÑ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¾ ÑÐµÐ³Ð¾Ð´Ð½Ñ</div>
                </div>
            </div>

            <div class="dashboard-widgets">
                <div class="card">
                    <div class="card-header">
                        <h3>ðŸ“‹ ÐŸÐ»Ð°Ð½Ñ‹ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ</h3>
                    </div>
                    <div class="widget-content">
                        <div class="task-item">
                            <span class="task-status completed">âœ“</span>
                            <span>Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð·Ð°ÐºÐ°Ð·Ð° #ORD-240001</span>
                        </div>
                        <div class="task-item">
                            <span class="task-status pending">â³</span>
                            <span>ÐŸÑ€Ð¸ÐµÐ¼ÐºÐ° Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð² Ð¾Ñ‚ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</span>
                        </div>
                        <div class="task-item">
                            <span class="task-status pending">â³</span>
                            <span>ÐžÑ‚Ð³Ñ€ÑƒÐ·ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ð¸</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>âš ï¸ ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ</h3>
                    </div>
                    <div class="widget-content">
                        <div class="alert alert-warning">
                            ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº: Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð” (500 ÐºÐ³)
                        </div>
                        <div class="alert alert-info">
                            ÐŸÐ»Ð°Ð½Ð¾Ð²Ð¾Ðµ Ð¢Ðž Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ñ Ð·Ð°Ð²Ñ‚Ñ€Ð°
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Planning Tab -->
        <div id="planning" class="tab-content">
            <div class="procurement-header">
                <h2>ðŸ›’ ModuÅ‚ zakupÃ³w</h2>
                <div class="procurement-actions">
                    <button class="btn btn-primary" onclick="generateMRPRequirements()">ðŸ”„ Generuj zapotrzebowania MRP</button>
                    <button class="btn btn-secondary" onclick="showModal('procurementModal')">âž• Nowe zamÃ³wienie zakupu</button>
                    <button class="btn btn-secondary" onclick="showSpotPurchaseModal()">âš¡ Zakup spot</button>
                </div>
            </div>

            <!-- MRP Requirements -->
            <div class="card">
                <div class="card-header">
                    <h3>ðŸ“‹ Zapotrzebowania MRP</h3>
                    <button class="btn btn-secondary" onclick="loadMRPRequirements()">ðŸ”„ OdÅ›wieÅ¼</button>
                </div>
                
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>MateriaÅ‚</th>
                                <th>IloÅ›Ä‡</th>
                                <th>Data potrzeby</th>
                                <th>Priorytet</th>
                                <th>Å¹rÃ³dÅ‚o</th>
                                <th>Status</th>
                                <th>DziaÅ‚ania</th>
                            </tr>
                        </thead>
                        <tbody id="mrpRequirementsTable">
                            <!-- MRP requirements will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Purchase Orders -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h3>ðŸ“‘ ZamÃ³wienia zakupu</h3>
                    <div class="filter-buttons">
                        <button class="btn btn-sm btn-secondary" onclick="filterPurchaseOrders('all')">Wszystkie</button>
                        <button class="btn btn-sm btn-info" onclick="filterPurchaseOrders('draft')">Projekty</button>
                        <button class="btn btn-sm btn-warning" onclick="filterPurchaseOrders('sent')">WysÅ‚ane</button>
                        <button class="btn btn-sm btn-success" onclick="filterPurchaseOrders('confirmed')">Potwierdzone</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nr ZZ</th>
                                <th>Dostawca</th>
                                <th>MateriaÅ‚</th>
                                <th>IloÅ›Ä‡</th>
                                <th>Cena jedn.</th>
                                <th>WartoÅ›Ä‡</th>
                                <th>Termin dostawy</th>
                                <th>Status</th>
                                <th>DziaÅ‚ania</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseOrdersTable">
                            <!-- Purchase orders will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Supplier Performance -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h3>ðŸ“Š Ocena dostawcÃ³w</h3>
                </div>
                
                <div class="supplier-performance-grid">
                    <div class="performance-card">
                        <h4>ðŸ† Najlepsi dostawcy</h4>
                        <div class="performance-list">
                            <div class="performance-item">
                                <span class="supplier-name">BASF Polska</span>
                                <span class="performance-score">96.8%</span>
                            </div>
                            <div class="performance-item">
                                <span class="supplier-name">Siegwerk Druckfarben</span>
                                <span class="performance-score">94.5%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="performance-card">
                        <h4>âš ï¸ Alerty jakoÅ›ciowe</h4>
                        <div class="alert-list">
                            <div class="alert-item">
                                <span>OpÃ³Åºnienie dostawy - PO-2024-0012</span>
                                <span class="alert-time">2 dni</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="performance-card">
                        <h4>ðŸ’° Savings vs budÅ¼et</h4>
                        <div class="savings-info">
                            <div class="savings-item">
                                <span class="savings-label">Ten miesiÄ…c:</span>
                                <span class="savings-value positive">+12,500 PLN</span>
                            </div>
                            <div class="savings-item">
                                <span class="savings-label">YTD:</span>
                                <span class="savings-value positive">+45,200 PLN</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Materials Management -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h3>ðŸ“¦ ZarzÄ…dzanie materiaÅ‚ami</h3>
                    <button class="btn btn-primary" onclick="showModal('materialModal')">
                        âž• Dodaj materiaÅ‚
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">ðŸ”</span>
                    <input type="text" class="search-input" placeholder="Szukaj materiaÅ‚Ã³w..." onkeyup="filterMaterials(this.value)">
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Kod</th>
                                <th>Nazwa</th>
                                <th>Typ</th>
                                <th>Jednostka</th>
                                <th>Koszt</th>
                                <th>Min. zapas</th>
                                <th>Dostawca</th>
                                <th>DziaÅ‚ania</th>
                            </tr>
                        </thead>
                        <tbody id="materialsTable">
                            <!-- Materials will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Suppliers Management -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h3>ðŸ‘¥ ZarzÄ…dzanie dostawcami</h3>
                    <button class="btn btn-primary" onclick="showModal('supplierModal')">
                        âž• Dodaj dostawcÄ™
                    </button>
                </div>

                <div class="search-container">
                    <span class="search-icon">ðŸ”</span>
                    <input type="text" class="search-input" placeholder="Szukaj dostawcÃ³w..." onkeyup="filterSuppliers(this.value)">
                </div>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Kod</th>
                                <th>Nazwa</th>
                                <th>Kontakt</th>
                                <th>Email</th>
                                <th>Telefon</th>
                                <th>Ocena</th>
                                <th>Status</th>
                                <th>DziaÅ‚ania</th>
                            </tr>
                        </thead>
                        <tbody id="suppliersTable">
                            <!-- Suppliers will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="orders" class="tab-content">
            <div class="orders-header">
                <h2>ðŸ“‘ Order Management System</h2>
                <div class="orders-actions">
                    <button class="btn btn-primary" onclick="showOrderCreationWizard()">âž• Create New Order</button>
                    <button class="btn btn-secondary" onclick="showQuoteCalculator()">ðŸ’° Quote Calculator</button>
                    <button class="btn btn-secondary" onclick="generateOrderReport()">ðŸ“Š Generate Report</button>
                </div>
            </div>

            <!-- Order Pipeline Status -->
            <div class="card">
                <div class="card-header">
                    <h3>ðŸ“ˆ Order Pipeline Overview</h3>
                    <div class="pipeline-stats">
                        <div class="stat-item">
                            <span class="stat-number">12</span>
                            <span class="stat-label">Active Orders</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">â‚¬125K</span>
                            <span class="stat-label">Pipeline Value</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">94%</span>
                            <span class="stat-label">On-Time Delivery</span>
                        </div>
                    </div>
                </div>
                
                <div class="pipeline-container">
                    <div class="pipeline-stage">
                        <div class="stage-header">
                            <h4>ðŸ†• New Orders</h4>
                            <span class="stage-count">3</span>
                        </div>
                        <div class="stage-orders" id="newOrders">
                            <div class="pipeline-order" onclick="showOrderDetail('ORD-240004')">
                                <div class="order-title">Barrier Film Multi-layer</div>
                                <div class="order-customer">TechPack Solutions</div>
                                <div class="order-value">â‚¬15,200</div>
                            </div>
                            <div class="pipeline-order" onclick="showOrderDetail('ORD-240005')">
                                <div class="order-title">Food Grade PE Film</div>
                                <div class="order-customer">FreshFood Ltd</div>
                                <div class="order-value">â‚¬8,400</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage">
                        <div class="stage-header">
                            <h4>ðŸ“‹ In Planning</h4>
                            <span class="stage-count">2</span>
                        </div>
                        <div class="stage-orders" id="planningOrders">
                            <div class="pipeline-order" onclick="showOrderDetail('ORD-240002')">
                                <div class="order-title">Stretch Film 500mm</div>
                                <div class="order-customer">Logistics Corp</div>
                                <div class="order-value">â‚¬12,600</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage">
                        <div class="stage-header">
                            <h4>ðŸ­ In Production</h4>
                            <span class="stage-count">4</span>
                        </div>
                        <div class="stage-orders" id="productionOrders">
                            <div class="pipeline-order" onclick="showOrderDetail('ORD-240001')">
                                <div class="order-title">Printed Bags with Logo</div>
                                <div class="order-customer">Brand Corp</div>
                                <div class="order-value">â‚¬22,800</div>
                                <div class="order-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 65%"></div>
                                    </div>
                                    <span class="progress-text">65%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="pipeline-stage">
                        <div class="stage-header">
                            <h4>âœ… Ready to Ship</h4>
                            <span class="stage-count">1</span>
                        </div>
                        <div class="stage-orders" id="completedOrders">
                            <div class="pipeline-order" onclick="showOrderDetail('ORD-240003')">
                                <div class="order-title">PE Film Transparent</div>
                                <div class="order-customer">PackCorp</div>
                                <div class="order-value">â‚¬9,200</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customer & Product Quick Access -->
            <div class="quick-access-grid">
                <div class="card">
                    <div class="card-header">
                        <h3>ðŸ‘¥ Top Customers</h3>
                        <button class="btn btn-sm btn-secondary" onclick="showCustomerManager()">Manage</button>
                    </div>
                    <div class="customer-list">
                        <div class="customer-item" onclick="createOrderForCustomer('TechPack Solutions')">
                            <div class="customer-info">
                                <span class="customer-name">TechPack Solutions</span>
                                <span class="customer-details">5 active orders â€¢ Premium client</span>
                            </div>
                            <div class="customer-metrics">
                                <span class="customer-value">â‚¬45,200</span>
                                <span class="customer-growth positive">+12%</span>
                            </div>
                        </div>
                        <div class="customer-item" onclick="createOrderForCustomer('FreshFood Ltd')">
                            <div class="customer-info">
                                <span class="customer-name">FreshFood Ltd</span>
                                <span class="customer-details">2 active orders â€¢ Food grade specialist</span>
                            </div>
                            <div class="customer-metrics">
                                <span class="customer-value">â‚¬28,400</span>
                                <span class="customer-growth positive">+8%</span>
                            </div>
                        </div>
                        <div class="customer-item" onclick="createOrderForCustomer('Logistics Corp')">
                            <div class="customer-info">
                                <span class="customer-name">Logistics Corp</span>
                                <span class="customer-details">1 active order â€¢ Industrial packaging</span>
                            </div>
                            <div class="customer-metrics">
                                <span class="customer-value">â‚¬15,600</span>
                                <span class="customer-growth neutral">Â±0%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>ðŸ† Best Selling Products</h3>
                        <button class="btn btn-sm btn-secondary" onclick="showProductCatalog()">Catalog</button>
                    </div>
                    <div class="product-list">
                        <div class="product-item" onclick="createOrderForProduct('Barrier Film Multi-layer')">
                            <div class="product-info">
                                <span class="product-name">Barrier Film Multi-layer</span>
                                <span class="product-details">9-layer coex â€¢ Food grade â€¢ High barrier</span>
                            </div>
                            <div class="product-metrics">
                                <span class="product-orders">15 orders</span>
                                <span class="product-revenue">â‚¬89K</span>
                            </div>
                        </div>
                        <div class="product-item" onclick="createOrderForProduct('Printed PE Film')">
                            <div class="product-info">
                                <span class="product-name">Printed PE Film</span>
                                <span class="product-details">Flexographic â€¢ Up to 8 colors â€¢ Custom design</span>
                            </div>
                            <div class="product-metrics">
                                <span class="product-orders">12 orders</span>
                                <span class="product-revenue">â‚¬67K</span>
                            </div>
                        </div>
                        <div class="product-item" onclick="createOrderForProduct('Stretch Film LLDPE')">
                            <div class="product-info">
                                <span class="product-name">Stretch Film LLDPE</span>
                                <span class="product-details">500mm width â€¢ Machine grade â€¢ High puncture</span>
                            </div>
                            <div class="product-metrics">
                                <span class="product-orders">8 orders</span>
                                <span class="product-revenue">â‚¬34K</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Orders Table -->
            <div class="card" style="margin-top: 2rem;">
                <div class="card-header">
                    <h3>ðŸ“‹ All Orders</h3>
                    <div class="order-filters">
                        <input type="text" placeholder="Search orders..." class="search-input" oninput="searchOrders(this.value)">
                        <select class="form-input" onchange="filterOrdersByStatus(this.value)">
                            <option value="">All Statuses</option>
                            <option value="new">New</option>
                            <option value="approved">Approved</option>
                            <option value="in_planning">In Planning</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="in_production">In Production</option>
                            <option value="produced">Produced</option>
                            <option value="shipped">Shipped</option>
                            <option value="closed">Closed</option>
                        </select>
                        <select class="form-input" onchange="filterOrdersByPriority(this.value)">
                            <option value="">All Priorities</option>
                            <option value="high">High Priority</option>
                            <option value="medium">Medium Priority</option>
                            <option value="low">Low Priority</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Order #</th>
                                <th>Customer</th>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Value</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Priority</th>
                                <th>Progress</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTable">
                            <!-- Orders will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Warehouse Tab -->
        <div id="warehouse" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐºÐ»Ð°Ð´Ð¾Ð¼</h2>
                    <button class="btn btn-primary" onclick="receiveDelivery()">
                        ðŸ“¦ ÐŸÑ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÑƒ
                    </button>
                </div>

                <div class="warehouse-overview">
                    <div class="warehouse-stats">
                        <div class="stat-item">
                            <span class="stat-number">1247</span>
                            <span class="stat-text">Ñ‚ ÑÑ‹Ñ€ÑŒÑ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">23</span>
                            <span class="stat-text">Ð½Ð¾Ð¼ÐµÐ½ÐºÐ»Ð°Ñ‚ÑƒÑ€Ñ‹</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">85%</span>
                            <span class="stat-text">Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾</span>
                        </div>
                    </div>
                </div>

                <div class="warehouse-sections">
                    <div class="warehouse-section">
                        <h3>ðŸ“¦ Ð¡Ñ‹Ñ€ÑŒÐµ Ð¸ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹</h3>
                        <div class="material-grid">
                            <div class="material-card" onclick="showWarehouseDetail('ldpe-granulate')">
                                <div class="material-name">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð”</div>
                                <div class="material-quantity">500 ÐºÐ³</div>
                                <div class="material-status low">ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº</div>
                            </div>
                            <div class="material-card" onclick="showWarehouseDetail('pp-granulate')">
                                <div class="material-name">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐŸ</div>
                                <div class="material-quantity">750 ÐºÐ³</div>
                                <div class="material-status ok">ÐÐ¾Ñ€Ð¼Ð°</div>
                            </div>
                            <div class="material-card" onclick="showWarehouseDetail('blue-dye')">
                                <div class="material-name">ÐšÑ€Ð°ÑÐ¸Ñ‚ÐµÐ»ÑŒ ÑÐ¸Ð½Ð¸Ð¹</div>
                                <div class="material-quantity">25 ÐºÐ³</div>
                                <div class="material-status ok">ÐÐ¾Ñ€Ð¼Ð°</div>
                            </div>
                        </div>
                    </div>

                    <div class="warehouse-section">
                        <h3>ðŸ“‹ Ð“Ð¾Ñ‚Ð¾Ð²Ð°Ñ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ñ</h3>
                        <div class="finished-goods">
                            <div class="goods-item">
                                <span>ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢ 12Ð¼ÐºÐ¼</span>
                                <span class="quantity">150 Ñ€ÑƒÐ»Ð¾Ð½Ð¾Ð²</span>
                            </div>
                            <div class="goods-item">
                                <span>ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ñ„Ð°ÑÐ¾Ð²Ð¾Ñ‡Ð½Ñ‹Ðµ</span>
                                <span class="quantity">50000 ÑˆÑ‚</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Inventory Management -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3>ðŸ“‹ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ°Ð¼Ð¸</h3>
                        <button class="btn btn-primary" onclick="showModal('inventoryModal')">
                            âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»</th>
                                    <th>Ð¡ÐºÐ»Ð°Ð´</th>
                                    <th>ÐŸÐ°Ñ€Ñ‚Ð¸Ñ</th>
                                    <th>ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾</th>
                                    <th>Ð—Ð°Ñ€ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾</th>
                                    <th>Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾</th>
                                    <th>Ð›Ð¾ÐºÐ°Ñ†Ð¸Ñ</th>
                                    <th>Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ</th>
                                </tr>
                            </thead>
                            <tbody id="inventoryTable">
                                <!-- Inventory will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Batches Management -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3>ðŸ·ï¸ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ñ‚Ð¸ÑÐ¼Ð¸</h3>
                        <button class="btn btn-primary" onclick="showModal('batchModal')">
                            âž• ÐŸÑ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ð°Ñ€Ñ‚Ð¸ÑŽ
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸</th>
                                    <th>ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»</th>
                                    <th>ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº</th>
                                    <th>ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾</th>
                                    <th>Ð”Ð°Ñ‚Ð° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ</th>
                                    <th>Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°</th>
                                    <th>Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹</th>
                                    <th>Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ</th>
                                </tr>
                            </thead>
                            <tbody id="batchesTable">
                                <!-- Batches will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Tab -->
        <div id="production" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð»Ð¸Ð½Ð¸Ð¸</h2>
                    <button class="btn btn-secondary" onclick="refreshProduction()">
                        ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ
                    </button>
                </div>

                <div class="production-lines">
                    <div class="production-line-card" onclick="showLineDetail('line-1')">
                        <div class="line-header">
                            <h3>Ð›Ð¸Ð½Ð¸Ñ 1 - Ð­ÐºÑÑ‚Ñ€ÑƒÐ·Ð¸Ñ</h3>
                            <span class="line-status running">Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚</span>
                        </div>
                        <div class="line-details">
                            <div class="current-order">Ð—Ð°ÐºÐ°Ð·: #ORD-240001</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%"></div>
                            </div>
                            <div class="line-metrics">
                                <span>ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ: 65%</span>
                                <span>Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ: 120 Ð¼/Ð¼Ð¸Ð½</span>
                                <span>ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ: 2Ñ‡ 15Ð¼Ð¸Ð½</span>
                            </div>
                        </div>
                    </div>

                    <div class="production-line-card" onclick="showLineDetail('line-2')">
                        <div class="line-header">
                            <h3>Ð›Ð¸Ð½Ð¸Ñ 2 - ÐŸÐµÑ‡Ð°Ñ‚ÑŒ</h3>
                            <span class="line-status running">Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚</span>
                        </div>
                        <div class="line-details">
                            <div class="current-order">Ð—Ð°ÐºÐ°Ð·: #ORD-240002</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 30%"></div>
                            </div>
                            <div class="line-metrics">
                                <span>ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ: 30%</span>
                                <span>Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ: 85 Ð¼/Ð¼Ð¸Ð½</span>
                                <span>ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ: 4Ñ‡ 20Ð¼Ð¸Ð½</span>
                            </div>
                        </div>
                    </div>

                    <div class="production-line-card" onclick="showLineDetail('line-3')">
                        <div class="line-header">
                            <h3>Ð›Ð¸Ð½Ð¸Ñ 3 - Ð›Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ</h3>
                            <span class="line-status maintenance">ÐžÐ±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ</span>
                        </div>
                        <div class="line-details">
                            <div class="current-order">ÐŸÐ»Ð°Ð½Ð¾Ð²Ð¾Ðµ Ð¢Ðž</div>
                            <div class="line-metrics">
                                <span>ÐÐ°Ñ‡Ð°Ð»Ð¾: 08:00</span>
                                <span>ÐžÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ðµ: 12:00</span>
                                <span>ÐžÑ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹: ÐŸÐµÑ‚Ñ€Ð¾Ð² Ð.Ð˜.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="production-summary">
                    <h3>Ð¡Ð²Ð¾Ð´ÐºÐ° Ð·Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">ÐŸÑ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¾</span>
                            <span class="summary-value">2.5 Ñ‚Ð¾Ð½Ð½</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Ð’Ñ€ÐµÐ¼Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹</span>
                            <span class="summary-value">18.5 Ñ‡Ð°ÑÐ¾Ð²</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ</span>
                            <span class="summary-value">92%</span>
                        </div>
                    </div>
                </div>

                <!-- Production Queue -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h3>ðŸ“‹ ÐžÑ‡ÐµÑ€ÐµÐ´ÑŒ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°</h3>
                        <button class="btn btn-secondary" onclick="loadProductionQueue()">
                            ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ
                        </button>
                    </div>

                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ð—Ð°ÐºÐ°Ð·</th>
                                    <th>ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚</th>
                                    <th>ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾</th>
                                    <th>Ð›Ð¸Ð½Ð¸Ñ</th>
                                    <th>Ð’Ñ€ÐµÐ¼Ñ Ð½Ð°Ñ‡Ð°Ð»Ð°</th>
                                    <th>Ð’Ñ€ÐµÐ¼Ñ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ</th>
                                    <th>Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</th>
                                    <th>ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚</th>
                                </tr>
                            </thead>
                            <tbody id="productionQueueTable">
                                <!-- Production queue will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ð¸ Ð¾Ñ‚Ñ‡ÐµÑ‚Ñ‹</h2>
                    <select class="form-select" style="width: auto;">
                        <option>Ð—Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ</option>
                        <option>Ð—Ð° Ð½ÐµÐ´ÐµÐ»ÑŽ</option>
                        <option>Ð—Ð° Ð¼ÐµÑÑÑ†</option>
                    </select>
                </div>

                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>ðŸ“Š ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ</h3>
                        <div class="chart-placeholder">
                            <div class="chart-bar" style="height: 60%"></div>
                            <div class="chart-bar" style="height: 80%"></div>
                            <div class="chart-bar" style="height: 75%"></div>
                            <div class="chart-bar" style="height: 90%"></div>
                            <div class="chart-bar" style="height: 85%"></div>
                        </div>
                        <div class="chart-labels">
                            <span>ÐŸÐ½</span><span>Ð’Ñ‚</span><span>Ð¡Ñ€</span><span>Ð§Ñ‚</span><span>ÐŸÑ‚</span>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>ðŸ’° Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð»Ð°Ð½Ð°</h3>
                        <div class="plan-progress">
                            <div class="plan-circle">
                                <span class="plan-percentage">87%</span>
                            </div>
                            <div class="plan-details">
                                <div>ÐŸÐ»Ð°Ð½: 100 Ñ‚Ð¾Ð½Ð½</div>
                                <div>Ð¤Ð°ÐºÑ‚: 87 Ñ‚Ð¾Ð½Ð½</div>
                                <div>ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ: 13 Ñ‚Ð¾Ð½Ð½</div>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>âš¡ Ð­Ñ„Ñ„ÐµÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¾Ð±Ð¾Ñ€ÑƒÐ´Ð¾Ð²Ð°Ð½Ð¸Ñ</h3>
                        <div class="efficiency-list">
                            <div class="efficiency-item">
                                <span>Ð›Ð¸Ð½Ð¸Ñ 1</span>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill" style="width: 95%">95%</div>
                                </div>
                            </div>
                            <div class="efficiency-item">
                                <span>Ð›Ð¸Ð½Ð¸Ñ 2</span>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill" style="width: 88%">88%</div>
                                </div>
                            </div>
                            <div class="efficiency-item">
                                <span>Ð›Ð¸Ð½Ð¸Ñ 3</span>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill" style="width: 0%">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Material Modal -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</h3>
                <button class="modal-close" onclick="hideModal('materialModal')">&times;</button>
            </div>
            <form id="materialForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ÐšÐ¾Ð´ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°</label>
                        <input type="text" name="code" class="form-input" required placeholder="GR-PVD-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ</label>
                        <input type="text" name="name" class="form-input" required placeholder="Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð” Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ð¢Ð¸Ð¿ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°</label>
                        <select name="type" class="form-select" required>
                            <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¸Ð¿</option>
                            <option value="granulate_ldpe">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð”</option>
                            <option value="granulate_hdpe">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐÐ”</option>
                            <option value="granulate_pp">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐŸ</option>
                            <option value="ink_printing">ÐšÑ€Ð°ÑÐºÐ° Ð´Ð»Ñ Ð¿ÐµÑ‡Ð°Ñ‚Ð¸</option>
                            <option value="adhesive_pu">ÐšÐ»ÐµÐ¹ ÐŸÐ£</option>
                            <option value="adhesive_acrylic">ÐšÐ»ÐµÐ¹ Ð°ÐºÑ€Ð¸Ð»Ð¾Ð²Ñ‹Ð¹</option>
                            <option value="solvent">Ð Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚ÐµÐ»ÑŒ</option>
                            <option value="additive">Ð”Ð¾Ð±Ð°Ð²ÐºÐ°</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ð•Ð´Ð¸Ð½Ð¸Ñ†Ð° Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ</label>
                        <select name="unit" class="form-select" required>
                            <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñƒ</option>
                            <option value="ÐºÐ³">ÐºÐ³</option>
                            <option value="Ð»">Ð»</option>
                            <option value="Ð¼">Ð¼</option>
                            <option value="ÑˆÑ‚">ÑˆÑ‚</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ</label>
                        <input type="number" name="standard_cost" class="form-input" step="0.01" placeholder="245.50">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº</label>
                        <input type="number" name="min_stock_level" class="form-input" step="0.01" placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ð¢Ð¾Ñ‡ÐºÐ° Ð¿ÐµÑ€ÐµÐ·Ð°ÐºÐ°Ð·Ð°</label>
                        <input type="number" name="reorder_point" class="form-input" step="0.01" placeholder="2000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº</label>
                        <select name="supplier_id" class="form-select" id="materialSupplierSelect">
                            <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ</label>
                    <textarea name="description" class="form-textarea" placeholder="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°"></textarea>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal('materialModal')">âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</h3>
                <button class="modal-close" onclick="hideModal('supplierModal')">&times;</button>
            </div>
            <form id="supplierForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">ÐšÐ¾Ð´ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</label>
                        <input type="text" name="code" class="form-input" required placeholder="SUP001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ</label>
                        <input type="text" name="name" class="form-input" required placeholder="Dow Chemical Europe">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð½Ð¾Ðµ Ð»Ð¸Ñ†Ð¾</label>
                        <input type="text" name="contact_person" class="form-input" placeholder="John Smith">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" name="email" class="form-input" placeholder="contact@company.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½</label>
                        <input type="tel" name="phone" class="form-input" placeholder="+7-495-123-4567">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</label>
                        <select name="is_active" class="form-select">
                            <option value="true">ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹</option>
                            <option value="false">ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ÐÐ´Ñ€ÐµÑ</label>
                    <textarea name="address" class="form-textarea" placeholder="ÐÐ´Ñ€ÐµÑ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°"></textarea>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal('supplierModal')">âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Additional modals for inventory, batches, orders would follow similar pattern -->

                <!-- Inventory Modal -->
            <div id="inventoryModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº</h3>
                        <button class="modal-close" onclick="hideModal('inventoryModal')">&times;</button>
                    </div>
                    <form id="inventoryForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»</label>
                                <select name="material_id" class="form-select" required id="inventoryMaterialSelect">
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð¡ÐºÐ»Ð°Ð´</label>
                                <select name="warehouse" class="form-select" required>
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐºÐ»Ð°Ð´</option>
                                    <option value="MAG-1">MAG-1 - ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÑÐºÐ»Ð°Ð´</option>
                                    <option value="MAG-2">MAG-2 - Ð¡ÐºÐ»Ð°Ð´ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ð¸</option>
                                    <option value="MAG-3">MAG-3 - Ð¡ÐºÐ»Ð°Ð´ Ð±Ñ€Ð°ÐºÐ°</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸</label>
                                <input type="text" name="batch_number" class="form-input" placeholder="240115-001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾</label>
                                <input type="number" name="quantity" class="form-input" step="0.01" required placeholder="1000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð—Ð°Ñ€ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾</label>
                                <input type="number" name="reserved_quantity" class="form-input" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð›Ð¾ÐºÐ°Ñ†Ð¸Ñ</label>
                                <input type="text" name="location_code" class="form-input" placeholder="A1-05-02">
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('inventoryModal')">âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Batch Modal -->
            <div id="batchModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÐŸÑ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ð°Ñ€Ñ‚Ð¸ÑŽ</h3>
                        <button class="modal-close" onclick="hideModal('batchModal')">&times;</button>
                    </div>
                    <form id="batchForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸</label>
                                <input type="text" name="batch_number" class="form-input" required placeholder="240115-001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»</label>
                                <select name="material_id" class="form-select" required id="batchMaterialSelect">
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº</label>
                                <select name="supplier_id" class="form-select" required id="batchSupplierSelect">
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾</label>
                                <input type="number" name="received_quantity" class="form-input" step="0.01" required placeholder="2500">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð”Ð°Ñ‚Ð° Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°</label>
                                <input type="date" name="production_date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð”Ð°Ñ‚Ð° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ</label>
                                <input type="date" name="received_date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°</label>
                                <select name="quality_status" class="form-select" required>
                                    <option value="pending">ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ñ</option>
                                    <option value="approved">ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¾</option>
                                    <option value="quarantine">ÐšÐ°Ñ€Ð°Ð½Ñ‚Ð¸Ð½</option>
                                    <option value="blocked">Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¾</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <h4>Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 0.5rem;">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_coa" value="true"> Ð¡ÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚ Ð°Ð½Ð°Ð»Ð¸Ð·Ð° (CoA)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_tds" value="true"> Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ (TDS)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_sds" value="true"> ÐŸÐ°ÑÐ¿Ð¾Ñ€Ñ‚ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ (SDS)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_doc" value="true"> Ð”ÐµÐºÐ»Ð°Ñ€Ð°Ñ†Ð¸Ñ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ (DoC)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_cmr" value="true"> Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚Ð½Ð°Ñ Ð½Ð°ÐºÐ»Ð°Ð´Ð½Ð°Ñ (CMR)
                                </label>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ðŸ’¾ ÐŸÑ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ð°Ñ€Ñ‚Ð¸ÑŽ</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('batchModal')">âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Order Modal -->
            <div id="orderModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·</h3>
                        <button class="modal-close" onclick="hideModal('orderModal')">&times;</button>
                    </div>
                    <form id="orderForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð°</label>
                                <input type="text" name="order_number" class="form-input" required placeholder="ORD-240001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐšÐ»Ð¸ÐµÐ½Ñ‚</label>
                                <input type="text" name="customer" class="form-input" required placeholder="ÐžÐžÐž ÐŸÐ¸Ñ‰ÐµÐ¿Ñ€Ð¾Ð¼">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚ <small style="color: #64748b;">(Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð· ÑÐ¿Ð¸ÑÐºÐ° Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð¾Ð²)</small></label>
                                <input type="text" name="product" class="form-input" required placeholder="ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢ 12Ð¼ÐºÐ¼" list="productList">
                                <datalist id="productList">
                                    <option value="ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢ 12Ð¼ÐºÐ¼">Ð­ÐºÑÑ‚Ñ€ÑƒÐ·Ð¸Ñ: GR-PET-001 + DYE-CLEAR</option>
                                    <option value="ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ñ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð¾Ð¼">ÐŸÐµÑ‡Ð°Ñ‚ÑŒ: GR-PVD-001 + DYE-BLUE</option>
                                    <option value="Ð¡Ñ‚Ñ€ÐµÐ¹Ñ‡-Ð¿Ð»ÐµÐ½ÐºÐ° 500Ð¼Ð¼">Ð­ÐºÑÑ‚Ñ€ÑƒÐ·Ð¸Ñ: GR-LLDPE-001</option>
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾</label>
                                <input type="number" name="quantity" class="form-input" step="0.01" required placeholder="5000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð”Ð°Ñ‚Ð° Ð·Ð°ÐºÐ°Ð·Ð°</label>
                                <input type="date" name="order_date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð”Ð°Ñ‚Ð° Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸</label>
                                <input type="date" name="delivery_date" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</label>
                                <select name="status" class="form-select" required>
                                    <option value="new">ÐÐ¾Ð²Ñ‹Ð¹</option>
                                    <option value="planned">Ð—Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½</option>
                                    <option value="in_production">Ð’ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ðµ</option>
                                    <option value="completed">Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½</option>
                                    <option value="shipped">ÐžÑ‚Ð³Ñ€ÑƒÐ¶ÐµÐ½</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚</label>
                                <select name="priority" class="form-select" required>
                                    <option value="low">ÐÐ¸Ð·ÐºÐ¸Ð¹</option>
                                    <option value="medium">Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹</option>
                                    <option value="high">Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹</option>
                                    <option value="critical">ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸</label>
                            <textarea name="notes" class="form-textarea" placeholder="Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ Ðº Ð·Ð°ÐºÐ°Ð·Ñƒ"></textarea>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">ðŸ’¾ Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('orderModal')">âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Import Modal -->
            <div id="importModal" class="modal">
                <div class="modal-content" style="max-width: 1000px;">
                    <div class="modal-header">
                        <h3>Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ…</h3>
                        <button class="modal-close" onclick="hideModal('importModal')">&times;</button>
                    </div>
                    
                    <div id="importStep1" class="import-step">
                        <div class="import-section">
                            <h4>1. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¸Ð¿ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°</h4>
                            <div class="entity-selection">
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="materials">
                                    <div class="entity-card">
                                        <div class="entity-icon">ðŸ“¦</div>
                                        <div class="entity-info">
                                            <div class="entity-name">ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹</div>
                                            <div class="entity-desc">ÐšÐ¾Ð´, Ð½Ð°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ, Ñ‚Ð¸Ð¿, ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="suppliers">
                                    <div class="entity-card">
                                        <div class="entity-icon">ðŸ‘¥</div>
                                        <div class="entity-info">
                                            <div class="entity-name">ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ¸</div>
                                            <div class="entity-desc">ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ, ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹, Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="inventory">
                                    <div class="entity-card">
                                        <div class="entity-icon">ðŸ“‹</div>
                                        <div class="entity-info">
                                            <div class="entity-name">ÐžÑÑ‚Ð°Ñ‚ÐºÐ¸</div>
                                            <div class="entity-desc">Ð¡ÐºÐ»Ð°Ð´, ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾, Ð»Ð¾ÐºÐ°Ñ†Ð¸Ñ</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="batches">
                                    <div class="entity-card">
                                        <div class="entity-icon">ðŸ·ï¸</div>
                                        <div class="entity-info">
                                            <div class="entity-name">ÐŸÐ°Ñ€Ñ‚Ð¸Ð¸</div>
                                            <div class="entity-desc">ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸, Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð», Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="orders">
                                    <div class="entity-card">
                                        <div class="entity-icon">ðŸ“‘</div>
                                        <div class="entity-info">
                                            <div class="entity-name">Ð—Ð°ÐºÐ°Ð·Ñ‹</div>
                                            <div class="entity-desc">ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð°, ÐºÐ»Ð¸ÐµÐ½Ñ‚, Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="import-section">
                            <h4>2. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð»</h4>
                            <div class="file-upload-area" onclick="document.getElementById('importFileInput').click()">
                                <div class="upload-icon">ðŸ“</div>
                                <div class="upload-text">
                                    <div class="upload-title">ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ñ„Ð°Ð¹Ð»Ð°</div>
                                    <div class="upload-subtitle">ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹: CSV, Excel (.xlsx, .xls), JSON</div>
                                </div>
                                <input type="file" id="importFileInput" style="display: none;" 
                                       accept=".csv,.xlsx,.xls,.json" onchange="handleImportFile(event)">
                            </div>
                            <div id="fileInfo" class="file-info" style="display: none;"></div>
                        </div>

                        <div class="import-section">
                            <h4>3. Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ ÑˆÐ°Ð±Ð»Ð¾Ð½ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)</h4>
                            <div class="template-options">
                                <button class="btn btn-secondary btn-sm" onclick="downloadTemplate('csv')">
                                    ðŸ“„ Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ CSV ÑˆÐ°Ð±Ð»Ð¾Ð½
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="downloadTemplate('excel')">
                                    ðŸ“Š Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Excel ÑˆÐ°Ð±Ð»Ð¾Ð½
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="importStep2" class="import-step" style="display: none;">
                        <div class="import-section">
                            <h4>ÐŸÑ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´Ð°Ð½Ð½Ñ‹Ñ…</h4>
                            <div class="preview-info">
                                <div class="preview-stats">
                                    <span id="previewCount">0</span> Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾ Ðº Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñƒ
                                </div>
                                <div class="preview-actions">
                                    <button class="btn btn-secondary btn-sm" onclick="backToStep1()">
                                        â† ÐÐ°Ð·Ð°Ð´
                                    </button>
                                </div>
                            </div>
                            <div class="preview-table-container">
                                <table class="table" id="previewTable">
                                    <thead id="previewHeader"></thead>
                                    <tbody id="previewBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="import-section">
                            <h4>ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°</h4>
                            <div class="import-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="skipDuplicates" checked>
                                    ÐŸÑ€Ð¾Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ð´ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ‚Ñ‹ (Ð¿Ð¾ ÐºÐ¾Ð´Ñƒ/Ð½Ð¾Ð¼ÐµÑ€Ñƒ)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="updateExisting">
                                    ÐžÐ±Ð½Ð¾Ð²Ð»ÑÑ‚ÑŒ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="validateData" checked>
                                    ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ´ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¾Ð¼
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <div class="btn-group">
                            <button id="nextBtn" class="btn btn-primary" onclick="nextStep()" disabled>
                                Ð”Ð°Ð»ÐµÐµ â†’
                            </button>
                            <button id="importBtn" class="btn btn-success" onclick="executeImport()" style="display: none;">
                                âœ… Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ
                            </button>
                            <button class="btn btn-secondary" onclick="hideModal('importModal')">
                                ÐžÑ‚Ð¼ÐµÐ½Ð°
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detail Modals -->
            
            <!-- Order Detail Modal -->
            <div id="orderDetailModal" class="modal">
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3 id="orderDetailTitle">Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð·Ð°ÐºÐ°Ð·Ð°</h3>
                        <button class="modal-close" onclick="hideModal('orderDetailModal')">&times;</button>
                    </div>
                    
                    <div class="detail-content">
                        <div class="detail-grid">
                            <div class="detail-section">
                                <h4>ðŸ“‹ ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð°:</span>
                                    <span class="detail-value" id="orderNumber">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐšÐ»Ð¸ÐµÐ½Ñ‚:</span>
                                    <span class="detail-value" id="orderCustomer">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:</span>
                                    <span class="detail-value" id="orderStatus">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚:</span>
                                    <span class="detail-value" id="orderPriority">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ“¦ ÐŸÑ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ñ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚:</span>
                                    <span class="detail-value" id="orderProduct">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾:</span>
                                    <span class="detail-value" id="orderQuantity">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð•Ð´Ð¸Ð½Ð¸Ñ†Ð° Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ:</span>
                                    <span class="detail-value" id="orderUnit">Ð¿.Ð¼.</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ“… Ð¡Ñ€Ð¾ÐºÐ¸</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ð”Ð°Ñ‚Ð° Ð·Ð°ÐºÐ°Ð·Ð°:</span>
                                    <span class="detail-value" id="orderDate">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÐ»Ð°Ð½Ð¸Ñ€ÑƒÐµÐ¼Ð°Ñ Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ°:</span>
                                    <span class="detail-value" id="orderDeliveryDate">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð”Ð½ÐµÐ¹ Ð´Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸:</span>
                                    <span class="detail-value" id="orderDaysLeft">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>âš™ï¸ ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ð›Ð¸Ð½Ð¸Ñ:</span>
                                    <span class="detail-value" id="orderLine">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ:</span>
                                    <span class="detail-value" id="orderProgress">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸:</span>
                                    <span class="detail-value" id="orderTimeLeft">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-actions">
                            <button class="btn btn-primary" onclick="editOrder()">âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ</button>
                            <button class="btn btn-success" onclick="startProduction()">â–¶ï¸ ÐÐ°Ñ‡Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾</button>
                            <button class="btn btn-secondary" onclick="printOrder()">ðŸ–¨ï¸ ÐŸÐµÑ‡Ð°Ñ‚ÑŒ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Material Detail Modal -->
            <div id="materialDetailModal" class="modal">
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3 id="materialDetailTitle">Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°</h3>
                        <button class="modal-close" onclick="hideModal('materialDetailModal')">&times;</button>
                    </div>
                    
                    <div class="detail-content">
                        <div class="detail-grid">
                            <div class="detail-section">
                                <h4>ðŸ“¦ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">ÐšÐ¾Ð´ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°:</span>
                                    <span class="detail-value" id="materialCode">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ:</span>
                                    <span class="detail-value" id="materialName">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¢Ð¸Ð¿:</span>
                                    <span class="detail-value" id="materialType">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ“Š ÐžÑÑ‚Ð°Ñ‚ÐºÐ¸ Ð¸ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº:</span>
                                    <span class="detail-value" id="materialCurrentStock">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº:</span>
                                    <span class="detail-value" id="materialMinStock">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¢Ð¾Ñ‡ÐºÐ° Ð¿ÐµÑ€ÐµÐ·Ð°ÐºÐ°Ð·Ð°:</span>
                                    <span class="detail-value" id="materialReorderPoint">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ’° Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:</span>
                                    <span class="detail-value" id="materialCost">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð·Ð°ÐºÑƒÐ¿ÐºÐ°:</span>
                                    <span class="detail-value" id="materialLastPurchase">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-actions">
                            <button class="btn btn-primary" onclick="editMaterial()">âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ</button>
                            <button class="btn btn-warning" onclick="orderMaterial()">ðŸ“¦ Ð—Ð°ÐºÐ°Ð·Ð°Ñ‚ÑŒ</button>
                            <button class="btn btn-secondary" onclick="viewMaterialHistory()">ðŸ“ˆ Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Production Line Detail Modal -->
            <div id="lineDetailModal" class="modal">
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <h3 id="lineDetailTitle">Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð¹ Ð»Ð¸Ð½Ð¸Ð¸</h3>
                        <button class="modal-close" onclick="hideModal('lineDetailModal')">&times;</button>
                    </div>
                    
                    <div class="detail-content">
                        <div class="detail-grid">
                            <div class="detail-section">
                                <h4>âš™ï¸ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð»Ð¸Ð½Ð¸Ð¸</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ð›Ð¸Ð½Ð¸Ñ:</span>
                                    <span class="detail-value" id="lineName">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:</span>
                                    <span class="detail-value" id="lineStatus">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ Ð·Ð°ÐºÐ°Ð·:</span>
                                    <span class="detail-value" id="lineCurrentOrder">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ“Š ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ:</span>
                                    <span class="detail-value" id="lineProgress">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ:</span>
                                    <span class="detail-value" id="lineSpeed">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸:</span>
                                    <span class="detail-value" id="lineTimeLeft">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ‘¨â€ðŸ”§ ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ñ‹</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¡Ð¼ÐµÐ½Ð°:</span>
                                    <span class="detail-value" id="lineShift">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ 1:</span>
                                    <span class="detail-value" id="lineOperator1">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐžÐ¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€ 2:</span>
                                    <span class="detail-value" id="lineOperator2">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section full-width">
                                <h4>ðŸ“ˆ Ð“Ñ€Ð°Ñ„Ð¸Ðº ÑÐµÐ³Ð¾Ð´Ð½Ñ</h4>
                                <div class="line-schedule">
                                    <div class="schedule-item completed">
                                        <span class="schedule-time">08:00-12:00</span>
                                        <span class="schedule-order">ORD-240001</span>
                                        <span class="schedule-status">Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾</span>
                                    </div>
                                    <div class="schedule-item current">
                                        <span class="schedule-time">12:00-18:00</span>
                                        <span class="schedule-order">ORD-240002</span>
                                        <span class="schedule-status">Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ</span>
                                    </div>
                                    <div class="schedule-item planned">
                                        <span class="schedule-time">18:00-22:00</span>
                                        <span class="schedule-order">ORD-240003</span>
                                        <span class="schedule-status">Ð—Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-actions">
                            <button class="btn btn-success" onclick="startLineProduction()">â–¶ï¸ Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ</button>
                            <button class="btn btn-warning" onclick="pauseLineProduction()">â¸ï¸ ÐŸÐ°ÑƒÐ·Ð°</button>
                            <button class="btn btn-danger" onclick="stopLineProduction()">â¹ï¸ ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ</button>
                            <button class="btn btn-secondary" onclick="lineSettings()">âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Warehouse Item Detail Modal -->
            <div id="warehouseDetailModal" class="modal">
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h3 id="warehouseDetailTitle">Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° Ð½Ð° ÑÐºÐ»Ð°Ð´Ðµ</h3>
                        <button class="modal-close" onclick="hideModal('warehouseDetailModal')">&times;</button>
                    </div>
                    
                    <div class="detail-content">
                        <div class="detail-grid">
                            <div class="detail-section">
                                <h4>ðŸ“¦ ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»</h4>
                                <div class="detail-item">
                                    <span class="detail-label">ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ:</span>
                                    <span class="detail-value" id="warehouseMaterialName">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾:</span>
                                    <span class="detail-value" id="warehouseMaterialQuantity">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:</span>
                                    <span class="detail-value" id="warehouseMaterialStatus">-</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ“ Ð Ð°Ð·Ð¼ÐµÑ‰ÐµÐ½Ð¸Ðµ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">Ð—Ð¾Ð½Ð° ÑÐºÐ»Ð°Ð´Ð°:</span>
                                    <span class="detail-value" id="warehouseZone">A1</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¡Ñ‚ÐµÐ»Ð»Ð°Ð¶:</span>
                                    <span class="detail-value" id="warehouseRack">05</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ð¯Ñ‡ÐµÐ¹ÐºÐ°:</span>
                                    <span class="detail-value" id="warehouseCell">02</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>ðŸ“… Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ</h4>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¿Ð¾ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ðµ:</span>
                                    <span class="detail-value" id="warehouseLastReceived">15.01.2024</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ñ€Ð°ÑÑ…Ð¾Ð´:</span>
                                    <span class="detail-value" id="warehouseLastUsed">20.01.2024</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-actions">
                            <button class="btn btn-primary" onclick="moveWarehouseItem()">ðŸ“¦ ÐŸÐµÑ€ÐµÐ¼ÐµÑÑ‚Ð¸Ñ‚ÑŒ</button>
                            <button class="btn btn-warning" onclick="adjustStock()">âš–ï¸ ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²ÐºÐ°</button>
                            <button class="btn btn-secondary" onclick="printWarehouseLabel()">ðŸ·ï¸ Ð­Ñ‚Ð¸ÐºÐµÑ‚ÐºÐ°</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CRUD Modals -->
            
            <!-- Material Modal -->
            <div id="materialModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</h3>
                        <button class="modal-close" onclick="hideModal('materialModal')">&times;</button>
                    </div>
                    
                    <form id="materialForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="materialCode">ÐšÐ¾Ð´ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° *</label>
                                <input type="text" id="materialCode" name="code" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialName">ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ *</label>
                                <input type="text" id="materialName" name="name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialType">Ð¢Ð¸Ð¿ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° *</label>
                                <select id="materialType" name="type" required>
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¸Ð¿</option>
                                    <option value="granulate_ldpe">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð”</option>
                                    <option value="granulate_hdpe">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐÐ”</option>
                                    <option value="granulate_pp">Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐŸ</option>
                                    <option value="film_pet">ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢</option>
                                    <option value="film_ldpe">ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ’Ð”</option>
                                    <option value="dye">ÐšÑ€Ð°ÑÐ¸Ñ‚ÐµÐ»ÑŒ</option>
                                    <option value="additive">Ð”Ð¾Ð±Ð°Ð²ÐºÐ°</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialUnit">Ð•Ð´Ð¸Ð½Ð¸Ñ†Ð° Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ *</label>
                                <select id="materialUnit" name="unit" required>
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐµÐ´Ð¸Ð½Ð¸Ñ†Ñƒ</option>
                                    <option value="ÐºÐ³">ÐºÐ³</option>
                                    <option value="Ñ‚">Ñ‚</option>
                                    <option value="Ð¼">Ð¼</option>
                                    <option value="Ð¿.Ð¼.">Ð¿.Ð¼.</option>
                                    <option value="ÑˆÑ‚">ÑˆÑ‚</option>
                                    <option value="Ð»">Ð»</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="materialCost">Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ (â‚½)</label>
                                <input type="number" id="materialCost" name="standard_cost" step="0.01" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="materialMinStock">ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº</label>
                                <input type="number" id="materialMinStock" name="min_stock_level" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="materialReorderPoint">Ð¢Ð¾Ñ‡ÐºÐ° Ð¿ÐµÑ€ÐµÐ·Ð°ÐºÐ°Ð·Ð°</label>
                                <input type="number" id="materialReorderPoint" name="reorder_point" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="materialSupplier">ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº</label>
                                <select id="materialSupplier" name="supplier_id">
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="materialDescription">ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ</label>
                                <textarea id="materialDescription" name="description" rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('materialModal')">ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Supplier Modal -->
            <div id="supplierModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</h3>
                        <button class="modal-close" onclick="hideModal('supplierModal')">&times;</button>
                    </div>
                    
                    <form id="supplierForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="supplierCode">ÐšÐ¾Ð´ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ° *</label>
                                <input type="text" id="supplierCode" name="code" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="supplierName">ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ *</label>
                                <input type="text" id="supplierName" name="name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="supplierContact">ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð½Ð¾Ðµ Ð»Ð¸Ñ†Ð¾</label>
                                <input type="text" id="supplierContact" name="contact_person">
                            </div>
                            
                            <div class="form-group">
                                <label for="supplierEmail">Email</label>
                                <input type="email" id="supplierEmail" name="email">
                            </div>
                            
                            <div class="form-group">
                                <label for="supplierPhone">Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½</label>
                                <input type="tel" id="supplierPhone" name="phone">
                            </div>
                            
                            <div class="form-group">
                                <label for="supplierActive">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</label>
                                <select id="supplierActive" name="is_active">
                                    <option value="true">ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹</option>
                                    <option value="false">ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹</option>
                                </select>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="supplierAddress">ÐÐ´Ñ€ÐµÑ</label>
                                <textarea id="supplierAddress" name="address" rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('supplierModal')">ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Inventory Modal -->
            <div id="inventoryModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº</h3>
                        <button class="modal-close" onclick="hideModal('inventoryModal')">&times;</button>
                    </div>
                    
                    <form id="inventoryForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="inventoryMaterialSelect">ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð» *</label>
                                <select id="inventoryMaterialSelect" name="material_id" required>
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="inventoryWarehouse">Ð¡ÐºÐ»Ð°Ð´ *</label>
                                <select id="inventoryWarehouse" name="warehouse" required>
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐºÐ»Ð°Ð´</option>
                                    <option value="MAG-1">Ð¡ÐºÐ»Ð°Ð´ ÑÑ‹Ñ€ÑŒÑ</option>
                                    <option value="MAG-2">Ð¡ÐºÐ»Ð°Ð´ Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð¹ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ†Ð¸Ð¸</option>
                                    <option value="MAG-3">Ð¡ÐºÐ»Ð°Ð´ ÑƒÐ¿Ð°ÐºÐ¾Ð²ÐºÐ¸</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="inventoryBatch">ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸</label>
                                <input type="text" id="inventoryBatch" name="batch_number">
                            </div>
                            
                            <div class="form-group">
                                <label for="inventoryQuantity">ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ *</label>
                                <input type="number" id="inventoryQuantity" name="quantity" required min="0" step="0.01">
                            </div>
                            
                            <div class="form-group">
                                <label for="inventoryReserved">Ð—Ð°Ñ€ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾</label>
                                <input type="number" id="inventoryReserved" name="reserved_quantity" min="0" step="0.01" value="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="inventoryLocation">ÐšÐ¾Ð´ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸</label>
                                <input type="text" id="inventoryLocation" name="location_code" placeholder="A1-05-02">
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('inventoryModal')">ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Batch Modal -->
            <div id="batchModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÐŸÑ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ð°Ñ€Ñ‚Ð¸ÑŽ</h3>
                        <button class="modal-close" onclick="hideModal('batchModal')">&times;</button>
                    </div>
                    
                    <form id="batchForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="batchNumber">ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸ *</label>
                                <input type="text" id="batchNumber" name="batch_number" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="batchMaterialSelect">ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð» *</label>
                                <select id="batchMaterialSelect" name="material_id" required>
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="batchSupplierSelect">ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº *</label>
                                <select id="batchSupplierSelect" name="supplier_id" required>
                                    <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="batchQuantity">ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ *</label>
                                <input type="number" id="batchQuantity" name="received_quantity" required min="0" step="0.01">
                            </div>
                            
                            <div class="form-group">
                                <label for="batchProductionDate">Ð”Ð°Ñ‚Ð° Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°</label>
                                <input type="date" id="batchProductionDate" name="production_date">
                            </div>
                            
                            <div class="form-group">
                                <label for="batchReceivedDate">Ð”Ð°Ñ‚Ð° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ *</label>
                                <input type="date" id="batchReceivedDate" name="received_date" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="batchQualityStatus">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°</label>
                                <select id="batchQualityStatus" name="quality_status">
                                    <option value="pending">ÐÐ° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐµ</option>
                                    <option value="approved">ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¾</option>
                                    <option value="rejected">ÐžÑ‚ÐºÐ»Ð¾Ð½ÐµÐ½Ð¾</option>
                                    <option value="quarantine">ÐšÐ°Ñ€Ð°Ð½Ñ‚Ð¸Ð½</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('batchModal')">ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Order Modal -->
            <div id="orderModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·</h3>
                        <button class="modal-close" onclick="hideModal('orderModal')">&times;</button>
                    </div>
                    
                    <form id="orderForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="orderNumber">ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð° *</label>
                                <input type="text" id="orderNumber" name="order_number" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="orderCustomer">ÐšÐ»Ð¸ÐµÐ½Ñ‚ *</label>
                                <input type="text" id="orderCustomer" name="customer" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="orderProduct">ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚ *</label>
                                <input type="text" id="orderProduct" name="product" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="orderQuantity">ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ *</label>
                                <input type="number" id="orderQuantity" name="quantity" required min="0" step="0.01">
                            </div>
                            
                            <div class="form-group">
                                <label for="orderDate">Ð”Ð°Ñ‚Ð° Ð·Ð°ÐºÐ°Ð·Ð° *</label>
                                <input type="date" id="orderDate" name="order_date" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="orderDeliveryDate">Ð”Ð°Ñ‚Ð° Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸</label>
                                <input type="date" id="orderDeliveryDate" name="delivery_date">
                            </div>
                            
                            <div class="form-group">
                                <label for="orderStatus">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</label>
                                <select id="orderStatus" name="status">
                                    <option value="new">ÐÐ¾Ð²Ñ‹Ð¹</option>
                                    <option value="in_progress">Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ</option>
                                    <option value="completed">Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½</option>
                                    <option value="cancelled">ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="orderPriority">ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚</label>
                                <select id="orderPriority" name="priority">
                                    <option value="low">ÐÐ¸Ð·ÐºÐ¸Ð¹</option>
                                    <option value="medium">Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹</option>
                                    <option value="high">Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹</option>
                                    <option value="urgent">ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ñ‹Ð¹</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('orderModal')">ÐžÑ‚Ð¼ÐµÐ½Ð°</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- File input for old import (backup) -->
            <input type="file" id="fileInput" style="display: none;" accept=".json" onchange="handleFileImport(event)">

    <script>
        // =============================================
        // DATA STORAGE AND MANAGEMENT
        // =============================================
        
        class ERPStorage {
            constructor() {
                this.storageKey = 'mpsystem_erp_data';
                this.init();
            }

            init() {
                if (!localStorage.getItem(this.storageKey)) {
                    this.initializeWithSampleData();
                }
                this.updateStorageStatus();
                this.initializeProductionRules();
                this.initializeProcurementData();
            }

            // Initialize production rules and recipes
            initializeProductionRules() {
                const data = this.getData();
                if (!data.production_recipes) {
                    data.production_recipes = this.getDefaultProductionRecipes();
                    data.production_lines = this.getDefaultProductionLines();
                    data.production_queue = [
                        {
                            id: 1,
                            order_id: 1,
                            order_number: 'ORD-240001',
                            line_id: 'line-2',
                            product: 'ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ñ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð¾Ð¼',
                            quantity: 5000,
                            estimated_start: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(),
                            estimated_completion: new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(),
                            setup_time: 45,
                            production_time: 100,
                            status: 'queued',
                            priority: 'high'
                        }
                    ];
                    this.setData(data);
                }
            }

            getDefaultProductionRecipes() {
                return [
                    {
                        id: 1,
                        product_name: 'ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢ 12Ð¼ÐºÐ¼',
                        line_type: 'extrusion',
                        materials_required: [
                            { material_code: 'GR-PET-001', quantity_per_unit: 1.1 }, // ÐºÐ³ Ð½Ð° Ð¿.Ð¼.
                            { material_code: 'DYE-CLEAR', quantity_per_unit: 0.01 }
                        ],
                        production_time_per_unit: 0.1, // Ð¼Ð¸Ð½ÑƒÑ‚ Ð½Ð° Ð¿.Ð¼.
                        setup_time: 30 // Ð¼Ð¸Ð½ÑƒÑ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
                    },
                    {
                        id: 2,
                        product_name: 'ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ñ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð¾Ð¼',
                        line_type: 'printing',
                        materials_required: [
                            { material_code: 'GR-PVD-001', quantity_per_unit: 0.05 }, // ÐºÐ³ Ð½Ð° ÑˆÑ‚ÑƒÐºÑƒ
                            { material_code: 'DYE-BLUE', quantity_per_unit: 0.001 }
                        ],
                        production_time_per_unit: 0.02, // Ð¼Ð¸Ð½ÑƒÑ‚ Ð½Ð° ÑˆÑ‚ÑƒÐºÑƒ
                        setup_time: 45
                    },
                    {
                        id: 3,
                        product_name: 'Ð¡Ñ‚Ñ€ÐµÐ¹Ñ‡-Ð¿Ð»ÐµÐ½ÐºÐ° 500Ð¼Ð¼',
                        line_type: 'extrusion',
                        materials_required: [
                            { material_code: 'GR-LLDPE-001', quantity_per_unit: 1.0 }
                        ],
                        production_time_per_unit: 0.15,
                        setup_time: 20
                    }
                ];
            }

            getDefaultProductionLines() {
                return [
                    {
                        id: 'line-1',
                        name: 'Ð›Ð¸Ð½Ð¸Ñ 1 - Ð­ÐºÑÑ‚Ñ€ÑƒÐ·Ð¸Ñ',
                        type: 'extrusion',
                        status: 'running',
                        current_order: 'ORD-240001',
                        capacity_per_hour: 600, // ÐµÐ´Ð¸Ð½Ð¸Ñ† Ð² Ñ‡Ð°Ñ
                        operators: ['Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜.Ð˜.', 'ÐŸÐµÑ‚Ñ€Ð¾Ð² ÐŸ.ÐŸ.'],
                        shift: 'day'
                    },
                    {
                        id: 'line-2',
                        name: 'Ð›Ð¸Ð½Ð¸Ñ 2 - ÐŸÐµÑ‡Ð°Ñ‚ÑŒ',
                        type: 'printing',
                        status: 'running',
                        current_order: 'ORD-240002',
                        capacity_per_hour: 3000, // ÐµÐ´Ð¸Ð½Ð¸Ñ† Ð² Ñ‡Ð°Ñ
                        operators: ['Ð¡Ð¸Ð´Ð¾Ñ€Ð¾Ð² Ð¡.Ð¡.', 'Ð¤ÐµÐ´Ð¾Ñ€Ð¾Ð² Ð¤.Ð¤.'],
                        shift: 'day'
                    },
                    {
                        id: 'line-3',
                        name: 'Ð›Ð¸Ð½Ð¸Ñ 3 - Ð›Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ',
                        type: 'lamination',
                        status: 'maintenance',
                        current_order: null,
                        capacity_per_hour: 400,
                        operators: ['ÐŸÐµÑ‚Ñ€Ð¾Ð² Ð.Ð˜.'],
                        shift: 'day'
                    }
                ];
            }

            initializeProcurementData() {
                const data = this.getData();
                if (!data.procurement_requirements) {
                    data.procurement_requirements = [];
                    data.purchase_orders = [];
                    data.supplier_contracts = this.getDefaultContracts();
                    data.price_history = [];
                    data.delivery_schedule = [];
                    this.setData(data);
                }
            }

            getDefaultContracts() {
                return [
                    {
                        id: 1,
                        supplier_id: 1,
                        material_id: 1, // GR-PVD-001
                        contract_number: 'CTR-2024-001',
                        price: 240.00,
                        currency: 'PLN',
                        moq: 1000, // minimum order quantity
                        lead_time_days: 7,
                        payment_terms: '30 dni',
                        valid_from: '2024-01-01',
                        valid_to: '2024-12-31',
                        discount_tiers: [
                            { min_quantity: 5000, discount_percent: 2 },
                            { min_quantity: 10000, discount_percent: 5 }
                        ],
                        status: 'active'
                    },
                    {
                        id: 2,
                        supplier_id: 1,
                        material_id: 2, // GR-PET-001
                        contract_number: 'CTR-2024-002',
                        price: 300.00,
                        currency: 'PLN',
                        moq: 800,
                        lead_time_days: 10,
                        payment_terms: '30 dni',
                        valid_from: '2024-01-01',
                        valid_to: '2024-12-31',
                        status: 'active'
                    }
                ];
            }

            initializeWithSampleData() {
                const sampleData = {
                    materials: [
                        {
                            id: 1,
                            code: 'GR-PVD-001',
                            name: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð” LDPE 020C Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹',
                            type: 'granulate_ldpe',
                            unit: 'ÐºÐ³',
                            description: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ Ð¿Ð¾Ð»Ð¸ÑÑ‚Ð¸Ð»ÐµÐ½Ð° Ð½Ð¸Ð·ÐºÐ¾Ð³Ð¾ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾Ð¹ Ð¿Ð»ÐµÐ½ÐºÐ¸',
                            standard_cost: 245.50,
                            min_stock_level: 1000.0,
                            reorder_point: 2000.0,
                            supplier_id: 1,
                            is_active: true,
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 2,
                            code: 'GR-PET-001',
                            name: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ­Ð¢ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹',
                            type: 'granulate_pet',
                            unit: 'ÐºÐ³',
                            description: 'ÐŸÐ­Ð¢ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð¿Ð»ÐµÐ½ÐºÐ¸',
                            standard_cost: 310.00,
                            min_stock_level: 800.0,
                            reorder_point: 1500.0,
                            supplier_id: 1,
                            is_active: true,
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 3,
                            code: 'DYE-CLEAR',
                            name: 'Ð¡Ñ‚Ð°Ð±Ð¸Ð»Ð¸Ð·Ð°Ñ‚Ð¾Ñ€ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹',
                            type: 'additive',
                            unit: 'ÐºÐ³',
                            description: 'Ð¡Ñ‚Ð°Ð±Ð¸Ð»Ð¸Ð·Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ñ… Ð¿Ð»ÐµÐ½Ð¾Ðº',
                            standard_cost: 890.00,
                            min_stock_level: 100.0,
                            reorder_point: 200.0,
                            supplier_id: 2,
                            is_active: true,
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 4,
                            code: 'DYE-BLUE',
                            name: 'ÐšÑ€Ð°ÑÐ¸Ñ‚ÐµÐ»ÑŒ ÑÐ¸Ð½Ð¸Ð¹',
                            type: 'dye',
                            unit: 'ÐºÐ³',
                            description: 'ÐšÐ¾Ð½Ñ†ÐµÐ½Ñ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÐºÑ€Ð°ÑÐ¸Ñ‚ÐµÐ»ÑŒ Ð´Ð»Ñ Ð¿Ð¾Ð»Ð¸Ð¼ÐµÑ€Ð¾Ð²',
                            standard_cost: 1250.00,
                            min_stock_level: 50.0,
                            reorder_point: 100.0,
                            supplier_id: 2,
                            is_active: true,
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 5,
                            code: 'GR-LLDPE-001',
                            name: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ Ð›ÐŸÐ­ÐÐŸ',
                            type: 'granulate_lldpe',
                            unit: 'ÐºÐ³',
                            description: 'Ð›Ð¸Ð½ÐµÐ¹Ð½Ñ‹Ð¹ Ð¿Ð¾Ð»Ð¸ÑÑ‚Ð¸Ð»ÐµÐ½ Ð½Ð¸Ð·ÐºÐ¾Ð¹ Ð¿Ð»Ð¾Ñ‚Ð½Ð¾ÑÑ‚Ð¸',
                            standard_cost: 267.00,
                            min_stock_level: 600.0,
                            reorder_point: 1200.0,
                            supplier_id: 1,
                            is_active: true,
                            created_at: new Date().toISOString()
                        }
                    ],
                    suppliers: [
                        {
                            id: 1,
                            code: 'SUP001',
                            name: 'Dow Chemical Europe',
                            contact_person: 'John Smith',
                            email: 'john.smith@dow.com',
                            phone: '+49-123-456789',
                            address: 'Industrial Park, Germany',
                            rating_delivery: 98.5,
                            rating_quality: 99.2,
                            rating_documents: 100.0,
                            rating_cooperation: 85.0,
                            overall_rating: 95.8,
                            is_active: true,
                            is_approved: true,
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 2,
                            code: 'SUP002',
                            name: 'Siegwerk Druckfarben',
                            contact_person: 'Klaus Mueller',
                            email: 'k.mueller@siegwerk.com',
                            phone: '+49-2241-304-0',
                            address: 'Siegburg, Germany',
                            rating_delivery: 92.8,
                            rating_quality: 98.5,
                            rating_documents: 96.0,
                            rating_cooperation: 90.0,
                            overall_rating: 94.5,
                            is_active: true,
                            is_approved: true,
                            created_at: new Date().toISOString()
                        }
                    ],
                    inventory: [
                        {
                            id: 1,
                            material_id: 1, // GR-PVD-001
                            warehouse: 'MAG-1',
                            batch_number: '240115-001',
                            quantity: 2500.0,
                            reserved_quantity: 250.0,
                            available_quantity: 2250.0,
                            location_code: 'A1-05-02',
                            reservations: [
                                {
                                    order_id: 1,
                                    quantity: 250.0,
                                    reserved_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()
                                }
                            ],
                            last_movement_date: new Date().toISOString()
                        },
                        {
                            id: 2,
                            material_id: 2, // GR-PET-001
                            warehouse: 'MAG-1',
                            batch_number: '240118-002',
                            quantity: 3000.0,
                            reserved_quantity: 0.0,
                            available_quantity: 3000.0,
                            location_code: 'A2-04-01',
                            last_movement_date: new Date().toISOString()
                        },
                        {
                            id: 3,
                            material_id: 3, // DYE-CLEAR
                            warehouse: 'MAG-1',
                            batch_number: '240120-003',
                            quantity: 200.0,
                            reserved_quantity: 0.0,
                            available_quantity: 200.0,
                            location_code: 'C1-01-01',
                            last_movement_date: new Date().toISOString()
                        },
                        {
                            id: 4,
                            material_id: 4, // DYE-BLUE
                            warehouse: 'MAG-1',
                            batch_number: '240120-004',
                            quantity: 150.0,
                            reserved_quantity: 5.0,
                            available_quantity: 145.0,
                            location_code: 'C1-01-02',
                            reservations: [
                                {
                                    order_id: 1,
                                    quantity: 5.0,
                                    reserved_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()
                                }
                            ],
                            last_movement_date: new Date().toISOString()
                        },
                        {
                            id: 5,
                            material_id: 5, // GR-LLDPE-001
                            warehouse: 'MAG-1',
                            batch_number: '240119-005',
                            quantity: 1800.0,
                            reserved_quantity: 0.0,
                            available_quantity: 1800.0,
                            location_code: 'A3-02-01',
                            last_movement_date: new Date().toISOString()
                        }
                    ],
                    batches: [
                        {
                            id: 1,
                            batch_number: '240115-001',
                            material_id: 1, // GR-PVD-001
                            supplier_id: 1,
                            received_quantity: 2500.0,
                            available_quantity: 2500.0,
                            production_date: '2024-01-10',
                            received_date: '2024-01-15',
                            quality_status: 'approved',
                            has_coa: true,
                            has_tds: true,
                            has_sds: true,
                            has_doc: true,
                            expiry_date: '2025-01-10',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 2,
                            batch_number: '240118-002',
                            material_id: 2, // GR-PET-001
                            supplier_id: 1,
                            received_quantity: 3000.0,
                            available_quantity: 3000.0,
                            production_date: '2024-01-12',
                            received_date: '2024-01-18',
                            quality_status: 'approved',
                            has_coa: true,
                            has_tds: true,
                            has_sds: true,
                            has_doc: true,
                            expiry_date: '2025-01-12',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 3,
                            batch_number: '240120-003',
                            material_id: 3, // DYE-CLEAR
                            supplier_id: 2,
                            received_quantity: 200.0,
                            available_quantity: 200.0,
                            production_date: '2024-01-15',
                            received_date: '2024-01-20',
                            quality_status: 'approved',
                            has_coa: true,
                            has_tds: true,
                            has_sds: true,
                            has_doc: true,
                            expiry_date: '2025-01-15',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 4,
                            batch_number: '240120-004',
                            material_id: 4, // DYE-BLUE
                            supplier_id: 2,
                            received_quantity: 150.0,
                            available_quantity: 150.0,
                            production_date: '2024-01-15',
                            received_date: '2024-01-20',
                            quality_status: 'approved',
                            has_coa: true,
                            has_tds: true,
                            has_sds: true,
                            has_doc: true,
                            expiry_date: '2025-01-15',
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 5,
                            batch_number: '240119-005',
                            material_id: 5, // GR-LLDPE-001
                            supplier_id: 1,
                            received_quantity: 1800.0,
                            available_quantity: 1800.0,
                            production_date: '2024-01-14',
                            received_date: '2024-01-19',
                            quality_status: 'approved',
                            has_coa: true,
                            has_tds: true,
                            has_sds: true,
                            has_doc: true,
                            has_cmr: true,
                            created_at: new Date().toISOString()
                        }
                    ],
                    orders: [
                        {
                            id: 1,
                            order_number: 'ORD-240001',
                            customer: 'ÐžÐžÐž "ÐÐ»ÑŒÑ„Ð° ÐŸÐ°ÐºÐµÑ‚"',
                            product: 'ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ñ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð¾Ð¼',
                            quantity: 5000,
                            unit: 'ÑˆÑ‚',
                            priority: 'high',
                            status: 'scheduled',
                            delivery_date: '2024-02-15',
                            materials_reserved: true,
                            production_scheduled: true,
                            scheduled_line: 'line-2',
                            estimated_start: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(),
                            estimated_completion: new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(),
                            material_requirements: [
                                { material_code: 'GR-PVD-001', required_quantity: 250, unit: 'ÐºÐ³' },
                                { material_code: 'DYE-BLUE', required_quantity: 5, unit: 'ÐºÐ³' }
                            ],
                            created_at: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString()
                        }
                    ],
                    activities: [
                        {
                            id: 1,
                            type: 'material_created',
                            description: 'Ð¡Ð¾Ð·Ð´Ð°Ð½ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» GR-PVD-001',
                            timestamp: new Date().toISOString()
                        }
                    ]
                };

                this.setData(sampleData);
                this.addActivity('system_init', 'Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ñ Ð¾Ð±Ñ€Ð°Ð·Ñ†Ð¾Ð²Ñ‹Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸');
            }

            getData() {
                try {
                    return JSON.parse(localStorage.getItem(this.storageKey)) || {};
                } catch (e) {
                    console.error('Error parsing storage data:', e);
                    return {};
                }
            }

            setData(data) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(data));
                    this.updateStorageStatus();
                    return true;
                } catch (e) {
                    console.error('Error saving to storage:', e);
                    showToast('ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…', 'error');
                    return false;
                }
            }

            getTable(tableName) {
                const data = this.getData();
                return data[tableName] || [];
            }

            setTable(tableName, tableData) {
                const data = this.getData();
                data[tableName] = tableData;
                return this.setData(data);
            }

            addRecord(tableName, record) {
                const table = this.getTable(tableName);
                const newId = table.length > 0 ? Math.max(...table.map(r => r.id)) + 1 : 1;
                const newRecord = {
                    id: newId,
                    ...record,
                    created_at: new Date().toISOString()
                };
                table.push(newRecord);
                this.setTable(tableName, table);
                return newRecord;
            }

            updateRecord(tableName, id, updates) {
                const table = this.getTable(tableName);
                const index = table.findIndex(r => r.id === id);
                if (index !== -1) {
                    table[index] = { ...table[index], ...updates, updated_at: new Date().toISOString() };
                    this.setTable(tableName, table);
                    return table[index];
                }
                return null;
            }

            deleteRecord(tableName, id) {
                const table = this.getTable(tableName);
                const filteredTable = table.filter(r => r.id !== id);
                this.setTable(tableName, filteredTable);
                return true;
            }

            addActivity(type, description) {
                const activities = this.getTable('activities');
                const newActivity = {
                    id: activities.length + 1,
                    type,
                    description,
                    timestamp: new Date().toISOString()
                };
                activities.unshift(newActivity); // Add to beginning
                activities.splice(10); // Keep only last 10
                this.setTable('activities', activities);
            }

            updateStorageStatus() {
                const data = this.getData();
                const size = new Blob([JSON.stringify(data)]).size;
                const statusElement = document.getElementById('storageStatus');
                if (statusElement) {
                    statusElement.textContent = `ðŸ’¾ Local Storage (${(size / 1024).toFixed(1)} KB)`;
                }
            }

            exportData() {
                const data = this.getData();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mpsystem_erp_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast('Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹', 'success');
            }

            // =============================================
            // BUSINESS LOGIC METHODS
            // =============================================

            processOrder(orderData) {
                // 1. Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°ÐºÐ°Ð·
                const order = this.addRecord('orders', {
                    ...orderData,
                    status: 'new',
                    created_at: new Date().toISOString(),
                    materials_reserved: false,
                    production_scheduled: false
                });

                // 2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ€ÐµÑ†ÐµÐ¿Ñ‚ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°
                const recipe = this.findProductionRecipe(order.product);
                if (!recipe) {
                    this.addActivity('order_warning', `Ð—Ð°ÐºÐ°Ð· ${order.order_number}: Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ñ€ÐµÑ†ÐµÐ¿Ñ‚ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð´Ð»Ñ ${order.product}`);
                    return { success: false, message: 'Ð ÐµÑ†ÐµÐ¿Ñ‚ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½', order: order };
                }

                // 3. Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð½Ð¾ÑÑ‚ÑŒ Ð² Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°Ñ…
                const materialRequirements = this.calculateMaterialRequirements(recipe, order.quantity);
                
                // 4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²
                const materialCheck = this.checkMaterialAvailability(materialRequirements);
                if (!materialCheck.available) {
                    this.addActivity('order_warning', `Ð—Ð°ÐºÐ°Ð· ${order.order_number}: Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð² - ${materialCheck.missing.join(', ')}`);
                    return { 
                        success: false, 
                        message: 'ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²', 
                        missing: materialCheck.missing,
                        order: order
                    };
                }

                // 5. Ð ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹
                this.reserveMaterials(order.id, materialRequirements);
                this.updateRecord('orders', order.id, { 
                    materials_reserved: true,
                    status: 'materials_reserved',
                    material_requirements: materialRequirements
                });

                // 6. ÐŸÐ»Ð°Ð½Ð¸Ñ€ÑƒÐµÐ¼ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾
                const productionPlan = this.scheduleProduction(order, recipe);
                if (productionPlan.success) {
                    this.updateRecord('orders', order.id, { 
                        production_scheduled: true,
                        scheduled_line: productionPlan.line_id,
                        estimated_start: productionPlan.start_time,
                        estimated_completion: productionPlan.completion_time,
                        status: 'scheduled'
                    });
                }

                this.addActivity('order_processed', `Ð—Ð°ÐºÐ°Ð· ${order.order_number} Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½ Ð¸ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð½Ð° ${productionPlan.line_name}`);
                
                return { 
                    success: true, 
                    order: order,
                    production_plan: productionPlan,
                    material_requirements: materialRequirements
                };
            }

            findProductionRecipe(productName) {
                const data = this.getData();
                return data.production_recipes.find(recipe => 
                    recipe.product_name.toLowerCase().includes(productName.toLowerCase()) ||
                    productName.toLowerCase().includes(recipe.product_name.toLowerCase())
                );
            }

            calculateMaterialRequirements(recipe, quantity) {
                return recipe.materials_required.map(material => ({
                    material_code: material.material_code,
                    required_quantity: material.quantity_per_unit * quantity,
                    unit: 'ÐºÐ³'
                }));
            }

            checkMaterialAvailability(requirements) {
                const data = this.getData();
                const missing = [];
                let available = true;

                requirements.forEach(req => {
                    const material = data.materials.find(m => m.code === req.material_code);
                    if (!material) {
                        missing.push(`${req.material_code} (Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½)`);
                        available = false;
                        return;
                    }

                    // Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº
                    const inventory = data.inventory.filter(inv => inv.material_id === material.id);
                    const totalAvailable = inventory.reduce((sum, inv) => 
                        sum + (inv.quantity - (inv.reserved_quantity || 0)), 0
                    );

                    if (totalAvailable < req.required_quantity) {
                        missing.push(`${material.name} (Ð½ÑƒÐ¶Ð½Ð¾: ${req.required_quantity}, Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾: ${totalAvailable})`);
                        available = false;
                    }
                });

                return { available, missing };
            }

            reserveMaterials(orderId, requirements) {
                const data = this.getData();
                
                requirements.forEach(req => {
                    const material = data.materials.find(m => m.code === req.material_code);
                    if (!material) return;

                    let remainingToReserve = req.required_quantity;
                    
                    // Ð ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹ Ð¿Ð¾ FIFO
                    const availableInventory = data.inventory
                        .filter(inv => inv.material_id === material.id)
                        .filter(inv => (inv.quantity - (inv.reserved_quantity || 0)) > 0);

                    availableInventory.forEach(inv => {
                        if (remainingToReserve <= 0) return;

                        const available = inv.quantity - (inv.reserved_quantity || 0);
                        const toReserve = Math.min(available, remainingToReserve);
                        
                        inv.reserved_quantity = (inv.reserved_quantity || 0) + toReserve;
                        remainingToReserve -= toReserve;
                    });
                });

                this.setData(data);
            }

            scheduleProduction(order, recipe) {
                const data = this.getData();
                
                // ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÑƒÑŽ Ð»Ð¸Ð½Ð¸ÑŽ
                const suitableLines = data.production_lines.filter(line => 
                    line.type === recipe.line_type && line.status !== 'maintenance'
                );

                if (suitableLines.length === 0) {
                    return { 
                        success: false, 
                        message: `ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… Ð»Ð¸Ð½Ð¸Ð¹ Ñ‚Ð¸Ð¿Ð° ${recipe.line_type}` 
                    };
                }

                // Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½ÑƒÑŽ Ð»Ð¸Ð½Ð¸ÑŽ
                const selectedLine = suitableLines[0];
                
                // Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°
                const productionTime = recipe.setup_time + (recipe.production_time_per_unit * order.quantity);
                const startTime = new Date();
                const completionTime = new Date(startTime.getTime() + productionTime * 60000);

                // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°
                if (!data.production_queue) data.production_queue = [];
                
                const queueItem = {
                    id: Date.now(),
                    order_id: order.id,
                    order_number: order.order_number,
                    line_id: selectedLine.id,
                    product: order.product,
                    quantity: order.quantity,
                    estimated_start: startTime.toISOString(),
                    estimated_completion: completionTime.toISOString(),
                    setup_time: recipe.setup_time,
                    production_time: productionTime - recipe.setup_time,
                    status: 'queued',
                    priority: order.priority || 'medium'
                };

                data.production_queue.push(queueItem);
                this.setData(data);

                return {
                    success: true,
                    line_id: selectedLine.id,
                    line_name: selectedLine.name,
                    start_time: startTime.toISOString(),
                    completion_time: completionTime.toISOString(),
                    production_time: productionTime
                };
            }

            // =============================================
            // MRP & PROCUREMENT LOGIC
            // =============================================

            generateMRPRequirements() {
                const data = this.getData();
                const requirements = [];
                
                // 1. ÐÐ½Ð°Ð»Ð¸Ð· Ð½Ð¾Ð²Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð²
                const activeOrders = data.orders.filter(order => 
                    ['new', 'scheduled', 'materials_reserved'].includes(order.status)
                );
                
                activeOrders.forEach(order => {
                    if (order.material_requirements) {
                        order.material_requirements.forEach(req => {
                            const material = data.materials.find(m => m.code === req.material_code);
                            if (material) {
                                requirements.push({
                                    source: 'order',
                                    source_id: order.id,
                                    material_id: material.id,
                                    material_code: req.material_code,
                                    required_quantity: req.required_quantity,
                                    required_date: order.delivery_date,
                                    priority: order.priority,
                                    description: `Dla zamÃ³wienia ${order.order_number}`
                                });
                            }
                        });
                    }
                });

                // 2. ÐÐ½Ð°Ð»Ð¸Ð· Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¾Ð²
                data.materials.forEach(material => {
                    const inventory = data.inventory.filter(inv => inv.material_id === material.id);
                    const totalAvailable = inventory.reduce((sum, inv) => 
                        sum + (inv.quantity - (inv.reserved_quantity || 0)), 0
                    );
                    
                    if (totalAvailable < material.reorder_point) {
                        const orderQuantity = Math.max(
                            material.min_stock_level * 2 - totalAvailable,
                            material.min_stock_level
                        );
                        
                        requirements.push({
                            source: 'reorder_point',
                            source_id: null,
                            material_id: material.id,
                            material_code: material.code,
                            required_quantity: orderQuantity,
                            required_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            priority: 'medium',
                            description: `Stan magazynowy poniÅ¼ej minimum (${totalAvailable} < ${material.reorder_point})`
                        });
                    }
                });

                // 3. Grupowanie i optymalizacja
                const groupedRequirements = this.groupRequirements(requirements);
                
                // Zapisz wymagania
                data.procurement_requirements = groupedRequirements;
                this.setData(data);
                
                this.addActivity('mrp_generated', `Wygenerowano ${groupedRequirements.length} zapotrzebowaÅ„ zakupowych`);
                return groupedRequirements;
            }

            groupRequirements(requirements) {
                const grouped = {};
                
                requirements.forEach(req => {
                    const key = `${req.material_id}_${req.required_date}`;
                    
                    if (!grouped[key]) {
                        grouped[key] = {
                            id: Date.now() + Math.random(),
                            material_id: req.material_id,
                            material_code: req.material_code,
                            total_quantity: 0,
                            required_date: req.required_date,
                            priority: req.priority,
                            sources: [],
                            status: 'new',
                            created_at: new Date().toISOString()
                        };
                    }
                    
                    grouped[key].total_quantity += req.required_quantity;
                    grouped[key].sources.push({
                        source: req.source,
                        source_id: req.source_id,
                        quantity: req.required_quantity,
                        description: req.description
                    });
                    
                    // Priorytet najwyÅ¼szy ze wszystkich ÅºrÃ³deÅ‚
                    if (req.priority === 'high') grouped[key].priority = 'high';
                    else if (req.priority === 'medium' && grouped[key].priority !== 'high') {
                        grouped[key].priority = 'medium';
                    }
                });
                
                return Object.values(grouped);
            }

            createPurchaseOrder(requirementId, supplierId, negotiatedPrice) {
                const data = this.getData();
                const requirement = data.procurement_requirements.find(r => r.id == requirementId);
                const supplier = data.suppliers.find(s => s.id === supplierId);
                const material = data.materials.find(m => m.id === requirement.material_id);
                
                if (!requirement || !supplier || !material) {
                    return { success: false, message: 'Nie znaleziono wymaganych danych' };
                }

                // SprawdÅº kontrakt
                const contract = data.supplier_contracts.find(c => 
                    c.supplier_id === supplierId && 
                    c.material_id === material.id && 
                    c.status === 'active'
                );

                let finalPrice = negotiatedPrice;
                let moq = 1000; // default
                let leadTime = 14; // default

                if (contract) {
                    if (!negotiatedPrice) finalPrice = contract.price;
                    moq = contract.moq;
                    leadTime = contract.lead_time_days;
                    
                    // SprawdÅº rabaty
                    if (contract.discount_tiers) {
                        const applicableDiscount = contract.discount_tiers
                            .filter(tier => requirement.total_quantity >= tier.min_quantity)
                            .reduce((max, tier) => tier.discount_percent > max.discount_percent ? tier : max, 
                                   { discount_percent: 0 });
                        
                        if (applicableDiscount.discount_percent > 0) {
                            finalPrice = finalPrice * (1 - applicableDiscount.discount_percent / 100);
                        }
                    }
                }

                // Optymalizacja iloÅ›ci (MOQ, transport)
                const optimizedQuantity = Math.max(requirement.total_quantity, moq);
                
                // UtwÃ³rz zamÃ³wienie zakupu
                const purchaseOrder = {
                    id: Date.now(),
                    po_number: `PO-${new Date().getFullYear()}-${String(data.purchase_orders.length + 1).padStart(4, '0')}`,
                    supplier_id: supplierId,
                    material_id: material.id,
                    quantity: optimizedQuantity,
                    unit_price: finalPrice,
                    total_value: optimizedQuantity * finalPrice,
                    currency: contract?.currency || 'PLN',
                    required_date: requirement.required_date,
                    estimated_delivery: new Date(Date.now() + leadTime * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    payment_terms: contract?.payment_terms || '30 dni',
                    status: 'draft',
                    requirement_id: requirementId,
                    created_at: new Date().toISOString(),
                    created_by: 'Zakupowiec'
                };

                data.purchase_orders.push(purchaseOrder);
                
                // Oznacz wymaganie jako procesowane
                requirement.status = 'processing';
                requirement.po_id = purchaseOrder.id;
                
                this.setData(data);
                this.addActivity('purchase_order_created', 
                    `Utworzono ZZ ${purchaseOrder.po_number} dla ${material.name}`);
                
                return {
                    success: true,
                    purchase_order: purchaseOrder,
                    optimized_quantity: optimizedQuantity,
                    original_quantity: requirement.total_quantity,
                    final_price: finalPrice,
                    contract_price: contract?.price
                };
            }

            importData(jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    this.setData(data);
                    this.addActivity('data_import', 'Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¸Ð· Ñ„Ð°Ð¹Ð»Ð°');
                    showToast('Ð”Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹', 'success');
                    refreshCurrentTab();
                    return true;
                } catch (e) {
                    console.error('Import error:', e);
                    showToast('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…', 'error');
                    return false;
                }
            }
        }

        // Initialize storage
        const storage = new ERPStorage();

        // =============================================
        // UI MANAGEMENT
        // =============================================

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load tab content
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'planning':
                    loadPlanning();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'warehouse':
                    loadWarehouse();
                    break;
                case 'production':
                    loadProduction();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');

            // Load data for specific modals
            if (modalId === 'materialModal') {
                loadSuppliersSelect();
            } else if (modalId === 'inventoryModal') {
                loadMaterialsSelect('inventoryMaterialSelect');
            } else if (modalId === 'batchModal') {
                loadMaterialsSelect('batchMaterialSelect');
                loadSuppliersSelect('batchSupplierSelect');
            }
        }

        function loadMaterialsSelect(selectId) {
            const materials = storage.getTable('materials');
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</option>' + 
                materials.map(m => `<option value="${m.id}">${m.code} - ${m.name}</option>`).join('');
        }

        function loadSuppliersSelect(selectId = 'materialSupplierSelect') {
            const suppliers = storage.getTable('suppliers');
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</option>' + 
                suppliers.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            
            // Reset form and edit state
            const form = modal.querySelector('form');
            if (form) {
                form.reset();
                delete form.dataset.editId;
            }
            
            // Reset modal titles
            if (modalId === 'materialModal') {
                document.querySelector('#materialModal h3').textContent = 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»';
            } else if (modalId === 'supplierModal') {
                document.querySelector('#supplierModal h3').textContent = 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°';
            } else if (modalId === 'importModal') {
                // Reset import state
                importDataState.entityType = null;
                importDataState.file = null;
                importDataState.parsedData = null;
                importDataState.validatedData = null;
                
                // Reset UI
                document.getElementById('importStep1').style.display = 'block';
                document.getElementById('importStep2').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-flex';
                document.getElementById('importBtn').style.display = 'none';
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('fileInfo').style.display = 'none';
                
                // Clear radio buttons
                document.querySelectorAll('input[name="entityType"]').forEach(radio => {
                    radio.checked = false;
                });
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} show`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'âš ï¸'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // =============================================
        // DASHBOARD FUNCTIONS
        // =============================================

        function loadDashboard() {
            updateDashboardStats();
        }

        function updateDashboardStats() {
            // Simulate real-time data
            document.getElementById('totalOrders').textContent = '12';
            document.getElementById('productionEfficiency').textContent = '92%';
            document.getElementById('warehouseLoad').textContent = '85%';
            document.getElementById('todayProduction').textContent = '2.5Ñ‚';
        }

        function loadPlanning() {
            // Load procurement data
            loadMRPRequirements();
            loadPurchaseOrders();
            loadMaterials();
            loadSuppliers();
            showToast('ModuÅ‚ zakupÃ³w zaÅ‚adowany', 'success');
        }

        function loadOrders() {
            // Load orders data
            loadOrdersTable();
            showToast('Ð—Ð°ÐºÐ°Ð·Ñ‹ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹', 'success');
        }

        function loadWarehouse() {
            // Load warehouse data
            loadInventory();
            loadBatches();
            showToast('Ð¡ÐºÐ»Ð°Ð´ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½', 'success');
        }

        function loadProduction() {
            // Load production queue
            loadProductionQueue();
            showToast('ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾', 'success');
        }

        function loadProductionQueue() {
            const data = storage.getData();
            const productionQueue = data.production_queue || [];
            const productionLines = data.production_lines || [];
            const queueTable = document.getElementById('productionQueueTable');
            
            if (productionQueue.length === 0) {
                queueTable.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem;">ÐžÑ‡ÐµÑ€ÐµÐ´ÑŒ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð¿ÑƒÑÑ‚Ð°</td></tr>`;
                return;
            }

            queueTable.innerHTML = productionQueue.map(item => {
                const line = productionLines.find(l => l.id === item.line_id);
                const statusClass = getQueueStatusClass(item.status);
                const priorityClass = getPriorityClass(item.priority);
                
                return `
                    <tr>
                        <td>${item.order_number}</td>
                        <td>${item.product}</td>
                        <td>${item.quantity}</td>
                        <td>${line ? line.name : 'ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð°'}</td>
                        <td>${new Date(item.estimated_start).toLocaleString()}</td>
                        <td>${new Date(item.estimated_completion).toLocaleString()}</td>
                        <td><span class="badge ${statusClass}">${getQueueStatusLabel(item.status)}</span></td>
                        <td><span class="badge ${priorityClass}">${getPriorityLabel(item.priority)}</span></td>
                    </tr>
                `;
            }).join('');
        }

        function getQueueStatusClass(status) {
            const classes = {
                'queued': 'badge-info',
                'in_progress': 'badge-warning',
                'completed': 'badge-success',
                'paused': 'badge-secondary'
            };
            return classes[status] || 'badge-secondary';
        }

        function getQueueStatusLabel(status) {
            const labels = {
                'queued': 'Ð’ Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸',
                'in_progress': 'Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ',
                'completed': 'Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾',
                'paused': 'ÐŸÑ€Ð¸Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾'
            };
            return labels[status] || status;
        }

        function loadAnalytics() {
            // Analytics module is already populated with static data
            showToast('ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð°', 'success');
        }

        // =============================================
        // PROCUREMENT FUNCTIONS
        // =============================================

        function generateMRPRequirements() {
            const requirements = storage.generateMRPRequirements();
            loadMRPRequirements();
            
            if (requirements.length > 0) {
                showToast(`Wygenerowano ${requirements.length} zapotrzebowaÅ„ MRP`, 'success');
                setTimeout(() => {
                    let message = `ðŸ“‹ Zapotrzebowania MRP:\n\n`;
                    requirements.forEach(req => {
                        message += `â€¢ ${req.material_code}: ${req.total_quantity} kg\n`;
                        message += `  Priorytet: ${req.priority}, Data: ${req.required_date}\n`;
                        message += `  Å¹rÃ³dÅ‚a: ${req.sources.length}\n\n`;
                    });
                    alert(message);
                }, 500);
            } else {
                showToast('Brak nowych zapotrzebowaÅ„ MRP', 'info');
            }
        }

        function loadMRPRequirements() {
            const data = storage.getData();
            const requirements = data.procurement_requirements || [];
            const materials = data.materials || [];
            const table = document.getElementById('mrpRequirementsTable');
            
            if (requirements.length === 0) {
                table.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">Brak zapotrzebowaÅ„ MRP</td></tr>';
                return;
            }

            table.innerHTML = requirements.map(req => {
                const material = materials.find(m => m.id === req.material_id);
                const priorityClass = req.priority === 'high' ? 'badge-danger' : 
                                    req.priority === 'medium' ? 'badge-warning' : 'badge-info';
                const statusClass = req.status === 'new' ? 'badge-info' : 
                                  req.status === 'processing' ? 'badge-warning' : 'badge-success';
                
                return `
                    <tr>
                        <td>
                            <div><strong>${material ? material.name : 'Nieznany'}</strong></div>
                            <small style="color: #64748b;">${req.material_code}</small>
                        </td>
                        <td><strong>${req.total_quantity}</strong> kg</td>
                        <td>${new Date(req.required_date).toLocaleDateString()}</td>
                        <td><span class="badge ${priorityClass}">${req.priority}</span></td>
                        <td>
                            <small>${req.sources.length} ÅºrÃ³deÅ‚</small>
                            <div style="font-size: 0.8em; color: #64748b;">
                                ${req.sources.slice(0, 2).map(s => s.description).join(', ')}
                                ${req.sources.length > 2 ? '...' : ''}
                            </div>
                        </td>
                        <td><span class="badge ${statusClass}">${getRequirementStatusLabel(req.status)}</span></td>
                        <td class="action-buttons">
                            ${req.status === 'new' ? 
                                `<button class="btn btn-sm btn-primary" onclick="createPurchaseOrderFromRequirement(${req.id})">
                                    ðŸ“‘ UtwÃ³rz ZZ
                                </button>` : 
                                `<button class="btn btn-sm btn-secondary" onclick="viewRequirementDetails(${req.id})">
                                    ðŸ‘ï¸ SzczegÃ³Å‚y
                                </button>`}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getRequirementStatusLabel(status) {
            const labels = {
                'new': 'Nowe',
                'processing': 'W toku',
                'completed': 'ZakoÅ„czone'
            };
            return labels[status] || status;
        }

        function loadPurchaseOrders() {
            const data = storage.getData();
            const purchaseOrders = data.purchase_orders || [];
            const suppliers = data.suppliers || [];
            const materials = data.materials || [];
            const table = document.getElementById('purchaseOrdersTable');
            
            if (purchaseOrders.length === 0) {
                table.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 2rem;">Brak zamÃ³wieÅ„ zakupu</td></tr>';
                return;
            }

            table.innerHTML = purchaseOrders.map(po => {
                const supplier = suppliers.find(s => s.id === po.supplier_id);
                const material = materials.find(m => m.id === po.material_id);
                const statusClass = getPOStatusClass(po.status);
                
                return `
                    <tr>
                        <td><strong>${po.po_number}</strong></td>
                        <td>${supplier ? supplier.name : 'Nieznany'}</td>
                        <td>
                            <div>${material ? material.name : 'Nieznany'}</div>
                            <small style="color: #64748b;">${material ? material.code : ''}</small>
                        </td>
                        <td>${po.quantity} kg</td>
                        <td>${po.unit_price.toFixed(2)} ${po.currency}</td>
                        <td><strong>${po.total_value.toFixed(2)} ${po.currency}</strong></td>
                        <td>${new Date(po.estimated_delivery).toLocaleDateString()}</td>
                        <td><span class="badge ${statusClass}">${getPOStatusLabel(po.status)}</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-info" onclick="viewPODetails(${po.id})">ðŸ‘ï¸</button>
                            ${po.status === 'draft' ? 
                                `<button class="btn btn-sm btn-primary" onclick="sendPO(${po.id})">ðŸ“¤</button>` : ''}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getPOStatusClass(status) {
            const classes = {
                'draft': 'badge-secondary',
                'sent': 'badge-warning',
                'confirmed': 'badge-success',
                'delivered': 'badge-info',
                'cancelled': 'badge-danger'
            };
            return classes[status] || 'badge-secondary';
        }

        function getPOStatusLabel(status) {
            const labels = {
                'draft': 'Projekt',
                'sent': 'WysÅ‚ane',
                'confirmed': 'Potwierdzone',
                'delivered': 'Dostarczone',
                'cancelled': 'Anulowane'
            };
            return labels[status] || status;
        }

        function createPurchaseOrderFromRequirement(requirementId) {
            const data = storage.getData();
            const requirement = data.procurement_requirements.find(r => r.id == requirementId);
            const material = data.materials.find(m => m.id === requirement.material_id);
            
            if (!requirement || !material) {
                showToast('Nie znaleziono wymagania lub materiaÅ‚u', 'error');
                return;
            }

            // ZnajdÅº dostawcÃ³w dla tego materiaÅ‚u
            const suppliers = data.suppliers.filter(s => s.is_active);
            const contracts = data.supplier_contracts.filter(c => 
                c.material_id === material.id && c.status === 'active'
            );

            let supplierOptions = '';
            if (contracts.length > 0) {
                contracts.forEach(contract => {
                    const supplier = suppliers.find(s => s.id === contract.supplier_id);
                    if (supplier) {
                        supplierOptions += `<option value="${supplier.id}" data-price="${contract.price}" data-moq="${contract.moq}">
                            ${supplier.name} - ${contract.price} ${contract.currency} (MOQ: ${contract.moq} kg)
                        </option>`;
                    }
                });
            } else {
                suppliers.forEach(supplier => {
                    supplierOptions += `<option value="${supplier.id}">
                        ${supplier.name} (brak kontraktu)
                    </option>`;
                });
            }

            const formHtml = `
                <div style="background: white; padding: 2rem; border-radius: 12px; max-width: 600px; margin: 2rem auto;">
                    <h3>ðŸ“‘ Tworzenie zamÃ³wienia zakupu</h3>
                    <p><strong>MateriaÅ‚:</strong> ${material.name} (${material.code})</p>
                    <p><strong>Wymagana iloÅ›Ä‡:</strong> ${requirement.total_quantity} kg</p>
                    <p><strong>Data potrzeby:</strong> ${new Date(requirement.required_date).toLocaleDateString()}</p>
                    
                    <form id="createPOForm">
                        <div style="margin: 1rem 0;">
                            <label><strong>Dostawca:</strong></label>
                            <select id="poSupplier" required style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;">
                                <option value="">Wybierz dostawcÄ™...</option>
                                ${supplierOptions}
                            </select>
                        </div>
                        
                        <div style="margin: 1rem 0;">
                            <label><strong>IloÅ›Ä‡ (kg):</strong></label>
                            <input type="number" id="poQuantity" value="${requirement.total_quantity}" min="1" required 
                                   style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;">
                        </div>
                        
                        <div style="margin: 1rem 0;">
                            <label><strong>Cena jednostkowa (PLN):</strong></label>
                            <input type="number" id="poPrice" step="0.01" placeholder="Zostanie uzupeÅ‚niona z kontraktu" 
                                   style="width: 100%; padding: 0.5rem; margin-top: 0.25rem;">
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button type="button" onclick="this.closest('div').parentElement.parentElement.remove()" 
                                    style="flex: 1; padding: 0.75rem; background: #6b7280; color: white; border: none; border-radius: 6px;">
                                Anuluj
                            </button>
                            <button type="submit" style="flex: 1; padding: 0.75rem; background: #3b82f6; color: white; border: none; border-radius: 6px;">
                                UtwÃ³rz zamÃ³wienie
                            </button>
                        </div>
                    </form>
                </div>
            `;

            // Create and show modal
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;';
            modal.innerHTML = formHtml;
            document.body.appendChild(modal);

            // Handle supplier selection
            document.getElementById('poSupplier').addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                const price = selectedOption.getAttribute('data-price');
                const moq = selectedOption.getAttribute('data-moq');
                
                if (price) {
                    document.getElementById('poPrice').value = price;
                }
                if (moq) {
                    const currentQty = parseFloat(document.getElementById('poQuantity').value);
                    if (currentQty < parseFloat(moq)) {
                        document.getElementById('poQuantity').value = moq;
                    }
                }
            });

            // Handle form submission
            document.getElementById('createPOForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const supplierId = parseInt(document.getElementById('poSupplier').value);
                const quantity = parseFloat(document.getElementById('poQuantity').value);
                const price = parseFloat(document.getElementById('poPrice').value);
                
                if (!supplierId || !quantity || !price) {
                    alert('ProszÄ™ wypeÅ‚niÄ‡ wszystkie pola');
                    return;
                }

                const result = storage.createPurchaseOrder(requirementId, supplierId, price);
                
                if (result.success) {
                    showToast(`Utworzono zamÃ³wienie ${result.purchase_order.po_number}`, 'success');
                    loadMRPRequirements();
                    loadPurchaseOrders();
                    modal.remove();
                    
                    setTimeout(() => {
                        let message = `ðŸ“‘ ZamÃ³wienie zakupu utworzone:\n\n`;
                        message += `Nr: ${result.purchase_order.po_number}\n`;
                        message += `IloÅ›Ä‡: ${result.optimized_quantity} kg\n`;
                        message += `Cena: ${result.final_price.toFixed(2)} PLN/kg\n`;
                        message += `WartoÅ›Ä‡: ${result.purchase_order.total_value.toFixed(2)} PLN\n`;
                        message += `Dostawa: ${result.purchase_order.estimated_delivery}\n`;
                        
                        if (result.optimized_quantity > result.original_quantity) {
                            message += `\nâš ï¸ IloÅ›Ä‡ zostaÅ‚a zwiÄ™kszona z ${result.original_quantity} do ${result.optimized_quantity} kg (MOQ)`;
                        }
                        
                        alert(message);
                    }, 500);
                } else {
                    showToast(result.message, 'error');
                }
            });
        }

        // Action functions
        function createPlan() {
            showToast('Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ð»Ð°Ð½Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function receiveDelivery() {
            showModal('batchModal');
        }

        function refreshProduction() {
            loadProduction();
            showToast('Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹', 'success');
        }

        // =============================================
        // MATERIALS FUNCTIONS
        // =============================================

        function loadMaterials() {
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            const materialsTable = document.getElementById('materialsTable');
            
            if (materials.length === 0) {
                materialsTable.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-state-icon">ðŸ“¦</div>
                            <p>ÐÐµÑ‚ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð² Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ</p>
                        </td>
                    </tr>
                `;
                return;
            }

            materialsTable.innerHTML = materials.map(material => {
                const supplier = suppliers.find(s => s.id === material.supplier_id);
                return `
                    <tr>
                        <td>${material.code}</td>
                        <td>${material.name}</td>
                        <td>${getTypeLabel(material.type)}</td>
                        <td>${material.unit}</td>
                        <td>${material.standard_cost ? material.standard_cost.toFixed(2) + ' â‚½' : '-'}</td>
                        <td>${material.min_stock_level || '-'}</td>
                        <td>${supplier ? supplier.name : '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="editMaterial(${material.id})" title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMaterial(${material.id})" title="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function filterMaterials(searchTerm) {
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            const filtered = materials.filter(material => 
                material.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                material.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                getTypeLabel(material.type).toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            const materialsTable = document.getElementById('materialsTable');
            materialsTable.innerHTML = filtered.map(material => {
                const supplier = suppliers.find(s => s.id === material.supplier_id);
                return `
                    <tr>
                        <td>${material.code}</td>
                        <td>${material.name}</td>
                        <td>${getTypeLabel(material.type)}</td>
                        <td>${material.unit}</td>
                        <td>${material.standard_cost ? material.standard_cost.toFixed(2) + ' â‚½' : '-'}</td>
                        <td>${material.min_stock_level || '-'}</td>
                        <td>${supplier ? supplier.name : '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="editMaterial(${material.id})" title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMaterial(${material.id})" title="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function getTypeLabel(type) {
            const types = {
                'granulate_ldpe': 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð”',
                'granulate_hdpe': 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐÐ”', 
                'granulate_pp': 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐŸ',
                'film_pet': 'ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢',
                'film_ldpe': 'ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ’Ð”',
                'dye': 'ÐšÑ€Ð°ÑÐ¸Ñ‚ÐµÐ»ÑŒ',
                'additive': 'Ð”Ð¾Ð±Ð°Ð²ÐºÐ°'
            };
            return types[type] || type;
        }

        function deleteMaterial(id) {
            if (confirm('Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»?')) {
                const deleted = storage.deleteRecord('materials', id);
                storage.addActivity('material_deleted', `Ð£Ð´Ð°Ð»ÐµÐ½ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» ${deleted.code}`);
                showToast('ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð» ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
                loadMaterials();
                loadDashboard();
            }
        }

        function editMaterial(id) {
            const material = storage.getTable('materials').find(m => m.id === id);
            if (!material) return;

            // Fill form with existing data
            document.getElementById('materialCode').value = material.code;
            document.getElementById('materialName').value = material.name;
            document.getElementById('materialType').value = material.type;
            document.getElementById('materialUnit').value = material.unit;
            document.getElementById('materialCost').value = material.standard_cost || '';
            document.getElementById('materialMinStock').value = material.min_stock_level || '';
            document.getElementById('materialReorderPoint').value = material.reorder_point || '';
            document.getElementById('materialSupplier').value = material.supplier_id || '';
            document.getElementById('materialDescription').value = material.description || '';

            // Set edit mode
            document.getElementById('materialForm').dataset.editId = id;
            document.querySelector('#materialModal h3').textContent = 'Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»';
            
            // Load suppliers for select
            loadSuppliersSelect();
            
            showModal('materialModal');
        }

        // =============================================
        // SUPPLIERS FUNCTIONS  
        // =============================================

        function loadSuppliers() {
            const suppliers = storage.getTable('suppliers');
            const suppliersTable = document.getElementById('suppliersTable');
            
            if (suppliers.length === 0) {
                suppliersTable.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-state-icon">ðŸ‘¥</div>
                            <p>ÐÐµÑ‚ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ¾Ð² Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ</p>
                        </td>
                    </tr>
                `;
                return;
            }

            suppliersTable.innerHTML = suppliers.map(supplier => `
                <tr>
                    <td>${supplier.code}</td>
                    <td>${supplier.name}</td>
                    <td>${supplier.contact_person || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>â­â­â­â­â­</td>
                    <td><span class="badge ${supplier.is_active ? 'badge-success' : 'badge-danger'}">${supplier.is_active ? 'ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹' : 'ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editSupplier(${supplier.id})" title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ">âœï¸</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})" title="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ">ðŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterSuppliers(searchTerm) {
            const suppliers = storage.getTable('suppliers');
            const filtered = suppliers.filter(supplier => 
                supplier.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                supplier.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (supplier.contact_person && supplier.contact_person.toLowerCase().includes(searchTerm.toLowerCase()))
            );
            
            const suppliersTable = document.getElementById('suppliersTable');
            suppliersTable.innerHTML = filtered.map(supplier => `
                <tr>
                    <td>${supplier.code}</td>
                    <td>${supplier.name}</td>
                    <td>${supplier.contact_person || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>â­â­â­â­â­</td>
                    <td><span class="badge ${supplier.is_active ? 'badge-success' : 'badge-danger'}">${supplier.is_active ? 'ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹' : 'ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹'}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editSupplier(${supplier.id})" title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ">âœï¸</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})" title="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ">ðŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteSupplier(id) {
            if (confirm('Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°?')) {
                const deleted = storage.deleteRecord('suppliers', id);
                storage.addActivity('supplier_deleted', `Ð£Ð´Ð°Ð»ÐµÐ½ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº ${deleted.name}`);
                showToast('ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
                loadSuppliers();
                loadDashboard();
            }
        }

        function editSupplier(id) {
            const supplier = storage.getTable('suppliers').find(s => s.id === id);
            if (!supplier) return;

            // Fill form with existing data
            document.getElementById('supplierCode').value = supplier.code;
            document.getElementById('supplierName').value = supplier.name;
            document.getElementById('supplierContact').value = supplier.contact_person || '';
            document.getElementById('supplierEmail').value = supplier.email || '';
            document.getElementById('supplierPhone').value = supplier.phone || '';
            document.getElementById('supplierActive').value = supplier.is_active.toString();
            document.getElementById('supplierAddress').value = supplier.address || '';

            // Set edit mode
            document.getElementById('supplierForm').dataset.editId = id;
            document.querySelector('#supplierModal h3').textContent = 'Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°';
            
            showModal('supplierModal');
        }

        function filterOrders(status) {
            showToast(`Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²: ${status}`, 'info');
        }

        // =============================================
        // DETAIL MODAL FUNCTIONS
        // =============================================

        function showOrderDetail(orderId) {
            const orderData = getOrderData(orderId);
            
            // Populate order detail modal
            document.getElementById('orderNumber').textContent = orderData.number;
            document.getElementById('orderCustomer').textContent = orderData.customer;
            document.getElementById('orderStatus').innerHTML = `<span class="badge ${orderData.statusClass}">${orderData.status}</span>`;
            document.getElementById('orderPriority').innerHTML = `<span class="badge ${orderData.priorityClass}">${orderData.priority}</span>`;
            document.getElementById('orderProduct').textContent = orderData.product;
            document.getElementById('orderQuantity').textContent = orderData.quantity;
            document.getElementById('orderDate').textContent = orderData.orderDate;
            document.getElementById('orderDeliveryDate').textContent = orderData.deliveryDate;
            document.getElementById('orderDaysLeft').textContent = orderData.daysLeft;
            document.getElementById('orderLine').textContent = orderData.line;
            document.getElementById('orderProgress').textContent = orderData.progress;
            document.getElementById('orderTimeLeft').textContent = orderData.timeLeft;
            
            showModal('orderDetailModal');
        }

        function showWarehouseDetail(materialId) {
            const materialData = getWarehouseMaterialData(materialId);
            
            // Populate warehouse detail modal
            document.getElementById('warehouseMaterialName').textContent = materialData.name;
            document.getElementById('warehouseMaterialQuantity').textContent = materialData.quantity;
            document.getElementById('warehouseMaterialStatus').innerHTML = `<span class="material-status ${materialData.statusClass}">${materialData.status}</span>`;
            
            showModal('warehouseDetailModal');
        }

        function showLineDetail(lineId) {
            const lineData = getLineData(lineId);
            
            // Populate line detail modal
            document.getElementById('lineName').textContent = lineData.name;
            document.getElementById('lineStatus').innerHTML = `<span class="line-status ${lineData.statusClass}">${lineData.status}</span>`;
            document.getElementById('lineCurrentOrder').textContent = lineData.currentOrder;
            document.getElementById('lineProgress').textContent = lineData.progress;
            document.getElementById('lineSpeed').textContent = lineData.speed;
            document.getElementById('lineTimeLeft').textContent = lineData.timeLeft;
            document.getElementById('lineShift').textContent = lineData.shift;
            document.getElementById('lineOperator1').textContent = lineData.operator1;
            document.getElementById('lineOperator2').textContent = lineData.operator2;
            
            showModal('lineDetailModal');
        }

        function showMaterialDetail(materialId) {
            const materialData = getMaterialData(materialId);
            
            // Populate material detail modal
            document.getElementById('materialCode').textContent = materialData.code;
            document.getElementById('materialName').textContent = materialData.name;
            document.getElementById('materialType').textContent = materialData.type;
            document.getElementById('materialCurrentStock').textContent = materialData.currentStock;
            document.getElementById('materialMinStock').textContent = materialData.minStock;
            document.getElementById('materialReorderPoint').textContent = materialData.reorderPoint;
            document.getElementById('materialCost').textContent = materialData.cost;
            document.getElementById('materialLastPurchase').textContent = materialData.lastPurchase;
            
            showModal('materialDetailModal');
        }

        // =============================================
        // DATA FUNCTIONS
        // =============================================

        function getOrderData(orderId) {
            const orders = {
                'ORD-240001': {
                    number: '#ORD-240001',
                    customer: 'ÐžÐžÐž "ÐŸÐ¸Ñ‰ÐµÐ¿Ñ€Ð¾Ð¼"',
                    status: 'Ð’ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ',
                    statusClass: 'badge-warning',
                    priority: 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹',
                    priorityClass: 'badge-info',
                    product: 'ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢ 12Ð¼ÐºÐ¼, 1500Ð¼Ð¼',
                    quantity: '5000 Ð¿.Ð¼.',
                    orderDate: '20.01.2024',
                    deliveryDate: '25.01.2024',
                    daysLeft: '2 Ð´Ð½Ñ',
                    line: 'Ð›Ð¸Ð½Ð¸Ñ 1 (Ð­ÐºÑÑ‚Ñ€ÑƒÐ·Ð¸Ñ)',
                    progress: '65%',
                    timeLeft: '2Ñ‡ 15Ð¼Ð¸Ð½'
                },
                'ORD-240002': {
                    number: '#ORD-240002',
                    customer: 'Ð˜ÐŸ Ð¡Ð¼Ð¸Ñ€Ð½Ð¾Ð²',
                    status: 'ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ñ‹Ð¹',
                    statusClass: 'badge-danger',
                    priority: 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹',
                    priorityClass: 'badge-danger',
                    product: 'ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ñ Ð»Ð¾Ð³Ð¾Ñ‚Ð¸Ð¿Ð¾Ð¼',
                    quantity: '10000 ÑˆÑ‚.',
                    orderDate: '22.01.2024',
                    deliveryDate: '24.01.2024',
                    daysLeft: '1 Ð´ÐµÐ½ÑŒ',
                    line: 'Ð›Ð¸Ð½Ð¸Ñ 2 (ÐŸÐµÑ‡Ð°Ñ‚ÑŒ)',
                    progress: '30%',
                    timeLeft: '4Ñ‡ 20Ð¼Ð¸Ð½'
                },
                'ORD-240003': {
                    number: '#ORD-240003',
                    customer: 'Ð¢Ð” "ÐœÐµÐ³Ð°ÑÑ‚Ñ€Ð¾Ð¹"',
                    status: 'Ð—Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½',
                    statusClass: 'badge-info',
                    priority: 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹',
                    priorityClass: 'badge-info',
                    product: 'Ð¡Ñ‚Ñ€ÐµÐ¹Ñ‡-Ð¿Ð»ÐµÐ½ÐºÐ° 500Ð¼Ð¼',
                    quantity: '2000 ÐºÐ³',
                    orderDate: '23.01.2024',
                    deliveryDate: '30.01.2024',
                    daysLeft: '7 Ð´Ð½ÐµÐ¹',
                    line: 'ÐÐµ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð°',
                    progress: '0%',
                    timeLeft: 'ÐÐµ Ð½Ð°Ñ‡Ð°Ñ‚Ð¾'
                }
            };
            return orders[orderId] || {};
        }

        function getWarehouseMaterialData(materialId) {
            const materials = {
                'ldpe-granulate': {
                    name: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð”',
                    quantity: '500 ÐºÐ³',
                    status: 'ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº',
                    statusClass: 'low'
                },
                'pp-granulate': {
                    name: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐŸ',
                    quantity: '750 ÐºÐ³',
                    status: 'ÐÐ¾Ñ€Ð¼Ð°',
                    statusClass: 'ok'
                },
                'blue-dye': {
                    name: 'ÐšÑ€Ð°ÑÐ¸Ñ‚ÐµÐ»ÑŒ ÑÐ¸Ð½Ð¸Ð¹',
                    quantity: '25 ÐºÐ³',
                    status: 'ÐÐ¾Ñ€Ð¼Ð°',
                    statusClass: 'ok'
                }
            };
            return materials[materialId] || {};
        }

        function getLineData(lineId) {
            const lines = {
                'line-1': {
                    name: 'Ð›Ð¸Ð½Ð¸Ñ 1 - Ð­ÐºÑÑ‚Ñ€ÑƒÐ·Ð¸Ñ',
                    status: 'Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚',
                    statusClass: 'running',
                    currentOrder: '#ORD-240001',
                    progress: '65%',
                    speed: '120 Ð¼/Ð¼Ð¸Ð½',
                    timeLeft: '2Ñ‡ 15Ð¼Ð¸Ð½',
                    shift: 'Ð”Ð½ÐµÐ²Ð½Ð°Ñ (08:00-20:00)',
                    operator1: 'Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜.Ð˜.',
                    operator2: 'ÐŸÐµÑ‚Ñ€Ð¾Ð² ÐŸ.ÐŸ.'
                },
                'line-2': {
                    name: 'Ð›Ð¸Ð½Ð¸Ñ 2 - ÐŸÐµÑ‡Ð°Ñ‚ÑŒ',
                    status: 'Ð Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚',
                    statusClass: 'running',
                    currentOrder: '#ORD-240002',
                    progress: '30%',
                    speed: '85 Ð¼/Ð¼Ð¸Ð½',
                    timeLeft: '4Ñ‡ 20Ð¼Ð¸Ð½',
                    shift: 'Ð”Ð½ÐµÐ²Ð½Ð°Ñ (08:00-20:00)',
                    operator1: 'Ð¡Ð¸Ð´Ð¾Ñ€Ð¾Ð² Ð¡.Ð¡.',
                    operator2: 'Ð¤ÐµÐ´Ð¾Ñ€Ð¾Ð² Ð¤.Ð¤.'
                },
                'line-3': {
                    name: 'Ð›Ð¸Ð½Ð¸Ñ 3 - Ð›Ð°Ð¼Ð¸Ð½Ð°Ñ†Ð¸Ñ',
                    status: 'ÐžÐ±ÑÐ»ÑƒÐ¶Ð¸Ð²Ð°Ð½Ð¸Ðµ',
                    statusClass: 'maintenance',
                    currentOrder: 'ÐŸÐ»Ð°Ð½Ð¾Ð²Ð¾Ðµ Ð¢Ðž',
                    progress: '0%',
                    speed: '0 Ð¼/Ð¼Ð¸Ð½',
                    timeLeft: '2Ñ‡ 30Ð¼Ð¸Ð½',
                    shift: 'Ð”Ð½ÐµÐ²Ð½Ð°Ñ (08:00-20:00)',
                    operator1: 'ÐŸÐµÑ‚Ñ€Ð¾Ð² Ð.Ð˜.',
                    operator2: 'Ð¡Ð»ÐµÑÐ°Ñ€ÑŒ'
                }
            };
            return lines[lineId] || {};
        }

        function getMaterialData(materialId) {
            // Placeholder for material data
            return {
                code: 'GR-PVD-001',
                name: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð” Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹',
                type: 'ÐŸÐ¾Ð»Ð¸ÑÑ‚Ð¸Ð»ÐµÐ½ Ð½Ð¸Ð·ÐºÐ¾Ð³Ð¾ Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ',
                currentStock: '500 ÐºÐ³',
                minStock: '1000 ÐºÐ³',
                reorderPoint: '2000 ÐºÐ³',
                cost: '245.50 â‚½/ÐºÐ³',
                lastPurchase: '15.01.2024'
            };
        }

        // =============================================
        // ACTION FUNCTIONS FOR DETAIL MODALS
        // =============================================

        function editOrder() {
            showToast('Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function startProduction() {
            showToast('Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð° Ð·Ð°ÐºÐ°Ð·Ð°', 'success');
        }

        function printOrder() {
            showToast('ÐŸÐµÑ‡Ð°Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function editMaterial() {
            showToast('Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function orderMaterial() {
            showToast('Ð—Ð°ÐºÐ°Ð· Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function viewMaterialHistory() {
            showToast('Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function startLineProduction() {
            showToast('Ð—Ð°Ð¿ÑƒÑÐº Ð»Ð¸Ð½Ð¸Ð¸', 'success');
        }

        function pauseLineProduction() {
            showToast('ÐŸÐ°ÑƒÐ·Ð° Ð»Ð¸Ð½Ð¸Ð¸', 'warning');
        }

        function stopLineProduction() {
            showToast('ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð»Ð¸Ð½Ð¸Ð¸', 'danger');
        }

        function lineSettings() {
            showToast('ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð»Ð¸Ð½Ð¸Ð¸ - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function moveWarehouseItem() {
            showToast('ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function adjustStock() {
            showToast('ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¾Ð² - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        function printWarehouseLabel() {
            showToast('ÐŸÐµÑ‡Ð°Ñ‚ÑŒ ÑÑ‚Ð¸ÐºÐµÑ‚ÐºÐ¸ - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'info');
        }

        // =============================================
        // ADDITIONAL CRUD FUNCTIONS
        // =============================================

        function loadInventory() {
            const inventory = storage.getTable('inventory');
            const materials = storage.getTable('materials');
            const inventoryTable = document.getElementById('inventoryTable');
            
            if (inventory.length === 0) {
                inventoryTable.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem;">ÐÐµÑ‚ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¾Ð² Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ</td></tr>`;
                return;
            }

            inventoryTable.innerHTML = inventory.map(item => {
                const material = materials.find(m => m.id === item.material_id);
                const available = item.quantity - (item.reserved_quantity || 0);
                return `
                    <tr>
                        <td>${material ? material.name : 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»'}</td>
                        <td>${item.warehouse}</td>
                        <td>${item.batch_number || '-'}</td>
                        <td>${item.quantity}</td>
                        <td>${item.reserved_quantity || 0}</td>
                        <td>${available}</td>
                        <td>${item.location_code || '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteInventory(${item.id})" title="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadBatches() {
            const batches = storage.getTable('batches');
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            const batchesTable = document.getElementById('batchesTable');
            
            if (batches.length === 0) {
                batchesTable.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem;">ÐÐµÑ‚ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¹ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ</td></tr>`;
                return;
            }

            batchesTable.innerHTML = batches.map(batch => {
                const material = materials.find(m => m.id === batch.material_id);
                const supplier = suppliers.find(s => s.id === batch.supplier_id);
                return `
                    <tr>
                        <td>${batch.batch_number}</td>
                        <td>${material ? material.name : 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»'}</td>
                        <td>${supplier ? supplier.name : 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº'}</td>
                        <td>${batch.received_quantity}</td>
                        <td>${new Date(batch.received_date).toLocaleDateString()}</td>
                        <td><span class="badge badge-success">ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¾</span></td>
                        <td>ðŸ“„</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteBatch(${batch.id})" title="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadOrdersTable() {
            const orders = storage.getTable('orders');
            const ordersTable = document.getElementById('ordersTable');
            
            if (orders.length === 0) {
                ordersTable.innerHTML = `<tr><td colspan="8" style="text-align: center; padding: 2rem;">ÐÐµÑ‚ Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ</td></tr>`;
                return;
            }

            ordersTable.innerHTML = orders.map(order => `
                <tr>
                    <td>${order.order_number}</td>
                    <td>${order.customer}</td>
                    <td>${order.product}</td>
                    <td>${order.quantity}</td>
                    <td>${new Date(order.order_date).toLocaleDateString()}</td>
                    <td><span class="badge badge-info">ÐÐ¾Ð²Ñ‹Ð¹</span></td>
                    <td><span class="badge badge-warning">Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteOrder(${order.id})" title="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ">ðŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        }

        function deleteInventory(id) {
            if (confirm('Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº?')) {
                storage.deleteRecord('inventory', id);
                loadInventory();
                showToast('ÐžÑÑ‚Ð°Ñ‚Ð¾Ðº ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
            }
        }

        function deleteBatch(id) {
            if (confirm('Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ñ‚Ð¸ÑŽ?')) {
                storage.deleteRecord('batches', id);
                loadBatches();
                showToast('ÐŸÐ°Ñ€Ñ‚Ð¸Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°', 'success');
            }
        }

        function deleteOrder(id) {
            if (confirm('Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·?')) {
                storage.deleteRecord('orders', id);
                loadOrdersTable();
                showToast('Ð—Ð°ÐºÐ°Ð· ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
            }
        }

        function loadMaterialsSelect(selectId) {
            const materials = storage.getTable('materials');
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»</option>' + 
                materials.map(m => `<option value="${m.id}">${m.name} (${m.code})</option>`).join('');
        }

        function loadSuppliersSelect(selectId = 'materialSupplier') {
            const suppliers = storage.getTable('suppliers');
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°</option>' + 
                suppliers.map(s => `<option value="${s.id}">${s.name} (${s.code})</option>`).join('');
        }

        // =============================================
        // MATERIALS FUNCTIONS
        // =============================================

        function loadMaterials() {
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            
            const materialsHtml = materials.map(material => {
                const supplier = suppliers.find(s => s.id === material.supplier_id);
                return `
                    <tr>
                        <td><strong>${material.code}</strong></td>
                        <td>${material.name}</td>
                        <td><span class="badge badge-info">${getTypeLabel(material.type)}</span></td>
                        <td>${material.unit}</td>
                        <td>${material.standard_cost ? material.standard_cost.toFixed(2) + ' â‚½' : '-'}</td>
                        <td>${material.min_stock_level || '-'}</td>
                        <td>${supplier ? supplier.name : '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editMaterial(${material.id})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMaterial(${material.id})">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('materialsTable').innerHTML = materialsHtml || `
                <tr><td colspan="8" class="empty-state">ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹</td></tr>
            `;
        }

        function filterMaterials(searchTerm) {
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            const filtered = materials.filter(m => 
                m.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                m.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const materialsHtml = filtered.map(material => {
                const supplier = suppliers.find(s => s.id === material.supplier_id);
                return `
                    <tr>
                        <td><strong>${material.code}</strong></td>
                        <td>${material.name}</td>
                        <td><span class="badge badge-info">${getTypeLabel(material.type)}</span></td>
                        <td>${material.unit}</td>
                        <td>${material.standard_cost ? material.standard_cost.toFixed(2) + ' â‚½' : '-'}</td>
                        <td>${material.min_stock_level || '-'}</td>
                        <td>${supplier ? supplier.name : '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editMaterial(${material.id})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMaterial(${material.id})">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('materialsTable').innerHTML = materialsHtml || `
                <tr><td colspan="8" class="empty-state">ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹</td></tr>
            `;
        }

        function getTypeLabel(type) {
            const types = {
                'granulate_ldpe': 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð”',
                'granulate_hdpe': 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐÐ”',
                'granulate_pp': 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐŸ',
                'ink_printing': 'ÐšÑ€Ð°ÑÐºÐ°',
                'adhesive_pu': 'ÐšÐ»ÐµÐ¹ ÐŸÐ£',
                'adhesive_acrylic': 'ÐšÐ»ÐµÐ¹ Ð°ÐºÑ€Ð¸Ð»Ð¾Ð²Ñ‹Ð¹',
                'solvent': 'Ð Ð°ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚ÐµÐ»ÑŒ',
                'additive': 'Ð”Ð¾Ð±Ð°Ð²ÐºÐ°'
            };
            return types[type] || type;
        }



        function deleteMaterial(id) {
            if (confirm('Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»?')) {
                const material = storage.getTable('materials').find(m => m.id === id);
                storage.deleteRecord('materials', id);
                storage.addActivity('material_deleted', `Ð£Ð´Ð°Ð»ÐµÐ½ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» ${material.code}`);
                showToast('ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð» ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
                loadMaterials();
                loadDashboard(); // Update stats
            }
        }

        // =============================================
        // SUPPLIERS FUNCTIONS  
        // =============================================

        function loadSuppliers() {
            const suppliers = storage.getTable('suppliers');
            
            const suppliersHtml = suppliers.map(supplier => `
                <tr>
                    <td><strong>${supplier.code}</strong></td>
                    <td>${supplier.name}</td>
                    <td>${supplier.contact_person || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>${supplier.overall_rating ? supplier.overall_rating.toFixed(1) + '/100' : '-'}</td>
                    <td>
                        <span class="badge ${supplier.is_active ? 'badge-success' : 'badge-danger'}">
                            ${supplier.is_active ? 'ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹' : 'ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹'}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="editSupplier(${supplier.id})">âœï¸</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">ðŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('suppliersTable').innerHTML = suppliersHtml || `
                <tr><td colspan="8" class="empty-state">ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹</td></tr>
            `;
        }

        function filterSuppliers(searchTerm) {
            const suppliers = storage.getTable('suppliers');
            const filtered = suppliers.filter(s => 
                s.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                s.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const suppliersHtml = filtered.map(supplier => `
                <tr>
                    <td><strong>${supplier.code}</strong></td>
                    <td>${supplier.name}</td>
                    <td>${supplier.contact_person || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>${supplier.overall_rating ? supplier.overall_rating.toFixed(1) + '/100' : '-'}</td>
                    <td>
                        <span class="badge ${supplier.is_active ? 'badge-success' : 'badge-danger'}">
                            ${supplier.is_active ? 'ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹' : 'ÐÐµÐ°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹'}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="editSupplier(${supplier.id})">âœï¸</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">ðŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('suppliersTable').innerHTML = suppliersHtml || `
                <tr><td colspan="8" class="empty-state">ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹</td></tr>
            `;
        }

        function deleteSupplier(id) {
            if (confirm('Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ð³Ð¾ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°?')) {
                const supplier = storage.getTable('suppliers').find(s => s.id === id);
                storage.deleteRecord('suppliers', id);
                storage.addActivity('supplier_deleted', `Ð£Ð´Ð°Ð»ÐµÐ½ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº ${supplier.name}`);
                showToast('ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
                loadSuppliers();
                loadDashboard(); // Update stats
            }
        }

        // =============================================
        // INVENTORY FUNCTIONS
        // =============================================

        function loadInventory() {
            const inventory = storage.getTable('inventory');
            const materials = storage.getTable('materials');
            
            const inventoryHtml = inventory.map(item => {
                const material = materials.find(m => m.id === item.material_id);
                const reservedQty = item.reserved_quantity || 0;
                const availableQty = item.quantity - reservedQty;
                
                return `
                    <tr onclick="showInventoryDetails(${item.id})" style="cursor: pointer;" title="ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹">
                        <td>
                            <div>${material ? material.name : 'Unknown'}</div>
                            <small style="color: #64748b;">${material ? material.code : '-'}</small>
                        </td>
                        <td>${item.warehouse}</td>
                        <td>${item.batch_number || '-'}</td>
                        <td><strong>${item.quantity.toFixed(1)}</strong> ÐºÐ³</td>
                        <td style="color: ${reservedQty > 0 ? '#f59e0b' : '#94a3b8'};">
                            <strong>${reservedQty.toFixed(1)}</strong> ÐºÐ³
                            ${reservedQty > 0 ? ' ðŸ”’' : ''}
                        </td>
                        <td style="color: ${availableQty > 0 ? '#10b981' : '#ef4444'};">
                            <strong>${availableQty.toFixed(1)}</strong> ÐºÐ³
                        </td>
                        <td>${item.location_code || '-'}</td>
                        <td class="action-buttons" onclick="event.stopPropagation();">
                            <button class="btn btn-sm btn-warning" onclick="editInventory(${item.id})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteInventory(${item.id})">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('inventoryTable').innerHTML = inventoryHtml || `
                <tr><td colspan="8" class="empty-state">ÐžÑÑ‚Ð°Ñ‚ÐºÐ¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹</td></tr>
            `;
        }

        // =============================================
        // BATCHES FUNCTIONS
        // =============================================

        function loadBatches() {
            const batches = storage.getTable('batches');
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            
            const batchesHtml = batches.map(batch => {
                const material = materials.find(m => m.id === batch.material_id);
                const supplier = suppliers.find(s => s.id === batch.supplier_id);
                const documents = [
                    batch.has_coa ? 'CoA' : null,
                    batch.has_tds ? 'TDS' : null,
                    batch.has_sds ? 'SDS' : null,
                    batch.has_doc ? 'DoC' : null,
                    batch.has_cmr ? 'CMR' : null
                ].filter(Boolean).join(', ');

                return `
                    <tr>
                        <td><strong>${batch.batch_number}</strong></td>
                        <td>${material ? material.name : 'Unknown'}</td>
                        <td>${supplier ? supplier.name : 'Unknown'}</td>
                        <td>${batch.received_quantity}</td>
                        <td>${new Date(batch.received_date).toLocaleDateString()}</td>
                        <td>
                            <span class="badge ${getQualityStatusClass(batch.quality_status)}">
                                ${getQualityStatusLabel(batch.quality_status)}
                            </span>
                        </td>
                        <td><small>${documents || 'ÐÐµÑ‚'}</small></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editBatch(${batch.id})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBatch(${batch.id})">ðŸ—‘ï¸</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('batchesTable').innerHTML = batchesHtml || `
                <tr><td colspan="8" class="empty-state">ÐŸÐ°Ñ€Ñ‚Ð¸Ð¸ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹</td></tr>
            `;
        }

        function getQualityStatusClass(status) {
            const classes = {
                'pending': 'badge-warning',
                'approved': 'badge-success',
                'blocked': 'badge-danger',
                'quarantine': 'badge-warning'
            };
            return classes[status] || 'badge-info';
        }

        function getQualityStatusLabel(status) {
            const labels = {
                'pending': 'ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚',
                'approved': 'ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¾',
                'blocked': 'Ð—Ð°Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¾',
                'quarantine': 'ÐšÐ°Ñ€Ð°Ð½Ñ‚Ð¸Ð½'
            };
            return labels[status] || status;
        }

        // =============================================
        // ORDERS FUNCTIONS
        // =============================================

        function loadOrders() {
            const orders = storage.getTable('orders');
            
            const ordersHtml = orders.length ? orders.map(order => `
                <tr>
                    <td><strong>${order.order_number}</strong></td>
                    <td>${order.customer}</td>
                    <td>${order.product}</td>
                    <td>${order.quantity}</td>
                    <td>${new Date(order.order_date).toLocaleDateString()}</td>
                    <td>
                        <span class="badge ${getOrderStatusClass(order.status)}">
                            ${getOrderStatusLabel(order.status)}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${getPriorityClass(order.priority)}">
                            ${getPriorityLabel(order.priority)}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="editOrder(${order.id})">âœï¸</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteOrder(${order.id})">ðŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('') : `<tr><td colspan="8" class="empty-state">Ð—Ð°ÐºÐ°Ð·Ñ‹ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹</td></tr>`;

            document.getElementById('ordersTable').innerHTML = ordersHtml;
        }

        function getOrderStatusClass(status) {
            const classes = {
                'new': 'badge-info',
                'planned': 'badge-warning',
                'in_production': 'badge-warning',
                'completed': 'badge-success',
                'shipped': 'badge-success',
                'cancelled': 'badge-danger'
            };
            return classes[status] || 'badge-info';
        }

        function getOrderStatusLabel(status) {
            const labels = {
                'new': 'ÐÐ¾Ð²Ñ‹Ð¹',
                'planned': 'Ð—Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½',
                'in_production': 'Ð’ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ðµ',
                'completed': 'Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½',
                'shipped': 'ÐžÑ‚Ð³Ñ€ÑƒÐ¶ÐµÐ½',
                'cancelled': 'ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½'
            };
            return labels[status] || status;
        }

        function getPriorityClass(priority) {
            const classes = {
                'low': 'badge-info',
                'medium': 'badge-warning',
                'high': 'badge-danger',
                'critical': 'badge-danger'
            };
            return classes[priority] || 'badge-info';
        }

        function getPriorityLabel(priority) {
            const labels = {
                'low': 'ÐÐ¸Ð·ÐºÐ¸Ð¹',
                'medium': 'Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹',
                'high': 'Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹',
                'critical': 'ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹'
            };
            return labels[priority] || priority;
        }

        // =============================================
        // FORM HANDLERS
        // =============================================

        // Material form handler
        document.getElementById('materialForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const materialData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['standard_cost', 'min_stock_level', 'reorder_point'].includes(key)) {
                        materialData[key] = parseFloat(value);
                    } else if (key === 'supplier_id') {
                        materialData[key] = parseInt(value);
                    } else {
                        materialData[key] = value;
                    }
                }
            }

            const editId = this.dataset.editId;
            if (editId) {
                // Update existing material
                const updated = storage.updateRecord('materials', parseInt(editId), materialData);
                storage.addActivity('material_updated', `ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» ${updated.code}`);
                showToast('ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð» Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½', 'success');
                delete this.dataset.editId;
                document.querySelector('#materialModal h3').textContent = 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»';
            } else {
                // Create new material
                const newMaterial = storage.addRecord('materials', materialData);
                storage.addActivity('material_created', `Ð¡Ð¾Ð·Ð´Ð°Ð½ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð» ${newMaterial.code}`);
                showToast('ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð» ÑÐ¾Ð·Ð´Ð°Ð½', 'success');
            }
            
            hideModal('materialModal');
            loadMaterials();
            loadDashboard();
        });

        // Supplier form handler
        document.getElementById('supplierForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const supplierData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (key === 'is_active') {
                        supplierData[key] = value === 'true';
                    } else {
                        supplierData[key] = value;
                    }
                }
            }

            const editId = this.dataset.editId;
            if (editId) {
                // Update existing supplier
                const updated = storage.updateRecord('suppliers', parseInt(editId), supplierData);
                storage.addActivity('supplier_updated', `ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº ${updated.name}`);
                showToast('ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½', 'success');
                delete this.dataset.editId;
                document.querySelector('#supplierModal h3').textContent = 'Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°';
            } else {
                // Create new supplier
                const newSupplier = storage.addRecord('suppliers', supplierData);
                storage.addActivity('supplier_created', `Ð¡Ð¾Ð·Ð´Ð°Ð½ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº ${newSupplier.name}`);
                showToast('ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº ÑÐ¾Ð·Ð´Ð°Ð½', 'success');
            }
            
            hideModal('supplierModal');
            loadSuppliers();
            loadDashboard();
        });

        // Inventory form handler
        document.getElementById('inventoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const inventoryData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['material_id'].includes(key)) {
                        inventoryData[key] = parseInt(value);
                    } else if (['quantity', 'reserved_quantity'].includes(key)) {
                        inventoryData[key] = parseFloat(value);
                    } else {
                        inventoryData[key] = value;
                    }
                }
            }

            // Calculate available quantity
            inventoryData.available_quantity = inventoryData.quantity - (inventoryData.reserved_quantity || 0);
            inventoryData.last_movement_date = new Date().toISOString();

            const newInventory = storage.addRecord('inventory', inventoryData);
            storage.addActivity('inventory_added', `Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº Ð´Ð»Ñ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°`);
            showToast('ÐžÑÑ‚Ð°Ñ‚Ð¾Ðº Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½', 'success');
            hideModal('inventoryModal');
            loadInventory();
            loadDashboard();
        });

        // Batch form handler
        document.getElementById('batchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const batchData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['material_id', 'supplier_id'].includes(key)) {
                        batchData[key] = parseInt(value);
                    } else if (['received_quantity'].includes(key)) {
                        batchData[key] = parseFloat(value);
                    } else if (key.startsWith('has_')) {
                        batchData[key] = true; // checkbox checked
                    } else {
                        batchData[key] = value;
                    }
                }
            }

            // Set available quantity equal to received quantity initially
            batchData.available_quantity = batchData.received_quantity;

            const newBatch = storage.addRecord('batches', batchData);
            storage.addActivity('batch_received', `ÐŸÑ€Ð¸Ð½ÑÑ‚Ð° Ð¿Ð°Ñ€Ñ‚Ð¸Ñ ${newBatch.batch_number}`);
            showToast('ÐŸÐ°Ñ€Ñ‚Ð¸Ñ Ð¿Ñ€Ð¸Ð½ÑÑ‚Ð°', 'success');
            hideModal('batchModal');
            loadBatches();
            loadDashboard();
        });

        // Order form handler with business logic
        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const orderData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['quantity'].includes(key)) {
                        orderData[key] = parseFloat(value);
                    } else {
                        orderData[key] = value;
                    }
                }
            }

            // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð½Ð¾Ð²ÑƒÑŽ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð·Ð°ÐºÐ°Ð·Ð°
            const result = storage.processOrder(orderData);
            
            if (result.success) {
                showToast(`Ð—Ð°ÐºÐ°Ð· ${result.order.order_number} ÑÐ¾Ð·Ð´Ð°Ð½ Ð¸ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð½Ð° ${result.production_plan.line_name}`, 'success');
                
                // ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð´ÐµÑ‚Ð°Ð»Ð¸ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
                setTimeout(() => {
                    let detailMessage = `ðŸ“‹ Ð—Ð°ÐºÐ°Ð· Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½:\n`;
                    detailMessage += `ðŸ­ Ð›Ð¸Ð½Ð¸Ñ: ${result.production_plan.line_name}\n`;
                    detailMessage += `â±ï¸ Ð’Ñ€ÐµÐ¼Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°: ${Math.round(result.production_plan.production_time)} Ð¼Ð¸Ð½\n`;
                    detailMessage += `ðŸ“¦ ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ñ‹ Ð·Ð°Ñ€ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹:\n`;
                    result.material_requirements.forEach(req => {
                        detailMessage += `  â€¢ ${req.material_code}: ${req.required_quantity} ${req.unit}\n`;
                    });
                    
                    alert(detailMessage);
                }, 1000);
            } else {
                if (result.missing) {
                    let errorMessage = `âŒ Ð—Ð°ÐºÐ°Ð· ${result.order.order_number} ÑÐ¾Ð·Ð´Ð°Ð½, Ð½Ð¾ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½:\n\n`;
                    errorMessage += `ðŸš« ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²:\n`;
                    result.missing.forEach(item => {
                        errorMessage += `  â€¢ ${item}\n`;
                    });
                    
                    showToast('Ð—Ð°ÐºÐ°Ð· ÑÐ¾Ð·Ð´Ð°Ð½, Ð½Ð¾ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð´Ð¾Ð·Ð°ÐºÐ°Ð·Ð° Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð¾Ð²', 'warning');
                    setTimeout(() => alert(errorMessage), 500);
                } else {
                    showToast(`ÐžÑˆÐ¸Ð±ÐºÐ°: ${result.message}`, 'error');
                }
            }
            hideModal('orderModal');
            loadOrders();
            loadDashboard();
        });

        // =============================================
        // ADVANCED IMPORT SYSTEM
        // =============================================

        let importDataState = {
            entityType: null,
            file: null,
            parsedData: null,
            validatedData: null
        };

        // Entity field mappings for templates and validation
        const entityFields = {
            materials: [
                { key: 'code', label: 'ÐšÐ¾Ð´ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°', required: true, example: 'GR-PVD-001' },
                { key: 'name', label: 'ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ', required: true, example: 'Ð“Ñ€Ð°Ð½ÑƒÐ»ÑÑ‚ ÐŸÐ’Ð” Ð¿Ñ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ñ‹Ð¹' },
                { key: 'type', label: 'Ð¢Ð¸Ð¿', required: true, example: 'granulate_ldpe' },
                { key: 'unit', label: 'Ð•Ð´Ð¸Ð½Ð¸Ñ†Ð° Ð¸Ð·Ð¼ÐµÑ€ÐµÐ½Ð¸Ñ', required: true, example: 'ÐºÐ³' },
                { key: 'standard_cost', label: 'Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð°Ñ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ', required: false, example: '245.50' },
                { key: 'min_stock_level', label: 'ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº', required: false, example: '1000' },
                { key: 'reorder_point', label: 'Ð¢Ð¾Ñ‡ÐºÐ° Ð¿ÐµÑ€ÐµÐ·Ð°ÐºÐ°Ð·Ð°', required: false, example: '2000' },
                { key: 'supplier_id', label: 'ID Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°', required: false, example: '1' },
                { key: 'description', label: 'ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ', required: false, example: 'ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°' }
            ],
            suppliers: [
                { key: 'code', label: 'ÐšÐ¾Ð´ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°', required: true, example: 'SUP001' },
                { key: 'name', label: 'ÐÐ°Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ', required: true, example: 'Dow Chemical Europe' },
                { key: 'contact_person', label: 'ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð½Ð¾Ðµ Ð»Ð¸Ñ†Ð¾', required: false, example: 'John Smith' },
                { key: 'email', label: 'Email', required: false, example: 'contact@company.com' },
                { key: 'phone', label: 'Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½', required: false, example: '+7-495-123-4567' },
                { key: 'address', label: 'ÐÐ´Ñ€ÐµÑ', required: false, example: 'ÐœÐ¾ÑÐºÐ²Ð°, ÑƒÐ». ÐŸÑ€Ð¸Ð¼ÐµÑ€Ð½Ð°Ñ, 1' },
                { key: 'is_active', label: 'ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹', required: false, example: 'true' }
            ],
            inventory: [
                { key: 'material_id', label: 'ID Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°', required: true, example: '1' },
                { key: 'warehouse', label: 'Ð¡ÐºÐ»Ð°Ð´', required: true, example: 'MAG-1' },
                { key: 'batch_number', label: 'ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸', required: false, example: '240115-001' },
                { key: 'quantity', label: 'ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾', required: true, example: '1000' },
                { key: 'reserved_quantity', label: 'Ð—Ð°Ñ€ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾', required: false, example: '0' },
                { key: 'location_code', label: 'ÐšÐ¾Ð´ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸', required: false, example: 'A1-05-02' }
            ],
            batches: [
                { key: 'batch_number', label: 'ÐÐ¾Ð¼ÐµÑ€ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸', required: true, example: '240115-001' },
                { key: 'material_id', label: 'ID Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð°', required: true, example: '1' },
                { key: 'supplier_id', label: 'ID Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°', required: true, example: '1' },
                { key: 'received_quantity', label: 'ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾', required: true, example: '2500' },
                { key: 'production_date', label: 'Ð”Ð°Ñ‚Ð° Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´ÑÑ‚Ð²Ð°', required: false, example: '2024-01-10' },
                { key: 'received_date', label: 'Ð”Ð°Ñ‚Ð° Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ', required: true, example: '2024-01-15' },
                { key: 'quality_status', label: 'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ°Ñ‡ÐµÑÑ‚Ð²Ð°', required: false, example: 'approved' }
            ],
            orders: [
                { key: 'order_number', label: 'ÐÐ¾Ð¼ÐµÑ€ Ð·Ð°ÐºÐ°Ð·Ð°', required: true, example: 'ORD-240001' },
                { key: 'customer', label: 'ÐšÐ»Ð¸ÐµÐ½Ñ‚', required: true, example: 'ÐžÐžÐž ÐŸÐ¸Ñ‰ÐµÐ¿Ñ€Ð¾Ð¼' },
                { key: 'product', label: 'ÐŸÑ€Ð¾Ð´ÑƒÐºÑ‚', required: true, example: 'ÐŸÐ»ÐµÐ½ÐºÐ° ÐŸÐ­Ð¢ 12Ð¼ÐºÐ¼' },
                { key: 'quantity', label: 'ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾', required: true, example: '5000' },
                { key: 'order_date', label: 'Ð”Ð°Ñ‚Ð° Ð·Ð°ÐºÐ°Ð·Ð°', required: true, example: '2024-01-20' },
                { key: 'delivery_date', label: 'Ð”Ð°Ñ‚Ð° Ð¿Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸', required: false, example: '2024-01-25' },
                { key: 'status', label: 'Ð¡Ñ‚Ð°Ñ‚ÑƒÑ', required: false, example: 'new' },
                { key: 'priority', label: 'ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚', required: false, example: 'medium' }
            ]
        };

        // Handle entity type selection
        document.addEventListener('change', function(e) {
            if (e.target.name === 'entityType') {
                importDataState.entityType = e.target.value;
                checkImportReadiness();
            }
        });

        // Check if ready to proceed to next step
        function checkImportReadiness() {
            const nextBtn = document.getElementById('nextBtn');
            const hasEntity = importDataState.entityType;
            const hasFile = importDataState.file;
            
            if (nextBtn) {
                nextBtn.disabled = !(hasEntity && hasFile);
            }
        }

        // Handle file selection
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            importDataState.file = file;
            
            // Show file info
            const fileInfo = document.getElementById('fileInfo');
            if (fileInfo) {
                fileInfo.style.display = 'block';
                fileInfo.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="file-icon">ðŸ“„</div>
                        <div>
                            <div style="font-weight: 600;">${file.name}</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                ${(file.size / 1024).toFixed(1)} KB â€¢ ${file.type || 'Unknown type'}
                            </div>
                        </div>
                    </div>
                `;
            }

            checkImportReadiness();
        }

        // Download template files
        function downloadTemplate(format) {
            if (!importDataState.entityType) {
                showToast('Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¸Ð¿ Ð´Ð°Ð½Ð½Ñ‹Ñ…', 'warning');
                return;
            }

            const fields = entityFields[importDataState.entityType];
            const headers = fields.map(f => f.label);
            const example = fields.map(f => f.example);

            if (format === 'csv') {
                const csvContent = [
                    headers.join(','),
                    example.join(',')
                ].join('\n');

                downloadFile(csvContent, `${importDataState.entityType}_template.csv`, 'text/csv');
            } else if (format === 'excel') {
                // Simple Excel-like format (actually CSV with Excel extension)
                const csvContent = [
                    headers.join(','),
                    example.join(',')
                ].join('\n');

                downloadFile(csvContent, `${importDataState.entityType}_template.xlsx`, 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            }
        }

        // Utility function to download files
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑÐºÐ°Ñ‡Ð°Ð½', 'success');
        }

        // Parse different file formats
        function parseFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const content = e.target.result;
                    const extension = file.name.split('.').pop().toLowerCase();
                    
                    try {
                        let data;
                        
                        if (extension === 'json') {
                            data = JSON.parse(content);
                        } else if (extension === 'csv') {
                            data = parseCSV(content);
                        } else if (['xlsx', 'xls'].includes(extension)) {
                            // For now, treat Excel files as CSV (user should save as CSV)
                            showToast('ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚Ðµ Excel Ñ„Ð°Ð¹Ð» ÐºÐ°Ðº CSV', 'warning');
                            reject(new Error('Excel files not supported yet. Please convert to CSV.'));
                            return;
                        } else {
                            reject(new Error('Unsupported file format'));
                            return;
                        }
                        
                        resolve(data);
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = () => reject(new Error('File reading failed'));
                reader.readAsText(file);
            });
        }

        // Simple CSV parser
        function parseCSV(content) {
            const lines = content.split('\n').filter(line => line.trim());
            if (lines.length < 2) throw new Error('CSV Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ');
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                
                data.push(row);
            }
            
            return data;
        }

        // Navigation between steps
        function nextStep() {
            if (!importDataState.file || !importDataState.entityType) {
                showToast('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ‚Ð¸Ð¿ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ñ„Ð°Ð¹Ð»', 'warning');
                return;
            }

            // Parse file and show preview
            parseFile(importDataState.file)
                .then(data => {
                    importDataState.parsedData = data;
                    showPreview(data);
                    
                    // Switch to step 2
                    document.getElementById('importStep1').style.display = 'none';
                    document.getElementById('importStep2').style.display = 'block';
                    document.getElementById('nextBtn').style.display = 'none';
                    document.getElementById('importBtn').style.display = 'inline-flex';
                })
                .catch(error => {
                    showToast('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð°: ' + error.message, 'error');
                });
        }

        function backToStep1() {
            document.getElementById('importStep1').style.display = 'block';
            document.getElementById('importStep2').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-flex';
            document.getElementById('importBtn').style.display = 'none';
        }

        // Show data preview
        function showPreview(data) {
            if (!Array.isArray(data) || data.length === 0) {
                showToast('ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð°', 'warning');
                return;
            }

            const fields = entityFields[importDataState.entityType];
            const previewHeader = document.getElementById('previewHeader');
            const previewBody = document.getElementById('previewBody');
            const previewCount = document.getElementById('previewCount');

            // Build header
            previewHeader.innerHTML = `
                <tr>
                    ${fields.map(field => `<th>${field.label}</th>`).join('')}
                    <th>Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</th>
                </tr>
            `;

            // Build body (show first 10 rows)
            const previewRows = data.slice(0, 10);
            previewBody.innerHTML = previewRows.map(row => {
                const validation = validateRow(row, fields);
                const statusClass = validation.isValid ? 'badge-success' : 'badge-danger';
                const statusText = validation.isValid ? 'âœ… ÐžÐš' : 'âŒ ÐžÑˆÐ¸Ð±ÐºÐ°';
                
                return `
                    <tr>
                        ${fields.map(field => {
                            const value = getFieldValue(row, field);
                            return `<td>${value || '-'}</td>`;
                        }).join('')}
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');

            if (previewCount) {
                previewCount.textContent = data.length;
            }
        }

        // Get field value from row (flexible field matching)
        function getFieldValue(row, field) {
            // Try exact key match first
            if (row.hasOwnProperty(field.key)) {
                return row[field.key];
            }
            
            // Try label match
            if (row.hasOwnProperty(field.label)) {
                return row[field.label];
            }
            
            // Try case-insensitive matches
            const keys = Object.keys(row);
            const matchKey = keys.find(key => 
                key.toLowerCase() === field.key.toLowerCase() ||
                key.toLowerCase() === field.label.toLowerCase()
            );
            
            return matchKey ? row[matchKey] : '';
        }

        // Validate a single row
        function validateRow(row, fields) {
            const errors = [];
            
            fields.forEach(field => {
                if (field.required) {
                    const value = getFieldValue(row, field);
                    if (!value || value.toString().trim() === '') {
                        errors.push(`${field.label} Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ`);
                    }
                }
            });
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }

        // Execute import
        function executeImport() {
            if (!importDataState.parsedData) {
                showToast('ÐÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð´Ð»Ñ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð°', 'error');
                return;
            }

            const skipDuplicates = document.getElementById('skipDuplicates').checked;
            const updateExisting = document.getElementById('updateExisting').checked;
            const validateData = document.getElementById('validateData').checked;
            
            const fields = entityFields[importDataState.entityType];
            const existingData = storage.getTable(importDataState.entityType);
            
            let imported = 0;
            let skipped = 0;
            let updated = 0;
            let errors = 0;

            importDataState.parsedData.forEach(row => {
                try {
                    // Validate if required
                    if (validateData) {
                        const validation = validateRow(row, fields);
                        if (!validation.isValid) {
                            errors++;
                            return;
                        }
                    }

                    // Convert row to proper format
                    const record = {};
                    fields.forEach(field => {
                        const value = getFieldValue(row, field);
                        if (value !== '') {
                            if (['standard_cost', 'min_stock_level', 'reorder_point', 'quantity', 'reserved_quantity', 'received_quantity'].includes(field.key)) {
                                record[field.key] = parseFloat(value);
                            } else if (['material_id', 'supplier_id'].includes(field.key)) {
                                record[field.key] = parseInt(value);
                            } else if (field.key === 'is_active') {
                                record[field.key] = value.toLowerCase() === 'true' || value === '1';
                            } else {
                                record[field.key] = value;
                            }
                        }
                    });

                    // Check for duplicates
                    const identifierField = ['code', 'order_number', 'batch_number'].find(f => record[f]);
                    let existingRecord = null;
                    
                    if (identifierField) {
                        existingRecord = existingData.find(item => item[identifierField] === record[identifierField]);
                    }

                    if (existingRecord) {
                        if (updateExisting) {
                            storage.updateRecord(importDataState.entityType, existingRecord.id, record);
                            updated++;
                        } else if (skipDuplicates) {
                            skipped++;
                        } else {
                            storage.addRecord(importDataState.entityType, record);
                            imported++;
                        }
                    } else {
                        storage.addRecord(importDataState.entityType, record);
                        imported++;
                    }
                } catch (error) {
                    console.error('Import error for row:', row, error);
                    errors++;
                }
            });

            // Show results
            const message = `Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½: ${imported} Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾, ${updated} Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾, ${skipped} Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾, ${errors} Ð¾ÑˆÐ¸Ð±Ð¾Ðº`;
            showToast(message, errors > 0 ? 'warning' : 'success');
            
            storage.addActivity('data_import', `Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚ ${importDataState.entityType}: ${imported} Ð·Ð°Ð¿Ð¸ÑÐµÐ¹`);
            
            // Close modal and refresh
            hideModal('importModal');
            refreshCurrentTab();
            loadDashboard();
        }

        // =============================================
        // EXPORT/IMPORT FUNCTIONS (Legacy)
        // =============================================

        function exportData() {
            storage.exportData();
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    storage.importData(e.target.result);
                };
                reader.readAsText(file);
            }
        }

        function refreshCurrentTab() {
            const activeTab = document.querySelector('.nav-tab.active');
            if (activeTab) {
                activeTab.click();
            }
        }

        // =============================================
        // INITIALIZATION
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Add click outside modal to close
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
            });
        });

        // Delete functions for other entities
        function deleteInventory(id) {
            if (confirm('Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº?')) {
                storage.deleteRecord('inventory', id);
                storage.addActivity('inventory_deleted', 'Ð£Ð´Ð°Ð»ÐµÐ½ Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ðº');
                showToast('ÐžÑÑ‚Ð°Ñ‚Ð¾Ðº ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
                loadInventory();
                loadDashboard();
            }
        }

        function showInventoryDetails(inventoryId) {
            const inventory = storage.getTable('inventory');
            const materials = storage.getTable('materials');
            const orders = storage.getTable('orders');
            
            const item = inventory.find(inv => inv.id === inventoryId);
            if (!item) return;
            
            const material = materials.find(m => m.id === item.material_id);
            const reservedQty = item.reserved_quantity || 0;
            
            let details = `ðŸ“¦ Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¾Ð²:\n\n`;
            details += `ÐœÐ°Ñ‚ÐµÑ€Ð¸Ð°Ð»: ${material ? material.name : 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð¾'}\n`;
            details += `ÐšÐ¾Ð´: ${material ? material.code : '-'}\n`;
            details += `ÐŸÐ°Ñ€Ñ‚Ð¸Ñ: ${item.batch_number}\n`;
            details += `Ð’ÑÐµÐ³Ð¾: ${item.quantity} ÐºÐ³\n`;
            details += `Ð—Ð°Ñ€ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾: ${reservedQty} ÐºÐ³\n`;
            details += `Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾: ${(item.quantity - reservedQty)} ÐºÐ³\n\n`;
            
            if (item.reservations && item.reservations.length > 0) {
                details += `ðŸ”’ Ð ÐµÐ·ÐµÑ€Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:\n`;
                item.reservations.forEach(res => {
                    const order = orders.find(o => o.id === res.order_id);
                    details += `â€¢ ${res.quantity} ÐºÐ³ Ð´Ð»Ñ Ð·Ð°ÐºÐ°Ð·Ð° ${order ? order.order_number : res.order_id}\n`;
                });
            }
            
            alert(details);
        }

        function deleteBatch(id) {
            if (confirm('Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ð¿Ð°Ñ€Ñ‚Ð¸ÑŽ?')) {
                const batch = storage.getTable('batches').find(b => b.id === id);
                storage.deleteRecord('batches', id);
                storage.addActivity('batch_deleted', `Ð£Ð´Ð°Ð»ÐµÐ½Ð° Ð¿Ð°Ñ€Ñ‚Ð¸Ñ ${batch.batch_number}`);
                showToast('ÐŸÐ°Ñ€Ñ‚Ð¸Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°', 'success');
                loadBatches();
                loadDashboard();
            }
        }

        function deleteOrder(id) {
            if (confirm('Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾Ñ‚ Ð·Ð°ÐºÐ°Ð·?')) {
                const order = storage.getTable('orders').find(o => o.id === id);
                storage.deleteRecord('orders', id);
                storage.addActivity('order_deleted', `Ð£Ð´Ð°Ð»ÐµÐ½ Ð·Ð°ÐºÐ°Ð· ${order.order_number}`);
                showToast('Ð—Ð°ÐºÐ°Ð· ÑƒÐ´Ð°Ð»ÐµÐ½', 'success');
                loadOrders();
                loadDashboard();
            }
        }

        // Edit functions (simplified - open modal with data)
        function editMaterial(id) {
            const material = storage.getTable('materials').find(m => m.id === id);
            if (material) {
                // Fill form with existing data
                const form = document.getElementById('materialForm');
                Object.keys(material).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        input.value = material[key];
                    }
                });
                
                // Change form behavior to update instead of create
                form.dataset.editId = id;
                document.querySelector('#materialModal h3').textContent = 'Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»';
                showModal('materialModal');
            }
        }

        function editSupplier(id) {
            const supplier = storage.getTable('suppliers').find(s => s.id === id);
            if (supplier) {
                const form = document.getElementById('supplierForm');
                Object.keys(supplier).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = supplier[key];
                        } else {
                            input.value = supplier[key];
                        }
                    }
                });
                
                form.dataset.editId = id;
                document.querySelector('#supplierModal h3').textContent = 'Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÑ‚Ð°Ð²Ñ‰Ð¸ÐºÐ°';
                showModal('supplierModal');
            }
        }

        function editInventory(id) {
            showToast('Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¾Ð² - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'warning');
        }

        function editBatch(id) {
            showToast('Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸ - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'warning');
        }

        function editOrder(id) {
            showToast('Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð° - Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ', 'warning');
        }
    </script>
</body>
</html>