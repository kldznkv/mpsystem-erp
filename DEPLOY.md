# MPSYSTEM Backend Deployment Guide

## Deployment on Render.com

This guide explains how to deploy MPSYSTEM Backend to Render.com using automatic deployment from GitHub.

### Prerequisites

1. GitHub repository with MPSYSTEM code
2. Render.com account (free tier available)
3. PostgreSQL database (included in Render setup)

### Deployment Steps

#### 1. Push to GitHub

Ensure all code is pushed to your GitHub repository:

```bash
git add .
git commit -m "Prepare for Render.com deployment"
git push origin main
```

#### 2. Connect to Render.com

1. Go to [Render.com](https://render.com)
2. Sign up/login with your GitHub account
3. Click "New +" â†’ "Blueprint"
4. Connect your GitHub repository
5. Select the repository containing MPSYSTEM

#### 3. Automatic Deployment

Render will automatically detect the `render.yaml` file and:

- Create a PostgreSQL database (`mpsystem-db`)
- Create a web service (`mpsystem-backend`)
- Set up environment variables
- Deploy the application

#### 4. Environment Variables

The following environment variables are automatically configured:

- `ENVIRONMENT=production`
- `DEBUG=false`
- `SECRET_KEY` (auto-generated)
- `DATABASE_URL` (from PostgreSQL service)
- `CORS_ORIGINS` (GitHub Pages domain)
- `PORT=10000`

#### 5. Access Your Application

After deployment (5-10 minutes):

- **API URL**: `https://mpsystem-backend.onrender.com`
- **API Docs**: `https://mpsystem-backend.onrender.com/api/v1/docs`
- **Health Check**: `https://mpsystem-backend.onrender.com/health`

### Configuration Files

The deployment uses these configuration files:

- `render.yaml` - Render.com service configuration
- `backend/start_production.py` - Production startup script
- `backend/requirements.txt` - Python dependencies
- `backend/src/app/core/config.py` - Application configuration

### Database

- **Type**: PostgreSQL 15
- **Plan**: Free tier (0.1 CPU, 0.25GB RAM)
- **Storage**: 1GB
- **Connections**: 20 max

The database is automatically:
- Created and connected to the web service
- Initialized with tables on first startup
- Populated with sample data

### Frontend Configuration

Update your frontend to point to the production API:

```javascript
// In frontend/js/config.js
API_BASE_URL: 'https://mpsystem-backend.onrender.com'
```

### Monitoring and Logs

#### View Logs
```bash
# Through Render Dashboard
1. Go to your service dashboard
2. Click "Logs" tab
3. View real-time logs

# Or use Render CLI
render logs -s mpsystem-backend
```

#### Health Monitoring
- Automatic health checks every 30 seconds
- Endpoint: `/health`
- Returns database status and metrics

### Troubleshooting

#### Common Issues

1. **Build Fails**
   ```bash
   # Check build logs in Render dashboard
   # Verify requirements.txt is correct
   # Ensure Python version compatibility
   ```

2. **Database Connection Issues**
   ```bash
   # Check DATABASE_URL environment variable
   # Verify PostgreSQL service is running
   # Check connection pool settings
   ```

3. **CORS Errors**
   ```bash
   # Verify CORS_ORIGINS environment variable
   # Check frontend URL in config
   # Test with curl/Postman first
   ```

#### Environment Variables

To update environment variables:

1. Go to Render Dashboard
2. Select your service
3. Go to "Environment" tab
4. Add/modify variables
5. Service will auto-redeploy

### Performance Optimization

#### Free Tier Limitations
- Service spins down after 15 minutes of inactivity
- Cold start time: 10-30 seconds
- 750 hours/month limit

#### Optimization Tips
1. Use connection pooling (already configured)
2. Enable database connection pre-ping
3. Optimize database queries
4. Use appropriate worker count

### Production Checklist

- [ ] Environment variables configured
- [ ] Database connected and initialized
- [ ] CORS configured for frontend domain
- [ ] Health check endpoint working
- [ ] API documentation accessible
- [ ] Frontend updated to use production API
- [ ] SSL/HTTPS working
- [ ] Logs monitoring set up

### Security Notes

- Secret key is auto-generated by Render
- Database uses SSL connections
- CORS properly configured
- Debug mode disabled in production
- No sensitive data in logs

### Cost Estimation

**Free Tier (Current Setup):**
- Web Service: Free (750 hours/month)
- PostgreSQL: Free (1GB storage)
- Total: $0/month

**Paid Plans (Future):**
- Starter: $7/month (web) + $7/month (db)
- Pro: $25/month (web) + $20/month (db)

### Updates and Maintenance

#### Automatic Updates
- Push to `main` branch triggers auto-deployment
- Database migrations run automatically
- Zero-downtime deployments

#### Manual Operations
```bash
# Force redeploy
render deploy -s mpsystem-backend

# View service info
render services list

# Connect to database
render psql mpsystem-db
```

### Support

For deployment issues:
1. Check Render.com documentation
2. Review application logs
3. Test locally with Docker
4. Contact Render support (for platform issues)

---

**Next Steps**: After successful deployment, update your frontend configuration to use the production API endpoint.