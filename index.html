<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPSYSTEM Production ERP</title>
    <meta name="description" content="–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º –ø–ª–µ–Ω–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüè≠%3C/text%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Modern Dribbble-inspired CSS Variables */
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #a5b4fc;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            
            /* Modern neutral palette */
            --bg-primary: #fafbfc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f8fafc;
            --surface: #ffffff;
            --surface-hover: #f8fafc;
            
            /* Text colors */
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-tertiary: #94a3b8;
            --text-inverse: #ffffff;
            
            /* Border colors */
            --border-light: #e2e8f0;
            --border-medium: #cbd5e1;
            --border-dark: #94a3b8;
            
            /* Modern shadows */
            --shadow-xs: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            
            /* Modern spacing */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 20px;
            
            /* Transitions */
            --transition-fast: all 0.15s ease;
            --transition: all 0.2s ease;
            --transition-slow: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
            font-feature-settings: 'cv01', 'cv02', 'cv03', 'cv04';
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Modern Header */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border-light);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 1rem 2rem;
            backdrop-filter: blur(12px);
            background: rgba(255, 255, 255, 0.95);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.375rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .logo span:first-child {
            font-size: 1.5rem;
            filter: grayscale(20%);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .storage-status {
            padding: 0.5rem 0.875rem;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 500;
            border: 1px solid var(--border-light);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .storage-status.connected {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary-color);
            border-color: rgba(16, 185, 129, 0.2);
        }

        /* Modern Navigation */
        .nav-container {
            background: var(--surface);
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 2rem;
        }

        .nav-tabs {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            padding: 0 2rem;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            flex: 0 0 auto;
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.925rem;
            font-weight: 500;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
        }

        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--surface-hover);
        }

        .nav-tab:before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: var(--transition);
            transform: translateX(-50%);
        }

        .nav-tab.active:before {
            width: 100%;
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 4rem;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(16px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }

        /* Modern Cards */
        .card {
            background: var(--surface);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .card-title {
            font-size: 1.375rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        /* Modern Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.925rem;
        }

        .form-input, .form-select, .form-textarea {
            padding: 0.875rem 1rem;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-lg);
            font-size: 0.925rem;
            transition: var(--transition);
            background: var(--surface);
            color: var(--text-primary);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            background: var(--surface);
        }

        .form-input:hover, .form-select:hover, .form-textarea:hover {
            border-color: var(--border-dark);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            margin: 0;
        }

        /* Modern Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            border: 1px solid transparent;
            font-size: 0.925rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover:before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--text-inverse);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--surface);
            color: var(--text-secondary);
            border-color: var(--border-medium);
        }

        .btn-secondary:hover {
            background: var(--surface-hover);
            color: var(--text-primary);
            border-color: var(--border-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: var(--text-inverse);
            box-shadow: var(--shadow-sm);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: var(--text-inverse);
            box-shadow: var(--shadow-sm);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: var(--text-inverse);
            box-shadow: var(--shadow-sm);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Modern Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            background: var(--surface);
            border: 1px solid var(--border-light);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 1rem 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }

        .table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .table td {
            color: var(--text-primary);
            font-size: 0.925rem;
        }

        .table tr:hover {
            background: var(--surface-hover);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        /* Modern Status Badges */
        .badge {
            padding: 0.375rem 0.875rem;
            border-radius: var(--radius-lg);
            font-size: 0.8125rem;
            font-weight: 500;
            letter-spacing: 0.025em;
            border: 1px solid transparent;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary-color);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
            border-color: rgba(245, 158, 11, 0.2);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-color: rgba(239, 68, 68, 0.2);
        }

        .badge-info {
            background: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
            border-color: rgba(59, 130, 246, 0.2);
        }

        /* Modern Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: 1.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .stat-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
        }

        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: -0.025em;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: none;
            letter-spacing: 0;
        }

        /* Modern Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal.show {
            display: flex;
            opacity: 1;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--surface);
            border-radius: var(--radius-2xl);
            padding: 2rem;
            max-width: 640px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-light);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal.show .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        .modal-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: -0.025em;
        }

        .modal-close {
            background: var(--surface-hover);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            width: 32px;
            height: 32px;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--border-light);
            color: var(--text-primary);
        }

        /* File upload */
        .file-upload {
            border: 2px dashed var(--gray-300);
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            background: var(--gray-50);
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.05);
        }

        .file-upload.dragover {
            border-color: var(--primary-color);
            background: rgba(59, 130, 246, 0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                padding: 0 1rem;
            }

            .nav-tab {
                min-width: 120px;
            }

            .main-container {
                padding: 0 1rem 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-direction: column;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-lg);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 3000;
            max-width: 400px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--danger-color);
        }

        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }

        /* Modern Search */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1rem 0.875rem 2.75rem;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-lg);
            font-size: 0.925rem;
            background: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-input:hover {
            border-color: var(--border-dark);
        }

        .search-input::placeholder {
            color: var(--text-tertiary);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 1rem;
        }

        /* Action buttons in tables */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }

        /* Modern Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-tertiary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .empty-state p {
            font-size: 0.925rem;
            font-weight: 500;
        }

        /* Import Modal Styles */
        .import-step {
            min-height: 400px;
        }

        .import-section {
            margin-bottom: 2rem;
        }

        .import-section h4 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .entity-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .entity-option {
            cursor: pointer;
        }

        .entity-option input[type="radio"] {
            display: none;
        }

        .entity-card {
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            transition: var(--transition);
            background: var(--surface);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .entity-option input[type="radio"]:checked + .entity-card {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .entity-card:hover {
            border-color: var(--border-dark);
            background: var(--surface-hover);
        }

        .entity-icon {
            font-size: 2rem;
            opacity: 0.8;
        }

        .entity-info {
            flex: 1;
        }

        .entity-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .entity-desc {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .file-upload-area {
            border: 2px dashed var(--border-medium);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--surface-hover);
        }

        .file-upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .file-upload-area.dragover {
            border-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .upload-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .upload-subtitle {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .file-info {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .template-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .preview-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .preview-stats {
            font-weight: 600;
            color: var(--text-primary);
        }

        .preview-table-container {
            max-height: 300px;
            overflow: auto;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
        }

        .import-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
        }

        .modal-footer {
            border-top: 1px solid var(--border-light);
            padding-top: 1.5rem;
            margin-top: 2rem;
        }

        /* Simplified Interface Styles */
        .dashboard-widgets {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .widget-content {
            padding: 1rem;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-light);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }

        .task-status.completed {
            background: var(--success-color);
            color: white;
        }

        .task-status.pending {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .alert {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-lg);
            margin-bottom: 0.75rem;
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            color: #92400e;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            color: #1e40af;
        }

        /* Planning Timeline */
        .planning-timeline {
            background: var(--surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .timeline-header {
            display: grid;
            grid-template-columns: 200px repeat(5, 1fr);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-light);
        }

        .timeline-date {
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid var(--border-light);
        }

        .timeline-content {
            display: flex;
            flex-direction: column;
        }

        .production-line {
            display: grid;
            grid-template-columns: 200px repeat(5, 1fr);
            border-bottom: 1px solid var(--border-light);
        }

        .production-line:last-child {
            border-bottom: none;
        }

        .line-name {
            padding: 1rem;
            font-weight: 600;
            background: var(--bg-tertiary);
            border-right: 1px solid var(--border-light);
            display: flex;
            align-items: center;
        }

        .timeline-slots {
            display: contents;
        }

        .time-slot {
            padding: 1rem;
            border-right: 1px solid var(--border-light);
            text-align: center;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .time-slot.busy {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .time-slot.available {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .time-slot.planned {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .time-slot.maintenance {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        /* Orders Grid */
        .orders-filter {
            margin-bottom: 2rem;
        }

        .orders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .order-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: var(--transition);
        }

        .order-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .order-number {
            font-weight: 700;
            font-size: 1.125rem;
            color: var(--primary-color);
        }

        .order-info {
            margin-bottom: 1rem;
        }

        .order-customer {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .order-product {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .order-quantity {
            font-weight: 600;
            color: var(--primary-color);
        }

        .order-dates {
            color: var(--text-tertiary);
        }

        /* Warehouse */
        .warehouse-overview {
            margin-bottom: 2rem;
        }

        .warehouse-stats {
            display: flex;
            justify-content: space-around;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 2rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .warehouse-sections {
            display: grid;
            gap: 2rem;
        }

        .warehouse-section h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .material-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .material-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1rem;
        }

        .material-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .material-quantity {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .material-status {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .material-status.low {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .material-status.ok {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .finished-goods {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .goods-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
        }

        .quantity {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Production Lines */
        .production-lines {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .production-line-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .line-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .line-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .line-status {
            padding: 0.5rem 1rem;
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .line-status.running {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .line-status.maintenance {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .line-details {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .current-order {
            font-weight: 600;
            color: var(--primary-color);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
            transition: width 0.3s ease;
        }

        .line-metrics {
            display: flex;
            gap: 2rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .production-summary {
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .production-summary h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
        }

        .summary-item {
            text-align: center;
        }

        .summary-label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .summary-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* Analytics */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .analytics-card {
            background: var(--surface);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .analytics-card h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .chart-placeholder {
            display: flex;
            align-items: end;
            height: 150px;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, var(--primary-color), var(--primary-light));
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            min-height: 20px;
        }

        .chart-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .plan-progress {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .plan-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--primary-color) 87%, var(--bg-tertiary) 0);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .plan-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            background: var(--surface);
            border-radius: 50%;
            position: absolute;
        }

        .plan-percentage {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            z-index: 1;
            position: relative;
        }

        .plan-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .efficiency-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .efficiency-item {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .efficiency-item span:first-child {
            min-width: 80px;
            font-weight: 600;
        }

        .efficiency-bar {
            flex: 1;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
        }

        .efficiency-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #34d399);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: end;
            padding-right: 0.5rem;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .dashboard-widgets {
                grid-template-columns: 1fr;
            }

            .timeline-header,
            .production-line {
                grid-template-columns: 150px repeat(3, 1fr);
            }

            .orders-grid {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .plan-progress {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span>üè≠</span>
                <span>MPSYSTEM Production ERP</span>
            </div>
            <div class="header-actions">
                <div id="storageStatus" class="storage-status connected">
                    üíæ Local Storage Active
                </div>
                <button class="btn btn-secondary" onclick="exportData()">
                    üì§ Export Data
                </button>
                <button class="btn btn-secondary" onclick="showModal('importModal')">
                    üì• Import Data
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">
                üìä –î–∞—à–±–æ—Ä–¥
            </button>
            <button class="nav-tab" onclick="showTab('planning')">
                üìã –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            </button>
            <button class="nav-tab" onclick="showTab('orders')">
                üìë –ó–∞–∫–∞–∑—ã
            </button>
            <button class="nav-tab" onclick="showTab('warehouse')">
                üè≠ –°–∫–ª–∞–¥
            </button>
            <button class="nav-tab" onclick="showTab('production')">
                ‚öôÔ∏è –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ
            </button>
            <button class="nav-tab" onclick="showTab('analytics')">
                üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">–ó–∞–∫–∞–∑—ã –≤ —Ä–∞–±–æ—Ç–µ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="productionEfficiency">92%</div>
                    <div class="stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="warehouseLoad">85%</div>
                    <div class="stat-label">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫–ª–∞–¥–∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayProduction">2.5—Ç</div>
                    <div class="stat-label">–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
            </div>

            <div class="dashboard-widgets">
                <div class="card">
                    <div class="card-header">
                        <h3>üìã –ü–ª–∞–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    </div>
                    <div class="widget-content">
                        <div class="task-item">
                            <span class="task-status completed">‚úì</span>
                            <span>–ó–∞–ø—É—Å–∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –∑–∞–∫–∞–∑–∞ #ORD-240001</span>
                        </div>
                        <div class="task-item">
                            <span class="task-status pending">‚è≥</span>
                            <span>–ü—Ä–∏–µ–º–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</span>
                        </div>
                        <div class="task-item">
                            <span class="task-status pending">‚è≥</span>
                            <span>–û—Ç–≥—Ä—É–∑–∫–∞ –≥–æ—Ç–æ–≤–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    </div>
                    <div class="widget-content">
                        <div class="alert alert-warning">
                            –ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫: –ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î (500 –∫–≥)
                        </div>
                        <div class="alert alert-info">
                            –ü–ª–∞–Ω–æ–≤–æ–µ –¢–û –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –∑–∞–≤—Ç—Ä–∞
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Planning Tab -->
        <div id="planning" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h2>
                    <button class="btn btn-primary" onclick="createPlan()">
                        ‚ûï –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω
                    </button>
                </div>

                <div class="planning-timeline">
                    <div class="timeline-header">
                        <div class="timeline-date">–°–µ–≥–æ–¥–Ω—è</div>
                        <div class="timeline-date">–ó–∞–≤—Ç—Ä–∞</div>
                        <div class="timeline-date">28.01</div>
                        <div class="timeline-date">29.01</div>
                        <div class="timeline-date">30.01</div>
                    </div>
                    <div class="timeline-content">
                        <div class="production-line">
                            <div class="line-name">–õ–∏–Ω–∏—è 1 (–≠–∫—Å—Ç—Ä—É–∑–∏—è)</div>
                            <div class="timeline-slots">
                                <div class="time-slot busy">ORD-001</div>
                                <div class="time-slot available"></div>
                                <div class="time-slot planned">ORD-003</div>
                                <div class="time-slot available"></div>
                                <div class="time-slot available"></div>
                            </div>
                        </div>
                        <div class="production-line">
                            <div class="line-name">–õ–∏–Ω–∏—è 2 (–ü–µ—á–∞—Ç—å)</div>
                            <div class="timeline-slots">
                                <div class="time-slot busy">ORD-002</div>
                                <div class="time-slot busy">ORD-004</div>
                                <div class="time-slot available"></div>
                                <div class="time-slot planned">ORD-005</div>
                                <div class="time-slot available"></div>
                            </div>
                        </div>
                        <div class="production-line">
                            <div class="line-name">–õ–∏–Ω–∏—è 3 (–õ–∞–º–∏–Ω–∞—Ü–∏—è)</div>
                            <div class="timeline-slots">
                                <div class="time-slot maintenance">–¢–û</div>
                                <div class="time-slot available"></div>
                                <div class="time-slot available"></div>
                                <div class="time-slot available"></div>
                                <div class="time-slot available"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="orders" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">–ó–∞–∫–∞–∑—ã</h2>
                    <button class="btn btn-primary" onclick="createOrder()">
                        ‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑
                    </button>
                </div>

                <div class="orders-filter">
                    <select class="form-select" onchange="filterOrders(this.value)">
                        <option value="all">–í—Å–µ –∑–∞–∫–∞–∑—ã</option>
                        <option value="new">–ù–æ–≤—ã–µ</option>
                        <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                        <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                    </select>
                </div>

                <div class="orders-grid">
                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-number">#ORD-240001</span>
                            <span class="badge badge-warning">–í —Ä–∞–±–æ—Ç–µ</span>
                        </div>
                        <div class="order-info">
                            <div class="order-customer">–û–û–û "–ü–∏—â–µ–ø—Ä–æ–º"</div>
                            <div class="order-product">–ü–ª–µ–Ω–∫–∞ –ü–≠–¢ 12–º–∫–º, 1500–º–º</div>
                            <div class="order-quantity">5000 –ø.–º.</div>
                        </div>
                        <div class="order-dates">
                            <small>–ó–∞–∫–∞–∑: 20.01.2024 | –ü–æ—Å—Ç–∞–≤–∫–∞: 25.01.2024</small>
                        </div>
                    </div>

                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-number">#ORD-240002</span>
                            <span class="badge badge-danger">–ö—Ä–∏—Ç–∏—á–Ω—ã–π</span>
                        </div>
                        <div class="order-info">
                            <div class="order-customer">–ò–ü –°–º–∏—Ä–Ω–æ–≤</div>
                            <div class="order-product">–ü–∞–∫–µ—Ç—ã —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º</div>
                            <div class="order-quantity">10000 —à—Ç.</div>
                        </div>
                        <div class="order-dates">
                            <small>–ó–∞–∫–∞–∑: 22.01.2024 | –ü–æ—Å—Ç–∞–≤–∫–∞: 24.01.2024</small>
                        </div>
                    </div>

                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-number">#ORD-240003</span>
                            <span class="badge badge-info">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</span>
                        </div>
                        <div class="order-info">
                            <div class="order-customer">–¢–î "–ú–µ–≥–∞—Å—Ç—Ä–æ–π"</div>
                            <div class="order-product">–°—Ç—Ä–µ–π—á-–ø–ª–µ–Ω–∫–∞ 500–º–º</div>
                            <div class="order-quantity">2000 –∫–≥</div>
                        </div>
                        <div class="order-dates">
                            <small>–ó–∞–∫–∞–∑: 23.01.2024 | –ü–æ—Å—Ç–∞–≤–∫–∞: 30.01.2024</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Warehouse Tab -->
        <div id="warehouse" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º</h2>
                    <button class="btn btn-primary" onclick="receiveDelivery()">
                        üì¶ –ü—Ä–∏–Ω—è—Ç—å –ø–æ—Å—Ç–∞–≤–∫—É
                    </button>
                </div>

                <div class="warehouse-overview">
                    <div class="warehouse-stats">
                        <div class="stat-item">
                            <span class="stat-number">1247</span>
                            <span class="stat-text">—Ç —Å—ã—Ä—å—è</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">23</span>
                            <span class="stat-text">–Ω–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä—ã</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">85%</span>
                            <span class="stat-text">–∑–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                        </div>
                    </div>
                </div>

                <div class="warehouse-sections">
                    <div class="warehouse-section">
                        <h3>üì¶ –°—ã—Ä—å–µ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
                        <div class="material-grid">
                            <div class="material-card">
                                <div class="material-name">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î</div>
                                <div class="material-quantity">500 –∫–≥</div>
                                <div class="material-status low">–ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫</div>
                            </div>
                            <div class="material-card">
                                <div class="material-name">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ü</div>
                                <div class="material-quantity">750 –∫–≥</div>
                                <div class="material-status ok">–ù–æ—Ä–º–∞</div>
                            </div>
                            <div class="material-card">
                                <div class="material-name">–ö—Ä–∞—Å–∏—Ç–µ–ª—å —Å–∏–Ω–∏–π</div>
                                <div class="material-quantity">25 –∫–≥</div>
                                <div class="material-status ok">–ù–æ—Ä–º–∞</div>
                            </div>
                        </div>
                    </div>

                    <div class="warehouse-section">
                        <h3>üìã –ì–æ—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è</h3>
                        <div class="finished-goods">
                            <div class="goods-item">
                                <span>–ü–ª–µ–Ω–∫–∞ –ü–≠–¢ 12–º–∫–º</span>
                                <span class="quantity">150 —Ä—É–ª–æ–Ω–æ–≤</span>
                            </div>
                            <div class="goods-item">
                                <span>–ü–∞–∫–µ—Ç—ã —Ñ–∞—Å–æ–≤–æ—á–Ω—ã–µ</span>
                                <span class="quantity">50000 —à—Ç</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Production Tab -->
        <div id="production" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏</h2>
                    <button class="btn btn-secondary" onclick="refreshProduction()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>

                <div class="production-lines">
                    <div class="production-line-card">
                        <div class="line-header">
                            <h3>–õ–∏–Ω–∏—è 1 - –≠–∫—Å—Ç—Ä—É–∑–∏—è</h3>
                            <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                        </div>
                        <div class="line-details">
                            <div class="current-order">–ó–∞–∫–∞–∑: #ORD-240001</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 65%"></div>
                            </div>
                            <div class="line-metrics">
                                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: 65%</span>
                                <span>–°–∫–æ—Ä–æ—Å—Ç—å: 120 –º/–º–∏–Ω</span>
                                <span>–û—Å—Ç–∞–ª–æ—Å—å: 2—á 15–º–∏–Ω</span>
                            </div>
                        </div>
                    </div>

                    <div class="production-line-card">
                        <div class="line-header">
                            <h3>–õ–∏–Ω–∏—è 2 - –ü–µ—á–∞—Ç—å</h3>
                            <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                        </div>
                        <div class="line-details">
                            <div class="current-order">–ó–∞–∫–∞–∑: #ORD-240002</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 30%"></div>
                            </div>
                            <div class="line-metrics">
                                <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: 30%</span>
                                <span>–°–∫–æ—Ä–æ—Å—Ç—å: 85 –º/–º–∏–Ω</span>
                                <span>–û—Å—Ç–∞–ª–æ—Å—å: 4—á 20–º–∏–Ω</span>
                            </div>
                        </div>
                    </div>

                    <div class="production-line-card">
                        <div class="line-header">
                            <h3>–õ–∏–Ω–∏—è 3 - –õ–∞–º–∏–Ω–∞—Ü–∏—è</h3>
                            <span class="line-status maintenance">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</span>
                        </div>
                        <div class="line-details">
                            <div class="current-order">–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û</div>
                            <div class="line-metrics">
                                <span>–ù–∞—á–∞–ª–æ: 08:00</span>
                                <span>–û–∫–æ–Ω—á–∞–Ω–∏–µ: 12:00</span>
                                <span>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: –ü–µ—Ç—Ä–æ–≤ –ê.–ò.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="production-summary">
                    <h3>–°–≤–æ–¥–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ</span>
                            <span class="summary-value">2.5 —Ç–æ–Ω–Ω</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</span>
                            <span class="summary-value">18.5 —á–∞—Å–æ–≤</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</span>
                            <span class="summary-value">92%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h2>
                    <select class="form-select" style="width: auto;">
                        <option>–ó–∞ —Å–µ–≥–æ–¥–Ω—è</option>
                        <option>–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                        <option>–ó–∞ –º–µ—Å—è—Ü</option>
                    </select>
                </div>

                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                        <div class="chart-placeholder">
                            <div class="chart-bar" style="height: 60%"></div>
                            <div class="chart-bar" style="height: 80%"></div>
                            <div class="chart-bar" style="height: 75%"></div>
                            <div class="chart-bar" style="height: 90%"></div>
                            <div class="chart-bar" style="height: 85%"></div>
                        </div>
                        <div class="chart-labels">
                            <span>–ü–Ω</span><span>–í—Ç</span><span>–°—Ä</span><span>–ß—Ç</span><span>–ü—Ç</span>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>üí∞ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞</h3>
                        <div class="plan-progress">
                            <div class="plan-circle">
                                <span class="plan-percentage">87%</span>
                            </div>
                            <div class="plan-details">
                                <div>–ü–ª–∞–Ω: 100 —Ç–æ–Ω–Ω</div>
                                <div>–§–∞–∫—Ç: 87 —Ç–æ–Ω–Ω</div>
                                <div>–û—Å—Ç–∞–ª–æ—Å—å: 13 —Ç–æ–Ω–Ω</div>
                            </div>
                        </div>
                    </div>

                    <div class="analytics-card">
                        <h3>‚ö° –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</h3>
                        <div class="efficiency-list">
                            <div class="efficiency-item">
                                <span>–õ–∏–Ω–∏—è 1</span>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill" style="width: 95%">95%</div>
                                </div>
                            </div>
                            <div class="efficiency-item">
                                <span>–õ–∏–Ω–∏—è 2</span>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill" style="width: 88%">88%</div>
                                </div>
                            </div>
                            <div class="efficiency-item">
                                <span>–õ–∏–Ω–∏—è 3</span>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill" style="width: 0%">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Material Modal -->
    <div id="materialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</h3>
                <button class="modal-close" onclick="hideModal('materialModal')">&times;</button>
            </div>
            <form id="materialForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">–ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</label>
                        <input type="text" name="code" class="form-input" required placeholder="GR-PVD-001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="name" class="form-input" required placeholder="–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞</label>
                        <select name="type" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="granulate_ldpe">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î</option>
                            <option value="granulate_hdpe">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ù–î</option>
                            <option value="granulate_pp">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ü</option>
                            <option value="ink_printing">–ö—Ä–∞—Å–∫–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏</option>
                            <option value="adhesive_pu">–ö–ª–µ–π –ü–£</option>
                            <option value="adhesive_acrylic">–ö–ª–µ–π –∞–∫—Ä–∏–ª–æ–≤—ã–π</option>
                            <option value="solvent">–†–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—å</option>
                            <option value="additive">–î–æ–±–∞–≤–∫–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
                        <select name="unit" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –µ–¥–∏–Ω–∏—Ü—É</option>
                            <option value="–∫–≥">–∫–≥</option>
                            <option value="–ª">–ª</option>
                            <option value="–º">–º</option>
                            <option value="—à—Ç">—à—Ç</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
                        <input type="number" name="standard_cost" class="form-input" step="0.01" placeholder="245.50">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫</label>
                        <input type="number" name="min_stock_level" class="form-input" step="0.01" placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–æ—á–∫–∞ –ø–µ—Ä–µ–∑–∞–∫–∞–∑–∞</label>
                        <input type="number" name="reorder_point" class="form-input" step="0.01" placeholder="2000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü–æ—Å—Ç–∞–≤—â–∏–∫</label>
                        <select name="supplier_id" class="form-select" id="materialSupplierSelect">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea name="description" class="form-textarea" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞"></textarea>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal('materialModal')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</h3>
                <button class="modal-close" onclick="hideModal('supplierModal')">&times;</button>
            </div>
            <form id="supplierForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">–ö–æ–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</label>
                        <input type="text" name="code" class="form-input" required placeholder="SUP001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="name" class="form-input" required placeholder="Dow Chemical Europe">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                        <input type="text" name="contact_person" class="form-input" placeholder="John Smith">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" name="email" class="form-input" placeholder="contact@company.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" name="phone" class="form-input" placeholder="+7-495-123-4567">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                        <select name="is_active" class="form-select">
                            <option value="true">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                            <option value="false">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">–ê–¥—Ä–µ—Å</label>
                    <textarea name="address" class="form-textarea" placeholder="–ê–¥—Ä–µ—Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞"></textarea>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="hideModal('supplierModal')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Additional modals for inventory, batches, orders would follow similar pattern -->

                <!-- Inventory Modal -->
            <div id="inventoryModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>–î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–æ–∫</h3>
                        <button class="modal-close" onclick="hideModal('inventoryModal')">&times;</button>
                    </div>
                    <form id="inventoryForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">–ú–∞—Ç–µ—Ä–∏–∞–ª</label>
                                <select name="material_id" class="form-select" required id="inventoryMaterialSelect">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–°–∫–ª–∞–¥</label>
                                <select name="warehouse" class="form-select" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–∫–ª–∞–¥</option>
                                    <option value="MAG-1">MAG-1 - –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥</option>
                                    <option value="MAG-2">MAG-2 - –°–∫–ª–∞–¥ –≥–æ—Ç–æ–≤–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏</option>
                                    <option value="MAG-3">MAG-3 - –°–∫–ª–∞–¥ –±—Ä–∞–∫–∞</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏</label>
                                <input type="text" name="batch_number" class="form-input" placeholder="240115-001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                                <input type="number" name="quantity" class="form-input" step="0.01" required placeholder="1000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ</label>
                                <input type="number" name="reserved_quantity" class="form-input" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–õ–æ–∫–∞—Ü–∏—è</label>
                                <input type="text" name="location_code" class="form-input" placeholder="A1-05-02">
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('inventoryModal')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Batch Modal -->
            <div id="batchModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>–ü—Ä–∏–Ω—è—Ç—å –ø–∞—Ä—Ç–∏—é</h3>
                        <button class="modal-close" onclick="hideModal('batchModal')">&times;</button>
                    </div>
                    <form id="batchForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏</label>
                                <input type="text" name="batch_number" class="form-input" required placeholder="240115-001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ú–∞—Ç–µ—Ä–∏–∞–ª</label>
                                <select name="material_id" class="form-select" required id="batchMaterialSelect">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ü–æ—Å—Ç–∞–≤—â–∏–∫</label>
                                <select name="supplier_id" class="form-select" required id="batchSupplierSelect">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ü–æ–ª—É—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                                <input type="number" name="received_quantity" class="form-input" step="0.01" required placeholder="2500">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–î–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</label>
                                <input type="date" name="production_date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</label>
                                <input type="date" name="received_date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–°—Ç–∞—Ç—É—Å –∫–∞—á–µ—Å—Ç–≤–∞</label>
                                <select name="quality_status" class="form-select" required>
                                    <option value="pending">–û–∂–∏–¥–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è</option>
                                    <option value="approved">–û–¥–æ–±—Ä–µ–Ω–æ</option>
                                    <option value="quarantine">–ö–∞—Ä–∞–Ω—Ç–∏–Ω</option>
                                    <option value="blocked">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <h4>–î–æ–∫—É–º–µ–Ω—Ç—ã:</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 0.5rem;">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_coa" value="true"> –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ (CoA)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_tds" value="true"> –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è (TDS)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_sds" value="true"> –ü–∞—Å–ø–æ—Ä—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (SDS)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_doc" value="true"> –î–µ–∫–ª–∞—Ä–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (DoC)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="has_cmr" value="true"> –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è (CMR)
                                </label>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">üíæ –ü—Ä–∏–Ω—è—Ç—å –ø–∞—Ä—Ç–∏—é</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('batchModal')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Order Modal -->
            <div id="orderModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h3>
                        <button class="modal-close" onclick="hideModal('orderModal')">&times;</button>
                    </div>
                    <form id="orderForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</label>
                                <input type="text" name="order_number" class="form-input" required placeholder="ORD-240001">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ö–ª–∏–µ–Ω—Ç</label>
                                <input type="text" name="customer" class="form-input" required placeholder="–û–û–û –ü–∏—â–µ–ø—Ä–æ–º">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ü—Ä–æ–¥—É–∫—Ç</label>
                                <input type="text" name="product" class="form-input" required placeholder="–ü–ª–µ–Ω–∫–∞ –ü–≠–¢ 12–º–∫–º">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                                <input type="number" name="quantity" class="form-input" step="0.01" required placeholder="5000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</label>
                                <input type="date" name="order_date" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–î–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏</label>
                                <input type="date" name="delivery_date" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                <select name="status" class="form-select" required>
                                    <option value="new">–ù–æ–≤—ã–π</option>
                                    <option value="planned">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</option>
                                    <option value="in_production">–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ</option>
                                    <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                                    <option value="shipped">–û—Ç–≥—Ä—É–∂–µ–Ω</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                                <select name="priority" class="form-select" required>
                                    <option value="low">–ù–∏–∑–∫–∏–π</option>
                                    <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                                    <option value="critical">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
                            <textarea name="notes" class="form-textarea" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É"></textarea>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">üíæ –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
                            <button type="button" class="btn btn-secondary" onclick="hideModal('orderModal')">‚ùå –û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Import Modal -->
            <div id="importModal" class="modal">
                <div class="modal-content" style="max-width: 1000px;">
                    <div class="modal-header">
                        <h3>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                        <button class="modal-close" onclick="hideModal('importModal')">&times;</button>
                    </div>
                    
                    <div id="importStep1" class="import-step">
                        <div class="import-section">
                            <h4>1. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞</h4>
                            <div class="entity-selection">
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="materials">
                                    <div class="entity-card">
                                        <div class="entity-icon">üì¶</div>
                                        <div class="entity-info">
                                            <div class="entity-name">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
                                            <div class="entity-desc">–ö–æ–¥, –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, —Ç–∏–ø, —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="suppliers">
                                    <div class="entity-card">
                                        <div class="entity-icon">üë•</div>
                                        <div class="entity-info">
                                            <div class="entity-name">–ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</div>
                                            <div class="entity-desc">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –∫–æ–Ω—Ç–∞–∫—Ç—ã, —Ä–µ–π—Ç–∏–Ω–≥</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="inventory">
                                    <div class="entity-card">
                                        <div class="entity-icon">üìã</div>
                                        <div class="entity-info">
                                            <div class="entity-name">–û—Å—Ç–∞—Ç–∫–∏</div>
                                            <div class="entity-desc">–°–∫–ª–∞–¥, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –ª–æ–∫–∞—Ü–∏—è</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="batches">
                                    <div class="entity-card">
                                        <div class="entity-icon">üè∑Ô∏è</div>
                                        <div class="entity-info">
                                            <div class="entity-name">–ü–∞—Ä—Ç–∏–∏</div>
                                            <div class="entity-desc">–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏, –º–∞—Ç–µ—Ä–∏–∞–ª, –ø–æ—Å—Ç–∞–≤—â–∏–∫</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="entity-option">
                                    <input type="radio" name="entityType" value="orders">
                                    <div class="entity-card">
                                        <div class="entity-icon">üìë</div>
                                        <div class="entity-info">
                                            <div class="entity-name">–ó–∞–∫–∞–∑—ã</div>
                                            <div class="entity-desc">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞, –∫–ª–∏–µ–Ω—Ç, –ø—Ä–æ–¥—É–∫—Ç</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="import-section">
                            <h4>2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</h4>
                            <div class="file-upload-area" onclick="document.getElementById('importFileInput').click()">
                                <div class="upload-icon">üìÅ</div>
                                <div class="upload-text">
                                    <div class="upload-title">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</div>
                                    <div class="upload-subtitle">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: CSV, Excel (.xlsx, .xls), JSON</div>
                                </div>
                                <input type="file" id="importFileInput" style="display: none;" 
                                       accept=".csv,.xlsx,.xls,.json" onchange="handleImportFile(event)">
                            </div>
                            <div id="fileInfo" class="file-info" style="display: none;"></div>
                        </div>

                        <div class="import-section">
                            <h4>3. –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</h4>
                            <div class="template-options">
                                <button class="btn btn-secondary btn-sm" onclick="downloadTemplate('csv')">
                                    üìÑ –°–∫–∞—á–∞—Ç—å CSV —à–∞–±–ª–æ–Ω
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="downloadTemplate('excel')">
                                    üìä –°–∫–∞—á–∞—Ç—å Excel —à–∞–±–ª–æ–Ω
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="importStep2" class="import-step" style="display: none;">
                        <div class="import-section">
                            <h4>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</h4>
                            <div class="preview-info">
                                <div class="preview-stats">
                                    <span id="previewCount">0</span> –∑–∞–ø–∏—Å–µ–π –≥–æ—Ç–æ–≤–æ –∫ –∏–º–ø–æ—Ä—Ç—É
                                </div>
                                <div class="preview-actions">
                                    <button class="btn btn-secondary btn-sm" onclick="backToStep1()">
                                        ‚Üê –ù–∞–∑–∞–¥
                                    </button>
                                </div>
                            </div>
                            <div class="preview-table-container">
                                <table class="table" id="previewTable">
                                    <thead id="previewHeader"></thead>
                                    <tbody id="previewBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="import-section">
                            <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–º–ø–æ—Ä—Ç–∞</h4>
                            <div class="import-options">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="skipDuplicates" checked>
                                    –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã (–ø–æ –∫–æ–¥—É/–Ω–æ–º–µ—Ä—É)
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="updateExisting">
                                    –û–±–Ω–æ–≤–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="validateData" checked>
                                    –ü—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <div class="btn-group">
                            <button id="nextBtn" class="btn btn-primary" onclick="nextStep()" disabled>
                                –î–∞–ª–µ–µ ‚Üí
                            </button>
                            <button id="importBtn" class="btn btn-success" onclick="executeImport()" style="display: none;">
                                ‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                            </button>
                            <button class="btn btn-secondary" onclick="hideModal('importModal')">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File input for old import (backup) -->
            <input type="file" id="fileInput" style="display: none;" accept=".json" onchange="handleFileImport(event)">

    <script>
        // =============================================
        // DATA STORAGE AND MANAGEMENT
        // =============================================
        
        class ERPStorage {
            constructor() {
                this.storageKey = 'mpsystem_erp_data';
                this.init();
            }

            init() {
                if (!localStorage.getItem(this.storageKey)) {
                    this.initializeWithSampleData();
                }
                this.updateStorageStatus();
            }

            initializeWithSampleData() {
                const sampleData = {
                    materials: [
                        {
                            id: 1,
                            code: 'GR-PVD-001',
                            name: '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î LDPE 020C –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π',
                            type: 'granulate_ldpe',
                            unit: '–∫–≥',
                            description: '–ì—Ä–∞–Ω—É–ª—è—Ç –ø–æ–ª–∏—ç—Ç–∏–ª–µ–Ω–∞ –Ω–∏–∑–∫–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –ø–ª–µ–Ω–∫–∏',
                            standard_cost: 245.50,
                            min_stock_level: 1000.0,
                            reorder_point: 2000.0,
                            supplier_id: 1,
                            is_active: true,
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 2,
                            code: 'INK-RED-001',
                            name: '–ö—Ä–∞—Å–∫–∞ –∫—Ä–∞—Å–Ω–∞—è RAL 3020',
                            type: 'ink_printing',
                            unit: '–∫–≥',
                            description: '–ö—Ä–∞—Å–∫–∞ –¥–ª—è —Ñ–ª–µ–∫—Å–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –ø–µ—á–∞—Ç–∏, –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç RAL 3020',
                            standard_cost: 1250.00,
                            min_stock_level: 50.0,
                            reorder_point: 100.0,
                            supplier_id: 2,
                            is_active: true,
                            created_at: new Date().toISOString()
                        }
                    ],
                    suppliers: [
                        {
                            id: 1,
                            code: 'SUP001',
                            name: 'Dow Chemical Europe',
                            contact_person: 'John Smith',
                            email: 'john.smith@dow.com',
                            phone: '+49-123-456789',
                            address: 'Industrial Park, Germany',
                            rating_delivery: 98.5,
                            rating_quality: 99.2,
                            rating_documents: 100.0,
                            rating_cooperation: 85.0,
                            overall_rating: 95.8,
                            is_active: true,
                            is_approved: true,
                            created_at: new Date().toISOString()
                        },
                        {
                            id: 2,
                            code: 'SUP002',
                            name: 'Siegwerk Druckfarben',
                            contact_person: 'Klaus Mueller',
                            email: 'k.mueller@siegwerk.com',
                            phone: '+49-2241-304-0',
                            address: 'Siegburg, Germany',
                            rating_delivery: 92.8,
                            rating_quality: 98.5,
                            rating_documents: 96.0,
                            rating_cooperation: 90.0,
                            overall_rating: 94.5,
                            is_active: true,
                            is_approved: true,
                            created_at: new Date().toISOString()
                        }
                    ],
                    inventory: [
                        {
                            id: 1,
                            material_id: 1,
                            warehouse: 'MAG-1',
                            batch_number: '240115-001',
                            quantity: 2500.0,
                            reserved_quantity: 0.0,
                            available_quantity: 2500.0,
                            location_code: 'A1-05-02',
                            last_movement_date: new Date().toISOString()
                        }
                    ],
                    batches: [
                        {
                            id: 1,
                            batch_number: '240115-001',
                            material_id: 1,
                            supplier_id: 1,
                            received_quantity: 2500.0,
                            available_quantity: 2500.0,
                            production_date: '2024-01-10',
                            received_date: '2024-01-15',
                            quality_status: 'approved',
                            has_coa: true,
                            has_tds: true,
                            has_sds: true,
                            has_doc: true,
                            has_cmr: true,
                            created_at: new Date().toISOString()
                        }
                    ],
                    orders: [],
                    activities: [
                        {
                            id: 1,
                            type: 'material_created',
                            description: '–°–æ–∑–¥–∞–Ω –º–∞—Ç–µ—Ä–∏–∞–ª GR-PVD-001',
                            timestamp: new Date().toISOString()
                        }
                    ]
                };

                this.setData(sampleData);
                this.addActivity('system_init', '–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å –æ–±—Ä–∞–∑—Ü–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏');
            }

            getData() {
                try {
                    return JSON.parse(localStorage.getItem(this.storageKey)) || {};
                } catch (e) {
                    console.error('Error parsing storage data:', e);
                    return {};
                }
            }

            setData(data) {
                try {
                    localStorage.setItem(this.storageKey, JSON.stringify(data));
                    this.updateStorageStatus();
                    return true;
                } catch (e) {
                    console.error('Error saving to storage:', e);
                    showToast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
                    return false;
                }
            }

            getTable(tableName) {
                const data = this.getData();
                return data[tableName] || [];
            }

            setTable(tableName, tableData) {
                const data = this.getData();
                data[tableName] = tableData;
                return this.setData(data);
            }

            addRecord(tableName, record) {
                const table = this.getTable(tableName);
                const newId = table.length > 0 ? Math.max(...table.map(r => r.id)) + 1 : 1;
                const newRecord = {
                    id: newId,
                    ...record,
                    created_at: new Date().toISOString()
                };
                table.push(newRecord);
                this.setTable(tableName, table);
                return newRecord;
            }

            updateRecord(tableName, id, updates) {
                const table = this.getTable(tableName);
                const index = table.findIndex(r => r.id === id);
                if (index !== -1) {
                    table[index] = { ...table[index], ...updates, updated_at: new Date().toISOString() };
                    this.setTable(tableName, table);
                    return table[index];
                }
                return null;
            }

            deleteRecord(tableName, id) {
                const table = this.getTable(tableName);
                const filteredTable = table.filter(r => r.id !== id);
                this.setTable(tableName, filteredTable);
                return true;
            }

            addActivity(type, description) {
                const activities = this.getTable('activities');
                const newActivity = {
                    id: activities.length + 1,
                    type,
                    description,
                    timestamp: new Date().toISOString()
                };
                activities.unshift(newActivity); // Add to beginning
                activities.splice(10); // Keep only last 10
                this.setTable('activities', activities);
            }

            updateStorageStatus() {
                const data = this.getData();
                const size = new Blob([JSON.stringify(data)]).size;
                const statusElement = document.getElementById('storageStatus');
                if (statusElement) {
                    statusElement.textContent = `üíæ Local Storage (${(size / 1024).toFixed(1)} KB)`;
                }
            }

            exportData() {
                const data = this.getData();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mpsystem_erp_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showToast('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
            }

            importData(jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    this.setData(data);
                    this.addActivity('data_import', '–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞');
                    showToast('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                    refreshCurrentTab();
                    return true;
                } catch (e) {
                    console.error('Import error:', e);
                    showToast('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', 'error');
                    return false;
                }
            }
        }

        // Initialize storage
        const storage = new ERPStorage();

        // =============================================
        // UI MANAGEMENT
        // =============================================

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Load tab content
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'planning':
                    loadPlanning();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'warehouse':
                    loadWarehouse();
                    break;
                case 'production':
                    loadProduction();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('show');

            // Load data for specific modals
            if (modalId === 'materialModal') {
                loadSuppliersSelect();
            } else if (modalId === 'inventoryModal') {
                loadMaterialsSelect('inventoryMaterialSelect');
            } else if (modalId === 'batchModal') {
                loadMaterialsSelect('batchMaterialSelect');
                loadSuppliersSelect('batchSupplierSelect');
            }
        }

        function loadMaterialsSelect(selectId) {
            const materials = storage.getTable('materials');
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª</option>' + 
                materials.map(m => `<option value="${m.id}">${m.code} - ${m.name}</option>`).join('');
        }

        function loadSuppliersSelect(selectId = 'materialSupplierSelect') {
            const suppliers = storage.getTable('suppliers');
            const select = document.getElementById(selectId);
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</option>' + 
                suppliers.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('show');
            
            // Reset form and edit state
            const form = modal.querySelector('form');
            if (form) {
                form.reset();
                delete form.dataset.editId;
            }
            
            // Reset modal titles
            if (modalId === 'materialModal') {
                document.querySelector('#materialModal h3').textContent = '–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª';
            } else if (modalId === 'supplierModal') {
                document.querySelector('#supplierModal h3').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞';
            } else if (modalId === 'importModal') {
                // Reset import state
                importDataState.entityType = null;
                importDataState.file = null;
                importDataState.parsedData = null;
                importDataState.validatedData = null;
                
                // Reset UI
                document.getElementById('importStep1').style.display = 'block';
                document.getElementById('importStep2').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-flex';
                document.getElementById('importBtn').style.display = 'none';
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('fileInfo').style.display = 'none';
                
                // Clear radio buttons
                document.querySelectorAll('input[name="entityType"]').forEach(radio => {
                    radio.checked = false;
                });
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} show`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // =============================================
        // DASHBOARD FUNCTIONS
        // =============================================

        function loadDashboard() {
            updateDashboardStats();
        }

        function updateDashboardStats() {
            // Simulate real-time data
            document.getElementById('totalOrders').textContent = '12';
            document.getElementById('productionEfficiency').textContent = '92%';
            document.getElementById('warehouseLoad').textContent = '85%';
            document.getElementById('todayProduction').textContent = '2.5—Ç';
        }

        function loadPlanning() {
            // Planning module is already populated with static data
            showToast('–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ', 'success');
        }

        function loadOrders() {
            // Orders module is already populated with static data
            showToast('–ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
        }

        function loadWarehouse() {
            // Warehouse module is already populated with static data
            showToast('–°–∫–ª–∞–¥ –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
        }

        function loadProduction() {
            // Production module is already populated with static data
            showToast('–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ', 'success');
        }

        function loadAnalytics() {
            // Analytics module is already populated with static data
            showToast('–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
        }

        // Simplified action functions
        function createPlan() {
            showToast('–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–∞ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function createOrder() {
            showToast('–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function receiveDelivery() {
            showToast('–§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–µ–º–∫–∏ –ø–æ—Å—Ç–∞–≤–∫–∏ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
        }

        function refreshProduction() {
            loadProduction();
            showToast('–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'success');
        }

        function filterOrders(status) {
            showToast(`–§–∏–ª—å—Ç—Ä –∑–∞–∫–∞–∑–æ–≤: ${status}`, 'info');
        }

        // =============================================
        // MATERIALS FUNCTIONS
        // =============================================

        function loadMaterials() {
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            
            const materialsHtml = materials.map(material => {
                const supplier = suppliers.find(s => s.id === material.supplier_id);
                return `
                    <tr>
                        <td><strong>${material.code}</strong></td>
                        <td>${material.name}</td>
                        <td><span class="badge badge-info">${getTypeLabel(material.type)}</span></td>
                        <td>${material.unit}</td>
                        <td>${material.standard_cost ? material.standard_cost.toFixed(2) + ' ‚ÇΩ' : '-'}</td>
                        <td>${material.min_stock_level || '-'}</td>
                        <td>${supplier ? supplier.name : '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editMaterial(${material.id})">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMaterial(${material.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('materialsTable').innerHTML = materialsHtml || `
                <tr><td colspan="8" class="empty-state">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>
            `;
        }

        function filterMaterials(searchTerm) {
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            const filtered = materials.filter(m => 
                m.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                m.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const materialsHtml = filtered.map(material => {
                const supplier = suppliers.find(s => s.id === material.supplier_id);
                return `
                    <tr>
                        <td><strong>${material.code}</strong></td>
                        <td>${material.name}</td>
                        <td><span class="badge badge-info">${getTypeLabel(material.type)}</span></td>
                        <td>${material.unit}</td>
                        <td>${material.standard_cost ? material.standard_cost.toFixed(2) + ' ‚ÇΩ' : '-'}</td>
                        <td>${material.min_stock_level || '-'}</td>
                        <td>${supplier ? supplier.name : '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editMaterial(${material.id})">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMaterial(${material.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('materialsTable').innerHTML = materialsHtml || `
                <tr><td colspan="8" class="empty-state">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>
            `;
        }

        function getTypeLabel(type) {
            const types = {
                'granulate_ldpe': '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î',
                'granulate_hdpe': '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ù–î',
                'granulate_pp': '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ü',
                'ink_printing': '–ö—Ä–∞—Å–∫–∞',
                'adhesive_pu': '–ö–ª–µ–π –ü–£',
                'adhesive_acrylic': '–ö–ª–µ–π –∞–∫—Ä–∏–ª–æ–≤—ã–π',
                'solvent': '–†–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—å',
                'additive': '–î–æ–±–∞–≤–∫–∞'
            };
            return types[type] || type;
        }



        function deleteMaterial(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª?')) {
                const material = storage.getTable('materials').find(m => m.id === id);
                storage.deleteRecord('materials', id);
                storage.addActivity('material_deleted', `–£–¥–∞–ª–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª ${material.code}`);
                showToast('–ú–∞—Ç–µ—Ä–∏–∞–ª —É–¥–∞–ª–µ–Ω', 'success');
                loadMaterials();
                loadDashboard(); // Update stats
            }
        }

        // =============================================
        // SUPPLIERS FUNCTIONS  
        // =============================================

        function loadSuppliers() {
            const suppliers = storage.getTable('suppliers');
            
            const suppliersHtml = suppliers.map(supplier => `
                <tr>
                    <td><strong>${supplier.code}</strong></td>
                    <td>${supplier.name}</td>
                    <td>${supplier.contact_person || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>${supplier.overall_rating ? supplier.overall_rating.toFixed(1) + '/100' : '-'}</td>
                    <td>
                        <span class="badge ${supplier.is_active ? 'badge-success' : 'badge-danger'}">
                            ${supplier.is_active ? '–ê–∫—Ç–∏–≤–Ω—ã–π' : '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π'}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="editSupplier(${supplier.id})">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('suppliersTable').innerHTML = suppliersHtml || `
                <tr><td colspan="8" class="empty-state">–ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>
            `;
        }

        function filterSuppliers(searchTerm) {
            const suppliers = storage.getTable('suppliers');
            const filtered = suppliers.filter(s => 
                s.code.toLowerCase().includes(searchTerm.toLowerCase()) ||
                s.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const suppliersHtml = filtered.map(supplier => `
                <tr>
                    <td><strong>${supplier.code}</strong></td>
                    <td>${supplier.name}</td>
                    <td>${supplier.contact_person || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>${supplier.overall_rating ? supplier.overall_rating.toFixed(1) + '/100' : '-'}</td>
                    <td>
                        <span class="badge ${supplier.is_active ? 'badge-success' : 'badge-danger'}">
                            ${supplier.is_active ? '–ê–∫—Ç–∏–≤–Ω—ã–π' : '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π'}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="editSupplier(${supplier.id})">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSupplier(${supplier.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('suppliersTable').innerHTML = suppliersHtml || `
                <tr><td colspan="8" class="empty-state">–ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>
            `;
        }

        function deleteSupplier(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞?')) {
                const supplier = storage.getTable('suppliers').find(s => s.id === id);
                storage.deleteRecord('suppliers', id);
                storage.addActivity('supplier_deleted', `–£–¥–∞–ª–µ–Ω –ø–æ—Å—Ç–∞–≤—â–∏–∫ ${supplier.name}`);
                showToast('–ü–æ—Å—Ç–∞–≤—â–∏–∫ —É–¥–∞–ª–µ–Ω', 'success');
                loadSuppliers();
                loadDashboard(); // Update stats
            }
        }

        // =============================================
        // INVENTORY FUNCTIONS
        // =============================================

        function loadInventory() {
            const inventory = storage.getTable('inventory');
            const materials = storage.getTable('materials');
            
            const inventoryHtml = inventory.map(item => {
                const material = materials.find(m => m.id === item.material_id);
                return `
                    <tr>
                        <td>${material ? material.name : 'Unknown'}</td>
                        <td>${item.warehouse}</td>
                        <td>${item.batch_number || '-'}</td>
                        <td>${item.quantity}</td>
                        <td>${item.reserved_quantity}</td>
                        <td>${item.available_quantity}</td>
                        <td>${item.location_code || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editInventory(${item.id})">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteInventory(${item.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('inventoryTable').innerHTML = inventoryHtml || `
                <tr><td colspan="8" class="empty-state">–û—Å—Ç–∞—Ç–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>
            `;
        }

        // =============================================
        // BATCHES FUNCTIONS
        // =============================================

        function loadBatches() {
            const batches = storage.getTable('batches');
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            
            const batchesHtml = batches.map(batch => {
                const material = materials.find(m => m.id === batch.material_id);
                const supplier = suppliers.find(s => s.id === batch.supplier_id);
                const documents = [
                    batch.has_coa ? 'CoA' : null,
                    batch.has_tds ? 'TDS' : null,
                    batch.has_sds ? 'SDS' : null,
                    batch.has_doc ? 'DoC' : null,
                    batch.has_cmr ? 'CMR' : null
                ].filter(Boolean).join(', ');

                return `
                    <tr>
                        <td><strong>${batch.batch_number}</strong></td>
                        <td>${material ? material.name : 'Unknown'}</td>
                        <td>${supplier ? supplier.name : 'Unknown'}</td>
                        <td>${batch.received_quantity}</td>
                        <td>${new Date(batch.received_date).toLocaleDateString()}</td>
                        <td>
                            <span class="badge ${getQualityStatusClass(batch.quality_status)}">
                                ${getQualityStatusLabel(batch.quality_status)}
                            </span>
                        </td>
                        <td><small>${documents || '–ù–µ—Ç'}</small></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="editBatch(${batch.id})">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBatch(${batch.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('batchesTable').innerHTML = batchesHtml || `
                <tr><td colspan="8" class="empty-state">–ü–∞—Ä—Ç–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>
            `;
        }

        function getQualityStatusClass(status) {
            const classes = {
                'pending': 'badge-warning',
                'approved': 'badge-success',
                'blocked': 'badge-danger',
                'quarantine': 'badge-warning'
            };
            return classes[status] || 'badge-info';
        }

        function getQualityStatusLabel(status) {
            const labels = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'approved': '–û–¥–æ–±—Ä–µ–Ω–æ',
                'blocked': '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ',
                'quarantine': '–ö–∞—Ä–∞–Ω—Ç–∏–Ω'
            };
            return labels[status] || status;
        }

        // =============================================
        // ORDERS FUNCTIONS
        // =============================================

        function loadOrders() {
            const orders = storage.getTable('orders');
            
            const ordersHtml = orders.length ? orders.map(order => `
                <tr>
                    <td><strong>${order.order_number}</strong></td>
                    <td>${order.customer}</td>
                    <td>${order.product}</td>
                    <td>${order.quantity}</td>
                    <td>${new Date(order.order_date).toLocaleDateString()}</td>
                    <td>
                        <span class="badge ${getOrderStatusClass(order.status)}">
                            ${getOrderStatusLabel(order.status)}
                        </span>
                    </td>
                    <td>
                        <span class="badge ${getPriorityClass(order.priority)}">
                            ${getPriorityLabel(order.priority)}
                        </span>
                    </td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="editOrder(${order.id})">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteOrder(${order.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('') : `<tr><td colspan="8" class="empty-state">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>`;

            document.getElementById('ordersTable').innerHTML = ordersHtml;
        }

        function getOrderStatusClass(status) {
            const classes = {
                'new': 'badge-info',
                'planned': 'badge-warning',
                'in_production': 'badge-warning',
                'completed': 'badge-success',
                'shipped': 'badge-success',
                'cancelled': 'badge-danger'
            };
            return classes[status] || 'badge-info';
        }

        function getOrderStatusLabel(status) {
            const labels = {
                'new': '–ù–æ–≤—ã–π',
                'planned': '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω',
                'in_production': '–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                'shipped': '–û—Ç–≥—Ä—É–∂–µ–Ω',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
            };
            return labels[status] || status;
        }

        function getPriorityClass(priority) {
            const classes = {
                'low': 'badge-info',
                'medium': 'badge-warning',
                'high': 'badge-danger',
                'critical': 'badge-danger'
            };
            return classes[priority] || 'badge-info';
        }

        function getPriorityLabel(priority) {
            const labels = {
                'low': '–ù–∏–∑–∫–∏–π',
                'medium': '–°—Ä–µ–¥–Ω–∏–π',
                'high': '–í—ã—Å–æ–∫–∏–π',
                'critical': '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π'
            };
            return labels[priority] || priority;
        }

        // =============================================
        // FORM HANDLERS
        // =============================================

        // Material form handler
        document.getElementById('materialForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const materialData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['standard_cost', 'min_stock_level', 'reorder_point'].includes(key)) {
                        materialData[key] = parseFloat(value);
                    } else if (key === 'supplier_id') {
                        materialData[key] = parseInt(value);
                    } else {
                        materialData[key] = value;
                    }
                }
            }

            const editId = this.dataset.editId;
            if (editId) {
                // Update existing material
                const updated = storage.updateRecord('materials', parseInt(editId), materialData);
                storage.addActivity('material_updated', `–û–±–Ω–æ–≤–ª–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª ${updated.code}`);
                showToast('–ú–∞—Ç–µ—Ä–∏–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                delete this.dataset.editId;
                document.querySelector('#materialModal h3').textContent = '–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª';
            } else {
                // Create new material
                const newMaterial = storage.addRecord('materials', materialData);
                storage.addActivity('material_created', `–°–æ–∑–¥–∞–Ω –º–∞—Ç–µ—Ä–∏–∞–ª ${newMaterial.code}`);
                showToast('–ú–∞—Ç–µ—Ä–∏–∞–ª —Å–æ–∑–¥–∞–Ω', 'success');
            }
            
            hideModal('materialModal');
            loadMaterials();
            loadDashboard();
        });

        // Supplier form handler
        document.getElementById('supplierForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const supplierData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (key === 'is_active') {
                        supplierData[key] = value === 'true';
                    } else {
                        supplierData[key] = value;
                    }
                }
            }

            const editId = this.dataset.editId;
            if (editId) {
                // Update existing supplier
                const updated = storage.updateRecord('suppliers', parseInt(editId), supplierData);
                storage.addActivity('supplier_updated', `–û–±–Ω–æ–≤–ª–µ–Ω –ø–æ—Å—Ç–∞–≤—â–∏–∫ ${updated.name}`);
                showToast('–ü–æ—Å—Ç–∞–≤—â–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                delete this.dataset.editId;
                document.querySelector('#supplierModal h3').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞';
            } else {
                // Create new supplier
                const newSupplier = storage.addRecord('suppliers', supplierData);
                storage.addActivity('supplier_created', `–°–æ–∑–¥–∞–Ω –ø–æ—Å—Ç–∞–≤—â–∏–∫ ${newSupplier.name}`);
                showToast('–ü–æ—Å—Ç–∞–≤—â–∏–∫ —Å–æ–∑–¥–∞–Ω', 'success');
            }
            
            hideModal('supplierModal');
            loadSuppliers();
            loadDashboard();
        });

        // Inventory form handler
        document.getElementById('inventoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const inventoryData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['material_id'].includes(key)) {
                        inventoryData[key] = parseInt(value);
                    } else if (['quantity', 'reserved_quantity'].includes(key)) {
                        inventoryData[key] = parseFloat(value);
                    } else {
                        inventoryData[key] = value;
                    }
                }
            }

            // Calculate available quantity
            inventoryData.available_quantity = inventoryData.quantity - (inventoryData.reserved_quantity || 0);
            inventoryData.last_movement_date = new Date().toISOString();

            const newInventory = storage.addRecord('inventory', inventoryData);
            storage.addActivity('inventory_added', `–î–æ–±–∞–≤–ª–µ–Ω –æ—Å—Ç–∞—Ç–æ–∫ –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞`);
            showToast('–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
            hideModal('inventoryModal');
            loadInventory();
            loadDashboard();
        });

        // Batch form handler
        document.getElementById('batchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const batchData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['material_id', 'supplier_id'].includes(key)) {
                        batchData[key] = parseInt(value);
                    } else if (['received_quantity'].includes(key)) {
                        batchData[key] = parseFloat(value);
                    } else if (key.startsWith('has_')) {
                        batchData[key] = true; // checkbox checked
                    } else {
                        batchData[key] = value;
                    }
                }
            }

            // Set available quantity equal to received quantity initially
            batchData.available_quantity = batchData.received_quantity;

            const newBatch = storage.addRecord('batches', batchData);
            storage.addActivity('batch_received', `–ü—Ä–∏–Ω—è—Ç–∞ –ø–∞—Ä—Ç–∏—è ${newBatch.batch_number}`);
            showToast('–ü–∞—Ä—Ç–∏—è –ø—Ä–∏–Ω—è—Ç–∞', 'success');
            hideModal('batchModal');
            loadBatches();
            loadDashboard();
        });

        // Order form handler
        document.getElementById('orderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const orderData = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['quantity'].includes(key)) {
                        orderData[key] = parseFloat(value);
                    } else {
                        orderData[key] = value;
                    }
                }
            }

            const newOrder = storage.addRecord('orders', orderData);
            storage.addActivity('order_created', `–°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ ${newOrder.order_number}`);
            showToast('–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω', 'success');
            hideModal('orderModal');
            loadOrders();
            loadDashboard();
        });

        // =============================================
        // ADVANCED IMPORT SYSTEM
        // =============================================

        let importDataState = {
            entityType: null,
            file: null,
            parsedData: null,
            validatedData: null
        };

        // Entity field mappings for templates and validation
        const entityFields = {
            materials: [
                { key: 'code', label: '–ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞', required: true, example: 'GR-PVD-001' },
                { key: 'name', label: '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', required: true, example: '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π' },
                { key: 'type', label: '–¢–∏–ø', required: true, example: 'granulate_ldpe' },
                { key: 'unit', label: '–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è', required: true, example: '–∫–≥' },
                { key: 'standard_cost', label: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å', required: false, example: '245.50' },
                { key: 'min_stock_level', label: '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫', required: false, example: '1000' },
                { key: 'reorder_point', label: '–¢–æ—á–∫–∞ –ø–µ—Ä–µ–∑–∞–∫–∞–∑–∞', required: false, example: '2000' },
                { key: 'supplier_id', label: 'ID –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞', required: false, example: '1' },
                { key: 'description', label: '–û–ø–∏—Å–∞–Ω–∏–µ', required: false, example: '–û–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞' }
            ],
            suppliers: [
                { key: 'code', label: '–ö–æ–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞', required: true, example: 'SUP001' },
                { key: 'name', label: '–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ', required: true, example: 'Dow Chemical Europe' },
                { key: 'contact_person', label: '–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ', required: false, example: 'John Smith' },
                { key: 'email', label: 'Email', required: false, example: 'contact@company.com' },
                { key: 'phone', label: '–¢–µ–ª–µ—Ñ–æ–Ω', required: false, example: '+7-495-123-4567' },
                { key: 'address', label: '–ê–¥—Ä–µ—Å', required: false, example: '–ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 1' },
                { key: 'is_active', label: '–ê–∫—Ç–∏–≤–Ω—ã–π', required: false, example: 'true' }
            ],
            inventory: [
                { key: 'material_id', label: 'ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞', required: true, example: '1' },
                { key: 'warehouse', label: '–°–∫–ª–∞–¥', required: true, example: 'MAG-1' },
                { key: 'batch_number', label: '–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏', required: false, example: '240115-001' },
                { key: 'quantity', label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', required: true, example: '1000' },
                { key: 'reserved_quantity', label: '–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ', required: false, example: '0' },
                { key: 'location_code', label: '–ö–æ–¥ –ª–æ–∫–∞—Ü–∏–∏', required: false, example: 'A1-05-02' }
            ],
            batches: [
                { key: 'batch_number', label: '–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏', required: true, example: '240115-001' },
                { key: 'material_id', label: 'ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞', required: true, example: '1' },
                { key: 'supplier_id', label: 'ID –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞', required: true, example: '1' },
                { key: 'received_quantity', label: '–ü–æ–ª—É—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', required: true, example: '2500' },
                { key: 'production_date', label: '–î–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', required: false, example: '2024-01-10' },
                { key: 'received_date', label: '–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è', required: true, example: '2024-01-15' },
                { key: 'quality_status', label: '–°—Ç–∞—Ç—É—Å –∫–∞—á–µ—Å—Ç–≤–∞', required: false, example: 'approved' }
            ],
            orders: [
                { key: 'order_number', label: '–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞', required: true, example: 'ORD-240001' },
                { key: 'customer', label: '–ö–ª–∏–µ–Ω—Ç', required: true, example: '–û–û–û –ü–∏—â–µ–ø—Ä–æ–º' },
                { key: 'product', label: '–ü—Ä–æ–¥—É–∫—Ç', required: true, example: '–ü–ª–µ–Ω–∫–∞ –ü–≠–¢ 12–º–∫–º' },
                { key: 'quantity', label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', required: true, example: '5000' },
                { key: 'order_date', label: '–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞', required: true, example: '2024-01-20' },
                { key: 'delivery_date', label: '–î–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏', required: false, example: '2024-01-25' },
                { key: 'status', label: '–°—Ç–∞—Ç—É—Å', required: false, example: 'new' },
                { key: 'priority', label: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç', required: false, example: 'medium' }
            ]
        };

        // Handle entity type selection
        document.addEventListener('change', function(e) {
            if (e.target.name === 'entityType') {
                importDataState.entityType = e.target.value;
                checkImportReadiness();
            }
        });

        // Check if ready to proceed to next step
        function checkImportReadiness() {
            const nextBtn = document.getElementById('nextBtn');
            const hasEntity = importDataState.entityType;
            const hasFile = importDataState.file;
            
            if (nextBtn) {
                nextBtn.disabled = !(hasEntity && hasFile);
            }
        }

        // Handle file selection
        function handleImportFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            importDataState.file = file;
            
            // Show file info
            const fileInfo = document.getElementById('fileInfo');
            if (fileInfo) {
                fileInfo.style.display = 'block';
                fileInfo.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="file-icon">üìÑ</div>
                        <div>
                            <div style="font-weight: 600;">${file.name}</div>
                            <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                ${(file.size / 1024).toFixed(1)} KB ‚Ä¢ ${file.type || 'Unknown type'}
                            </div>
                        </div>
                    </div>
                `;
            }

            checkImportReadiness();
        }

        // Download template files
        function downloadTemplate(format) {
            if (!importDataState.entityType) {
                showToast('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö', 'warning');
                return;
            }

            const fields = entityFields[importDataState.entityType];
            const headers = fields.map(f => f.label);
            const example = fields.map(f => f.example);

            if (format === 'csv') {
                const csvContent = [
                    headers.join(','),
                    example.join(',')
                ].join('\n');

                downloadFile(csvContent, `${importDataState.entityType}_template.csv`, 'text/csv');
            } else if (format === 'excel') {
                // Simple Excel-like format (actually CSV with Excel extension)
                const csvContent = [
                    headers.join(','),
                    example.join(',')
                ].join('\n');

                downloadFile(csvContent, `${importDataState.entityType}_template.xlsx`, 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            }
        }

        // Utility function to download files
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('–®–∞–±–ª–æ–Ω —Å–∫–∞—á–∞–Ω', 'success');
        }

        // Parse different file formats
        function parseFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const content = e.target.result;
                    const extension = file.name.split('.').pop().toLowerCase();
                    
                    try {
                        let data;
                        
                        if (extension === 'json') {
                            data = JSON.parse(content);
                        } else if (extension === 'csv') {
                            data = parseCSV(content);
                        } else if (['xlsx', 'xls'].includes(extension)) {
                            // For now, treat Excel files as CSV (user should save as CSV)
                            showToast('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ Excel —Ñ–∞–π–ª –∫–∞–∫ CSV', 'warning');
                            reject(new Error('Excel files not supported yet. Please convert to CSV.'));
                            return;
                        } else {
                            reject(new Error('Unsupported file format'));
                            return;
                        }
                        
                        resolve(data);
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = () => reject(new Error('File reading failed'));
                reader.readAsText(file);
            });
        }

        // Simple CSV parser
        function parseCSV(content) {
            const lines = content.split('\n').filter(line => line.trim());
            if (lines.length < 2) throw new Error('CSV –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –¥–∞–Ω–Ω—ã–µ');
            
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                const row = {};
                
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                
                data.push(row);
            }
            
            return data;
        }

        // Navigation between steps
        function nextStep() {
            if (!importDataState.file || !importDataState.entityType) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∞–π–ª', 'warning');
                return;
            }

            // Parse file and show preview
            parseFile(importDataState.file)
                .then(data => {
                    importDataState.parsedData = data;
                    showPreview(data);
                    
                    // Switch to step 2
                    document.getElementById('importStep1').style.display = 'none';
                    document.getElementById('importStep2').style.display = 'block';
                    document.getElementById('nextBtn').style.display = 'none';
                    document.getElementById('importBtn').style.display = 'inline-flex';
                })
                .catch(error => {
                    showToast('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: ' + error.message, 'error');
                });
        }

        function backToStep1() {
            document.getElementById('importStep1').style.display = 'block';
            document.getElementById('importStep2').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-flex';
            document.getElementById('importBtn').style.display = 'none';
        }

        // Show data preview
        function showPreview(data) {
            if (!Array.isArray(data) || data.length === 0) {
                showToast('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'warning');
                return;
            }

            const fields = entityFields[importDataState.entityType];
            const previewHeader = document.getElementById('previewHeader');
            const previewBody = document.getElementById('previewBody');
            const previewCount = document.getElementById('previewCount');

            // Build header
            previewHeader.innerHTML = `
                <tr>
                    ${fields.map(field => `<th>${field.label}</th>`).join('')}
                    <th>–°—Ç–∞—Ç—É—Å</th>
                </tr>
            `;

            // Build body (show first 10 rows)
            const previewRows = data.slice(0, 10);
            previewBody.innerHTML = previewRows.map(row => {
                const validation = validateRow(row, fields);
                const statusClass = validation.isValid ? 'badge-success' : 'badge-danger';
                const statusText = validation.isValid ? '‚úÖ –û–ö' : '‚ùå –û—à–∏–±–∫–∞';
                
                return `
                    <tr>
                        ${fields.map(field => {
                            const value = getFieldValue(row, field);
                            return `<td>${value || '-'}</td>`;
                        }).join('')}
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                    </tr>
                `;
            }).join('');

            if (previewCount) {
                previewCount.textContent = data.length;
            }
        }

        // Get field value from row (flexible field matching)
        function getFieldValue(row, field) {
            // Try exact key match first
            if (row.hasOwnProperty(field.key)) {
                return row[field.key];
            }
            
            // Try label match
            if (row.hasOwnProperty(field.label)) {
                return row[field.label];
            }
            
            // Try case-insensitive matches
            const keys = Object.keys(row);
            const matchKey = keys.find(key => 
                key.toLowerCase() === field.key.toLowerCase() ||
                key.toLowerCase() === field.label.toLowerCase()
            );
            
            return matchKey ? row[matchKey] : '';
        }

        // Validate a single row
        function validateRow(row, fields) {
            const errors = [];
            
            fields.forEach(field => {
                if (field.required) {
                    const value = getFieldValue(row, field);
                    if (!value || value.toString().trim() === '') {
                        errors.push(`${field.label} –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è`);
                    }
                }
            });
            
            return {
                isValid: errors.length === 0,
                errors: errors
            };
        }

        // Execute import
        function executeImport() {
            if (!importDataState.parsedData) {
                showToast('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞', 'error');
                return;
            }

            const skipDuplicates = document.getElementById('skipDuplicates').checked;
            const updateExisting = document.getElementById('updateExisting').checked;
            const validateData = document.getElementById('validateData').checked;
            
            const fields = entityFields[importDataState.entityType];
            const existingData = storage.getTable(importDataState.entityType);
            
            let imported = 0;
            let skipped = 0;
            let updated = 0;
            let errors = 0;

            importDataState.parsedData.forEach(row => {
                try {
                    // Validate if required
                    if (validateData) {
                        const validation = validateRow(row, fields);
                        if (!validation.isValid) {
                            errors++;
                            return;
                        }
                    }

                    // Convert row to proper format
                    const record = {};
                    fields.forEach(field => {
                        const value = getFieldValue(row, field);
                        if (value !== '') {
                            if (['standard_cost', 'min_stock_level', 'reorder_point', 'quantity', 'reserved_quantity', 'received_quantity'].includes(field.key)) {
                                record[field.key] = parseFloat(value);
                            } else if (['material_id', 'supplier_id'].includes(field.key)) {
                                record[field.key] = parseInt(value);
                            } else if (field.key === 'is_active') {
                                record[field.key] = value.toLowerCase() === 'true' || value === '1';
                            } else {
                                record[field.key] = value;
                            }
                        }
                    });

                    // Check for duplicates
                    const identifierField = ['code', 'order_number', 'batch_number'].find(f => record[f]);
                    let existingRecord = null;
                    
                    if (identifierField) {
                        existingRecord = existingData.find(item => item[identifierField] === record[identifierField]);
                    }

                    if (existingRecord) {
                        if (updateExisting) {
                            storage.updateRecord(importDataState.entityType, existingRecord.id, record);
                            updated++;
                        } else if (skipDuplicates) {
                            skipped++;
                        } else {
                            storage.addRecord(importDataState.entityType, record);
                            imported++;
                        }
                    } else {
                        storage.addRecord(importDataState.entityType, record);
                        imported++;
                    }
                } catch (error) {
                    console.error('Import error for row:', row, error);
                    errors++;
                }
            });

            // Show results
            const message = `–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω: ${imported} –¥–æ–±–∞–≤–ª–µ–Ω–æ, ${updated} –æ–±–Ω–æ–≤–ª–µ–Ω–æ, ${skipped} –ø—Ä–æ–ø—É—â–µ–Ω–æ, ${errors} –æ—à–∏–±–æ–∫`;
            showToast(message, errors > 0 ? 'warning' : 'success');
            
            storage.addActivity('data_import', `–ò–º–ø–æ—Ä—Ç ${importDataState.entityType}: ${imported} –∑–∞–ø–∏—Å–µ–π`);
            
            // Close modal and refresh
            hideModal('importModal');
            refreshCurrentTab();
            loadDashboard();
        }

        // =============================================
        // EXPORT/IMPORT FUNCTIONS (Legacy)
        // =============================================

        function exportData() {
            storage.exportData();
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    storage.importData(e.target.result);
                };
                reader.readAsText(file);
            }
        }

        function refreshCurrentTab() {
            const activeTab = document.querySelector('.nav-tab.active');
            if (activeTab) {
                activeTab.click();
            }
        }

        // =============================================
        // INITIALIZATION
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Add click outside modal to close
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
            });
        });

        // Delete functions for other entities
        function deleteInventory(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Å—Ç–∞—Ç–æ–∫?')) {
                storage.deleteRecord('inventory', id);
                storage.addActivity('inventory_deleted', '–£–¥–∞–ª–µ–Ω –æ—Å—Ç–∞—Ç–æ–∫');
                showToast('–û—Å—Ç–∞—Ç–æ–∫ —É–¥–∞–ª–µ–Ω', 'success');
                loadInventory();
                loadDashboard();
            }
        }

        function deleteBatch(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–∞—Ä—Ç–∏—é?')) {
                const batch = storage.getTable('batches').find(b => b.id === id);
                storage.deleteRecord('batches', id);
                storage.addActivity('batch_deleted', `–£–¥–∞–ª–µ–Ω–∞ –ø–∞—Ä—Ç–∏—è ${batch.batch_number}`);
                showToast('–ü–∞—Ä—Ç–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
                loadBatches();
                loadDashboard();
            }
        }

        function deleteOrder(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')) {
                const order = storage.getTable('orders').find(o => o.id === id);
                storage.deleteRecord('orders', id);
                storage.addActivity('order_deleted', `–£–¥–∞–ª–µ–Ω –∑–∞–∫–∞–∑ ${order.order_number}`);
                showToast('–ó–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω', 'success');
                loadOrders();
                loadDashboard();
            }
        }

        // Edit functions (simplified - open modal with data)
        function editMaterial(id) {
            const material = storage.getTable('materials').find(m => m.id === id);
            if (material) {
                // Fill form with existing data
                const form = document.getElementById('materialForm');
                Object.keys(material).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        input.value = material[key];
                    }
                });
                
                // Change form behavior to update instead of create
                form.dataset.editId = id;
                document.querySelector('#materialModal h3').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª';
                showModal('materialModal');
            }
        }

        function editSupplier(id) {
            const supplier = storage.getTable('suppliers').find(s => s.id === id);
            if (supplier) {
                const form = document.getElementById('supplierForm');
                Object.keys(supplier).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input) {
                        if (input.type === 'checkbox') {
                            input.checked = supplier[key];
                        } else {
                            input.value = supplier[key];
                        }
                    }
                });
                
                form.dataset.editId = id;
                document.querySelector('#supplierModal h3').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞';
                showModal('supplierModal');
            }
        }

        function editInventory(id) {
            showToast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function editBatch(id) {
            showToast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function editOrder(id) {
            showToast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }
    </script>
</body>
</html>