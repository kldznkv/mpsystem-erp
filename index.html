<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPSYSTEM - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º —É–ø–∞–∫–æ–≤–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</title>
    <meta name="description" content="–í–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ–º —É–ø–∞–∫–æ–≤–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: —ç–∫—Å—Ç—Ä—É–∑–∏—è, –ª–∞–º–∏–Ω–∞—Ü–∏—è, –ø–µ—á–∞—Ç—å">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüè≠%3C/text%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== UNIFIED CLEAN CSS SYSTEM ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
            font-size: 14px;
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            background: white;
            color: #374151;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.08);
            border-right: 1px solid #e5e7eb;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #f1f5f9;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .logo-icon {
            font-size: 1.5rem;
            background: #f8fafc;
            padding: 0.5rem;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
            color: #1f2937;
        }

        .logo-text .subtitle {
            font-size: 0.75rem;
            color: #6b7280;
            display: block;
            margin-top: 0.25rem;
        }

        .system-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.75rem;
            color: #6b7280;
        }

        .status-indicator {
            font-size: 0.75rem;
        }

        .status-indicator.online {
            color: #10b981;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            color: #6b7280;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            border-radius: 0;
        }

        .nav-item:hover {
            background: #f8fafc;
            color: #374151;
        }

        .nav-item.active {
            background: #f1f5f9;
            color: #1f2937;
            border-right: 3px solid #3b82f6;
            font-weight: 500;
        }

        .nav-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .nav-text {
            font-weight: 500;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content-wrapper {
            flex: 1;
            padding: 2rem;
            max-width: none;
        }

        /* ===== IMPROVED LAYOUT ===== */
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            color: #0f172a;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info {
            color: #64748b;
            font-size: 14px;
        }

        /* ===== NAVIGATION ===== */
        .nav-tabs {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            overflow-x: auto;
            display: flex;
            padding: 0;
        }

        .nav-tab {
            background: none;
            border: none;
            padding: 16px 24px;
            cursor: pointer;
            color: #64748b;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 14px;
        }

        /* ===== ENHANCED LAYOUT ===== */
        .tab-content {
            display: none;
            width: 100%;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== ENHANCED CARDS ===== */
        .card {
            background: white;
            border-radius: 4px;
            padding: 1rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
            border: 1px solid #e5e7eb;
            margin-bottom: 0.75rem;
            transition: all 0.15s ease;
        }

        .card:hover {
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #f1f5f9;
        }

        .card-header h3 {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin: 0;
        }

        /* Special compact styling for table cards */
        .card.table-card {
            padding: 0;
            overflow: hidden;
        }

        .card.table-card .card-header {
            padding: 0.75rem 1rem;
            margin-bottom: 0;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .card.table-card .table-container {
            margin-bottom: 0;
            border: none;
            border-radius: 0;
            box-shadow: none;
        }

        /* ===== ENHANCED GRIDS ===== */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            max-width: 100%;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        @media (min-width: 640px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            max-width: 100%;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        @media (min-width: 640px) {
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ===== OPTIMIZED TABLES ===== */
        .table-container {
            background: white;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
            border: 1px solid #e5e7eb;
            margin-bottom: 0.75rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8125rem;
            line-height: 1.3;
        }

        table th {
            background: #f8fafc;
            padding: 0.5rem 0.625rem;
            text-align: left;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.6875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }

        table td {
            padding: 0.5rem 0.625rem;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
            font-size: 0.8125rem;
            line-height: 1.3;
        }

        table tr:hover {
            background: #f8fafc;
        }

        table tr:last-child td {
            border-bottom: none;
        }

        /* Compact action buttons in tables */
        table .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 3px;
        }

        table .action-buttons {
            display: flex;
            gap: 0.25rem;
        }

        /* Status badges in tables */
        /* ===== UNIFIED BADGES ===== */
        .status-badge, .priority-badge, .quality-badge, .material-type-badge, 
        .movement-badge, .criticality-badge, .po-status-badge, .line-status-badge {
            padding: 0.125rem 0.5rem;
            font-size: 0.6875rem;
            border-radius: 3px;
            white-space: nowrap;
            font-weight: 500;
            display: inline-block;
        }

        /* Status Badge Colors */
        .status-badge.new, .status-badge.pending { background: #dbeafe; color: #1d4ed8; }
        .status-badge.in-progress, .status-badge.running { background: #d1fae5; color: #065f46; }
        .status-badge.completed, .status-badge.delivered { background: #f0f9ff; color: #0284c7; }
        .status-badge.cancelled, .status-badge.blocked { background: #fecaca; color: #991b1b; }
        .status-badge.paused, .status-badge.idle { background: #fef3c7; color: #92400e; }

        /* Priority Badge Colors */
        .priority-badge.low { background: #f0fdf4; color: #166534; }
        .priority-badge.normal { background: #f8fafc; color: #475569; }
        .priority-badge.high { background: #fef3c7; color: #92400e; }
        .priority-badge.urgent { background: #fecaca; color: #991b1b; }

        /* Quality Badge Colors */
        .quality-badge.quarantine { background: #fef3c7; color: #92400e; }
        .quality-badge.released { background: #d1fae5; color: #065f46; }
        .quality-badge.blocked { background: #fecaca; color: #991b1b; }

        /* Material Type Badge Colors */
        .material-type-badge.raw_material { background: #dbeafe; color: #1d4ed8; }
        .material-type-badge.semi_finished { background: #fef3c7; color: #92400e; }
        .material-type-badge.finished_good { background: #d1fae5; color: #065f46; }

        /* Movement Badge Colors */
        .movement-badge.receipt { background: #d1fae5; color: #065f46; }
        .movement-badge.issue { background: #fed7aa; color: #c2410c; }
        .movement-badge.transfer { background: #dbeafe; color: #1d4ed8; }
        .movement-badge.adjustment { background: #f3e8ff; color: #7c3aed; }

        /* Criticality Badge Colors */
        .criticality-badge.low { background: #d1fae5; color: #065f46; }
        .criticality-badge.medium { background: #fef3c7; color: #92400e; }
        .criticality-badge.high { background: #fed7aa; color: #c2410c; }
        .criticality-badge.critical { background: #fecaca; color: #991b1b; }

        /* PO Status Badge Colors */
        .po-status-badge.draft { background: #f1f5f9; color: #475569; }
        .po-status-badge.sent { background: #dbeafe; color: #1d4ed8; }
        .po-status-badge.confirmed { background: #d1fae5; color: #065f46; }
        .po-status-badge.partially_delivered { background: #fef3c7; color: #92400e; }
        .po-status-badge.completed { background: #f0f9ff; color: #0284c7; }

        /* Line Status Badge Colors */
        .line-status-badge.running { background: #d1fae5; color: #065f46; }
        .line-status-badge.setup { background: #fef3c7; color: #92400e; }
        .line-status-badge.idle { background: #fed7aa; color: #c2410c; }
        .line-status-badge.stopped { background: #f1f5f9; color: #475569; }

        /* ===== RESPONSIVE IMPROVEMENTS ===== */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content-wrapper {
                padding: 1rem;
            }

            .metrics-grid,
            .summary-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            /* Side panels on mobile become full screen */
            .modal.side-panel .modal-content {
                width: 100vw;
                max-width: 100vw;
                border-left: none;
                border-radius: 0;
            }

            .modal.side-panel .modal-body {
                height: calc(100vh - 120px);
            }
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== CARDS ===== */
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f1f5f9;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #0f172a;
            margin: 0;
        }

        /* ===== DASHBOARD METRICS ===== */
        .dashboard-metrics {
            margin-bottom: 2rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        /* ===== UNIFIED METRIC CARDS ===== */
        .metric-card, .summary-card, .oee-card {
            background: white;
            border-radius: 6px;
            padding: 1rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
            border: 1px solid #e5e7eb;
            transition: all 0.15s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover, .summary-card:hover, .oee-card:hover {
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        }

        .metric-card::before, .summary-card::before, .oee-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #3b82f6;
        }

        /* Color variants for different card types */
        .metric-card.availability::before, .summary-card.total::before, .oee-card.availability::before { background: #10b981; }
        .metric-card.performance::before, .summary-card.critical::before, .oee-card.performance::before { background: #f59e0b; }
        .metric-card.quality::before, .summary-card.blocked::before, .oee-card.quality::before { background: #8b5cf6; }
        .metric-card.total::before, .summary-card.available::before, .oee-card.total::before { background: #ef4444; }
        .summary-card.new::before { background: #3b82f6; }
        .summary-card.queued::before { background: #f59e0b; }
        .summary-card.in-progress::before { background: #10b981; }
        .summary-card.pending::before { background: #d97706; }
        .summary-card.on-order::before { background: #7c3aed; }
        .summary-card.delivered::before { background: #10b981; }
        .summary-card.budget::before { background: #ef4444; }

        .metric-header, .summary-header, .oee-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .metric-icon, .summary-icon, .oee-icon {
            font-size: 1rem;
            color: #9ca3af;
            line-height: 1;
        }

        .metric-title, .summary-title, .oee-title {
            font-size: 0.6875rem;
            font-weight: 500;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            line-height: 1.2;
        }

        .metric-value, .summary-value, .oee-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .metric-label, .summary-label {
            color: #6b7280;
            font-size: 0.6875rem;
            font-weight: 400;
            margin-top: 0.25rem;
            line-height: 1.2;
        }

        .metric-change, .oee-change {
            font-size: 0.75rem;
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
            margin-top: 0.25rem;
            font-weight: 500;
        }

        .metric-change.positive, .oee-change.positive {
            background: #dcfce7;
            color: #166534;
        }

        .metric-change.negative, .oee-change.negative {
            background: #fecaca;
            color: #991b1b;
        }



        /* Legacy stat styles for compatibility */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 13px;
            color: #64748b;
            font-weight: 500;
        }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            border: 1px solid transparent;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            text-decoration: none;
            font-family: inherit;
        }

        .btn-sm {
            padding: 0.375rem 0.625rem;
            font-size: 0.75rem;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: white;
            color: #6b7280;
            border-color: #d1d5db;
        }

        .btn-secondary:hover {
            background: #f9fafb;
            color: #374151;
        }

        .btn-success {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
            border-color: #f59e0b;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* ===== TABLES ===== */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        table th {
            background: #f8fafc;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
        }

        table td {
            padding: 12px 16px;
            border-bottom: 1px solid #f1f5f9;
            color: #374151;
        }

        table tr:hover {
            background: #f8fafc;
        }

        table tr:last-child td {
            border-bottom: none;
        }

        /* ===== FORMS ===== */
        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            background: white;
            transition: all 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* ===== MODALS & SIDE PANELS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal.side-panel {
            background: rgba(0,0,0,0.3);
            z-index: 1001;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Side panel variant */
        .modal.side-panel {
            justify-content: flex-end;
            align-items: stretch;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            position: relative;
        }

        /* Side panel content */
        .modal.side-panel .modal-content {
            width: 600px;
            max-width: 600px;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
            border-left: 1px solid #e5e7eb;
            border-right: none;
            border-top: none;
            border-bottom: none;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            position: fixed;
            right: 0;
            top: 0;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .modal.side-panel.active .modal-content {
            transform: translateX(0);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(100%);
            }
        }

        /* Side panel header with proper layout */
        .modal.side-panel .modal-header {
            border-bottom: 1px solid #e5e7eb;
            background: #f8fafc;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal.side-panel .modal-header h2,
        .modal.side-panel .modal-header h3 {
            margin: 0;
            flex: 1;
        }

        /* Modal title area for complex headers */
        .modal-title-area {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            flex: 1;
        }

        .modal-title-area h2,
        .modal-title-area h3 {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 500;
        }

        .line-status-badge {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
            background: #10b981;
            color: white;
            width: fit-content;
        }

        /* Side panel body with custom scroll */
        .modal.side-panel .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            height: calc(100vh - 80px);
            flex: 1;
        }

        .modal.side-panel .modal-footer {
            border-top: 1px solid #e5e7eb;
            background: white;
            padding: 1rem 1.5rem;
            flex-shrink: 0;
        }

        /* Ensure side panel modal content uses flex layout */
        .modal.side-panel .modal-content {
            display: flex;
            flex-direction: column;
        }

        /* Fix grid layouts in side panels */
        .modal.side-panel .line-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .modal.side-panel .detail-section.full-width {
            grid-column: 1 / -1;
        }

        /* ===== PURCHASING PAGE STYLES ===== */
        .purchasing-summary {
            margin-bottom: 1.5rem;
        }

        .purchasing-tabs {
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .tab-buttons {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }

        .tab-btn:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .tab-btn.active {
            background: white;
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .purchasing-tab-content {
            display: none;
            padding: 1.5rem;
        }

        .purchasing-tab-content.active {
            display: block;
        }

        .purchasing-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8125rem;
        }

        .purchasing-table th {
            background: #f8fafc;
            padding: 0.5rem 0.625rem;
            text-align: left;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.6875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .purchasing-table td {
            padding: 0.5rem 0.625rem;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .purchasing-table tr:hover {
            background: #f8fafc;
        }

        /* Header actions */
        .header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        /* Criticality badges */
        .criticality-badge {
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.6875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .criticality-badge.low {
            background: #d1fae5;
            color: #065f46;
        }

        .criticality-badge.medium {
            background: #fef3c7;
            color: #92400e;
        }

        .criticality-badge.high {
            background: #fed7aa;
            color: #c2410c;
        }

        .criticality-badge.critical {
            background: #fecaca;
            color: #991b1b;
        }

        /* Purchase order status badges */
        .po-status-badge {
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.6875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .po-status-badge.draft {
            background: #f3f4f6;
            color: #6b7280;
        }

        .po-status-badge.sent {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .po-status-badge.confirmed {
            background: #d1fae5;
            color: #065f46;
        }

        .po-status-badge.partially_delivered {
            background: #fef3c7;
            color: #92400e;
        }

        .po-status-badge.completed {
            background: #dcfce7;
            color: #166534;
        }

        /* Deliveries layout */
        .deliveries-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
            height: 600px;
        }

        .deliveries-filters {
            border-right: 1px solid #e5e7eb;
            padding-right: 1rem;
        }

        .filters-content {
            padding: 1rem 0;
        }

        .filter-group {
            margin-bottom: 1rem;
        }

        .filter-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }

        .filter-input,
        .filter-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .deliveries-main {
            overflow-y: auto;
        }

        .delivery-count {
            background: #dbeafe;
            color: #1d4ed8;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .deliveries-list {
            padding: 1rem 0;
        }

        .delivery-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }

        .delivery-card:hover {
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .delivery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .delivery-supplier {
            font-weight: 500;
            color: #374151;
        }

        .delivery-date {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .delivery-items {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .delivery-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Material list in PO */
        .materials-list {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .materials-list .material-item {
            display: block;
            margin-bottom: 0.125rem;
        }

        /* Supplier rating */
        .supplier-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .rating-stars {
            color: #fbbf24;
            font-size: 0.875rem;
        }

        .rating-value {
            font-size: 0.75rem;
            color: #6b7280;
        }

        /* Responsive for purchasing page */
        @media (max-width: 768px) {
            .deliveries-layout {
                grid-template-columns: 1fr;
                height: auto;
            }

            .deliveries-filters {
                border-right: none;
                border-bottom: 1px solid #e5e7eb;
                padding-right: 0;
                padding-bottom: 1rem;
            }

            .tab-buttons {
                flex-wrap: wrap;
            }

            .tab-btn {
                flex: 1;
                min-width: 120px;
            }
        }

        /* ===== INVENTORY PAGE STYLES ===== */
        .inventory-summary {
            margin-bottom: 1.5rem;
        }

        .mag-warehouses {
            margin-bottom: 1.5rem;
        }

        .warehouse-legend {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .legend-item {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .warehouses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            padding: 1rem 0;
        }

        .warehouse-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .warehouse-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .warehouse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .warehouse-name {
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }

        .warehouse-type {
            font-size: 0.75rem;
            color: #6b7280;
            background: #f3f4f6;
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
        }

        .warehouse-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .warehouse-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .warehouse-percent {
            text-align: center;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }

        /* Inventory tabs */
        .inventory-tabs {
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .inventory-tab-content {
            display: none;
            padding: 1.5rem;
        }

        .inventory-tab-content.active {
            display: block;
        }

        .inventory-filters {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
        }

        .movements-filters {
            background: #f8fafc;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
        }

        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8125rem;
        }

        .inventory-table th {
            background: #f8fafc;
            padding: 0.5rem 0.625rem;
            text-align: left;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.6875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .inventory-table td {
            padding: 0.5rem 0.625rem;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .inventory-table tr:hover {
            background: #f8fafc;
        }

        /* Quality status badges */
        .quality-badge {
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.6875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .quality-badge.quarantine {
            background: #fef3c7;
            color: #92400e;
        }

        .quality-badge.released {
            background: #d1fae5;
            color: #065f46;
        }

        .quality-badge.blocked {
            background: #fecaca;
            color: #991b1b;
        }

        /* Material type badges */
        .material-type-badge {
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.6875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .material-type-badge.raw_material {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .material-type-badge.semi_finished {
            background: #fef3c7;
            color: #92400e;
        }

        .material-type-badge.finished_good {
            background: #d1fae5;
            color: #065f46;
        }

        /* Movement type badges */
        .movement-badge {
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.6875rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .movement-badge.receipt {
            background: #d1fae5;
            color: #065f46;
        }

        .movement-badge.issue {
            background: #fed7aa;
            color: #c2410c;
        }

        .movement-badge.transfer {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .movement-badge.adjustment {
            background: #f3e8ff;
            color: #7c3aed;
        }

        /* Criticality indicators */
        .criticality-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .criticality-level {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .criticality-level.low {
            background: #10b981;
        }

        .criticality-level.medium {
            background: #f59e0b;
        }

        .criticality-level.high {
            background: #ef4444;
        }

        .criticality-level.critical {
            background: #dc2626;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Expiry date warnings */
        .expiry-warning {
            color: #ef4444;
            font-weight: 500;
        }

        .expiry-soon {
            color: #f59e0b;
            font-weight: 500;
        }

        /* Stocktaking layout */
        .stocktaking-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            height: 600px;
        }

        .stocktaking-plans,
        .stocktaking-results {
            overflow-y: auto;
        }

        .stocktaking-list {
            padding: 1rem 0;
        }

        .stocktaking-plan {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .stocktaking-plan:hover {
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .stocktaking-plan.active {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .stocktaking-status {
            background: #fef3c7;
            color: #92400e;
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .stocktaking-content {
            padding: 1rem 0;
        }

        /* Batch number styling */
        .batch-number {
            font-family: 'Courier New', monospace;
            background: #f3f4f6;
            padding: 0.125rem 0.375rem;
            border-radius: 3px;
            font-size: 0.75rem;
        }

        /* MAG location badges */
        .mag-badge {
            background: #f3f4f6;
            color: #374151;
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.6875rem;
            font-weight: 500;
            font-family: 'Courier New', monospace;
        }

        /* Responsive for inventory page */
        @media (max-width: 768px) {
            .warehouses-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .filters-row {
                grid-template-columns: 1fr;
            }

            .stocktaking-layout {
                grid-template-columns: 1fr;
                height: auto;
            }

            .inventory-table {
                font-size: 0.75rem;
            }

            .inventory-table th,
            .inventory-table td {
                padding: 0.375rem 0.5rem;
            }
        }

        /* ===== PRODUCTION PAGE STYLES ===== */
        .production-summary {
            margin-bottom: 1.5rem;
        }

        .oee-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        /* OEE cards now use unified metric card styles above */

        /* Production departments */
        .production-departments {
            margin-bottom: 1.5rem;
        }

        .department-group {
            margin-bottom: 2rem;
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }

        .department-header h3 {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
        }

        .department-status {
            font-size: 0.875rem;
            color: #6b7280;
            background: white;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }

        /* Production lines grid */
        .production-lines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1rem;
        }

        .production-line-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .production-line-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .production-line-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .production-line-card.running::before {
            background: #10b981;
        }

        .production-line-card.setup::before {
            background: #f59e0b;
        }

        .production-line-card.idle::before {
            background: #ef4444;
        }

        .production-line-card.stopped::before {
            background: #6b7280;
        }

        /* Line header */
        .line-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .line-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .line-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
        }

        .line-status {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .line-status.running {
            color: #10b981;
        }

        .line-status.setup {
            color: #f59e0b;
        }

        .line-status.idle {
            color: #ef4444;
        }

        .line-status.stopped {
            color: #6b7280;
        }

        .line-controls {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .btn-icon:hover {
            background: #f3f4f6;
        }

        /* Line details */
        .line-details {
            margin-bottom: 1rem;
        }

        .current-job {
            margin-bottom: 1rem;
        }

        .current-job strong {
            display: block;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .current-job span {
            color: #6b7280;
            font-size: 0.875rem;
        }

        /* Job progress */
        .job-progress {
            margin-bottom: 1rem;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #3b82f6;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* Setup and idle info */
        .setup-info,
        .idle-reason,
        .maintenance-info {
            margin-bottom: 1rem;
        }

        .setup-info span,
        .idle-reason span,
        .maintenance-info span {
            display: block;
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        /* Line metrics */
        .line-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 0.75rem;
        }

        .metric {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .metric-label {
            font-size: 0.75rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .metric-value {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1f2937;
        }

        /* Production alerts */
        .production-alerts {
            margin-bottom: 1.5rem;
        }

        .alerts-filter {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            background: white;
            color: #6b7280;
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .alerts-list {
            padding: 1rem 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .alert-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 1rem;
            border-bottom: 1px solid #f1f5f9;
            transition: background 0.2s ease;
        }

        .alert-item:hover {
            background: #f8fafc;
        }

        .alert-item:last-child {
            border-bottom: none;
        }

        .alert-icon {
            font-size: 1rem;
            margin-top: 0.125rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .alert-message {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .alert-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .alert-actions {
            display: flex;
            gap: 0.5rem;
        }

        .alert-action-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 3px;
            border: 1px solid #d1d5db;
            background: white;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .alert-action-btn:hover {
            background: #f3f4f6;
        }

        .alert-action-btn.primary {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* Status-specific colors for alerts */
        .alert-item.critical .alert-icon {
            color: #ef4444;
        }

        .alert-item.warning .alert-icon {
            color: #f59e0b;
        }

        .alert-item.info .alert-icon {
            color: #3b82f6;
        }

        /* Responsive design for production page */
        @media (max-width: 768px) {
            .oee-metrics {
                grid-template-columns: repeat(2, 1fr);
            }

            .production-lines-grid {
                grid-template-columns: 1fr;
            }

            .department-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }

            .line-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }

            .line-controls {
                align-self: flex-end;
            }

            .line-metrics {
                grid-template-columns: repeat(2, 1fr);
            }

            .alerts-filter {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .oee-metrics {
                grid-template-columns: 1fr;
            }

            .line-metrics {
                grid-template-columns: 1fr;
            }
        }

        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1rem;
            font-weight: 500;
            color: #374151;
            margin: 0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #f3f4f6;
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            background: #f9fafb;
        }

        .close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: #9ca3af;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        /* Modal controls */
        .modal-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .modal-controls .btn {
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            padding: 0.25rem;
        }

        /* Side panel specific adjustments */
        .modal.side-panel .modal-controls {
            margin-left: auto;
        }

        /* ===== LINE DETAILS MODAL ===== */
        .modal-content.line-modal {
            max-width: 900px;
            max-height: 90vh;
        }

        .line-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 1.5rem 0;
        }

        .detail-section {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .detail-section.full-width {
            grid-column: 1 / -1;
        }

        .detail-section h3 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .detail-item label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .progress-detail {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
            margin-left: 1rem;
        }

        .progress-detail .progress-bar {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
        }

        .progress-detail .progress-fill {
            height: 100%;
            background: #f97316;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .metrics-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .metric-item {
            text-align: center;
            padding: 1rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .metric-item .metric-title {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .metric-item .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .process-params {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .param-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .param-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .param-status {
            font-size: 1.2rem;
        }

        .param-status.normal {
            color: #10b981;
        }

        .param-status.warning {
            color: #f59e0b;
        }

        .param-status.critical {
            color: #ef4444;
        }

        .line-status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            background: #10b981;
            color: white;
        }

        .line-status-badge.idle {
            background: #6b7280;
        }

        .line-status-badge.maintenance {
            background: #f59e0b;
        }

        .line-status-badge.stopped {
            background: #ef4444;
        }

        .modal-actions {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* All action buttons now use unified .btn classes above */

        /* ===== ORDERS PAGE STYLES ===== */
        .orders-summary {
            margin-bottom: 2rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        /* Summary cards now use unified metric card styles above */

        /* Filters */
        .orders-filters {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }

        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-select, .filter-input, .filter-date {
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .filter-select:focus, .filter-input:focus, .filter-date:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .priority-checkboxes {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .priority-checkboxes label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            cursor: pointer;
        }

        /* Orders Main Layout */
        .orders-main {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            min-height: 70vh;
        }

        .orders-table-section {
            min-width: 0;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8125rem;
            line-height: 1.3;
        }

        .orders-table th {
            background: #f8fafc;
            padding: 0.5rem 0.625rem;
            text-align: left;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap;
            font-size: 0.6875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .orders-table td {
            padding: 0.5rem 0.625rem;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
            font-size: 0.8125rem;
            line-height: 1.3;
        }

        .orders-table tr:hover {
            background: #f8fafc;
        }

        /* Badges now use unified styles above */

        /* Progress bar */
        .progress-bar-order {
            width: 60px;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            display: inline-block;
        }

        .progress-fill-order {
            height: 100%;
            background: #3b82f6;
            border-radius: 3px;
            transition: width 0.2s ease;
        }

        /* Compact progress container */
        .progress-container {
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .progress-container small {
            font-size: 0.6875rem;
            color: #6b7280;
            white-space: nowrap;
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        /* btn-sm is defined above in unified styles */

        /* Timeline Panel */
        .production-timeline-panel {
            min-width: 0;
        }

        .timeline-legend {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.8rem;
        }

        .legend-item {
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            background: #f3f4f6;
            color: var(--text-secondary);
        }

        .timeline-content {
            padding: 1rem 0;
            min-height: 300px;
        }

        .timeline-placeholder {
            text-align: center;
            color: var(--text-secondary);
            padding: 2rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px dashed #d1d5db;
        }

        .timeline-stage {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
        }

        .timeline-stage.completed {
            background: #f0fdf4;
            border-left-color: #16a34a;
        }

        .timeline-stage.current {
            background: #fef3c7;
            border-left-color: #d97706;
        }

        .timeline-stage.pending {
            background: #f8fafc;
            border-left-color: #e5e7eb;
        }

        /* Order Number Link */
        .order-number-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .order-number-link:hover {
            text-decoration: underline;
        }

        /* ===== PLANNING PAGE STYLES ===== */
        .planning-metrics {
            margin-bottom: 2rem;
        }

        .planning-workspace {
            display: grid;
            grid-template-columns: 380px 1fr 350px;
            gap: 2rem;
            min-height: 80vh;
            max-height: 85vh;
        }

        /* Orders Queue Panel */
        .orders-queue-panel {
            min-width: 0;
        }

        .queue-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .orders-queue {
            max-height: 600px;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .order-queue-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: grab;
            transition: all 0.2s ease;
            border-left: 4px solid #e5e7eb;
        }

        .order-queue-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .order-queue-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }

        .order-queue-card.priority-urgent {
            border-left-color: #ef4444;
        }

        .order-queue-card.priority-high {
            border-left-color: #f59e0b;
        }

        .order-queue-card.priority-normal {
            border-left-color: #3b82f6;
        }

        .order-queue-card.priority-low {
            border-left-color: #10b981;
        }

        .queue-card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .queue-order-number {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
        }

        .queue-priority-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .queue-card-info {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .queue-card-info div {
            margin-bottom: 0.25rem;
        }

        .queue-deadline {
            color: #ef4444;
            font-weight: 500;
        }

        /* Production Lines Panel */
        .production-lines-panel {
            min-width: 0;
        }

        .timeline-controls {
            display: flex;
            gap: 0.5rem;
        }

        .production-lines-grid {
            padding: 1rem 0;
        }

        .production-line-row {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .line-row-header {
            background: #f8fafc;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .line-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .line-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .line-status-indicator {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .line-status-running {
            background: #dcfce7;
            color: #16a34a;
        }

        .line-status-idle {
            background: #fef3c7;
            color: #d97706;
        }

        .line-status-maintenance {
            background: #fee2e2;
            color: #dc2626;
        }

        .line-capacity {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .line-controls {
            display: flex;
            gap: 0.5rem;
        }

        .line-timeline {
            padding: 1rem;
            position: relative;
        }

        .timeline-slots {
            display: grid;
            grid-template-columns: repeat(24, 1fr);
            gap: 1px;
            height: 40px;
            background: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
        }

        .timeline-slot {
            background: #e5e7eb;
            position: relative;
            cursor: pointer;
        }

        .timeline-slot.occupied {
            background: #3b82f6;
        }

        .timeline-slot.setup {
            background: #f59e0b;
        }

        .timeline-slot.maintenance {
            background: #ef4444;
        }

        .timeline-slot:hover {
            opacity: 0.8;
        }

        .timeline-task {
            position: absolute;
            top: 2px;
            bottom: 2px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 500;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 0 4px;
        }

        .task-production {
            background: #3b82f6;
        }

        .task-setup {
            background: #f59e0b;
        }

        .task-maintenance {
            background: #ef4444;
        }

        /* Recommendations Panel */
        .recommendations-panel {
            min-width: 0;
        }

        .recommendations-content {
            max-height: 600px;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .recommendation-item {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #3b82f6;
        }

        .recommendation-item.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }

        .recommendation-item.error {
            border-left-color: #ef4444;
            background: #fef2f2;
        }

        .recommendation-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .recommendation-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }

        .recommendation-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Accept/decline buttons now use .btn .btn-success/.btn-secondary classes */

        /* Planning Modal */
        .planning-modal {
            max-width: 800px;
            width: 90%;
        }

        .planning-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .order-info-section,
        .line-selection-section,
        .timing-section {
            margin-bottom: 1.5rem;
        }

        .timing-section {
            grid-column: 1 / -1;
        }

        .timing-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .input-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .line-option {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .line-option:hover {
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .line-option.selected {
            border-color: var(--primary-color);
            background: #f0f9ff;
        }

        .line-option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .line-option-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .line-efficiency {
            font-size: 0.8rem;
            color: #10b981;
            font-weight: 500;
        }

        .line-option-details {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Drag and Drop */
        .drop-zone {
            min-height: 60px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            color: var(--text-secondary);
            background: #f9fafb;
            transition: all 0.2s ease;
        }

        .drop-zone.drag-over {
            border-color: var(--primary-color);
            background: #f0f9ff;
            color: var(--primary-color);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .planning-workspace {
                grid-template-columns: 280px 1fr 260px;
            }
        }

        @media (max-width: 768px) {
            .planning-workspace {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .planning-details {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .timing-inputs {
                grid-template-columns: 1fr;
            }
        }

        /* ===== UTILITIES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .mb-20 { margin-bottom: 20px; }
        .mt-20 { margin-top: 20px; }
        .hidden { display: none; }

        .flex { display: flex; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .gap-10 { gap: 10px; }
        .gap-15 { gap: 15px; }
        .gap-20 { gap: 20px; }

        /* ===== DASHBOARD WIDGETS ===== */
        .dashboard-widgets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* ===== STATUS BADGES ===== */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-new { background: #dbeafe; color: #1e40af; }
        .status-approved { background: #dcfce7; color: #166534; }
        .status-in-production { background: #fef3c7; color: #92400e; }
        .status-completed { background: #f0fdf4; color: #166534; }
        .status-cancelled { background: #fee2e2; color: #991b1b; }

        /* ===== MPSYSTEM SPECIFIC STYLES ===== */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
        }

        .subtitle {
            color: #6b7280;
            font-weight: 500;
        }

        .status-indicator {
            padding: 0.125rem 0.5rem;
            border-radius: 3px;
            font-size: 0.6875rem;
            font-weight: 500;
        }

        .status-indicator.online {
            color: #059669;
            background: #d1fae5;
        }

        .time {
            color: #374151;
            font-weight: 500;
            font-family: 'Monaco', 'Courier New', monospace;
        }

        /* Production Overview */
        .production-overview {
            margin-top: 30px;
        }

        .production-overview h2 {
            margin-bottom: 25px;
            color: #1f2937;
            font-size: 24px;
            font-weight: 700;
        }

        .line-group {
            margin-bottom: 35px;
        }

        .line-group h3 {
            margin-bottom: 20px;
            color: #374151;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .lines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        /* Line Cards */
        .line-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .line-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .line-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .line-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 16px;
        }

        .line-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .line-status.running {
            color: #059669;
            background: #d1fae5;
        }

        .line-status.idle {
            color: #d97706;
            background: #fef3c7;
        }

        .line-status.maintenance {
            color: #dc2626;
            background: #fee2e2;
        }

        .line-details {
            margin-bottom: 15px;
        }

        .current-order {
            font-weight: 500;
            color: #374151;
            margin-bottom: 12px;
        }

        .progress-info {
            margin-bottom: 12px;
        }

        .progress-bar {
            background: #f3f4f6;
            border-radius: 8px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            background: #3b82f6;
            height: 100%;
            border-radius: 8px;
            transition: width 0.3s ease;
        }

        .progress-fill.orange {
            background: #f59e0b;
        }

        .progress-text {
            font-size: 12px;
            color: #6b7280;
        }

        .line-metrics {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #6b7280;
        }

        .line-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .line-card:hover .line-actions {
            opacity: 1;
        }

        /* Action buttons now use unified btn styles above */

        /* Alerts Panel */
        .alerts-panel {
            margin-top: 35px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 25px;
        }

        .alerts-panel h3 {
            margin-bottom: 20px;
            color: #1f2937;
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-item.critical {
            background: #fef2f2;
            border-left-color: #dc2626;
        }

        .alert-item.warning {
            background: #fffbeb;
            border-left-color: #f59e0b;
        }

        .alert-item.info {
            background: #eff6ff;
            border-left-color: #3b82f6;
        }

        .alert-icon {
            font-size: 16px;
        }

        .alert-text {
            flex: 1;
            color: #374151;
            font-size: 14px;
        }

        .alert-time {
            color: #6b7280;
            font-size: 12px;
            min-width: 80px;
        }

        .alert-action {
            padding: 6px 12px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .alert-action:hover {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .container { padding: 0 15px; }
            .nav-tab { padding: 12px 16px; font-size: 13px; }
            .stats-grid { grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
            .dashboard-widgets { grid-template-columns: 1fr; }
            .modal-content { margin: 20px; width: calc(100% - 40px); }
            .lines-grid { grid-template-columns: 1fr; }
            .line-actions { position: static; opacity: 1; margin-top: 15px; }
            .alert-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .alert-time { min-width: auto; }
            .user-info { flex-direction: column; gap: 5px; align-items: flex-end; }
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">üè≠</span>
                <div class="logo-text">
                    <h1>MPSYSTEM</h1>
                    <span class="subtitle">–£–ø–∞–∫–æ–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</span>
                </div>
            </div>
            <div class="system-status">
                <span class="status-indicator online" id="systemStatus">‚óè Online</span>
                <span class="time" id="currentTime"></span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <button class="nav-item active" onclick="showTab('dashboard')">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
            </button>
            <button class="nav-item" onclick="showTab('planning')">
                <span class="nav-icon">üìã</span>
                <span class="nav-text">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
            </button>
            <button class="nav-item" onclick="showTab('production')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</span>
            </button>
            <button class="nav-item" onclick="showTab('quality')">
                <span class="nav-icon">üî¨</span>
                <span class="nav-text">–ö–∞—á–µ—Å—Ç–≤–æ</span>
            </button>
            <button class="nav-item" onclick="showTab('warehouse')">
                <span class="nav-icon">üì¶</span>
                <span class="nav-text">–°–∫–ª–∞–¥</span>
            </button>
            <button class="nav-item" onclick="showTab('purchasing')">
                <span class="nav-icon">üõí</span>
                <span class="nav-text">–ó–∞–∫—É–ø–∫–∏</span>
            </button>
            <button class="nav-item" onclick="showTab('orders')">
                <span class="nav-icon">üìë</span>
                <span class="nav-text">–ó–∞–∫–∞–∑—ã</span>
            </button>
            <button class="nav-item" onclick="showTab('maintenance')">
                <span class="nav-icon">üîß</span>
                <span class="nav-text">–¢–û</span>
            </button>
            <button class="nav-item" onclick="showTab('analytics')">
                <span class="nav-icon">üìà</span>
                <span class="nav-text">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
            </button>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="content-wrapper">
            <!-- Dashboard Tab -->
                    <div id="dashboard" class="tab-content active">
            <!-- UC-D001: –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫ - –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (4 –∫–∞—Ä—Ç–æ—á–∫–∏) -->
            <div class="dashboard-metrics">
                <div class="metrics-grid">
                    <div class="metric-card" data-metric="orders">
                        <div class="metric-header">
                            <span class="metric-icon">üìä</span>
                            <span class="metric-title">Orders</span>
                        </div>
                        <div class="metric-value" id="totalOrders">847</div>
                        <div class="metric-label">Active</div>
                        <div class="metric-change" id="ordersChange">+12 today</div>
                    </div>
                    <div class="metric-card" data-metric="production">
                        <div class="metric-header">
                            <span class="metric-icon">‚öôÔ∏è</span>
                            <span class="metric-title">Production</span>
                        </div>
                        <div class="metric-value" id="productionCapacity">94.2%</div>
                        <div class="metric-label">Capacity</div>
                        <div class="metric-change" id="productionChange">+2.1% vs target</div>
                    </div>
                    <div class="metric-card" data-metric="efficiency">
                        <div class="metric-header">
                            <span class="metric-icon">üìà</span>
                            <span class="metric-title">Efficiency</span>
                        </div>
                        <div class="metric-value" id="oeeMetric">87.3%</div>
                        <div class="metric-label">OEE</div>
                        <div class="metric-change" id="efficiencyChange">+1.2% vs yesterday</div>
                    </div>
                    <div class="metric-card" data-metric="quality">
                        <div class="metric-header">
                            <span class="metric-icon">‚úÖ</span>
                            <span class="metric-title">Quality</span>
                        </div>
                        <div class="metric-value" id="qualityRate">99.1%</div>
                        <div class="metric-label">Pass Rate</div>
                        <div class="metric-change" id="qualityChange">Excellent</div>
                    </div>
                </div>
            </div>

                <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫: –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ -->
                <div class="production-overview">
                    <h2>–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏</h2>
                    
                    <!-- üîÑ –ì—Ä—É–ø–ø–∞: –≠–∫—Å—Ç—Ä—É–∑–∏—è (4 –ª–∏–Ω–∏–∏ + 2 —Ä–µ–∑–∫–∏ + –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è) -->
                    <div class="line-group">
                        <h3>üîÑ –≠–∫—Å—Ç—Ä—É–∑–∏—è</h3>
                        <div class="lines-grid">
                            <!-- 4 –æ—Å–Ω–æ–≤–Ω—ã–µ –ª–∏–Ω–∏–∏ —ç–∫—Å—Ç—Ä—É–∑–∏–∏ -->
                            <div class="line-card" id="extrusion-1" onclick="showLineDetails('extrusion-1')">
                                <div class="line-header">
                                    <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è-1 (—Ä—É–∫–∞–≤–∞)</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–ó–∞–∫–∞–∑: ORD-250001</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 65%"></div>
                                        </div>
                                        <span class="progress-text">65% (2—á 30–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 89%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 3 –∑–∞–∫–∞–∑–∞</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="pauseLine('extrusion-1')">‚è∏Ô∏è</button>
                                    <button class="btn-action" onclick="adjustPriority('extrusion-1')">üîº</button>
                                </div>
                            </div>
                            
                            <div class="line-card" id="extrusion-2" onclick="showLineDetails('extrusion-2')">
                                <div class="line-header">
                                    <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è-2 (–ø–∞–∫–µ—Ç—ã)</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–ó–∞–∫–∞–∑: ORD-250003</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 30%"></div>
                                        </div>
                                        <span class="progress-text">30% (4—á 15–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 92%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 5 –∑–∞–∫–∞–∑–æ–≤</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="pauseLine('extrusion-2')">‚è∏Ô∏è</button>
                                    <button class="btn-action" onclick="adjustPriority('extrusion-2')">üîº</button>
                                </div>
                            </div>
                            
                            <div class="line-card" id="extrusion-3" onclick="showLineDetails('extrusion-3')">
                                <div class="line-header">
                                    <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è-3</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–ó–∞–∫–∞–∑: ORD-250008</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 85%"></div>
                                        </div>
                                        <span class="progress-text">85% (45–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 94%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 2 –∑–∞–∫–∞–∑–∞</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="pauseLine('extrusion-3')">‚è∏Ô∏è</button>
                                    <button class="btn-action" onclick="adjustPriority('extrusion-3')">üîº</button>
                                </div>
                            </div>
                            
                            <div class="line-card" id="extrusion-4" onclick="showLineDetails('extrusion-4')">
                                <div class="line-header">
                                    <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è-4</span>
                                    <span class="line-status idle">–ü—Ä–æ—Å—Ç–æ–π</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–û–∂–∏–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text">0%</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 0%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 1 –∑–∞–∫–∞–∑</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="checkMaterials('extrusion-4')">üì¶</button>
                                    <button class="btn-action" onclick="startLine('extrusion-4')">‚ñ∂Ô∏è</button>
                                </div>
                            </div>
                            
                            <!-- 2 –ª–∏–Ω–∏–∏ —Ä–µ–∑–∫–∏ -->
                            <div class="line-card" id="cutting-1" onclick="showLineDetails('cutting-1')">
                                <div class="line-header">
                                    <span class="line-name">–†–µ–∑–∫–∞-1</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–†–µ–∑–∫–∞ ORD-250001</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 40%"></div>
                                        </div>
                                        <span class="progress-text">40% (1—á 20–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 88%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 4 –∑–∞–∫–∞–∑–∞</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="pauseLine('cutting-1')">‚è∏Ô∏è</button>
                                    <button class="btn-action" onclick="adjustPriority('cutting-1')">üîº</button>
                                </div>
                            </div>
                            
                            <div class="line-card" id="cutting-2" onclick="showLineDetails('cutting-2')">
                                <div class="line-header">
                                    <span class="line-name">–†–µ–∑–∫–∞-2</span>
                                    <span class="line-status maintenance">–¢–û</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–°–º–µ–Ω–∞ –Ω–æ–∂–µ–π</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 70%"></div>
                                        </div>
                                        <span class="progress-text">70% (20–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 0%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 2 –∑–∞–∫–∞–∑–∞</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="completeMaintenance('cutting-2')">‚úÖ</button>
                                    <button class="btn-action" onclick="scheduleDelay('cutting-2')">‚è∞</button>
                                </div>
                            </div>
                            
                            <!-- –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è -->
                            <div class="line-card" id="laboratory" onclick="showLineDetails('laboratory')">
                                <div class="line-header">
                                    <span class="line-name">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–¢–µ—Å—Ç –ø–∞—Ä—Ç–∏–∏ ‚Ññ245</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 60%"></div>
                                        </div>
                                        <span class="progress-text">60% (30–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 95%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 3 –æ–±—Ä–∞–∑—Ü–∞</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="rushTest('laboratory')">‚ö°</button>
                                    <button class="btn-action" onclick="viewResults('laboratory')">üìã</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- üìÑ –ì—Ä—É–ø–ø–∞: –õ–∞–º–∏–Ω–∞—Ü–∏—è (1 –ª–∏–Ω–∏—è + —Ä–µ–∑–∫–∞) -->
                    <div class="line-group">
                        <h3>üìÑ –õ–∞–º–∏–Ω–∞—Ü–∏—è</h3>
                        <div class="lines-grid">
                            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ª–∏–Ω–∏—è –ª–∞–º–∏–Ω–∞—Ü–∏–∏ -->
                            <div class="line-card" id="lamination-1" onclick="showLineDetails('lamination-1')">
                                <div class="line-header">
                                    <span class="line-name">–õ–∞–º–∏–Ω–∞—Ü–∏—è-1</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–ó–∞–∫–∞–∑: ORD-250009</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 55%"></div>
                                        </div>
                                        <span class="progress-text">55% (3—á 45–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 82%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 7 –∑–∞–∫–∞–∑–æ–≤</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="pauseLine('lamination-1')">‚è∏Ô∏è</button>
                                    <button class="btn-action" onclick="adjustPriority('lamination-1')">üîº</button>
                                </div>
                            </div>
                            
                            <!-- –†–µ–∑–∫–∞ –ª–∞–º–∏–Ω–∞—Ü–∏–∏ -->
                            <div class="line-card" id="lamination-cutting" onclick="showLineDetails('lamination-cutting')">
                                <div class="line-header">
                                    <span class="line-name">–†–µ–∑–∫–∞ –ª–∞–º–∏–Ω–∞—Ü–∏–∏</span>
                                    <span class="line-status idle">–ü—Ä–æ—Å—Ç–æ–π</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–û–∂–∏–¥–∞–Ω–∏–µ –ª–∞–º–∏–Ω–∞—Ü–∏–∏</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text">0%</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 0%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 5 –∑–∞–∫–∞–∑–æ–≤</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="prepareForLamination('lamination-cutting')">üîÑ</button>
                                    <button class="btn-action" onclick="startLine('lamination-cutting')">‚ñ∂Ô∏è</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- üé® –ì—Ä—É–ø–ø–∞: –ü–µ—á–∞—Ç—å (2 –ª–∏–Ω–∏–∏) -->
                    <div class="line-group">
                        <h3>üé® –ü–µ—á–∞—Ç—å</h3>
                        <div class="lines-grid">
                            <!-- –§–ª–µ–∫—Å–æ–ø–µ—á–∞—Ç—å -->
                            <div class="line-card" id="printing-1" onclick="showLineDetails('printing-1')">
                                <div class="line-header">
                                    <span class="line-name">–§–ª–µ–∫—Å–æ–ø–µ—á–∞—Ç—å-1</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–ó–∞–∫–∞–∑: ORD-250012</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 45%"></div>
                                        </div>
                                        <span class="progress-text">45% (3—á 10–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 85%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 4 –∑–∞–∫–∞–∑–∞</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="pauseLine('printing-1')">‚è∏Ô∏è</button>
                                    <button class="btn-action" onclick="adjustPriority('printing-1')">üîº</button>
                                </div>
                            </div>
                            
                            <!-- –¶–∏—Ñ—Ä–æ–≤–∞—è –ø–µ—á–∞—Ç—å -->
                            <div class="line-card" id="printing-2" onclick="showLineDetails('printing-2')">
                                <div class="line-header">
                                    <span class="line-name">–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–µ—á–∞—Ç—å</span>
                                    <span class="line-status running">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                                </div>
                                <div class="line-details">
                                    <div class="current-order">–ó–∞–∫–∞–∑: ORD-250015</div>
                                    <div class="progress-info">
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 20%"></div>
                                        </div>
                                        <span class="progress-text">20% (1—á 45–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                                    </div>
                                    <div class="line-metrics">
                                        <span>OEE: 78%</span>
                                        <span>–û—á–µ—Ä–µ–¥—å: 2 –∑–∞–∫–∞–∑–∞</span>
                                    </div>
                                </div>
                                <div class="line-actions">
                                    <button class="btn-action" onclick="pauseLine('printing-2')">‚è∏Ô∏è</button>
                                    <button class="btn-action" onclick="adjustPriority('printing-2')">üîº</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤—ã–π –±–ª–æ–∫: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
                <div class="alerts-panel">
                    <h3>üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                    <div class="alerts-list" id="criticalAlerts">
                        <div class="alert-item critical">
                            <span class="alert-icon">‚ö†Ô∏è</span>
                            <span class="alert-text">–ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫: –ì—Ä–∞–Ω—É–ª—ã PE (–æ—Å—Ç–∞–ª–æ—Å—å 50–∫–≥)</span>
                            <span class="alert-time">5 –º–∏–Ω –Ω–∞–∑–∞–¥</span>
                            <button class="alert-action" onclick="orderMaterial('PE')">–ó–∞–∫–∞–∑–∞—Ç—å</button>
                        </div>
                        <div class="alert-item warning">
                            <span class="alert-icon">‚è∞</span>
                            <span class="alert-text">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω –∑–∞–∫–∞–∑ ORD-249987 (–æ–ø–æ–∑–¥–∞–Ω–∏–µ: 2 –¥–Ω—è)</span>
                            <span class="alert-time">1 —á–∞—Å –Ω–∞–∑–∞–¥</span>
                            <button class="alert-action" onclick="escalateOrder('ORD-249987')">–≠—Å–∫–∞–ª–∞—Ü–∏—è</button>
                        </div>
                        <div class="alert-item info">
                            <span class="alert-icon">üî¨</span>
                            <span class="alert-text">–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –ø–∞—Ä—Ç–∏–∏ ‚Ññ243</span>
                            <span class="alert-time">30 –º–∏–Ω –Ω–∞–∑–∞–¥</span>
                            <button class="alert-action" onclick="scheduleQC('243')">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                        <div class="alert-item warning">
                            <span class="alert-icon">üîß</span>
                            <span class="alert-text">–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û –≠–∫—Å—Ç—Ä—É–∑–∏—è-2 —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞</span>
                            <span class="alert-time">10 –º–∏–Ω –Ω–∞–∑–∞–¥</span>
                            <button class="alert-action" onclick="prepareMaintenance('extrusion-2')">–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê: PLANNING (–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞) -->
            <div id="planning" class="tab-content">
                <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫: –ú–µ—Ç—Ä–∏–∫–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div class="planning-metrics">
                    <div class="metrics-grid">
                        <div class="metric-card planning-orders">
                            <div class="metric-header">
                                <span class="metric-icon">üìã</span>
                                <span class="metric-title">Orders to Schedule</span>
                            </div>
                            <div class="metric-value" id="ordersToSchedule">23</div>
                            <div class="metric-label">–ö –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</div>
                        </div>
                        <div class="metric-card planning-lines">
                            <div class="metric-header">
                                <span class="metric-icon">‚öôÔ∏è</span>
                                <span class="metric-title">Lines Available</span>
                            </div>
                            <div class="metric-value" id="linesAvailable">6</div>
                            <div class="metric-label">–î–æ—Å—Ç—É–ø–Ω–æ –ª–∏–Ω–∏–π</div>
                        </div>
                        <div class="metric-card planning-setup">
                            <div class="metric-header">
                                <span class="metric-icon">üîß</span>
                                <span class="metric-title">Setup Time</span>
                            </div>
                            <div class="metric-value" id="setupTime">45 min</div>
                            <div class="metric-label">–ü–µ—Ä–µ–Ω–∞–ª–∞–¥–∫–∞</div>
                        </div>
                        <div class="metric-card planning-materials">
                            <div class="metric-header">
                                <span class="metric-icon">üì¶</span>
                                <span class="metric-title">Materials Ready</span>
                            </div>
                            <div class="metric-value" id="materialsReady">89%</div>
                            <div class="metric-label">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –≥–æ—Ç–æ–≤—ã</div>
                        </div>
                    </div>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div class="planning-workspace">
                    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: –û—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤ -->
                    <div class="orders-queue-panel">
                        <div class="card">
                            <div class="card-header">
                                <h3>üìã –û—á–µ—Ä–µ–¥—å –∑–∞–∫–∞–∑–æ–≤</h3>
                                <div class="queue-controls">
                                    <select id="queueFilter" class="filter-select">
                                        <option value="all">–í—Å–µ –∑–∞–∫–∞–∑—ã</option>
                                        <option value="new">–ù–æ–≤—ã–µ</option>
                                        <option value="confirmed">–í –æ—á–µ—Ä–µ–¥–∏</option>
                                        <option value="urgent">–°—Ä–æ—á–Ω—ã–µ</option>
                                    </select>
                                    <select id="queueSort" class="filter-select">
                                        <option value="priority">–ü–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É</option>
                                        <option value="deadline">–ü–æ —Å—Ä–æ–∫–∞–º</option>
                                        <option value="client">–ü–æ –∫–ª–∏–µ–Ω—Ç—É</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="orders-queue" id="ordersQueue">
                                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>

                    <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å: –õ–∏–Ω–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ -->
                    <div class="production-lines-panel">
                        <div class="card">
                            <div class="card-header">
                                <h3>üè≠ –õ–∏–Ω–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h3>
                                <div class="timeline-controls">
                                    <button class="btn btn-sm btn-secondary" onclick="switchTimelineView('day')">–î–µ–Ω—å</button>
                                    <button class="btn btn-sm btn-primary" onclick="switchTimelineView('week')">–ù–µ–¥–µ–ª—è</button>
                                    <button class="btn btn-sm btn-secondary" onclick="switchTimelineView('month')">–ú–µ—Å—è—Ü</button>
                                </div>
                            </div>
                            
                            <div class="production-lines-grid" id="productionLinesGrid">
                                <!-- –õ–∏–Ω–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>

                    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã -->
                    <div class="recommendations-panel">
                        <div class="card">
                            <div class="card-header">
                                <h3>ü§ñ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
                                <button class="btn btn-sm btn-primary" onclick="generateRecommendations()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                            </div>
                            
                            <div class="recommendations-content" id="recommendationsContent">
                                <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
                <div id="planningModal" class="modal">
                    <div class="modal-content planning-modal">
                        <div class="modal-header">
                            <h2>üìã –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
                            <div class="modal-controls">
                                <button class="btn btn-sm btn-secondary" onclick="toggleModalType('planningModal')" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥">‚áÑ</button>
                                <button class="close" onclick="hidePlanningModal()">&times;</button>
                            </div>
                        </div>
                        
                        <div class="planning-details">
                            <div class="order-info-section">
                                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h3>
                                <div id="planningOrderInfo">
                                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ -->
                                </div>
                            </div>
                            
                            <div class="line-selection-section">
                                <h3>–í—ã–±–æ—Ä –ª–∏–Ω–∏–∏</h3>
                                <div id="lineOptions">
                                    <!-- –û–ø—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –ª–∏–Ω–∏–∏ -->
                                </div>
                            </div>
                            
                            <div class="timing-section">
                                <h3>–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                                <div class="timing-inputs">
                                    <div class="input-group">
                                        <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
                                        <input type="datetime-local" id="startTime">
                                    </div>
                                    <div class="input-group">
                                        <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤ –æ—á–µ—Ä–µ–¥–∏:</label>
                                        <select id="queuePriority">
                                            <option value="1">–í—ã—Å—à–∏–π (1)</option>
                                            <option value="2">–í—ã—Å–æ–∫–∏–π (2)</option>
                                            <option value="3">–°—Ä–µ–¥–Ω–∏–π (3)</option>
                                            <option value="4">–ù–∏–∑–∫–∏–π (4)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button class="btn btn-primary" onclick="scheduleOrder()">üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="btn btn-secondary" onclick="hidePlanningModal()">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quality Tab -->
            <div id="quality" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üî¨ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞</h3>
                        <button class="btn btn-primary">+ –ù–æ–≤—ã–π —Ç–µ—Å—Ç</button>
                    </div>
                    <div class="dashboard-widgets">
                        <div class="card">
                            <h4>–ú–æ–¥—É–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏</h4>
                            <p>–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∏ –æ—Ç—á–µ—Ç—ã –ø–æ –∫–∞—á–µ—Å—Ç–≤—É.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Maintenance Tab -->
            <div id="maintenance" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</h3>
                        <button class="btn btn-primary">+ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –¢–û</button>
                    </div>
                    <div class="dashboard-widgets">
                        <div class="card">
                            <h4>–ú–æ–¥—É–ª—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏</h4>
                            <p>–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¢–û, —É—á–µ—Ç –∑–∞–ø—á–∞—Å—Ç–µ–π, –∏ –∏—Å—Ç–æ—Ä–∏—é –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Procurement Tab -->
            <div id="procurement" class="tab-content">
                <div class="dashboard-widgets">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
                            <button class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–ö–æ–¥</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–ï–¥–∏–Ω–∏—Ü–∞</th>
                                        <th>–¶–µ–Ω–∞</th>
                                        <th>–ú–∏–Ω. –æ—Å—Ç–∞—Ç–æ–∫</th>
                                        <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="materialsTable">
                                    <!-- Materials will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üè¢ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</h3>
                            <button class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–ö–æ–¥</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</th>
                                        <th>Email</th>
                                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <th>–†–µ–π—Ç–∏–Ω–≥</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="suppliersTable">
                                    <!-- Suppliers will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê: ORDERS (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏) -->
            <div id="orders" class="tab-content">
                <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫: –°–≤–æ–¥–∫–∞ –ø–æ –∑–∞–∫–∞–∑–∞–º (4 –∫–∞—Ä—Ç–æ—á–∫–∏) -->
                <div class="orders-summary">
                    <div class="summary-grid">
                        <div class="summary-card new">
                            <div class="summary-header">
                                <span class="summary-icon">üìù</span>
                                <span class="summary-title">New</span>
                            </div>
                            <div class="summary-value" id="ordersNew">23</div>
                            <div class="summary-label">–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</div>
                        </div>
                        <div class="summary-card queued">
                            <div class="summary-header">
                                <span class="summary-icon">‚è≥</span>
                                <span class="summary-title">Queued</span>
                            </div>
                            <div class="summary-value" id="ordersQueued">45</div>
                            <div class="summary-label">–í –æ—á–µ—Ä–µ–¥–∏</div>
                        </div>
                        <div class="summary-card in-progress">
                            <div class="summary-header">
                                <span class="summary-icon">‚öôÔ∏è</span>
                                <span class="summary-title">In Progress</span>
                            </div>
                            <div class="summary-value" id="ordersInProgress">18</div>
                            <div class="summary-label">–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ</div>
                        </div>
                        <div class="summary-card critical">
                            <div class="summary-header">
                                <span class="summary-icon">üö®</span>
                                <span class="summary-title">Critical</span>
                            </div>
                            <div class="summary-value" id="ordersCritical">7</div>
                            <div class="summary-label">–ö—Ä–∏—Ç–∏—á–Ω—ã–µ</div>
                        </div>
                    </div>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
                <div class="orders-filters">
                    <div class="filters-row">
                        <div class="filter-group">
                            <label>–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:</label>
                            <select id="filterStatus" class="filter-select">
                                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                <option value="new">–ù–æ–≤—ã–π</option>
                                <option value="confirmed">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</option>
                                <option value="planned">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω</option>
                                <option value="in_production">–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ</option>
                                <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                                <option value="shipped">–û—Ç–≥—Ä—É–∂–µ–Ω</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>–ö–ª–∏–µ–Ω—Ç:</label>
                            <input type="text" id="filterClient" class="filter-input" placeholder="–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞..." list="clientsList">
                            <datalist id="clientsList">
                                <option value="–û–û–û –ü–∞–∫–µ—Ç-–°–µ—Ä–≤–∏—Å">
                                <option value="–ê–û –£–ø–∞–∫–æ–≤–æ—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è">
                                <option value="–ò–ü –í–∞—Å–∏–ª—å–µ–≤">
                                <option value="–¢–ö –õ–æ–≥–∏—Å—Ç–∏–∫">
                                <option value="–ú–µ–≥–∞–¢—Ä–µ–π–¥">
                            </datalist>
                        </div>
                        
                        <div class="filter-group">
                            <label>–ü–µ—Ä–∏–æ–¥:</label>
                            <input type="date" id="filterDateFrom" class="filter-date">
                            <span>‚Äî</span>
                            <input type="date" id="filterDateTo" class="filter-date">
                        </div>
                        
                        <div class="filter-group">
                            <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
                            <div class="priority-checkboxes">
                                <label><input type="checkbox" value="urgent" checked> –°—Ä–æ—á–Ω—ã–π</label>
                                <label><input type="checkbox" value="high" checked> –í—ã—Å–æ–∫–∏–π</label>
                                <label><input type="checkbox" value="normal" checked> –û–±—ã—á–Ω—ã–π</label>
                                <label><input type="checkbox" value="low" checked> –ù–∏–∑–∫–∏–π</label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>–ü–æ–∏—Å–∫:</label>
                            <input type="text" id="searchOrder" class="filter-input" placeholder="–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞...">
                            <button class="btn btn-primary" onclick="applyOrderFilters()">üîç –ü–æ–∏—Å–∫</button>
                            <button class="btn btn-secondary" onclick="resetOrderFilters()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                        </div>
                    </div>
                </div>

                <div class="orders-main">
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ -->
                    <div class="orders-table-section">
                        <div class="card">
                            <div class="card-header">
                                <h3>üìë –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h3>
                                <button class="btn btn-primary" onclick="showCreateOrderModal()">+ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
                            </div>

                            <div class="table-container">
                                <table class="orders-table">
                                    <thead>
                                        <tr>
                                            <th>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</th>
                                            <th>–ö–ª–∏–µ–Ω—Ç</th>
                                            <th>–ü—Ä–æ–¥—É–∫—Ç</th>
                                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                            <th>–°—Ä–æ–∫ –ø–æ—Å—Ç–∞–≤–∫–∏</th>
                                            <th>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</th>
                                            <th>–°—Ç–∞—Ç—É—Å</th>
                                            <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersTableBody">
                                        <!-- Orders –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å: Timeline –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ -->
                    <div class="production-timeline-panel">
                        <div class="card">
                            <div class="card-header">
                                <h3>üè≠ Timeline –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h3>
                                <div class="timeline-legend">
                                    <span class="legend-item completed">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                    <span class="legend-item current">‚è≥ –¢–µ–∫—É—â–∏–π</span>
                                    <span class="legend-item pending">‚è∏Ô∏è –û–∂–∏–¥–∞–Ω–∏–µ</span>
                                </div>
                            </div>
                            
                            <div class="timeline-content" id="productionTimeline">
                                <div class="timeline-placeholder">
                                    –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ timeline –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê: INVENTORY (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–ª–∞–¥–æ–º) -->
            <div id="warehouse" class="tab-content">
                <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫: –°–∫–ª–∞–¥—Å–∫–∞—è —Å–≤–æ–¥–∫–∞ (4 –∫–∞—Ä—Ç–æ—á–∫–∏) -->
                <div class="inventory-summary">
                    <div class="summary-grid">
                        <div class="summary-card total">
                            <div class="summary-header">
                                <span class="summary-icon">üì¶</span>
                                <span class="summary-title">Total Items</span>
                            </div>
                            <div class="summary-value" id="totalItems">1,247</div>
                            <div class="summary-label">–í—Å–µ–≥–æ –ø–æ–∑–∏—Ü–∏–π</div>
                        </div>
                        <div class="summary-card critical">
                            <div class="summary-header">
                                <span class="summary-icon">‚ö†Ô∏è</span>
                                <span class="summary-title">Critical Stock</span>
                            </div>
                            <div class="summary-value" id="criticalStock">23</div>
                            <div class="summary-label">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏</div>
                        </div>
                        <div class="summary-card blocked">
                            <div class="summary-header">
                                <span class="summary-icon">üö´</span>
                                <span class="summary-title">Blocked Items</span>
                            </div>
                            <div class="summary-value" id="blockedItems">7</div>
                            <div class="summary-label">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</div>
                        </div>
                        <div class="summary-card available">
                            <div class="summary-header">
                                <span class="summary-icon">üí∞</span>
                                <span class="summary-title">Available Value</span>
                            </div>
                            <div class="summary-value" id="availableValue">‚Ç¨327K</div>
                            <div class="summary-label">–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø–∞—Å–æ–≤</div>
                        </div>
                    </div>
                </div>

                <!-- –í–∏–∑—É–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å–∫–ª–∞–¥–æ–≤ MAG -->
                <div class="mag-warehouses">
                    <div class="card">
                        <div class="card-header">
                            <h3>üè≠ –ö–∞—Ä—Ç–∞ —Å–∫–ª–∞–¥–æ–≤ MAG</h3>
                            <div class="warehouse-legend">
                                <span class="legend-item">‚ñì –ó–∞–ø–æ–ª–Ω–µ–Ω–æ</span>
                                <span class="legend-item">‚ñë –°–≤–æ–±–æ–¥–Ω–æ</span>
                            </div>
                        </div>
                        <div class="warehouses-grid">
                            <div class="warehouse-card" data-mag="MAG1" onclick="showMagDetails('MAG1')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 1</span>
                                    <span class="warehouse-type">–°—ã—Ä—å–µ</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 67%"></div>
                                </div>
                                <div class="warehouse-percent">67%</div>
                            </div>
                            <div class="warehouse-card" data-mag="MAG1.1" onclick="showMagDetails('MAG1.1')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 1.1</span>
                                    <span class="warehouse-type">ADR</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 45%"></div>
                                </div>
                                <div class="warehouse-percent">45%</div>
                            </div>
                            <div class="warehouse-card" data-mag="MAG2" onclick="showMagDetails('MAG2')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 2</span>
                                    <span class="warehouse-type">–≠–∫—Å—Ç—Ä—É–∑–∏—è</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 54%"></div>
                                </div>
                                <div class="warehouse-percent">54%</div>
                            </div>
                            <div class="warehouse-card" data-mag="MAG3" onclick="showMagDetails('MAG3')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 3</span>
                                    <span class="warehouse-type">UV</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 23%"></div>
                                </div>
                                <div class="warehouse-percent">23%</div>
                            </div>
                            <div class="warehouse-card" data-mag="MAG4" onclick="showMagDetails('MAG4')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 4</span>
                                    <span class="warehouse-type">–ü–µ—á–∞—Ç—å</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 34%"></div>
                                </div>
                                <div class="warehouse-percent">34%</div>
                            </div>
                            <div class="warehouse-card" data-mag="MAG5" onclick="showMagDetails('MAG5')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 5</span>
                                    <span class="warehouse-type">–õ–∞–º–∏–Ω–∞—Ü–∏—è</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 78%"></div>
                                </div>
                                <div class="warehouse-percent">78%</div>
                            </div>
                            <div class="warehouse-card" data-mag="MAG7" onclick="showMagDetails('MAG7')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 7</span>
                                    <span class="warehouse-type">–†–µ–∑–∫–∞</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 12%"></div>
                                </div>
                                <div class="warehouse-percent">12%</div>
                            </div>
                            <div class="warehouse-card" data-mag="MAG9" onclick="showMagDetails('MAG9')">
                                <div class="warehouse-header">
                                    <span class="warehouse-name">MAG 9</span>
                                    <span class="warehouse-type">–ì–æ—Ç–æ–≤–∞—è</span>
                                </div>
                                <div class="warehouse-bar">
                                    <div class="warehouse-fill" style="width: 89%"></div>
                                </div>
                                <div class="warehouse-percent">89%</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–±—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                <div class="inventory-tabs">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="showInventoryTab('materials')">üì¶ –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
                        <button class="tab-btn" onclick="showInventoryTab('critical')">‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏</button>
                        <button class="tab-btn" onclick="showInventoryTab('blocked')">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ</button>
                        <button class="tab-btn" onclick="showInventoryTab('movements')">üìã –î–≤–∏–∂–µ–Ω–∏—è</button>
                        <button class="tab-btn" onclick="showInventoryTab('stocktaking')">üîç –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</button>
                    </div>

                    <!-- –¢–∞–± 1: –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã -->
                    <div id="inventoryMaterials" class="inventory-tab-content active">
                        <div class="inventory-filters">
                            <div class="filters-row">
                                <div class="filter-group">
                                    <label>MAG —Å–∫–ª–∞–¥:</label>
                                    <select id="magFilter" class="filter-select">
                                        <option value="">–í—Å–µ —Å–∫–ª–∞–¥—ã</option>
                                        <option value="MAG1">MAG 1 - –°—ã—Ä—å–µ</option>
                                        <option value="MAG1.1">MAG 1.1 - ADR</option>
                                        <option value="MAG2">MAG 2 - –≠–∫—Å—Ç—Ä—É–∑–∏—è</option>
                                        <option value="MAG3">MAG 3 - UV</option>
                                        <option value="MAG4">MAG 4 - –ü–µ—á–∞—Ç—å</option>
                                        <option value="MAG5">MAG 5 - –õ–∞–º–∏–Ω–∞—Ü–∏—è</option>
                                        <option value="MAG7">MAG 7 - –†–µ–∑–∫–∞</option>
                                        <option value="MAG9">MAG 9 - –ì–æ—Ç–æ–≤–∞—è</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞:</label>
                                    <select id="typeFilter" class="filter-select">
                                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                        <option value="raw_material">–°—ã—Ä—å–µ</option>
                                        <option value="semi_finished">–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç—ã</option>
                                        <option value="finished_good">–ì–æ—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>–°—Ç–∞—Ç—É—Å –∫–∞—á–µ—Å—Ç–≤–∞:</label>
                                    <select id="qualityFilter" class="filter-select">
                                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                        <option value="quarantine">–ö–∞—Ä–∞–Ω—Ç–∏–Ω</option>
                                        <option value="released">–†–∞–∑—Ä–µ—à–µ–Ω</option>
                                        <option value="blocked">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>–ü–æ—Å—Ç–∞–≤—â–∏–∫:</label>
                                    <select id="supplierFilter" class="filter-select">
                                        <option value="">–í—Å–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" onclick="applyInventoryFilters()">üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                <button class="btn btn-secondary" onclick="resetInventoryFilters()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                            </div>
                        </div>

                        <div class="card table-card">
                            <div class="card-header">
                                <h3>üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–∞ —Å–∫–ª–∞–¥–µ</h3>
                                <div class="header-actions">
                                    <button class="btn btn-secondary" onclick="exportInventory()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç</button>
                                    <button class="btn btn-warning" onclick="showStocktakingModal()">üîç –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è</button>
                                    <button class="btn btn-primary" onclick="showReceiptModal()">+ –ü—Ä–∏—Ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="inventory-table">
                                    <thead>
                                        <tr>
                                            <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th>
                                            <th>MAG —Å–∫–ª–∞–¥</th>
                                            <th>–ü–∞—Ä—Ç–∏—è</th>
                                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                            <th>–°—Ç–∞—Ç—É—Å –∫–∞—á–µ—Å—Ç–≤–∞</th>
                                            <th>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</th>
                                            <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                                            <th>–î–∞—Ç–∞ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryMaterialsTable">
                                        <!-- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–± 2: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ -->
                    <div id="inventoryCritical" class="inventory-tab-content">
                        <div class="card table-card">
                            <div class="card-header">
                                <h3>‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏</h3>
                                <div class="header-actions">
                                    <button class="btn btn-primary" onclick="generatePurchaseRequests()">üõí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫–∏</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="inventory-table">
                                    <thead>
                                        <tr>
                                            <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th>
                                            <th>–¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫</th>
                                            <th>–¢–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞</th>
                                            <th>–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å</th>
                                            <th>–î–Ω–µ–π –¥–æ –Ω—É–ª—è</th>
                                            <th>–ü—Ä–µ–¥–ª. –∑–∞–∫–∞–∑</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryCriticalTable">
                                        <!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–± 3: –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ -->
                    <div id="inventoryBlocked" class="inventory-tab-content">
                        <div class="card table-card">
                            <div class="card-header">
                                <h3>üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h3>
                                <div class="header-actions">
                                    <button class="btn btn-warning" onclick="massUnblock()">üîì –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="inventory-table">
                                    <thead>
                                        <tr>
                                            <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th>
                                            <th>–ü–∞—Ä—Ç–∏—è</th>
                                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                            <th>–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</th>
                                            <th>–î–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</th>
                                            <th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π QC</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryBlockedTable">
                                        <!-- –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–± 4: –î–≤–∏–∂–µ–Ω–∏—è -->
                    <div id="inventoryMovements" class="inventory-tab-content">
                        <div class="movements-filters">
                            <div class="filters-row">
                                <div class="filter-group">
                                    <label>–î–∞—Ç–∞ –æ—Ç:</label>
                                    <input type="date" id="movementDateFrom" class="filter-input">
                                </div>
                                <div class="filter-group">
                                    <label>–î–∞—Ç–∞ –¥–æ:</label>
                                    <input type="date" id="movementDateTo" class="filter-input">
                                </div>
                                <div class="filter-group">
                                    <label>–¢–∏–ø –¥–≤–∏–∂–µ–Ω–∏—è:</label>
                                    <select id="movementTypeFilter" class="filter-select">
                                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                        <option value="receipt">–ü—Ä–∏—Ö–æ–¥</option>
                                        <option value="issue">–†–∞—Å—Ö–æ–¥</option>
                                        <option value="transfer">–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ</option>
                                        <option value="adjustment">–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞</option>
                                    </select>
                                </div>
                                <button class="btn btn-primary" onclick="filterMovements()">üîç –ù–∞–π—Ç–∏</button>
                            </div>
                        </div>

                        <div class="card table-card">
                            <div class="card-header">
                                <h3>üìã –ò—Å—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏–π</h3>
                                <div class="header-actions">
                                    <button class="btn btn-secondary" onclick="exportMovements()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="inventory-table">
                                    <thead>
                                        <tr>
                                            <th>–î–∞—Ç–∞/–í—Ä–µ–º—è</th>
                                            <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th>
                                            <th>–ü–∞—Ä—Ç–∏—è</th>
                                            <th>–¢–∏–ø –¥–≤–∏–∂–µ–Ω–∏—è</th>
                                            <th>–û—Ç–∫—É–¥–∞ ‚Üí –ö—É–¥–∞</th>
                                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                            <th>–î–æ–∫—É–º–µ–Ω—Ç</th>
                                            <th>–í—ã–ø–æ–ª–Ω–∏–ª</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventoryMovementsTable">
                                        <!-- –î–≤–∏–∂–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–± 5: –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è -->
                    <div id="inventoryStocktaking" class="inventory-tab-content">
                        <div class="stocktaking-layout">
                            <div class="stocktaking-plans">
                                <div class="card">
                                    <div class="card-header">
                                        <h3>üìÖ –ü–ª–∞–Ω—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏</h3>
                                        <button class="btn btn-primary" onclick="showCreateStocktakingModal()">+ –ù–æ–≤—ã–π –ø–ª–∞–Ω</button>
                                    </div>
                                    <div class="stocktaking-list" id="stocktakingPlansList">
                                        <!-- –ü–ª–∞–Ω—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ -->
                                    </div>
                                </div>
                            </div>
                            <div class="stocktaking-results">
                                <div class="card">
                                    <div class="card-header">
                                        <h3>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏</h3>
                                        <span class="stocktaking-status" id="stocktakingStatus">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>
                                    </div>
                                    <div class="stocktaking-content" id="stocktakingResults">
                                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê: PURCHASING (–ó–∞–∫—É–ø–∫–∏) -->
            <div id="purchasing" class="tab-content">
                <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫: –°–≤–æ–¥–∫–∞ –ø–æ –∑–∞–∫—É–ø–∫–∞–º (4 –∫–∞—Ä—Ç–æ—á–∫–∏) -->
                <div class="purchasing-summary">
                    <div class="summary-grid">
                        <div class="summary-card pending">
                            <div class="summary-header">
                                <span class="summary-icon">‚è≥</span>
                                <span class="summary-title">Pending Requests</span>
                            </div>
                            <div class="summary-value" id="pendingRequests">12</div>
                            <div class="summary-label">–ó–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É</div>
                        </div>
                        <div class="summary-card on-order">
                            <div class="summary-header">
                                <span class="summary-icon">üìã</span>
                                <span class="summary-title">On Order</span>
                            </div>
                            <div class="summary-value" id="onOrderValue">‚Ç¨45K</div>
                            <div class="summary-label">–ó–∞–∫–∞–∑–∞–Ω–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º</div>
                        </div>
                        <div class="summary-card delivered">
                            <div class="summary-header">
                                <span class="summary-icon">üì¶</span>
                                <span class="summary-title">Delivered Today</span>
                            </div>
                            <div class="summary-value" id="deliveredToday">8</div>
                            <div class="summary-label">–ü–æ—Å—Ç–∞–≤–æ–∫ —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        <div class="summary-card budget">
                            <div class="summary-header">
                                <span class="summary-icon">üí∞</span>
                                <span class="summary-title">Budget Variance</span>
                            </div>
                            <div class="summary-value" id="budgetVariance">-2.1%</div>
                            <div class="summary-label">–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞</div>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–±—ã –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                <div class="purchasing-tabs">
                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="showPurchasingTab('requests')">üìã –ó–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É</button>
                        <button class="tab-btn" onclick="showPurchasingTab('orders')">üõí –ó–∞–∫–∞–∑—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º</button>
                        <button class="tab-btn" onclick="showPurchasingTab('deliveries')">üì¶ –ü–æ—Å—Ç–∞–≤–∫–∏</button>
                        <button class="tab-btn" onclick="showPurchasingTab('suppliers')">üè≠ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</button>
                    </div>

                    <!-- –¢–∞–± 1: –ó–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É -->
                    <div id="purchasingRequests" class="purchasing-tab-content active">
                        <div class="card table-card">
                            <div class="card-header">
                                <h3>üìã –ó–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É</h3>
                                <div class="header-actions">
                                    <button class="btn btn-secondary" onclick="generateMRPRequests()">üîÑ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å MRP</button>
                                    <button class="btn btn-primary" onclick="showCreateRequestModal()">+ –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="purchasing-table">
                                    <thead>
                                        <tr>
                                            <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th>
                                            <th>–¢—Ä–µ–±—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                                            <th>–¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫</th>
                                            <th>–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å</th>
                                            <th>–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫</th>
                                            <th>–î–∞—Ç–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="purchaseRequestsTable">
                                        <!-- –ó–∞—è–≤–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–± 2: –ó–∞–∫–∞–∑—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º -->
                    <div id="purchasingOrders" class="purchasing-tab-content">
                        <div class="card table-card">
                            <div class="card-header">
                                <h3>üõí –ó–∞–∫–∞–∑—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º</h3>
                                <div class="header-actions">
                                    <button class="btn btn-secondary" onclick="exportPurchaseOrders()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç</button>
                                    <button class="btn btn-primary" onclick="showCreatePOModal()">+ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="purchasing-table">
                                    <thead>
                                        <tr>
                                            <th>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</th>
                                            <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                                            <th>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</th>
                                            <th>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞</th>
                                            <th>–°—Ç–∞—Ç—É—Å</th>
                                            <th>–ü–ª–∞–Ω–æ–≤–∞—è –¥–∞—Ç–∞</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="purchaseOrdersTable">
                                        <!-- –ó–∞–∫–∞–∑—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–± 3: –ü–æ—Å—Ç–∞–≤–∫–∏ -->
                    <div id="purchasingDeliveries" class="purchasing-tab-content">
                        <div class="deliveries-layout">
                            <div class="deliveries-filters">
                                <div class="card">
                                    <div class="card-header">
                                        <h3>üìÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ—Å—Ç–∞–≤–æ–∫</h3>
                                    </div>
                                    <div class="filters-content">
                                        <div class="filter-group">
                                            <label>–î–∞—Ç–∞ –æ—Ç:</label>
                                            <input type="date" id="deliveryDateFrom" class="filter-input">
                                        </div>
                                        <div class="filter-group">
                                            <label>–î–∞—Ç–∞ –¥–æ:</label>
                                            <input type="date" id="deliveryDateTo" class="filter-input">
                                        </div>
                                        <div class="filter-group">
                                            <label>–ü–æ—Å—Ç–∞–≤—â–∏–∫:</label>
                                            <select id="deliverySupplier" class="filter-select">
                                                <option value="">–í—Å–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</option>
                                            </select>
                                        </div>
                                        <button class="btn btn-primary" onclick="filterDeliveries()">üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                    </div>
                                </div>
                            </div>
                            <div class="deliveries-main">
                                <div class="card">
                                    <div class="card-header">
                                        <h3>üì¶ –ü–æ—Å—Ç–∞–≤–∫–∏ —Å–µ–≥–æ–¥–Ω—è</h3>
                                        <span class="delivery-count" id="todayDeliveryCount">8 –ø–æ—Å—Ç–∞–≤–æ–∫</span>
                                    </div>
                                    <div class="deliveries-list" id="deliveriesList">
                                        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—Å—Ç–∞–≤–æ–∫ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–∞–± 4: –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ -->
                    <div id="purchasingSuppliers" class="purchasing-tab-content">
                        <div class="card table-card">
                            <div class="card-header">
                                <h3>üè≠ –ë–∞–∑–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</h3>
                                <div class="header-actions">
                                    <button class="btn btn-secondary" onclick="importSuppliers()">üì• –ò–º–ø–æ—Ä—Ç</button>
                                    <button class="btn btn-primary" onclick="showCreateSupplierModal()">+ –ù–æ–≤—ã–π –ø–æ—Å—Ç–∞–≤—â–∏–∫</button>
                                </div>
                            </div>
                            <div class="table-container">
                                <table class="purchasing-table">
                                    <thead>
                                        <tr>
                                            <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
                                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</th>
                                            <th>–†–µ–π—Ç–∏–Ω–≥</th>
                                            <th>–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã</th>
                                            <th>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</th>
                                            <th>–ö–æ–Ω—Ç–∞–∫—Ç</th>
                                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                        </tr>
                                    </thead>
                                    <tbody id="suppliersTable">
                                        <!-- –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê: PRODUCTION (–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ) -->
            <div id="production" class="tab-content">
                <!-- –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫: OEE –º–µ—Ç—Ä–∏–∫–∏ -->
                <div class="production-summary">
                    <div class="oee-metrics">
                        <div class="oee-card availability">
                            <div class="oee-header">
                                <span class="oee-icon">üîÑ</span>
                                <span class="oee-title">Availability</span>
                            </div>
                            <div class="oee-value" id="availabilityMetric">92.1%</div>
                            <div class="oee-change positive" id="availabilityChange">‚Üë 2.1%</div>
                        </div>
                        <div class="oee-card performance">
                            <div class="oee-header">
                                <span class="oee-icon">‚ö°</span>
                                <span class="oee-title">Performance</span>
                            </div>
                            <div class="oee-value" id="performanceMetric">89.5%</div>
                            <div class="oee-change negative" id="performanceChange">‚Üì 1.2%</div>
                        </div>
                        <div class="oee-card quality">
                            <div class="oee-header">
                                <span class="oee-icon">‚úÖ</span>
                                <span class="oee-title">Quality</span>
                            </div>
                            <div class="oee-value" id="qualityMetric">98.2%</div>
                            <div class="oee-change positive" id="qualityChange">‚Üë 0.8%</div>
                        </div>
                        <div class="oee-card total">
                            <div class="oee-header">
                                <span class="oee-icon">üìä</span>
                                <span class="oee-title">OEE</span>
                            </div>
                            <div class="oee-value" id="oeeMetric">80.9%</div>
                            <div class="oee-change positive" id="oeeChange">‚Üë 1.7%</div>
                        </div>
                    </div>
                </div>

                <!-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º -->
                <div class="production-departments">
                    <!-- –û—Ç–¥–µ–ª –≠–∫—Å—Ç—Ä—É–∑–∏–∏ -->
                    <div class="department-group">
                        <div class="department-header">
                            <h3>üîÑ –≠–∫—Å—Ç—Ä—É–∑–∏—è</h3>
                            <span class="department-status">4 –ª–∏–Ω–∏–∏ + 2 —Ä–µ–∑–∫–∏ + –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è</span>
                        </div>
                        <div class="production-lines-grid">
                            <!-- –õ–∏–Ω–∏—è —ç–∫—Å—Ç—Ä—É–∑–∏–∏ 1 -->
                            <div class="production-line-card running" data-line="extrusion-1" onclick="showProductionLineDetails('extrusion-1')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è 1</span>
                                        <span class="line-status running">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span>
                                    </div>
                                    <div class="line-controls">
                                        <button class="btn-icon" onclick="pauseProductionLine('extrusion-1'); event.stopPropagation();" title="–ü–∞—É–∑–∞">‚è∏Ô∏è</button>
                                        <button class="btn-icon" onclick="showLineSettings('extrusion-1'); event.stopPropagation();" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>JOB-2024/0156</strong>
                                        <span>–ü–ª–µ–Ω–∫–∞ –ü–í–î 30–º–∫–º</span>
                                    </div>
                                    <div class="job-progress">
                                        <div class="progress-info">
                                            <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: 68%</span>
                                            <span>850/1250 –∫–≥</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 68%"></div>
                                        </div>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                                            <span class="metric-value">78/80 –º/–º–∏–Ω</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–í—Ä–µ–º—è –≤ —Å–º–µ–Ω–µ</span>
                                            <span class="metric-value">5—á 23–º</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ë—Ä–∞–∫</span>
                                            <span class="metric-value">1.2%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –õ–∏–Ω–∏—è —ç–∫—Å—Ç—Ä—É–∑–∏–∏ 2 -->
                            <div class="production-line-card setup" data-line="extrusion-2" onclick="showProductionLineDetails('extrusion-2')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è 2</span>
                                        <span class="line-status setup">üü° –ù–∞–ª–∞–¥–∫–∞</span>
                                    </div>
                                    <div class="line-controls">
                                        <button class="btn-icon" onclick="startProductionLine('extrusion-2'); event.stopPropagation();" title="–ó–∞–ø—É—Å–∫">‚ñ∂Ô∏è</button>
                                        <button class="btn-icon" onclick="showLineSettings('extrusion-2'); event.stopPropagation();" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>JOB-2024/0157</strong>
                                        <span>–ü–ª–µ–Ω–∫–∞ –ü–í–î —Ü–≤–µ—Ç–Ω–∞—è</span>
                                    </div>
                                    <div class="setup-info">
                                        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫—Å—Ç—Ä—É–¥–µ—Ä–∞</span>
                                        <span>–û–ø–µ—Ä–∞—Ç–æ—Ä: –ü–µ—Ç—Ä–æ–≤ –ê.–ò.</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–í—Ä–µ–º—è –Ω–∞–ª–∞–¥–∫–∏</span>
                                            <span class="metric-value">35 –º–∏–Ω</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</span>
                                            <span class="metric-value">85%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –õ–∏–Ω–∏—è —ç–∫—Å—Ç—Ä—É–∑–∏–∏ 3 -->
                            <div class="production-line-card idle" data-line="extrusion-3" onclick="showProductionLineDetails('extrusion-3')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è 3</span>
                                        <span class="line-status idle">üî¥ –ü—Ä–æ—Å—Ç–æ–π</span>
                                    </div>
                                    <div class="line-controls">
                                        <button class="btn-icon" onclick="startProductionLine('extrusion-3'); event.stopPropagation();" title="–ó–∞–ø—É—Å–∫">‚ñ∂Ô∏è</button>
                                        <button class="btn-icon" onclick="showLineSettings('extrusion-3'); event.stopPropagation();" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="idle-reason">
                                        <span>–û–∂–∏–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</span>
                                        <span>–ú–ê–¢-003 - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–í—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è</span>
                                            <span class="metric-value">2—á 15–º</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ü–ª–∞–Ω–æ–≤—ã–π –∑–∞–ø—É—Å–∫</span>
                                            <span class="metric-value">14:30</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –õ–∏–Ω–∏—è —ç–∫—Å—Ç—Ä—É–∑–∏–∏ 4 -->
                            <div class="production-line-card stopped" data-line="extrusion-4" onclick="showProductionLineDetails('extrusion-4')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–≠–∫—Å—Ç—Ä—É–∑–∏—è 4</span>
                                        <span class="line-status stopped">‚ö´ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</span>
                                    </div>
                                    <div class="line-controls">
                                        <button class="btn-icon" onclick="showMaintenanceInfo('extrusion-4'); event.stopPropagation();" title="–¢–û">üîß</button>
                                        <button class="btn-icon" onclick="showLineSettings('extrusion-4'); event.stopPropagation();" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="maintenance-info">
                                        <span>–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û</span>
                                        <span>–ó–∞–º–µ–Ω–∞ —ç–∫—Å—Ç—Ä—É–¥–µ—Ä–Ω–æ–≥–æ —á–µ—Ä–≤—è–∫–∞</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–í—Ä–µ–º—è –¢–û</span>
                                            <span class="metric-value">6—á 45–º</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</span>
                                            <span class="metric-value">75%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –†–µ–∑–∫–∞ 1 -->
                            <div class="production-line-card running" data-line="cutting-1" onclick="showProductionLineDetails('cutting-1')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–†–µ–∑–∫–∞ 1</span>
                                        <span class="line-status running">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>CUT-2024/0089</strong>
                                        <span>–†—É–∫–∞–≤ ‚Üí –ü–æ–ª–æ—Ç–Ω–æ</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                                            <span class="metric-value">120 –º/–º–∏–Ω</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –†–µ–∑–∫–∞ 2 -->
                            <div class="production-line-card running" data-line="cutting-2" onclick="showProductionLineDetails('cutting-2')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–†–µ–∑–∫–∞ 2</span>
                                        <span class="line-status running">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>CUT-2024/0090</strong>
                                        <span>–õ–∏—Å—Ç–æ–≤–∞—è —Ä–µ–∑–∫–∞</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                                            <span class="metric-value">95 –º/–º–∏–Ω</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è -->
                            <div class="production-line-card running" data-line="laboratory" onclick="showProductionLineDetails('laboratory')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è</span>
                                        <span class="line-status running">üü¢ –ê–∫—Ç–∏–≤–Ω–∞</span>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>QC-2024/0045</strong>
                                        <span>–ö–æ–Ω—Ç—Ä–æ–ª—å —Ç–æ–ª—â–∏–Ω—ã</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–û–±—Ä–∞–∑—Ü–æ–≤</span>
                                            <span class="metric-value">12 / –¥–µ–Ω—å</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –û—Ç–¥–µ–ª –õ–∞–º–∏–Ω–∞—Ü–∏–∏ -->
                    <div class="department-group">
                        <div class="department-header">
                            <h3>üìÑ –õ–∞–º–∏–Ω–∞—Ü–∏—è</h3>
                            <span class="department-status">1 –ª–∏–Ω–∏—è + —Ä–µ–∑–∫–∞</span>
                        </div>
                        <div class="production-lines-grid">
                            <!-- –õ–∏–Ω–∏—è –ª–∞–º–∏–Ω–∞—Ü–∏–∏ -->
                            <div class="production-line-card running" data-line="lamination-1" onclick="showProductionLineDetails('lamination-1')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–õ–∞–º–∏–Ω–∞—Ü–∏—è 1</span>
                                        <span class="line-status running">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span>
                                    </div>
                                    <div class="line-controls">
                                        <button class="btn-icon" onclick="pauseProductionLine('lamination-1'); event.stopPropagation();" title="–ü–∞—É–∑–∞">‚è∏Ô∏è</button>
                                        <button class="btn-icon" onclick="showLineSettings('lamination-1'); event.stopPropagation();" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>JOB-2024/0158</strong>
                                        <span>–õ–∞–º–∏–Ω–∞—Ü–∏—è –º–µ—Ç–∞–ª–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</span>
                                    </div>
                                    <div class="job-progress">
                                        <div class="progress-info">
                                            <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: 45%</span>
                                            <span>225/500 –∫–≥</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 45%"></div>
                                        </div>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                                            <span class="metric-value">25/30 –º/–º–∏–Ω</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ê–¥–≥–µ–∑–∏—è</span>
                                            <span class="metric-value">2.8 –ù/—Å–º</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ë—Ä–∞–∫</span>
                                            <span class="metric-value">0.8%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –†–µ–∑–∫–∞ –ª–∞–º–∏–Ω–∞—Ü–∏–∏ -->
                            <div class="production-line-card running" data-line="lamination-cutting" onclick="showProductionLineDetails('lamination-cutting')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–†–µ–∑–∫–∞ –ª–∞–º–∏–Ω–∞—Ü–∏–∏</span>
                                        <span class="line-status running">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>CUT-2024/0091</strong>
                                        <span>–ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è —Ä–µ–∑–∫–∞</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                                            <span class="metric-value">45 –º/–º–∏–Ω</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –û—Ç–¥–µ–ª –ü–µ—á–∞—Ç–∏ -->
                    <div class="department-group">
                        <div class="department-header">
                            <h3>üé® –ü–µ—á–∞—Ç—å</h3>
                            <span class="department-status">2 –ª–∏–Ω–∏–∏ (—Ñ–ª–µ–∫—Å–æ + —Ü–∏—Ñ—Ä–æ–≤–∞—è)</span>
                        </div>
                        <div class="production-lines-grid">
                            <!-- –§–ª–µ–∫—Å–æ–≥—Ä–∞—Ñ—Å–∫–∞—è –ø–µ—á–∞—Ç—å -->
                            <div class="production-line-card setup" data-line="flexo-1" onclick="showProductionLineDetails('flexo-1')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–§–ª–µ–∫—Å–æ 1</span>
                                        <span class="line-status setup">üü° –ù–∞–ª–∞–¥–∫–∞</span>
                                    </div>
                                    <div class="line-controls">
                                        <button class="btn-icon" onclick="startProductionLine('flexo-1'); event.stopPropagation();" title="–ó–∞–ø—É—Å–∫">‚ñ∂Ô∏è</button>
                                        <button class="btn-icon" onclick="showLineSettings('flexo-1'); event.stopPropagation();" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>JOB-2024/0159</strong>
                                        <span>–ü–µ—á–∞—Ç—å –ª–æ–≥–æ—Ç–∏–ø–∞ 4+0</span>
                                    </div>
                                    <div class="setup-info">
                                        <span>–°–º–µ–Ω–∞ —Ñ–æ—Ä–º –ø–µ—á–∞—Ç–∏</span>
                                        <span>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫—Ä–∞—Å–æ–∫</span>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–ü—Ä–∏–≤–æ–¥–∫–∞</span>
                                            <span class="metric-value">92%</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ö—Ä–∞—Å–∫–∏</span>
                                            <span class="metric-value">4 —Ü–≤–µ—Ç–∞</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –¶–∏—Ñ—Ä–æ–≤–∞—è –ø–µ—á–∞—Ç—å -->
                            <div class="production-line-card running" data-line="digital-1" onclick="showProductionLineDetails('digital-1')">
                                <div class="line-header">
                                    <div class="line-info">
                                        <span class="line-name">–¶–∏—Ñ—Ä–æ–≤–∞—è 1</span>
                                        <span class="line-status running">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span>
                                    </div>
                                    <div class="line-controls">
                                        <button class="btn-icon" onclick="pauseProductionLine('digital-1'); event.stopPropagation();" title="–ü–∞—É–∑–∞">‚è∏Ô∏è</button>
                                        <button class="btn-icon" onclick="showLineSettings('digital-1'); event.stopPropagation();" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                                    </div>
                                </div>
                                <div class="line-details">
                                    <div class="current-job">
                                        <strong>JOB-2024/0160</strong>
                                        <span>–≠—Ç–∏–∫–µ—Ç–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
                                    </div>
                                    <div class="job-progress">
                                        <div class="progress-info">
                                            <span>–ü—Ä–æ–≥—Ä–µ—Å—Å: 78%</span>
                                            <span>7800/10000 —à—Ç</span>
                                        </div>
                                        <div class="progress-bar">
                                            <div class="progress-fill" style="width: 78%"></div>
                                        </div>
                                    </div>
                                    <div class="line-metrics">
                                        <div class="metric">
                                            <span class="metric-label">–°–∫–æ—Ä–æ—Å—Ç—å</span>
                                            <span class="metric-value">850 —à—Ç/–º–∏–Ω</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ö–∞—á–µ—Å—Ç–≤–æ</span>
                                            <span class="metric-value">99.2%</span>
                                        </div>
                                        <div class="metric">
                                            <span class="metric-label">–ë—Ä–∞–∫</span>
                                            <span class="metric-value">0.3%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å –∞–ª–µ—Ä—Ç–æ–≤ -->
                <div class="production-alerts">
                    <div class="card">
                        <div class="card-header">
                            <h3>üö® –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
                            <div class="alerts-filter">
                                <button class="btn btn-sm filter-btn active" onclick="filterProductionAlerts('all')">–í—Å–µ</button>
                                <button class="btn btn-sm filter-btn" onclick="filterProductionAlerts('critical')">üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ</button>
                                <button class="btn btn-sm filter-btn" onclick="filterProductionAlerts('warning')">üü° –í–Ω–∏–º–∞–Ω–∏–µ</button>
                                <button class="btn btn-sm filter-btn" onclick="filterProductionAlerts('info')">üîµ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
                            </div>
                        </div>
                        <div class="alerts-list" id="productionAlertsList">
                            <!-- –ê–ª–µ—Ä—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h3>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">156</div>
                            <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤ –∑–∞ –º–µ—Å—è—Ü</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">98.5%</div>
                            <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">45.2—Ç</div>
                            <div class="stat-label">–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ –∑–∞ –º–µ—Å—è—Ü</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">12.3%</div>
                            <div class="stat-label">–†–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- UC-D002: Line Details Modal -->
    <div id="lineDetailsModal" class="modal">
        <div class="modal-content line-modal">
            <div class="modal-header">
                <div class="modal-title-area">
                    <h2 id="lineModalTitle">–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–π –ª–∏–Ω–∏–∏</h2>
                    <div class="line-status-badge" id="lineModalStatus">–†–∞–±–æ—Ç–∞–µ—Ç</div>
                </div>
                <div class="modal-controls">
                    <button class="btn btn-sm btn-secondary" onclick="toggleModalType('lineDetailsModal')" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥">‚áÑ</button>
                    <button class="close" onclick="hideLineDetails()">&times;</button>
                </div>
            </div>
            
            <div class="line-details-grid">
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="detail-section">
                    <h3>üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                    <div class="detail-item">
                        <label>–¢–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑:</label>
                        <span id="lineModalOrder">ORD-250001</span>
                    </div>
                    <div class="detail-item">
                        <label>–ü—Ä–æ–≥—Ä–µ—Å—Å:</label>
                        <div class="progress-detail">
                            <div class="progress-bar">
                                <div class="progress-fill" id="lineModalProgress" style="width: 65%"></div>
                            </div>
                            <span id="lineModalProgressText">65% (2—á 30–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å)</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <label>–û–ø–µ—Ä–∞—Ç–æ—Ä:</label>
                        <span id="lineModalOperator">–ò–≤–∞–Ω–æ–≤ –ò.–ò.</span>
                    </div>
                </div>

                <!-- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
                <div class="detail-section">
                    <h3>üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</h3>
                    <div class="metrics-row">
                        <div class="metric-item">
                            <div class="metric-title">OEE</div>
                            <div class="metric-value" id="lineModalOEE">89%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-title">–û—á–µ—Ä–µ–¥—å</div>
                            <div class="metric-value" id="lineModalQueue">3</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-title">–°–∫–æ—Ä–æ—Å—Ç—å</div>
                            <div class="metric-value" id="lineModalSpeed">120%</div>
                        </div>
                    </div>
                </div>

                <!-- –ò—Å—Ç–æ—Ä–∏—è –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                <div class="detail-section full-width">
                    <h3>üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–∞</h3>
                    <div class="process-params">
                        <div class="param-item">
                            <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</label>
                            <span class="param-value">185¬∞C</span>
                            <span class="param-status normal">‚úì</span>
                        </div>
                        <div class="param-item">
                            <label>–î–∞–≤–ª–µ–Ω–∏–µ:</label>
                            <span class="param-value">2.1 –±–∞—Ä</span>
                            <span class="param-status normal">‚úì</span>
                        </div>
                        <div class="param-item">
                            <label>–°–∫–æ—Ä–æ—Å—Ç—å –ª–∏–Ω–∏–∏:</label>
                            <span class="param-value">150 –º/–º–∏–Ω</span>
                            <span class="param-status warning">‚ö†</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- UC-D003: –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="modal-actions">
                <h3>üéÆ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                <div class="action-buttons">
                    <button class="btn-action primary" onclick="executeLineAction('pause')">
                        ‚è∏Ô∏è –ü–∞—É–∑–∞
                    </button>
                    <button class="btn-action secondary" onclick="executeLineAction('priority')">
                        üîº –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                    </button>
                    <button class="btn-action warning" onclick="executeLineAction('maintenance')">
                        üîß –¢–û
                    </button>
                    <button class="btn-action info" onclick="viewLineHistory()">
                        üìä –ò—Å—Ç–æ—Ä–∏—è
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
                <div class="modal-controls">
                    <button class="btn btn-sm btn-secondary" onclick="toggleModalType('orderModal')" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∏–¥">‚áÑ</button>
                    <button class="close" onclick="hideModal('orderModal')">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <form id="orderForm">
                    <div class="form-group">
                        <label for="customerSelect">–ö–ª–∏–µ–Ω—Ç</label>
                        <select id="customerSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                            <option value="client1">–û–û–û "–£–ø–∞–∫–æ–≤–∫–∞+"</option>
                            <option value="client2">–¢–î "–ü–æ–ª–∏–º–µ—Ä"</option>
                            <option value="client3">–ó–ê–û "–ü–ª–∞—Å—Ç–∏–∫"</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productSelect">–ü—Ä–æ–¥—É–∫—Ç</label>
                        <select id="productSelect" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç</option>
                            <option value="–ü–ª–µ–Ω–∫–∞ PET –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è 30–º–∫–º">–ü–ª–µ–Ω–∫–∞ PET –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è 30–º–∫–º</option>
                            <option value="–ü–ª–µ–Ω–∫–∞ LDPE 50–º–∫–º">–ü–ª–µ–Ω–∫–∞ LDPE 50–º–∫–º</option>
                            <option value="–ü–ª–µ–Ω–∫–∞ PE 20–º–∫–º">–ü–ª–µ–Ω–∫–∞ PE 20–º–∫–º</option>
                            <option value="–ü–ª–µ–Ω–∫–∞ PVC 50–º–∫–º">–ü–ª–µ–Ω–∫–∞ PVC 50–º–∫–º</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="quantityInput">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–∫–≥)</label>
                        <input type="number" id="quantityInput" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="deliveryDate">–î–∞—Ç–∞ –ø–æ—Å—Ç–∞–≤–∫–∏</label>
                        <input type="date" id="deliveryDate" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('orderModal')">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
            </div>
        </div>
    </div>

    <script>
        // ===== UNIFIED JAVASCRIPT SYSTEM =====
        
        // Enhanced ERP Storage System
        class ERPStorage {
            constructor() {
                this.data = {
                    materials: [],
                    suppliers: [],
                    inventory: [],
                    batches: [],
                    orders: [],
                    production_queue: [],
                    production_lines: [],
                    requirements: [],
                    purchase_orders: [],
                    contracts: [],
                    price_history: [],
                    delivery_schedule: [],
                    activities: []
                };
                this.init();
            }

            init() {
                this.loadFromStorage();
                this.initializeWithSampleData();
                this.initializeProductionRules();
                this.initializeProcurementData();
            }

            loadFromStorage() {
                try {
                    const storedData = localStorage.getItem('erp_data');
                    if (storedData) {
                        this.data = { ...this.data, ...JSON.parse(storedData) };
                    }
                } catch (error) {
                    console.error('Error loading from storage:', error);
                }
            }

            saveToStorage() {
                localStorage.setItem('erp_data', JSON.stringify(this.data));
            }

            getTable(tableName) {
                return this.data[tableName] || [];
            }

            getData() {
                return this.data;
            }

            addRecord(tableName, record) {
                if (!this.data[tableName]) this.data[tableName] = [];
                
                const id = this.data[tableName].length > 0 
                    ? Math.max(...this.data[tableName].map(r => r.id || 0)) + 1 
                    : 1;
                
                record.id = id;
                record.created_at = new Date().toISOString();
                this.data[tableName].push(record);
                this.saveToStorage();
                return record;
            }

            updateRecord(tableName, id, updates) {
                const index = this.data[tableName].findIndex(r => r.id === id);
                if (index !== -1) {
                    this.data[tableName][index] = { ...this.data[tableName][index], ...updates };
                    this.saveToStorage();
                    return this.data[tableName][index];
                }
                return null;
            }

            deleteRecord(tableName, id) {
                this.data[tableName] = this.data[tableName].filter(r => r.id !== id);
                this.saveToStorage();
            }

            addActivity(type, description) {
                this.addRecord('activities', {
                    type,
                    description,
                    timestamp: new Date().toISOString()
                });
            }

            initializeWithSampleData() {
                if (this.data.materials.length > 0) return; // Already initialized

                // Materials
                this.data.materials = [
                    { id: 1, code: 'GR-PET-001', name: 'PET –ì—Ä–∞–Ω—É–ª—ã –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ', type: 'granulate_pet', unit: '–∫–≥', standard_cost: 85.5, min_stock_level: 1000, supplier_id: 1 },
                    { id: 2, code: 'DYE-CLEAR', name: '–ö—Ä–∞—Å–∏—Ç–µ–ª—å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π', type: 'ink_printing', unit: '–∫–≥', standard_cost: 450.0, min_stock_level: 50, supplier_id: 2 },
                    { id: 3, code: 'DYE-BLUE', name: '–ö—Ä–∞—Å–∏—Ç–µ–ª—å —Å–∏–Ω–∏–π', type: 'ink_printing', unit: '–∫–≥', standard_cost: 520.0, min_stock_level: 30, supplier_id: 2 },
                    { id: 4, code: 'GR-LLDPE-001', name: 'LLDPE –ì—Ä–∞–Ω—É–ª—ã', type: 'granulate_ldpe', unit: '–∫–≥', standard_cost: 75.0, min_stock_level: 800, supplier_id: 1 }
                ];

                // Suppliers
                this.data.suppliers = [
                    { id: 1, code: 'SUP-001', name: '–û–ê–û "–ù–µ—Ñ—Ç–µ—Ö–∏–º"', contact_person: '–ò–≤–∞–Ω–æ–≤ –ò.–ò.', email: 'ivanov@neftehim.ru', phone: '+7-495-123-4567', is_active: true, overall_rating: 85.5 },
                    { id: 2, code: 'SUP-002', name: '–¢–î "–•–∏–º–∏—á–µ—Å–∫–∏–µ –∫—Ä–∞—Å–∏—Ç–µ–ª–∏"', contact_person: '–ü–µ—Ç—Ä–æ–≤–∞ –ú.–ê.', email: 'petrova@himkras.ru', phone: '+7-812-987-6543', is_active: true, overall_rating: 78.2 }
                ];

                // Inventory
                this.data.inventory = [
                    { id: 1, material_id: 1, quantity: 2500, reserved_quantity: 500, available_quantity: 2000, last_received: '2024-01-15', reservations: [{ order_id: 'ORD-240001', quantity: 500 }] },
                    { id: 2, material_id: 2, quantity: 120, reserved_quantity: 0, available_quantity: 120, last_received: '2024-01-10', reservations: [] },
                    { id: 3, material_id: 3, quantity: 80, reserved_quantity: 25, available_quantity: 55, last_received: '2024-01-12', reservations: [{ order_id: 'ORD-240001', quantity: 25 }] },
                    { id: 4, material_id: 4, quantity: 1200, reserved_quantity: 0, available_quantity: 1200, last_received: '2024-01-14', reservations: [] }
                ];

                // Orders
                this.data.orders = [
                    { id: 1, order_number: 'ORD-240001', customer_name: '–û–û–û "–£–ø–∞–∫–æ–≤–∫–∞+"', product_name: '–ü–ª–µ–Ω–∫–∞ PET –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è 30–º–∫–º', quantity: 1000, order_date: '2024-01-15', delivery_date: '2024-01-25', status: 'scheduled', priority: 'high', material_requirements: [{ material_id: 1, required_quantity: 500 }, { material_id: 3, required_quantity: 25 }] },
                    { id: 2, order_number: 'ORD-240002', customer_name: '–¢–î "–ü–æ–ª–∏–º–µ—Ä"', product_name: '–ü–ª–µ–Ω–∫–∞ LDPE 50–º–∫–º', quantity: 1500, order_date: '2024-01-16', delivery_date: '2024-01-28', status: 'new', priority: 'medium', material_requirements: [] }
                ];

                // Production Queue
                this.data.production_queue = [
                    { id: 1, order_id: 1, order_number: 'ORD-240001', product_name: '–ü–ª–µ–Ω–∫–∞ PET –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è 30–º–∫–º', quantity: 1000, line_id: 1, status: 'scheduled', scheduled_start: '2024-01-20T08:00:00', estimated_completion: '2024-01-20T16:00:00', priority: 'high' }
                ];

                this.saveToStorage();
            }

            initializeProductionRules() {
                if (!this.data.production_recipes) {
                    this.data.production_recipes = this.getDefaultProductionRecipes();
                }
                if (!this.data.production_lines) {
                    this.data.production_lines = this.getDefaultProductionLines();
                }
                this.saveToStorage();
            }

            initializeProcurementData() {
                if (!this.data.contracts) {
                    this.data.contracts = this.getDefaultContracts();
                }
                this.saveToStorage();
            }

            // Production Rules and Recipes
            getDefaultProductionRecipes() {
                return [
                    {
                        id: 1,
                        product_name: '–ü–ª–µ–Ω–∫–∞ PET –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è 30–º–∫–º',
                        material_requirements: [
                            { material_id: 1, quantity_per_unit: 0.5 },
                            { material_id: 2, quantity_per_unit: 0.025 }
                        ],
                        setup_time_minutes: 60,
                        production_time_per_unit: 0.5,
                        line_types: ['extrusion']
                    },
                    {
                        id: 2,
                        product_name: '–ü–ª–µ–Ω–∫–∞ LDPE 50–º–∫–º',
                        material_requirements: [
                            { material_id: 4, quantity_per_unit: 0.6 }
                        ],
                        setup_time_minutes: 45,
                        production_time_per_unit: 0.4,
                        line_types: ['extrusion']
                    }
                ];
            }

            getDefaultProductionLines() {
                return [
                    {
                        id: 1,
                        name: '–õ–∏–Ω–∏—è —ç–∫—Å—Ç—Ä—É–∑–∏–∏ 1',
                        type: 'extrusion',
                        status: 'available',
                        capacity_per_hour: 100,
                        current_order_id: null
                    },
                    {
                        id: 2,
                        name: '–õ–∏–Ω–∏—è —ç–∫—Å—Ç—Ä—É–∑–∏–∏ 2',
                        type: 'extrusion',
                        status: 'maintenance',
                        capacity_per_hour: 120,
                        current_order_id: null
                    }
                ];
            }

            getDefaultContracts() {
                return [
                    {
                        id: 1,
                        supplier_id: 1,
                        material_id: 1,
                        price: 82.0,
                        min_order_qty: 500,
                        lead_time_days: 7,
                        valid_from: '2024-01-01',
                        valid_to: '2024-12-31'
                    }
                ];
            }

            // Enhanced order processing
            processOrder(orderData) {
                try {
                    const order = this.addRecord('orders', {
                        order_number: this.generateOrderNumber(),
                        customer_name: orderData.customer_name || orderData.customer,
                        product_name: orderData.product_name || orderData.product,
                        quantity: orderData.quantity,
                        order_date: new Date().toISOString().split('T')[0],
                        delivery_date: orderData.deliveryDate,
                        status: 'new',
                        priority: 'medium'
                    });

                    this.addActivity('order_created', `–°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ ${order.order_number}`);
                    return { success: true, order: order };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            generateOrderNumber() {
                const orders = this.getTable('orders');
                const today = new Date();
                const year = today.getFullYear().toString().slice(-2);
                const month = (today.getMonth() + 1).toString().padStart(2, '0');
                const count = orders.filter(o => o.order_number && o.order_number.startsWith(`ORD-${year}${month}`)).length + 1;
                return `ORD-${year}${month}${count.toString().padStart(3, '0')}`;
            }
        }

        // Initialize storage
        const storage = new ERPStorage();

        // Navigation System
        function showTab(tabName) {
            console.log('üîÑ Switching to tab:', tabName);
            
            try {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });

                // Show selected tab
                const selectedTab = document.getElementById(tabName);
                if (selectedTab) {
                    selectedTab.classList.add('active');
                    console.log('‚úÖ Tab activated:', tabName);
                } else {
                    console.error('‚ùå Tab not found:', tabName);
                    return;
                }

                // Update navigation
                document.querySelectorAll('.nav-item').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const navButton = document.querySelector(`[onclick="showTab('${tabName}')"]`);
                if (navButton) {
                    navButton.classList.add('active');
                    console.log('‚úÖ Navigation updated for:', tabName);
                } else {
                    console.warn('‚ö†Ô∏è Navigation button not found for:', tabName);
                }

                // Load tab content
                loadTabContent(tabName);
                
            } catch (error) {
                console.error('‚ùå Error in showTab:', error);
            }
        }

        function loadTabContent(tabName) {
            switch(tabName) {
                case 'dashboard':
                    updateDashboardStats();
                    updateCurrentTime();
                    break;
                case 'planning':
                    loadPlanningPage();
                    break;
                case 'procurement':
                    loadMaterials();
                    loadSuppliers();
                    break;
                case 'orders':
                    loadOrdersPage();
                    break;
                case 'warehouse':
                    loadInventoryPage();
                    break;
                case 'purchasing':
                    loadPurchasingPage();
                    break;
                case 'production':
                    loadProductionPage();
                    break;
                case 'quality':
                    // Quality module placeholder
                    showToast('–ú–æ–¥—É–ª—å –∫–æ–Ω—Ç—Ä–æ–ª—è –∫–∞—á–µ—Å—Ç–≤–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
                    break;
                case 'maintenance':
                    // Maintenance module placeholder
                    showToast('–ú–æ–¥—É–ª—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
                    break;
                case 'analytics':
                    updateDashboardStats();
                    break;
            }
        }

        // Enhanced Modal & Side Panel System
        function showModal(modalId, asSidePanel = false) {
            console.log('üîÑ Opening modal:', modalId, 'as side panel:', asSidePanel);
            
            const modal = document.getElementById(modalId);
            if (!modal) {
                console.error('‚ùå Modal not found:', modalId);
                return;
            }
            
            if (asSidePanel) {
                modal.classList.add('side-panel');
                console.log('‚úÖ Added side-panel class to:', modalId);
            } else {
                modal.classList.remove('side-panel');
            }
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            console.log('‚úÖ Modal activated:', modalId);
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            if (modal.classList.contains('side-panel')) {
                const content = modal.querySelector('.modal-content');
                if (content) {
                    content.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        modal.classList.remove('active');
                        modal.classList.remove('side-panel');
                        content.style.transform = '';
                        document.body.style.overflow = '';
                    }, 300);
                    return;
                }
            }
            
            modal.classList.remove('active');
            modal.classList.remove('side-panel');
            document.body.style.overflow = '';
        }

        // Show any modal as side panel
        function showSidePanel(modalId) {
            showModal(modalId, true);
        }

        // Toggle between modal and side panel
        function toggleModalType(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            const isSidePanel = modal.classList.contains('side-panel');
            hideModal(modalId);
            
            setTimeout(() => {
                showModal(modalId, !isSidePanel);
            }, 100);
        }

        // Enhanced Data Loading Functions
        function loadOrders() {
            const orders = storage.getTable('orders');
            const tbody = document.getElementById('ordersTable');
            if (!tbody) return;

            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td>${order.order_number || order.id}</td>
                    <td>${order.customer_name || order.customer || '-'}</td>
                    <td>${order.product_name || order.product || '-'}</td>
                    <td>${order.quantity || 0} –∫–≥</td>
                    <td><span class="status-badge status-${getStatusClass(order.status)}">${getStatusLabel(order.status)}</span></td>
                    <td>${order.order_date || order.date || '-'}</td>
                    <td>
                        <button class="btn btn-small btn-secondary" onclick="editOrder(${order.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn btn-small btn-danger" onclick="deleteOrder(${order.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </td>
                </tr>
            `).join('');
        }

        function loadInventory() {
            const inventory = storage.getTable('inventory');
            const materials = storage.getTable('materials');
            const tbody = document.getElementById('inventoryTable');
            if (!tbody) return;

            tbody.innerHTML = inventory.map(item => {
                const material = materials.find(m => m.id === item.material_id);
                return `
                    <tr>
                        <td>${material ? material.code : 'N/A'}</td>
                        <td>${material ? material.name : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª'}</td>
                        <td>
                            <span style="color: ${item.available_quantity < 100 ? '#ef4444' : '#10b981'}">
                                ${item.quantity || 0} (–¥–æ—Å—Ç—É–ø–Ω–æ: ${item.available_quantity || 0})
                            </span>
                            ${item.reserved_quantity > 0 ? `<br><small>üîí –†–µ–∑–µ—Ä–≤: ${item.reserved_quantity}</small>` : ''}
                        </td>
                        <td>${material ? material.unit : '—à—Ç'}</td>
                        <td>${item.last_received || '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function loadProduction() {
            const productionQueue = storage.getTable('production_queue');
            const productionLines = storage.getTable('production_lines');
            const tbody = document.getElementById('productionTable');
            if (!tbody) return;

            tbody.innerHTML = productionQueue.map(item => {
                const line = productionLines.find(l => l.id === item.line_id);
                return `
                    <tr>
                        <td>${line ? line.name : '–õ–∏–Ω–∏—è ' + item.line_id}</td>
                        <td>${item.order_number || item.order_id}</td>
                        <td><span class="status-badge status-${getStatusClass(item.status)}">${getStatusLabel(item.status)}</span></td>
                        <td>${item.progress || 0}%</td>
                        <td>${item.estimated_completion ? new Date(item.estimated_completion).toLocaleString() : '-'}</td>
                    </tr>
                `;
            }).join('');
        }

        function loadMaterials() {
            const materials = storage.getTable('materials');
            const suppliers = storage.getTable('suppliers');
            const tbody = document.getElementById('materialsTable');
            if (!tbody) return;

            tbody.innerHTML = materials.map(material => {
                const supplier = suppliers.find(s => s.id === material.supplier_id);
                return `
                    <tr>
                        <td><strong>${material.code}</strong></td>
                        <td>${material.name}</td>
                        <td><span class="status-badge status-new">${getTypeLabel(material.type)}</span></td>
                        <td>${material.unit}</td>
                        <td>${material.standard_cost ? material.standard_cost.toFixed(2) + ' ‚ÇΩ' : '-'}</td>
                        <td>${material.min_stock_level || '-'}</td>
                        <td>${supplier ? supplier.name : '-'}</td>
                        <td>
                            <button class="btn btn-small btn-secondary" onclick="editMaterial(${material.id})">‚úèÔ∏è</button>
                            <button class="btn btn-small btn-danger" onclick="deleteMaterial(${material.id})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadSuppliers() {
            const suppliers = storage.getTable('suppliers');
            const tbody = document.getElementById('suppliersTable');
            if (!tbody) return;

            tbody.innerHTML = suppliers.map(supplier => `
                <tr>
                    <td><strong>${supplier.code}</strong></td>
                    <td>${supplier.name}</td>
                    <td>${supplier.contact_person || '-'}</td>
                    <td>${supplier.email || '-'}</td>
                    <td>${supplier.phone || '-'}</td>
                    <td>${supplier.overall_rating ? supplier.overall_rating.toFixed(1) + '/100' : '-'}</td>
                    <td>
                        <span class="status-badge ${supplier.is_active ? 'status-completed' : 'status-cancelled'}">
                            ${supplier.is_active ? '–ê–∫—Ç–∏–≤–Ω—ã–π' : '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-small btn-secondary" onclick="editSupplier(${supplier.id})">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-danger" onclick="deleteSupplier(${supplier.id})">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        // Enhanced Order Creation
        function createOrder() {
            const form = document.getElementById('orderForm');
            
            const orderData = {
                customer_name: document.getElementById('customerSelect').value,
                product_name: document.getElementById('productSelect').value,
                quantity: parseInt(document.getElementById('quantityInput').value),
                deliveryDate: document.getElementById('deliveryDate').value
            };

            if (!orderData.customer_name || !orderData.product_name || !orderData.quantity) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            const result = storage.processOrder(orderData);
            
            if (result.success) {
                hideModal('orderModal');
                form.reset();
                
                // Refresh data
                loadOrders();
                loadInventory();
                loadProduction();
                updateDashboardStats();
                
                showToast(`–ó–∞–∫–∞–∑ ${result.order.order_number} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`);
            } else {
                showToast(result.error, 'error');
            }
        }

        // Enhanced Utility Functions
        function getStatusClass(status) {
            const statusMap = {
                'new': 'new',
                'approved': 'approved',
                'scheduled': 'in-production',
                'in_production': 'in-production',
                'completed': 'completed',
                'shipped': 'completed',
                'cancelled': 'cancelled',
                'available': 'completed',
                'maintenance': 'cancelled',
                'draft': 'new',
                'sent': 'approved',
                'confirmed': 'approved',
                'delivered': 'completed'
            };
            return statusMap[status] || 'new';
        }

        function getStatusLabel(status) {
            const statusLabels = {
                'new': '–ù–æ–≤—ã–π',
                'approved': '–£—Ç–≤–µ—Ä–∂–¥–µ–Ω',
                'scheduled': '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω',
                'in_production': '–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ',
                'completed': '–í—ã–ø–æ–ª–Ω–µ–Ω',
                'shipped': '–û—Ç–≥—Ä—É–∂–µ–Ω',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω',
                'available': '–î–æ—Å—Ç—É–ø–Ω–∞',
                'maintenance': '–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ',
                'draft': '–ß–µ—Ä–Ω–æ–≤–∏–∫',
                'sent': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
                'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
                'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω'
            };
            return statusLabels[status] || status;
        }

        function getTypeLabel(type) {
            const types = {
                'granulate_ldpe': '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î',
                'granulate_hdpe': '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ù–î',
                'granulate_pp': '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ü',
                'granulate_pet': '–ì—Ä–∞–Ω—É–ª—è—Ç –ü–≠–¢',
                'ink_printing': '–ö—Ä–∞—Å–∫–∞',
                'adhesive_pu': '–ö–ª–µ–π –ü–£',
                'adhesive_acrylic': '–ö–ª–µ–π –∞–∫—Ä–∏–ª–æ–≤—ã–π',
                'solvent': '–†–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—å',
                'additive': '–î–æ–±–∞–≤–∫–∞'
            };
            return types[type] || type;
        }

        async function updateDashboardStats() {
            try {
                // Try to fetch from GitHub Pages static API
                const response = await fetch('./api/v1/dashboard/metrics.json');
                if (response.ok) {
                    const metrics = await response.json();
                    document.getElementById('totalOrders').textContent = metrics.orders_active;
                    document.getElementById('productionCapacity').textContent = metrics.production_capacity + '%';
                    document.getElementById('oeeMetric').textContent = metrics.oee_efficiency + '%';
                    document.getElementById('qualityRate').textContent = metrics.quality_pass_rate + '%';
                    return;
                }
            } catch (error) {
                console.log('üì° GitHub Pages API not available, using local data');
            }
            
            // Fallback to local storage data
            const orders = storage.getTable('orders');
            const productionQueue = storage.getTable('production_queue');
            
            // Update stats from local data
            document.getElementById('totalOrders').textContent = orders.filter(o => ['new', 'approved', 'scheduled', 'in_production'].includes(o.status)).length;
            document.getElementById('productionCapacity').textContent = '92%';
            document.getElementById('oeeMetric').textContent = '87.3%';
            document.getElementById('qualityRate').textContent = '99.1%';
        }

        // CRUD Operations
        function deleteOrder(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?')) {
                storage.deleteRecord('orders', id);
                loadOrders();
                updateDashboardStats();
                showToast('–ó–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω', 'success');
            }
        }

        function deleteMaterial(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª?')) {
                storage.deleteRecord('materials', id);
                loadMaterials();
                showToast('–ú–∞—Ç–µ—Ä–∏–∞–ª —É–¥–∞–ª–µ–Ω', 'success');
            }
        }

        function deleteSupplier(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞?')) {
                storage.deleteRecord('suppliers', id);
                loadSuppliers();
                showToast('–ü–æ—Å—Ç–∞–≤—â–∏–∫ —É–¥–∞–ª–µ–Ω', 'success');
            }
        }

        function editOrder(id) {
            // TODO: Implement order editing
            showToast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'warning');
        }

        function editMaterial(id) {
            // TODO: Implement material editing
            showToast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'warning');
        }

        function editSupplier(id) {
            // TODO: Implement supplier editing
            showToast('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'warning');
        }

        // MPSYSTEM specific functions
        function updateCurrentTime() {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('ru-RU');
            }
        }

        // =============================================
        // GITHUB PAGES API INTEGRATION
        // =============================================

        async function loadProductionLinesFromAPI() {
            try {
                const response = await fetch('./api/v1/dashboard/production-lines.json');
                if (response.ok) {
                    const lines = await response.json();
                    updateProductionLinesDisplay(lines);
                    return true;
                }
            } catch (error) {
                console.log('üì° Production lines API not available');
            }
            return false;
        }

        async function loadCriticalAlertsFromAPI() {
            try {
                const response = await fetch('./api/v1/dashboard/alerts.json');
                if (response.ok) {
                    const alerts = await response.json();
                    updateCriticalAlertsDisplay(alerts);
                    return true;
                }
            } catch (error) {
                console.log('üì° Critical alerts API not available');
            }
            return false;
        }

        function updateProductionLinesDisplay(lines) {
            lines.forEach(line => {
                const lineCard = document.getElementById(line.line_id);
                if (lineCard) {
                    // Update line status
                    const statusElement = lineCard.querySelector('.line-status');
                    if (statusElement) {
                        const statusText = {
                            'running': '–†–∞–±–æ—Ç–∞–µ—Ç',
                            'idle': '–ü—Ä–æ—Å—Ç–æ–π', 
                            'maintenance': '–¢–û',
                            'stopped': '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'
                        };
                        statusElement.textContent = statusText[line.status] || line.status;
                        statusElement.className = `line-status ${line.status}`;
                    }

                    // Update current order
                    const orderElement = lineCard.querySelector('.current-order');
                    if (orderElement) {
                        orderElement.textContent = line.current_order ? `–ó–∞–∫–∞–∑: ${line.current_order}` : '–ù–µ—Ç –∑–∞–∫–∞–∑–∞';
                    }

                    // Update progress
                    const progressFill = lineCard.querySelector('.progress-fill');
                    const progressText = lineCard.querySelector('.progress-text');
                    if (progressFill && progressText) {
                        progressFill.style.width = `${line.progress_percent}%`;
                        progressText.textContent = line.time_remaining || `${line.progress_percent}%`;
                    }

                    // Update metrics
                    const metricsElement = lineCard.querySelector('.line-metrics');
                    if (metricsElement) {
                        metricsElement.innerHTML = `
                            <span>OEE: ${line.oee_percent}%</span>
                            <span>–û—á–µ—Ä–µ–¥—å: ${line.queue_count} –∑–∞–∫–∞–∑–∞</span>
                        `;
                    }
                }
            });
        }

        function updateCriticalAlertsDisplay(alerts) {
            const alertsList = document.getElementById('criticalAlerts');
            if (!alertsList) return;

            alertsList.innerHTML = alerts.map(alert => `
                <div class="alert-item ${alert.alert_type}">
                    <span class="alert-icon">${alert.icon}</span>
                    <span class="alert-text">${alert.message}</span>
                    <span class="alert-time">${alert.time_ago}</span>
                    ${alert.action_available ? `<button class="alert-action" onclick="handleAlertAction(${alert.alert_id})">${alert.action_label}</button>` : ''}
                </div>
            `).join('');
        }

        function handleAlertAction(alertId) {
            showToast(`–î–µ–π—Å—Ç–≤–∏–µ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—é ${alertId} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ`, 'success');
        }

        // =============================================
        // UC-D001: DASHBOARD AUTO-UPDATE (30 seconds)
        // =============================================

        async function updateDashboardMetrics() {
            try {
                const response = await fetch('./api/v1/dashboard/metrics.json');
                if (response.ok) {
                    const metrics = await response.json();
                    
                    // Update metrics with animation
                    animateMetricUpdate('totalOrders', metrics.orders_active);
                    animateMetricUpdate('productionCapacity', metrics.production_capacity + '%');
                    animateMetricUpdate('oeeMetric', metrics.oee_efficiency + '%');
                    animateMetricUpdate('qualityRate', metrics.quality_pass_rate + '%');
                    
                    return true;
                }
            } catch (error) {
                console.log('üì° GitHub Pages metrics API not available');
            }
            return false;
        }

        function animateMetricUpdate(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.transform = 'scale(1.1)';
                element.style.color = '#10b981';
                setTimeout(() => {
                    element.textContent = newValue;
                    element.style.transform = 'scale(1)';
                    element.style.color = '';
                }, 200);
            }
        }

        // =============================================
        // UC-D002: LINE DETAILS MODAL
        // =============================================

        let currentLineData = null;

        function showLineDetails(lineId) {
            // Find line data from production lines API
            loadLineDetails(lineId);
            
            // Show as side panel by default
            showSidePanel('lineDetailsModal');
        }

        function hideLineDetails() {
            const modal = document.getElementById('lineDetailsModal');
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
            currentLineData = null;
        }

        async function loadLineDetails(lineId) {
            try {
                const response = await fetch('./api/v1/dashboard/production-lines.json');
                if (response.ok) {
                    const lines = await response.json();
                    const line = lines.find(l => l.line_id === lineId);
                    if (line) {
                        populateLineModal(line);
                        currentLineData = line;
                        return;
                    }
                }
            } catch (error) {
                console.log('üì° Line details API not available');
            }
            
            // Fallback data
            populateLineModal({
                line_id: lineId,
                line_name: `–õ–∏–Ω–∏—è ${lineId}`,
                status: 'running',
                current_order: 'ORD-250001',
                progress_percent: 65,
                time_remaining: '2—á 30–º–∏–Ω –æ—Å—Ç–∞–ª–æ—Å—å',
                oee_percent: 89,
                queue_count: 3,
                operator: '–ò–≤–∞–Ω–æ–≤ –ò.–ò.'
            });
        }

        function populateLineModal(line) {
            // Update modal title and status
            document.getElementById('lineModalTitle').textContent = line.line_name;
            const statusBadge = document.getElementById('lineModalStatus');
            statusBadge.textContent = getStatusText(line.status);
            statusBadge.className = `line-status-badge ${line.status}`;
            
            // Update details
            document.getElementById('lineModalOrder').textContent = line.current_order || '–ù–µ—Ç –∑–∞–∫–∞–∑–∞';
            document.getElementById('lineModalProgress').style.width = `${line.progress_percent}%`;
            document.getElementById('lineModalProgressText').textContent = line.time_remaining || `${line.progress_percent}%`;
            document.getElementById('lineModalOperator').textContent = line.operator;
            
            // Update metrics
            document.getElementById('lineModalOEE').textContent = `${line.oee_percent}%`;
            document.getElementById('lineModalQueue').textContent = line.queue_count;
            document.getElementById('lineModalSpeed').textContent = '120%'; // Mock data
        }

        function getStatusText(status) {
            const statusMap = {
                'running': '–†–∞–±–æ—Ç–∞–µ—Ç',
                'idle': '–ü—Ä–æ—Å—Ç–æ–π',
                'maintenance': '–ù–∞–ª–∞–¥–∫–∞',
                'stopped': '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'
            };
            return statusMap[status] || status;
        }

        // =============================================
        // UC-D003: QUICK ACTIONS
        // =============================================

        function executeLineAction(action) {
            if (!currentLineData) {
                showToast('–î–∞–Ω–Ω—ã–µ –ª–∏–Ω–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'error');
                return;
            }
            
            const lineId = currentLineData.line_id;
            const lineName = currentLineData.line_name;
            
            switch(action) {
                case 'pause':
                    showToast(`üè≠ –õ–∏–Ω–∏—è "${lineName}" –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø–∞—É–∑—É`, 'warning');
                    break;
                case 'priority':
                    showToast(`üîº –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ª–∏–Ω–∏–∏ "${lineName}" –∏–∑–º–µ–Ω–µ–Ω`, 'info');
                    break;
                case 'maintenance':
                    showToast(`üîß –õ–∏–Ω–∏—è "${lineName}" –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –≤ —Ä–µ–∂–∏–º –¢–û`, 'warning');
                    break;
                default:
                    showToast(`–î–µ–π—Å—Ç–≤–∏–µ "${action}" –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–ª—è –ª–∏–Ω–∏–∏ "${lineName}"`, 'info');
            }
            
            // Hide modal after action
            setTimeout(() => {
                hideLineDetails();
            }, 1500);
        }

        function viewLineHistory() {
            if (!currentLineData) return;
            
            showToast(`üìä –ò—Å—Ç–æ—Ä–∏—è –ª–∏–Ω–∏–∏ "${currentLineData.line_name}" –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏`, 'info');
        }

        // =============================================
        // ORDERS PAGE FUNCTIONS
        // =============================================

        // Sample orders data (—Å–æ–≥–ª–∞—Å–Ω–æ –¢–ó —Å—Ç—Ä—É–∫—Ç—É—Ä–µ)
        let ordersData = [
            {
                id: 'ord-001',
                number: 'ZP-2024/0318',
                clientId: 'client-001',
                client: '–û–û–û –ü–∞–∫–µ—Ç-–°–µ—Ä–≤–∏—Å',
                productId: 'prod-001',
                product: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è 30–º–∫–º',
                quantity: 2500,
                unit: '–∫–≥',
                dueDate: '2024-02-15',
                priority: 'high',
                status: 'in_production',
                value: 125000,
                margin: 15,
                progress: 65,
                createdBy: 'manager-001',
                createdAt: '2024-01-18',
                updatedAt: '2024-01-20',
                specialRequirements: '–û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É–ø–∞–∫–æ–≤–∫–µ',
                attachments: ['spec.pdf', 'drawing.dwg']
            },
            {
                id: 'ord-002', 
                number: 'ZP-2024/0319',
                clientId: 'client-002',
                client: '–ê–û –£–ø–∞–∫–æ–≤–æ—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è',
                productId: 'prod-002',
                product: '–ü–∞–∫–µ—Ç —Å –ø–µ—á–∞—Ç—å—é 4+0',
                quantity: 10000,
                unit: '—à—Ç',
                dueDate: '2024-02-20',
                priority: 'urgent',
                status: 'planned',
                value: 85000,
                margin: 12,
                progress: 15,
                createdBy: 'manager-002',
                createdAt: '2024-01-19',
                updatedAt: '2024-01-20',
                specialRequirements: '',
                attachments: []
            },
            {
                id: 'ord-003',
                number: 'ZP-2024/0320',
                clientId: 'client-003', 
                client: '–ò–ü –í–∞—Å–∏–ª—å–µ–≤',
                productId: 'prod-003',
                product: '–ü–ª–µ–Ω–∫–∞ –ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è',
                quantity: 1200,
                unit: '–º2',
                dueDate: '2024-02-25',
                priority: 'normal',
                status: 'new',
                value: 96000,
                margin: 18,
                progress: 0,
                createdBy: 'manager-001',
                createdAt: '2024-01-20',
                updatedAt: '2024-01-20',
                specialRequirements: '–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞',
                attachments: ['tech_spec.pdf']
            }
        ];

        let filteredOrders = [...ordersData];

        function loadOrdersPage() {
            updateOrdersSummary();
            renderOrdersTable();
        }

        function updateOrdersSummary() {
            const summary = {
                new: ordersData.filter(o => o.status === 'new').length,
                queued: ordersData.filter(o => ['confirmed', 'planned'].includes(o.status)).length,
                inProgress: ordersData.filter(o => o.status === 'in_production').length,
                critical: ordersData.filter(o => o.priority === 'urgent' || isOverdue(o)).length
            };

            document.getElementById('ordersNew').textContent = summary.new;
            document.getElementById('ordersQueued').textContent = summary.queued;
            document.getElementById('ordersInProgress').textContent = summary.inProgress;
            document.getElementById('ordersCritical').textContent = summary.critical;
        }

        function isOverdue(order) {
            const dueDate = new Date(order.dueDate);
            const today = new Date();
            return dueDate < today && !['completed', 'shipped'].includes(order.status);
        }

        function renderOrdersTable() {
            const tbody = document.getElementById('ordersTableBody');
            if (!tbody) return;

            tbody.innerHTML = filteredOrders.map(order => `
                <tr onclick="showOrderTimeline('${order.id}')">
                    <td>
                        <a href="#" class="order-number-link" onclick="showOrderDetails('${order.id}')">${order.number}</a>
                    </td>
                    <td>${order.client}</td>
                    <td>${order.product}</td>
                    <td>${order.quantity} ${order.unit}</td>
                    <td>${formatDate(order.dueDate)}</td>
                    <td>
                        <span class="priority-badge priority-${order.priority}">${getPriorityLabel(order.priority)}</span>
                    </td>
                    <td>
                        <span class="status-badge status-${order.status}">${getStatusLabel(order.status)}</span>
                    </td>
                    <td>
                        <div class="progress-bar-order">
                            <div class="progress-fill-order" style="width: ${order.progress}%"></div>
                        </div>
                        <small>${order.progress}%</small>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="editOrder('${order.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-secondary" onclick="duplicateOrder('${order.id}')">üìã</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteOrder('${order.id}')">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getPriorityLabel(priority) {
            const labels = {
                'low': '–ù–∏–∑–∫–∏–π',
                'normal': '–û–±—ã—á–Ω—ã–π', 
                'high': '–í—ã—Å–æ–∫–∏–π',
                'urgent': '–°—Ä–æ—á–Ω—ã–π'
            };
            return labels[priority] || priority;
        }

        function getStatusLabel(status) {
            const labels = {
                'new': '–ù–æ–≤—ã–π',
                'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
                'planned': '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω',
                'in_production': '–í –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                'shipped': '–û—Ç–≥—Ä—É–∂–µ–Ω'
            };
            return labels[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        function applyOrderFilters() {
            const status = document.getElementById('filterStatus').value;
            const client = document.getElementById('filterClient').value.toLowerCase();
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            const search = document.getElementById('searchOrder').value.toLowerCase();
            
            const selectedPriorities = Array.from(document.querySelectorAll('.priority-checkboxes input:checked'))
                .map(cb => cb.value);

            filteredOrders = ordersData.filter(order => {
                if (status && order.status !== status) return false;
                if (client && !order.client.toLowerCase().includes(client)) return false;
                if (search && !order.number.toLowerCase().includes(search)) return false;
                if (!selectedPriorities.includes(order.priority)) return false;
                
                if (dateFrom) {
                    const orderDate = new Date(order.createdAt);
                    const filterDate = new Date(dateFrom);
                    if (orderDate < filterDate) return false;
                }
                
                if (dateTo) {
                    const orderDate = new Date(order.createdAt);
                    const filterDate = new Date(dateTo);
                    if (orderDate > filterDate) return false;
                }
                
                return true;
            });

            renderOrdersTable();
            updateOrdersSummary();
        }

        function resetOrderFilters() {
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterClient').value = '';
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            document.getElementById('searchOrder').value = '';
            
            document.querySelectorAll('.priority-checkboxes input').forEach(cb => cb.checked = true);
            
            filteredOrders = [...ordersData];
            renderOrdersTable();
            updateOrdersSummary();
        }

        function showOrderTimeline(orderId) {
            const order = ordersData.find(o => o.id === orderId);
            if (!order) return;

            const timeline = document.getElementById('productionTimeline');
            const stages = [
                { name: 'MAG-1: –°—ã—Ä—å–µ', status: 'completed', date: '2024-01-18' },
                { name: 'MAG-2: –≠–∫—Å—Ç—Ä—É–∑–∏—è', status: 'completed', date: '2024-01-19' },
                { name: 'MAG-3: –£–§ –æ–±—Ä–∞–±–æ—Ç–∫–∞', status: 'current', date: '2024-01-20' },
                { name: 'MAG-4: –ü–µ—á–∞—Ç—å', status: 'pending', date: '' },
                { name: 'MAG-5: –ì–æ—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', status: 'pending', date: '' }
            ];

            timeline.innerHTML = `
                <div class="timeline-header">
                    <h4>–ó–∞–∫–∞–∑: ${order.number}</h4>
                    <p>–ö–ª–∏–µ–Ω—Ç: ${order.client}</p>
                    <p>–ü—Ä–æ–¥—É–∫—Ç: ${order.product}</p>
                </div>
                ${stages.map(stage => `
                    <div class="timeline-stage ${stage.status}">
                        <div class="stage-info">
                            <strong>${stage.name}</strong>
                            <br>
                            <small>${stage.date || '–û–∂–∏–¥–∞–Ω–∏–µ'}</small>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function showCreateOrderModal() {
            showSidePanel('orderModal');
        }

        function showOrderDetails(orderId) {
            const order = ordersData.find(o => o.id === orderId);
            if (order) {
                // TODO: Create order details modal/side panel
                showToast(`–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ ${order.number} - –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏`, 'info');
            }
        }

        function editOrder(orderId) {
            showToast(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ${orderId}`, 'info');
        }

        function duplicateOrder(orderId) {
            showToast(`–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ${orderId}`, 'info');
        }

        function deleteOrder(orderId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑?')) {
                ordersData = ordersData.filter(o => o.id !== orderId);
                filteredOrders = filteredOrders.filter(o => o.id !== orderId);
                renderOrdersTable();
                updateOrdersSummary();
                showToast('–ó–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω', 'success');
            }
        }

        // =============================================
        // PLANNING PAGE FUNCTIONS
        // =============================================

        // Sample planning data
        let planningData = {
            ordersToSchedule: 23,
            linesAvailable: 6,
            setupTime: '45 min',
            materialsReady: '89%',
            
            queuedOrders: [
                {
                    id: 'ord-001',
                    number: 'ZP-2024/0318',
                    client: '–û–û–û –ü–∞–∫–µ—Ç-–°–µ—Ä–≤–∏—Å',
                    product: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è 30–º–∫–º',
                    quantity: 2500,
                    unit: '–∫–≥',
                    deadline: '2024-02-15',
                    priority: 'high',
                    status: 'confirmed',
                    materialType: 'transparent',
                    width: 300,
                    thickness: 30
                },
                {
                    id: 'ord-002',
                    number: 'ZP-2024/0319',
                    client: '–ê–û –£–ø–∞–∫–æ–≤–æ—á–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è',
                    product: '–ü–∞–∫–µ—Ç —Å –ø–µ—á–∞—Ç—å—é 4+0',
                    quantity: 10000,
                    unit: '—à—Ç',
                    deadline: '2024-02-20',
                    priority: 'urgent',
                    status: 'new',
                    materialType: 'colored',
                    color: 'red',
                    width: 250,
                    thickness: 40
                },
                {
                    id: 'ord-003',
                    number: 'ZP-2024/0320',
                    client: '–ò–ü –í–∞—Å–∏–ª—å–µ–≤',
                    product: '–ü–ª–µ–Ω–∫–∞ –ª–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è',
                    quantity: 1200,
                    unit: '–º2',
                    deadline: '2024-02-25',
                    priority: 'normal',
                    status: 'confirmed',
                    materialType: 'transparent',
                    width: 400,
                    thickness: 50
                }
            ],
            
            productionLines: [
                {
                    id: 'extrusion-1',
                    name: '–≠–∫—Å—Ç—Ä—É–∑–∏—è –õ–∏–Ω–∏—è 1',
                    type: 'extrusion',
                    status: 'running',
                    currentOrder: 'ZP-2024/0315',
                    capacity: '95%',
                    efficiency: 92,
                    maxWidth: 500,
                    capabilities: ['transparent', 'colored'],
                    schedule: generateLineSchedule('extrusion-1')
                },
                {
                    id: 'extrusion-2',
                    name: '–≠–∫—Å—Ç—Ä—É–∑–∏—è –õ–∏–Ω–∏—è 2',
                    type: 'extrusion',
                    status: 'idle',
                    currentOrder: null,
                    capacity: '0%',
                    efficiency: 88,
                    maxWidth: 600,
                    capabilities: ['transparent', 'colored'],
                    schedule: generateLineSchedule('extrusion-2')
                },
                {
                    id: 'lamination-1',
                    name: '–õ–∞–º–∏–Ω–∞—Ü–∏—è –õ–∏–Ω–∏—è 1',
                    type: 'lamination',
                    status: 'running',
                    currentOrder: 'ZP-2024/0317',
                    capacity: '78%',
                    efficiency: 85,
                    maxWidth: 400,
                    capabilities: ['multilayer'],
                    schedule: generateLineSchedule('lamination-1')
                },
                {
                    id: 'printing-1',
                    name: '–§–ª–µ–∫—Å–æ–ø–µ—á–∞—Ç—å',
                    type: 'printing',
                    status: 'maintenance',
                    currentOrder: null,
                    capacity: '0%',
                    efficiency: 90,
                    maxWidth: 350,
                    capabilities: ['printing'],
                    schedule: generateLineSchedule('printing-1')
                }
            ]
        };

        let currentTimelineView = 'week';
        let draggedOrder = null;

        function generateLineSchedule(lineId) {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            const schedule = [];
            for (let i = 0; i < 24; i++) {
                if (Math.random() > 0.7) {
                    schedule.push({
                        type: Math.random() > 0.8 ? 'setup' : 'production',
                        order: `ZP-${2024}/0${Math.floor(Math.random() * 999) + 300}`,
                        duration: Math.floor(Math.random() * 4) + 1
                    });
                } else {
                    schedule.push(null);
                }
            }
            return schedule;
        }

        function loadPlanningPage() {
            updatePlanningMetrics();
            renderOrdersQueue();
            renderProductionLines();
            generateRecommendations();
        }

        function updatePlanningMetrics() {
            document.getElementById('ordersToSchedule').textContent = planningData.ordersToSchedule;
            document.getElementById('linesAvailable').textContent = planningData.linesAvailable;
            document.getElementById('setupTime').textContent = planningData.setupTime;
            document.getElementById('materialsReady').textContent = planningData.materialsReady;
        }

        function renderOrdersQueue() {
            const container = document.getElementById('ordersQueue');
            if (!container) return;

            const filter = document.getElementById('queueFilter')?.value || 'all';
            const sort = document.getElementById('queueSort')?.value || 'priority';

            let filteredOrders = [...planningData.queuedOrders];

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            if (filter !== 'all') {
                if (filter === 'urgent') {
                    filteredOrders = filteredOrders.filter(o => o.priority === 'urgent');
                } else {
                    filteredOrders = filteredOrders.filter(o => o.status === filter);
                }
            }

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            filteredOrders.sort((a, b) => {
                switch (sort) {
                    case 'priority':
                        const priorityOrder = { 'urgent': 0, 'high': 1, 'normal': 2, 'low': 3 };
                        return priorityOrder[a.priority] - priorityOrder[b.priority];
                    case 'deadline':
                        return new Date(a.deadline) - new Date(b.deadline);
                    case 'client':
                        return a.client.localeCompare(b.client);
                    default:
                        return 0;
                }
            });

            container.innerHTML = filteredOrders.map(order => `
                <div class="order-queue-card priority-${order.priority}" 
                     draggable="true" 
                     data-order-id="${order.id}"
                     ondragstart="handleDragStart(event)"
                     ondragend="handleDragEnd(event)"
                     onclick="showPlanningModal('${order.id}')">
                    
                    <div class="queue-card-header">
                        <span class="queue-order-number">${order.number}</span>
                        <span class="queue-priority-badge priority-${order.priority}">
                            ${getPriorityLabel(order.priority)}
                        </span>
                    </div>
                    
                    <div class="queue-card-info">
                        <div><strong>${order.client}</strong></div>
                        <div>${order.product}</div>
                        <div>${order.quantity} ${order.unit}</div>
                        <div class="queue-deadline">‚è∞ ${formatDate(order.deadline)}</div>
                        <div>üìè ${order.width}–º–º √ó ${order.thickness}–º–∫–º</div>
                        ${order.materialType ? `<div>üé® ${order.materialType === 'transparent' ? '–ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π' : '–¶–≤–µ—Ç–Ω–æ–π'}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function renderProductionLines() {
            const container = document.getElementById('productionLinesGrid');
            if (!container) return;

            container.innerHTML = planningData.productionLines.map(line => `
                <div class="production-line-row" data-line-id="${line.id}">
                    <div class="line-row-header">
                        <div class="line-info">
                            <span class="line-name">${line.name}</span>
                            <span class="line-status-indicator line-status-${line.status}">
                                ${getLineStatusLabel(line.status)}
                            </span>
                            <span class="line-capacity">–ó–∞–≥—Ä—É–∑–∫–∞: ${line.capacity}</span>
                        </div>
                        <div class="line-controls">
                            <button class="btn btn-sm btn-secondary" onclick="showLineDetails('${line.id}')">
                                üìä –î–µ—Ç–∞–ª–∏
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="optimizeLine('${line.id}')">
                                üîß –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div class="line-timeline">
                        <div class="timeline-slots"
                             ondrop="handleDrop(event, '${line.id}')"
                             ondragover="handleDragOver(event)">
                            ${renderTimelineSlots(line)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderTimelineSlots(line) {
            const slots = [];
            for (let i = 0; i < 24; i++) {
                const task = line.schedule[i];
                if (task) {
                    slots.push(`
                        <div class="timeline-slot occupied ${task.type}" title="${task.order}">
                            <div class="timeline-task task-${task.type}">
                                ${task.order.slice(-3)}
                            </div>
                        </div>
                    `);
                } else {
                    slots.push(`<div class="timeline-slot" title="–°–≤–æ–±–æ–¥–Ω–æ ${i}:00"></div>`);
                }
            }
            return slots.join('');
        }

        function getLineStatusLabel(status) {
            const labels = {
                'running': '‚ñ∂Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç',
                'idle': '‚è∏Ô∏è –ü—Ä–æ—Å—Ç–æ–π',
                'maintenance': 'üîß –¢–û'
            };
            return labels[status] || status;
        }

        function generateRecommendations() {
            const container = document.getElementById('recommendationsContent');
            if (!container) return;

            const recommendations = [
                {
                    type: 'optimization',
                    title: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–∞–ª–∞–¥–∫–∏',
                    description: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ –∑–∞–∫–∞–∑—ã ZP-2024/0318 –∏ ZP-2024/0320 –Ω–∞ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–µ—Ä–µ–Ω–∞–ª–∞–¥–∫—É.',
                    actions: ['accept', 'decline'],
                    orderId: 'ord-001'
                },
                {
                    type: 'warning',
                    title: '–ù–µ—Ö–≤–∞—Ç–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤',
                    description: '–î–ª—è –∑–∞–∫–∞–∑–∞ ZP-2024/0319 –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∞—Å–Ω–æ–≥–æ –∫—Ä–∞—Å–∏—Ç–µ–ª—è. –û–∂–∏–¥–∞–µ–º–∞—è –ø–æ—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ 2 –¥–Ω—è.',
                    actions: ['order_material'],
                    orderId: 'ord-002'
                },
                {
                    type: 'info',
                    title: '–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ª–∏–Ω–∏–∏',
                    description: '–≠–∫—Å—Ç—Ä—É–∑–∏—è –õ–∏–Ω–∏—è 1 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (92%) –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–∫–∞–∑–æ–≤. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å—Ä–æ—á–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.',
                    actions: ['accept'],
                    lineId: 'extrusion-1'
                },
                {
                    type: 'error',
                    title: '–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤',
                    description: '–ó–∞–∫–∞–∑ ZP-2024/0319 –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º –Ω–∞ 1 –¥–µ–Ω—å –ø—Ä–∏ —Ç–µ–∫—É—â–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.',
                    actions: ['reschedule', 'priority'],
                    orderId: 'ord-002'
                }
            ];

            container.innerHTML = recommendations.map((rec, index) => `
                <div class="recommendation-item ${rec.type}">
                    <div class="recommendation-title">${rec.title}</div>
                    <div class="recommendation-description">${rec.description}</div>
                    <div class="recommendation-actions">
                        ${rec.actions.includes('accept') ? '<button class="btn-accept" onclick="acceptRecommendation(' + index + ')">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>' : ''}
                        ${rec.actions.includes('decline') ? '<button class="btn-decline" onclick="declineRecommendation(' + index + ')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>' : ''}
                        ${rec.actions.includes('order_material') ? '<button class="btn-accept" onclick="orderMaterial(\'' + rec.orderId + '\')">üì¶ –ó–∞–∫–∞–∑–∞—Ç—å</button>' : ''}
                        ${rec.actions.includes('reschedule') ? '<button class="btn-accept" onclick="rescheduleOrder(\'' + rec.orderId + '\')">üìÖ –ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>' : ''}
                        ${rec.actions.includes('priority') ? '<button class="btn-accept" onclick="increasePriority(\'' + rec.orderId + '\')">üîº –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</button>' : ''}
                    </div>
                </div>
            `).join('');
        }

        function switchTimelineView(view) {
            currentTimelineView = view;
            document.querySelectorAll('.timeline-controls .btn').forEach(btn => {
                btn.className = 'btn btn-sm btn-secondary';
            });
            event.target.className = 'btn btn-sm btn-primary';
            
            renderProductionLines();
            showToast(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ –≤–∏–¥: ${view === 'day' ? '–î–µ–Ω—å' : view === 'week' ? '–ù–µ–¥–µ–ª—è' : '–ú–µ—Å—è—Ü'}`, 'info');
        }

        // Drag and Drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
        function handleDragStart(event) {
            draggedOrder = event.target.getAttribute('data-order-id');
            event.target.classList.add('dragging');
        }

        function handleDragEnd(event) {
            event.target.classList.remove('dragging');
            draggedOrder = null;
        }

        function handleDragOver(event) {
            event.preventDefault();
        }

        function handleDrop(event, lineId) {
            event.preventDefault();
            if (draggedOrder) {
                const order = planningData.queuedOrders.find(o => o.id === draggedOrder);
                if (order) {
                    showPlanningModal(draggedOrder, lineId);
                }
            }
        }

        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        function showPlanningModal(orderId, suggestedLineId = null) {
            const order = planningData.queuedOrders.find(o => o.id === orderId);
            if (!order) return;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ
            document.getElementById('planningOrderInfo').innerHTML = `
                <div><strong>–ó–∞–∫–∞–∑:</strong> ${order.number}</div>
                <div><strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${order.client}</div>
                <div><strong>–ü—Ä–æ–¥—É–∫—Ç:</strong> ${order.product}</div>
                <div><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</strong> ${order.quantity} ${order.unit}</div>
                <div><strong>–°—Ä–æ–∫:</strong> ${formatDate(order.deadline)}</div>
                <div><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> ${getPriorityLabel(order.priority)}</div>
            `;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–ø—Ü–∏–∏ –≤—ã–±–æ—Ä–∞ –ª–∏–Ω–∏–∏
            const compatibleLines = planningData.productionLines.filter(line => 
                isLineCompatible(line, order)
            );

            document.getElementById('lineOptions').innerHTML = compatibleLines.map(line => `
                <div class="line-option ${line.id === suggestedLineId ? 'selected' : ''}" 
                     onclick="selectLine('${line.id}')">
                    <div class="line-option-header">
                        <span class="line-option-name">${line.name}</span>
                        <span class="line-efficiency">‚ö° ${line.efficiency}%</span>
                    </div>
                    <div class="line-option-details">
                        –ó–∞–≥—Ä—É–∑–∫–∞: ${line.capacity} ‚Ä¢ –ú–∞–∫—Å. —à–∏—Ä–∏–Ω–∞: ${line.maxWidth}–º–º<br>
                        –°—Ç–∞—Ç—É—Å: ${getLineStatusLabel(line.status)}
                    </div>
                </div>
            `).join('');

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('startTime').value = now.toISOString().slice(0, 16);

            showSidePanel('planningModal');
        }

        function hidePlanningModal() {
            hideModal('planningModal');
        }

        function selectLine(lineId) {
            document.querySelectorAll('.line-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.closest('.line-option').classList.add('selected');
        }

        function isLineCompatible(line, order) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
            if (order.width > line.maxWidth) return false;
            if (order.materialType && !line.capabilities.includes(order.materialType)) return false;
            return true;
        }

        function scheduleOrder() {
            const selectedLine = document.querySelector('.line-option.selected');
            const startTime = document.getElementById('startTime').value;
            const priority = document.getElementById('queuePriority').value;

            if (!selectedLine) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞', 'error');
                return;
            }

            const lineId = selectedLine.onclick.toString().match(/'([^']+)'/)[1];
            showToast(`–ó–∞–∫–∞–∑ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ª–∏–Ω–∏—é ${lineId} —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º ${priority}`, 'success');
            hidePlanningModal();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –±—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
            renderOrdersQueue();
            renderProductionLines();
        }

        // –î–µ–π—Å—Ç–≤–∏—è —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
        function acceptRecommendation(index) {
            showToast('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞', 'success');
            generateRecommendations();
        }

        function declineRecommendation(index) {
            showToast('–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞', 'info');
            generateRecommendations();
        }

        function orderMaterial(orderId) {
            showToast('–ó–∞–∫–∞–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –∑–∞–∫—É–ø–∫–∏', 'success');
        }

        function rescheduleOrder(orderId) {
            showPlanningModal(orderId);
        }

        function increasePriority(orderId) {
            const order = planningData.queuedOrders.find(o => o.id === orderId);
            if (order) {
                order.priority = 'urgent';
                renderOrdersQueue();
                showToast('–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–∫–∞–∑–∞ –ø–æ–≤—ã—à–µ–Ω', 'success');
            }
        }

        function optimizeLine(lineId) {
            showToast(`–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–∏–Ω–∏–∏ ${lineId} –≤—ã–ø–æ–ª–Ω–µ–Ω–∞`, 'success');
        }

        // =============================================
        // PURCHASING PAGE FUNCTIONS
        // =============================================

        // Sample data for purchasing
        let purchasingData = {
            requests: [
                {
                    id: 'req-001',
                    materialId: 'mat-001',
                    materialName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è',
                    requiredQuantity: 500,
                    unit: '–∫–≥',
                    currentStock: 50,
                    criticalityLevel: 'critical',
                    requestedBy: 'system',
                    requestDate: '2024-01-15',
                    requiredDate: '2024-01-18',
                    status: 'pending',
                    suggestedSupplierId: 'sup-001',
                    suggestedSupplierName: '–û–û–û –ü–ª–∞—Å—Ç–∏–∫-–ì—Ä—É–ø–ø',
                    notes: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –Ω–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫'
                },
                {
                    id: 'req-002',
                    materialId: 'mat-002',
                    materialName: '–ö—Ä–∞—Å–∏—Ç–µ–ª—å —á–µ—Ä–Ω—ã–π',
                    requiredQuantity: 25,
                    unit: '–∫–≥',
                    currentStock: 15,
                    criticalityLevel: 'high',
                    requestedBy: 'user-001',
                    requestDate: '2024-01-16',
                    requiredDate: '2024-01-20',
                    status: 'pending',
                    suggestedSupplierId: 'sup-002',
                    suggestedSupplierName: '–•–∏–º–ü–æ—Å—Ç–∞–≤–∫–∞ –õ—Ç–¥',
                    notes: '–î–ª—è –ø–ª–∞–Ω–æ–≤–æ–≥–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞'
                },
                {
                    id: 'req-003',
                    materialId: 'mat-003',
                    materialName: '–ö–ª–µ–π –ø–æ–ª–∏—É—Ä–µ—Ç–∞–Ω–æ–≤—ã–π',
                    requiredQuantity: 100,
                    unit: '–∫–≥',
                    currentStock: 80,
                    criticalityLevel: 'medium',
                    requestedBy: 'system',
                    requestDate: '2024-01-17',
                    requiredDate: '2024-01-22',
                    status: 'approved',
                    suggestedSupplierId: 'sup-003',
                    suggestedSupplierName: '–°–ø–µ—Ü–•–∏–º',
                    notes: '–ü–ª–∞–Ω–æ–≤–∞—è –∑–∞–∫—É–ø–∫–∞'
                }
            ],
            orders: [
                {
                    id: 'po-001',
                    number: 'PO-2024/0012',
                    supplierId: 'sup-001',
                    supplierName: '–û–û–û –ü–ª–∞—Å—Ç–∏–∫-–ì—Ä—É–ø–ø',
                    items: [
                        { materialName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è', quantity: 1000, unit: '–∫–≥', price: 120 },
                        { materialName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î —Ü–≤–µ—Ç–Ω–∞—è', quantity: 500, unit: '–∫–≥', price: 135 }
                    ],
                    totalAmount: 187500,
                    currency: 'RUB',
                    orderDate: '2024-01-10',
                    requestedDeliveryDate: '2024-01-18',
                    confirmedDeliveryDate: '2024-01-19',
                    status: 'confirmed',
                    paymentTerms: '30 –¥–Ω–µ–π',
                    deliveryTerms: 'EXW —Å–∫–ª–∞–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞',
                    createdBy: 'manager-001'
                },
                {
                    id: 'po-002',
                    number: 'PO-2024/0013',
                    supplierId: 'sup-002',
                    supplierName: '–•–∏–º–ü–æ—Å—Ç–∞–≤–∫–∞ –õ—Ç–¥',
                    items: [
                        { materialName: '–ö—Ä–∞—Å–∏—Ç–µ–ª—å —á–µ—Ä–Ω—ã–π', quantity: 50, unit: '–∫–≥', price: 850 },
                        { materialName: '–ö—Ä–∞—Å–∏—Ç–µ–ª—å –∫—Ä–∞—Å–Ω—ã–π', quantity: 25, unit: '–∫–≥', price: 920 }
                    ],
                    totalAmount: 65500,
                    currency: 'RUB',
                    orderDate: '2024-01-12',
                    requestedDeliveryDate: '2024-01-20',
                    confirmedDeliveryDate: null,
                    status: 'sent',
                    paymentTerms: '14 –¥–Ω–µ–π',
                    deliveryTerms: 'FCA —Å–∫–ª–∞–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞',
                    createdBy: 'manager-002'
                }
            ],
            deliveries: [
                {
                    id: 'del-001',
                    purchaseOrderId: 'po-001',
                    supplierName: '–û–û–û –ü–ª–∞—Å—Ç–∏–∫-–ì—Ä—É–ø–ø',
                    deliveryDate: '2024-01-18',
                    status: 'scheduled',
                    items: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è (1000 –∫–≥), –ü–ª–µ–Ω–∫–∞ –ü–í–î —Ü–≤–µ—Ç–Ω–∞—è (500 –∫–≥)',
                    documentsReady: true,
                    notes: '–ü–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –≥—Ä–∞—Ñ–∏–∫—É'
                },
                {
                    id: 'del-002',
                    purchaseOrderId: 'po-002',
                    supplierName: '–•–∏–º–ü–æ—Å—Ç–∞–≤–∫–∞ –õ—Ç–¥',
                    deliveryDate: '2024-01-18',
                    status: 'delivered',
                    items: '–ö—Ä–∞—Å–∏—Ç–µ–ª—å —á–µ—Ä–Ω—ã–π (50 –∫–≥)',
                    documentsReady: true,
                    notes: '–ß–∞—Å—Ç–∏—á–Ω–∞—è –ø–æ—Å—Ç–∞–≤–∫–∞'
                }
            ],
            suppliers: [
                {
                    id: 'sup-001',
                    name: '–û–û–û –ü–ª–∞—Å—Ç–∏–∫-–ì—Ä—É–ø–ø',
                    categories: ['–ü–æ–ª–∏–º–µ—Ä—ã', '–ü–ª–µ–Ω–∫–∏'],
                    rating: 4.8,
                    paymentTerms: '30 –¥–Ω–µ–π',
                    activeOrders: 3,
                    contact: '+7 (495) 123-45-67',
                    email: 'orders@plastik-group.ru',
                    address: '–ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è, 15'
                },
                {
                    id: 'sup-002',
                    name: '–•–∏–º–ü–æ—Å—Ç–∞–≤–∫–∞ –õ—Ç–¥',
                    categories: ['–ö—Ä–∞—Å–∏—Ç–µ–ª–∏', '–î–æ–±–∞–≤–∫–∏'],
                    rating: 4.5,
                    paymentTerms: '14 –¥–Ω–µ–π',
                    activeOrders: 1,
                    contact: '+7 (812) 987-65-43',
                    email: 'sales@himpostavka.ru',
                    address: '–°–ü–±, –ø—Ä. –•–∏–º–∏–∫–æ–≤, 42'
                },
                {
                    id: 'sup-003',
                    name: '–°–ø–µ—Ü–•–∏–º',
                    categories: ['–ö–ª–µ–∏', '–†–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª–∏'],
                    rating: 4.2,
                    paymentTerms: '21 –¥–µ–Ω—å',
                    activeOrders: 0,
                    contact: '+7 (383) 555-22-11',
                    email: 'info@spechim.ru',
                    address: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, —É–ª. –•–∏–º–∏—á–µ—Å–∫–∞—è, 8'
                }
            ]
        };

        // Main purchasing page loader
        function loadPurchasingPage() {
            updatePurchasingSummary();
            showPurchasingTab('requests');
        }

        // Update purchasing summary metrics
        function updatePurchasingSummary() {
            const pendingRequests = purchasingData.requests.filter(r => r.status === 'pending').length;
            const onOrderValue = purchasingData.orders.reduce((sum, order) => 
                order.status !== 'completed' ? sum + order.totalAmount : sum, 0);
            const deliveredToday = purchasingData.deliveries.filter(d => 
                d.deliveryDate === '2024-01-18' && d.status === 'delivered').length;

            document.getElementById('pendingRequests').textContent = pendingRequests;
            document.getElementById('onOrderValue').textContent = '‚Ç¨' + Math.round(onOrderValue / 90) + 'K';
            document.getElementById('deliveredToday').textContent = deliveredToday;
            document.getElementById('budgetVariance').textContent = '-2.1%';
        }

        // Show purchasing tab
        function showPurchasingTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.purchasing-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('purchasing' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
            event.target.classList.add('active');

            // Load tab content
            switch(tabName) {
                case 'requests':
                    loadPurchaseRequests();
                    break;
                case 'orders':
                    loadPurchaseOrders();
                    break;
                case 'deliveries':
                    loadDeliveries();
                    break;
                case 'suppliers':
                    loadSuppliers();
                    break;
            }
        }

        // Load purchase requests
        function loadPurchaseRequests() {
            const tbody = document.getElementById('purchaseRequestsTable');
            if (!tbody) return;

            tbody.innerHTML = purchasingData.requests.map(request => `
                <tr>
                    <td>
                        <div><strong>${request.materialName}</strong></div>
                        <div style="font-size: 0.75rem; color: #6b7280;">${request.materialId}</div>
                    </td>
                    <td>${request.requiredQuantity} ${request.unit}</td>
                    <td>${request.currentStock} ${request.unit}</td>
                    <td>
                        <span class="criticality-badge ${request.criticalityLevel}">
                            ${getCriticalityLabel(request.criticalityLevel)}
                        </span>
                    </td>
                    <td>${request.suggestedSupplierName}</td>
                    <td>${formatDate(request.requiredDate)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="createPOFromRequest('${request.id}')">üìã</button>
                            <button class="btn btn-sm btn-secondary" onclick="editRequest('${request.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-danger" onclick="rejectRequest('${request.id}')">‚ùå</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Load purchase orders
        function loadPurchaseOrders() {
            const tbody = document.getElementById('purchaseOrdersTable');
            if (!tbody) return;

            tbody.innerHTML = purchasingData.orders.map(order => `
                <tr>
                    <td>
                        <a href="#" onclick="showPODetails('${order.id}')" class="order-number-link">${order.number}</a>
                    </td>
                    <td>${order.supplierName}</td>
                    <td>
                        <div class="materials-list">
                            ${order.items.map(item => 
                                `<span class="material-item">${item.materialName} (${item.quantity} ${item.unit})</span>`
                            ).join('')}
                        </div>
                    </td>
                    <td>${order.totalAmount.toLocaleString()} ${order.currency}</td>
                    <td>
                        <span class="po-status-badge ${order.status}">
                            ${getPOStatusLabel(order.status)}
                        </span>
                    </td>
                    <td>${formatDate(order.requestedDeliveryDate)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="showPODetails('${order.id}')">üëÅÔ∏è</button>
                            <button class="btn btn-sm btn-secondary" onclick="editPO('${order.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-warning" onclick="trackPO('${order.id}')">üìç</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Load deliveries
        function loadDeliveries() {
            const deliveriesList = document.getElementById('deliveriesList');
            if (!deliveriesList) return;

            deliveriesList.innerHTML = purchasingData.deliveries.map(delivery => `
                <div class="delivery-card">
                    <div class="delivery-header">
                        <span class="delivery-supplier">${delivery.supplierName}</span>
                        <span class="delivery-date">${formatDate(delivery.deliveryDate)}</span>
                    </div>
                    <div class="delivery-items">${delivery.items}</div>
                    <div class="delivery-actions">
                        <button class="btn btn-sm btn-success" onclick="acceptDelivery('${delivery.id}')">‚úÖ –ü—Ä–∏–Ω—è—Ç—å</button>
                        <button class="btn btn-sm btn-warning" onclick="postponeDelivery('${delivery.id}')">‚è≥ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏</button>
                        <button class="btn btn-sm btn-danger" onclick="rejectDelivery('${delivery.id}')">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        // Load suppliers in purchasing context
        function loadSuppliers() {
            const tbody = document.getElementById('suppliersTable');
            if (!tbody) return;

            tbody.innerHTML = purchasingData.suppliers.map(supplier => `
                <tr>
                    <td>
                        <div><strong>${supplier.name}</strong></div>
                        <div style="font-size: 0.75rem; color: #6b7280;">${supplier.address}</div>
                    </td>
                    <td>${supplier.categories.join(', ')}</td>
                    <td>
                        <div class="supplier-rating">
                            <span class="rating-stars">${'‚òÖ'.repeat(Math.floor(supplier.rating))}${'‚òÜ'.repeat(5-Math.floor(supplier.rating))}</span>
                            <span class="rating-value">${supplier.rating}</span>
                        </div>
                    </td>
                    <td>${supplier.paymentTerms}</td>
                    <td>${supplier.activeOrders}</td>
                    <td>
                        <div style="font-size: 0.75rem;">
                            <div>${supplier.contact}</div>
                            <div>${supplier.email}</div>
                        </div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="showSupplierDetails('${supplier.id}')">üëÅÔ∏è</button>
                            <button class="btn btn-sm btn-secondary" onclick="editSupplier('${supplier.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-sm btn-success" onclick="createPOForSupplier('${supplier.id}')">üõí</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Utility functions
        function getCriticalityLabel(level) {
            const labels = {
                'low': '–ù–∏–∑–∫–∞—è',
                'medium': '–°—Ä–µ–¥–Ω—è—è', 
                'high': '–í—ã—Å–æ–∫–∞—è',
                'critical': '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è'
            };
            return labels[level] || level;
        }

        function getPOStatusLabel(status) {
            const labels = {
                'draft': '–ß–µ—Ä–Ω–æ–≤–∏–∫',
                'sent': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
                'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω',
                'partially_delivered': '–ß–∞—Å—Ç–∏—á–Ω–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω',
                'completed': '–í—ã–ø–æ–ª–Ω–µ–Ω'
            };
            return labels[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        // Action functions (placeholders)
        function generateMRPRequests() {
            showToast('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è MRP –∑–∞—è–≤–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞. –î–æ–±–∞–≤–ª–µ–Ω–æ 3 –Ω–æ–≤—ã–µ –∑–∞—è–≤–∫–∏.', 'success');
            // Reload requests
            setTimeout(() => loadPurchaseRequests(), 1000);
        }

        function showCreateRequestModal() {
            showToast('–ú–æ–¥–∞–ª —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        function createPOFromRequest(requestId) {
            showToast(`–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É –∏–∑ –∑–∞—è–≤–∫–∏ ${requestId}`, 'success');
        }

        function editRequest(requestId) {
            showToast(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ ${requestId}`, 'info');
        }

        function rejectRequest(requestId) {
            showToast(`–ó–∞—è–≤–∫–∞ ${requestId} –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞`, 'warning');
        }

        function showCreatePOModal() {
            showToast('–ú–æ–¥–∞–ª —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫—É –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        function showPODetails(orderId) {
            showToast(`–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ ${orderId} –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏`, 'info');
        }

        function editPO(orderId) {
            showToast(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ${orderId}`, 'info');
        }

        function trackPO(orderId) {
            showToast(`–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ${orderId}`, 'info');
        }

        function exportPurchaseOrders() {
            showToast('–≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
        }

        function filterDeliveries() {
            showToast('–§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫ —Å–ø–∏—Å–∫—É –ø–æ—Å—Ç–∞–≤–æ–∫', 'success');
        }

        function acceptDelivery(deliveryId) {
            showToast(`–ü–æ—Å—Ç–∞–≤–∫–∞ ${deliveryId} –ø—Ä–∏–Ω—è—Ç–∞`, 'success');
        }

        function postponeDelivery(deliveryId) {
            showToast(`–ü–æ—Å—Ç–∞–≤–∫–∞ ${deliveryId} –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞`, 'warning');
        }

        function rejectDelivery(deliveryId) {
            showToast(`–ü–æ—Å—Ç–∞–≤–∫–∞ ${deliveryId} –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞`, 'error');
        }

        function importSuppliers() {
            showToast('–ò–º–ø–æ—Ä—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        function showCreateSupplierModal() {
            showToast('–ú–æ–¥–∞–ª —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        function showSupplierDetails(supplierId) {
            showToast(`–î–µ—Ç–∞–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ ${supplierId} –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏`, 'info');
        }

        function createPOForSupplier(supplierId) {
            showToast(`–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ ${supplierId}`, 'success');
        }

        // =============================================
        // INVENTORY PAGE FUNCTIONS
        // =============================================

        // Sample data for inventory
        let inventoryData = {
            materials: [
                {
                    id: 'batch-001',
                    materialId: 'MAT-001',
                    materialCode: 'MAT-001',
                    materialName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è',
                    type: 'raw_material',
                    category: 'granulate',
                    magLocation: 'MAG1',
                    batchNumber: 'B240115001',
                    supplierBatch: 'SP-2024-0089',
                    quantity: 850,
                    originalQuantity: 1000,
                    unit: '–∫–≥',
                    status: 'released',
                    expiryDate: '2025-01-15',
                    receivedDate: '2024-01-15',
                    supplierId: 'sup-001',
                    supplierName: '–û–û–û –ü–ª–∞—Å—Ç–∏–∫-–ì—Ä—É–ø–ø',
                    certificates: ['cert-001.pdf'],
                    minStock: 200,
                    reorderPoint: 300
                },
                {
                    id: 'batch-002',
                    materialId: 'MAT-002',
                    materialCode: 'MAT-002',
                    materialName: '–ö—Ä–∞—Å–∏—Ç–µ–ª—å —á–µ—Ä–Ω—ã–π',
                    type: 'raw_material',
                    category: 'masterbatch',
                    magLocation: 'MAG1',
                    batchNumber: 'B240116001',
                    supplierBatch: 'HC-2024-0012',
                    quantity: 45,
                    originalQuantity: 50,
                    unit: '–∫–≥',
                    status: 'released',
                    expiryDate: '2026-06-16',
                    receivedDate: '2024-01-16',
                    supplierId: 'sup-002',
                    supplierName: '–•–∏–º–ü–æ—Å—Ç–∞–≤–∫–∞ –õ—Ç–¥',
                    certificates: ['cert-002.pdf'],
                    minStock: 100,
                    reorderPoint: 150
                },
                {
                    id: 'batch-003',
                    materialId: 'MAT-003',
                    materialCode: 'MAT-003',
                    materialName: '–ö–ª–µ–π –ø–æ–ª–∏—É—Ä–µ—Ç–∞–Ω–æ–≤—ã–π',
                    type: 'raw_material',
                    category: 'adhesive',
                    magLocation: 'MAG5',
                    batchNumber: 'B240117001',
                    supplierBatch: 'SC-2024-0034',
                    quantity: 25,
                    originalQuantity: 100,
                    unit: '–∫–≥',
                    status: 'blocked',
                    expiryDate: '2024-12-17',
                    receivedDate: '2024-01-17',
                    supplierId: 'sup-003',
                    supplierName: '–°–ø–µ—Ü–•–∏–º',
                    certificates: [],
                    minStock: 50,
                    reorderPoint: 75,
                    blockReason: '–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ –≤—è–∑–∫–æ—Å—Ç–∏'
                },
                {
                    id: 'batch-004',
                    materialId: 'MAT-004',
                    materialCode: 'MAT-004',
                    materialName: '–ü–ª–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–∞—è 30–º–∫–º',
                    type: 'finished_good',
                    category: 'finished_product',
                    magLocation: 'MAG9',
                    batchNumber: 'B240118001',
                    supplierBatch: null,
                    quantity: 1200,
                    originalQuantity: 1200,
                    unit: '–∫–≥',
                    status: 'released',
                    expiryDate: null,
                    receivedDate: '2024-01-18',
                    supplierId: null,
                    supplierName: '–°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ',
                    certificates: ['qc-001.pdf'],
                    minStock: 500,
                    reorderPoint: 800
                }
            ],
            movements: [
                {
                    id: 'mov-001',
                    batchId: 'batch-001',
                    materialName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è',
                    batchNumber: 'B240115001',
                    type: 'receipt',
                    fromMag: '',
                    toMag: 'MAG1',
                    quantity: 1000,
                    reason: '–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞',
                    referenceDocument: 'PO-2024/0012',
                    performedBy: 'warehouse-001',
                    timestamp: '2024-01-15 09:30:00',
                    notes: '–ü–æ–ª–Ω–æ–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–∫–∞–∑—É'
                },
                {
                    id: 'mov-002',
                    batchId: 'batch-001',
                    materialName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è',
                    batchNumber: 'B240115001',
                    type: 'issue',
                    fromMag: 'MAG1',
                    toMag: '',
                    quantity: 150,
                    reason: '–†–∞—Å—Ö–æ–¥ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ',
                    referenceDocument: 'JOB-2024/0025',
                    performedBy: 'operator-001',
                    timestamp: '2024-01-16 14:15:00',
                    notes: '–†–∞—Å—Ö–æ–¥ –Ω–∞ –∑–∞–∫–∞–∑ ORD-001'
                },
                {
                    id: 'mov-003',
                    batchId: 'batch-003',
                    materialName: '–ö–ª–µ–π –ø–æ–ª–∏—É—Ä–µ—Ç–∞–Ω–æ–≤—ã–π',
                    batchNumber: 'B240117001',
                    type: 'transfer',
                    fromMag: 'MAG1',
                    toMag: 'MAG5',
                    quantity: 100,
                    reason: '–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –∑–æ–Ω—É –ª–∞–º–∏–Ω–∞—Ü–∏–∏',
                    referenceDocument: 'TRF-2024/0008',
                    performedBy: 'warehouse-002',
                    timestamp: '2024-01-17 11:45:00',
                    notes: '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É'
                }
            ],
            stocktakingPlans: [
                {
                    id: 'st-001',
                    name: '–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è MAG1',
                    planDate: '2024-01-25',
                    status: 'planned',
                    magLocations: ['MAG1'],
                    responsible: 'warehouse-001',
                    progress: 0
                },
                {
                    id: 'st-002',
                    name: '–ì–æ–¥–æ–≤–∞—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è',
                    planDate: '2024-02-01',
                    status: 'in_progress',
                    magLocations: ['MAG1', 'MAG2', 'MAG3', 'MAG4', 'MAG5', 'MAG7', 'MAG9'],
                    responsible: 'manager-001',
                    progress: 35
                }
            ]
        };

        // Filter state
        let inventoryFilters = {
            mag: '',
            type: '',
            quality: '',
            supplier: ''
        };

        // Main inventory page loader
        function loadInventoryPage() {
            updateInventorySummary();
            showInventoryTab('materials');
        }

        // Update inventory summary metrics
        function updateInventorySummary() {
            const totalItems = inventoryData.materials.length;
            const criticalStock = inventoryData.materials.filter(m => 
                m.quantity <= m.reorderPoint && m.status === 'released').length;
            const blockedItems = inventoryData.materials.filter(m => m.status === 'blocked').length;
            const totalValue = inventoryData.materials.reduce((sum, m) => sum + (m.quantity * 50), 0); // Mock calculation

            document.getElementById('totalItems').textContent = totalItems.toLocaleString();
            document.getElementById('criticalStock').textContent = criticalStock;
            document.getElementById('blockedItems').textContent = blockedItems;
            document.getElementById('availableValue').textContent = '‚Ç¨' + Math.round(totalValue / 1000) + 'K';
        }

        // Show inventory tab
        function showInventoryTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.inventory-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('inventory' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
            event.target.classList.add('active');

            // Load tab content
            switch(tabName) {
                case 'materials':
                    loadInventoryMaterials();
                    break;
                case 'critical':
                    loadCriticalStock();
                    break;
                case 'blocked':
                    loadBlockedMaterials();
                    break;
                case 'movements':
                    loadInventoryMovements();
                    break;
                case 'stocktaking':
                    loadStocktaking();
                    break;
            }
        }

        // Load inventory materials
        function loadInventoryMaterials() {
            const tbody = document.getElementById('inventoryMaterialsTable');
            if (!tbody) return;

            const filteredMaterials = inventoryData.materials.filter(material => {
                return (!inventoryFilters.mag || material.magLocation === inventoryFilters.mag) &&
                       (!inventoryFilters.type || material.type === inventoryFilters.type) &&
                       (!inventoryFilters.quality || material.status === inventoryFilters.quality) &&
                       (!inventoryFilters.supplier || material.supplierId === inventoryFilters.supplier);
            });

            tbody.innerHTML = filteredMaterials.map(material => `
                <tr>
                    <td>
                        <div><strong>${material.materialName}</strong></div>
                        <div style="font-size: 0.75rem; color: #6b7280;">${material.materialCode}</div>
                        <span class="material-type-badge ${material.type}">${getMaterialTypeLabel(material.type)}</span>
                    </td>
                    <td>
                        <span class="mag-badge">${material.magLocation}</span>
                    </td>
                    <td>
                        <span class="batch-number">${material.batchNumber}</span>
                        ${material.supplierBatch ? `<div style="font-size: 0.6875rem; color: #6b7280;">–ü–æ—Å—Ç–∞–≤—â–∏–∫: ${material.supplierBatch}</div>` : ''}
                    </td>
                    <td>${material.quantity} ${material.unit}</td>
                    <td>
                        <span class="quality-badge ${material.status}">${getQualityStatusLabel(material.status)}</span>
                    </td>
                    <td>
                        ${material.expiryDate ? 
                            `<span class="${getExpiryClass(material.expiryDate)}">${formatDate(material.expiryDate)}</span>` : 
                            '<span style="color: #6b7280;">–ë–µ–∑ —Å—Ä–æ–∫–∞</span>'
                        }
                    </td>
                    <td>${material.supplierName}</td>
                    <td>${formatDate(material.receivedDate)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="showBatchDetails('${material.id}')">üëÅÔ∏è</button>
                            <button class="btn btn-sm btn-secondary" onclick="moveBatch('${material.id}')">üìã</button>
                            <button class="btn btn-sm btn-warning" onclick="adjustQuantity('${material.id}')">‚öñÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Load critical stock
        function loadCriticalStock() {
            const tbody = document.getElementById('inventoryCriticalTable');
            if (!tbody) return;

            const criticalMaterials = inventoryData.materials.filter(m => 
                m.quantity <= m.reorderPoint && m.status === 'released');

            tbody.innerHTML = criticalMaterials.map(material => {
                const daysToZero = Math.max(0, Math.floor(material.quantity / 10)); // Mock calculation
                const suggestedOrder = material.reorderPoint - material.quantity + 100;
                const criticalityLevel = material.quantity <= material.minStock ? 'critical' : 'high';

                return `
                    <tr>
                        <td>
                            <div><strong>${material.materialName}</strong></div>
                            <div style="font-size: 0.75rem; color: #6b7280;">${material.materialCode}</div>
                        </td>
                        <td>${material.quantity} ${material.unit}</td>
                        <td>${material.reorderPoint} ${material.unit}</td>
                        <td>
                            <div class="criticality-indicator">
                                <div class="criticality-level ${criticalityLevel}"></div>
                                <span>${criticalityLevel === 'critical' ? '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è' : '–í—ã—Å–æ–∫–∞—è'}</span>
                            </div>
                        </td>
                        <td>${daysToZero} –¥–Ω–µ–π</td>
                        <td>${suggestedOrder} ${material.unit}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-primary" onclick="createPurchaseRequest('${material.materialId}')">üõí</button>
                                <button class="btn btn-sm btn-warning" onclick="adjustReorderPoint('${material.id}')">‚öñÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Load blocked materials
        function loadBlockedMaterials() {
            const tbody = document.getElementById('inventoryBlockedTable');
            if (!tbody) return;

            const blockedMaterials = inventoryData.materials.filter(m => m.status === 'blocked');

            tbody.innerHTML = blockedMaterials.map(material => `
                <tr>
                    <td>
                        <div><strong>${material.materialName}</strong></div>
                        <div style="font-size: 0.75rem; color: #6b7280;">${material.materialCode}</div>
                    </td>
                    <td>
                        <span class="batch-number">${material.batchNumber}</span>
                    </td>
                    <td>${material.quantity} ${material.unit}</td>
                    <td>${material.blockReason || '–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞'}</td>
                    <td>${formatDate(material.receivedDate)}</td>
                    <td>QC Manager</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-success" onclick="unblockMaterial('${material.id}')">üîì</button>
                            <button class="btn btn-sm btn-danger" onclick="scrapMaterial('${material.id}')">üóëÔ∏è</button>
                            <button class="btn btn-sm btn-primary" onclick="requestRetest('${material.id}')">üî¨</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Load inventory movements
        function loadInventoryMovements() {
            const tbody = document.getElementById('inventoryMovementsTable');
            if (!tbody) return;

            tbody.innerHTML = inventoryData.movements.map(movement => `
                <tr>
                    <td>${formatDateTime(movement.timestamp)}</td>
                    <td>
                        <div><strong>${movement.materialName}</strong></div>
                    </td>
                    <td>
                        <span class="batch-number">${movement.batchNumber}</span>
                    </td>
                    <td>
                        <span class="movement-badge ${movement.type}">${getMovementTypeLabel(movement.type)}</span>
                    </td>
                    <td>
                        ${movement.fromMag ? movement.fromMag : '‚Äî'} ‚Üí ${movement.toMag ? movement.toMag : '‚Äî'}
                    </td>
                    <td>${movement.quantity} –∫–≥</td>
                    <td>${movement.referenceDocument}</td>
                    <td>${movement.performedBy}</td>
                </tr>
            `).join('');
        }

        // Load stocktaking
        function loadStocktaking() {
            const plansList = document.getElementById('stocktakingPlansList');
            if (!plansList) return;

            plansList.innerHTML = inventoryData.stocktakingPlans.map(plan => `
                <div class="stocktaking-plan ${plan.status === 'in_progress' ? 'active' : ''}" onclick="selectStocktakingPlan('${plan.id}')">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong>${plan.name}</strong>
                        <span class="stocktaking-status">${getStocktakingStatusLabel(plan.status)}</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">
                        –î–∞—Ç–∞: ${formatDate(plan.planDate)} | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: ${plan.responsible}
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280;">
                        –°–∫–ª–∞–¥—ã: ${plan.magLocations.join(', ')}
                    </div>
                    ${plan.status === 'in_progress' ? 
                        `<div style="margin-top: 0.5rem;">
                            <div style="background: #e5e7eb; height: 4px; border-radius: 2px;">
                                <div style="background: #3b82f6; height: 100%; width: ${plan.progress}%; border-radius: 2px;"></div>
                            </div>
                            <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">–ü—Ä–æ–≥—Ä–µ—Å—Å: ${plan.progress}%</div>
                        </div>` : ''
                    }
                </div>
            `).join('');
        }

        // MAG warehouse details
        function showMagDetails(magId) {
            const magMaterials = inventoryData.materials.filter(m => m.magLocation === magId);
            const totalQuantity = magMaterials.reduce((sum, m) => sum + m.quantity, 0);
            
            showToast(`${magId}: ${magMaterials.length} –ø–æ–∑–∏—Ü–∏–π, ${totalQuantity} –∫–≥ –æ–±—â–∏–π –≤–µ—Å`, 'info');
        }

        // Utility functions
        function getMaterialTypeLabel(type) {
            const labels = {
                'raw_material': '–°—ã—Ä—å–µ',
                'semi_finished': '–ü–æ–ª—É—Ñ–∞–±—Ä–∏–∫–∞—Ç',
                'finished_good': '–ì–æ—Ç–æ–≤–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è'
            };
            return labels[type] || type;
        }

        function getQualityStatusLabel(status) {
            const labels = {
                'quarantine': '–ö–∞—Ä–∞–Ω—Ç–∏–Ω',
                'released': '–†–∞–∑—Ä–µ—à–µ–Ω',
                'blocked': '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω'
            };
            return labels[status] || status;
        }

        function getMovementTypeLabel(type) {
            const labels = {
                'receipt': '–ü—Ä–∏—Ö–æ–¥',
                'issue': '–†–∞—Å—Ö–æ–¥',
                'transfer': '–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ',
                'adjustment': '–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞'
            };
            return labels[type] || type;
        }

        function getStocktakingStatusLabel(status) {
            const labels = {
                'planned': '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞',
                'in_progress': '–í –ø—Ä–æ—Ü–µ—Å—Å–µ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–∞'
            };
            return labels[status] || status;
        }

        function getExpiryClass(expiryDate) {
            const today = new Date();
            const expiry = new Date(expiryDate);
            const daysToExpiry = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
            
            if (daysToExpiry < 0) return 'expiry-warning';
            if (daysToExpiry < 30) return 'expiry-soon';
            return '';
        }

        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString('ru-RU') + ' ' + date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }

        // Filter functions
        function applyInventoryFilters() {
            inventoryFilters.mag = document.getElementById('magFilter').value;
            inventoryFilters.type = document.getElementById('typeFilter').value;
            inventoryFilters.quality = document.getElementById('qualityFilter').value;
            inventoryFilters.supplier = document.getElementById('supplierFilter').value;
            
            loadInventoryMaterials();
            showToast('–§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω—ã', 'success');
        }

        function resetInventoryFilters() {
            inventoryFilters = { mag: '', type: '', quality: '', supplier: '' };
            
            document.getElementById('magFilter').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('qualityFilter').value = '';
            document.getElementById('supplierFilter').value = '';
            
            loadInventoryMaterials();
            showToast('–§–∏–ª—å—Ç—Ä—ã —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
        }

        // Action functions (placeholders)
        function showReceiptModal() {
            showToast('–ú–æ–¥–∞–ª –ø—Ä–∏—Ö–æ–¥–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        function exportInventory() {
            showToast('–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö —Å–∫–ª–∞–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
        }

        function showStocktakingModal() {
            showToast('–ú–æ–¥–∞–ª –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        function showBatchDetails(batchId) {
            showToast(`–î–µ—Ç–∞–ª–∏ –ø–∞—Ä—Ç–∏–∏ ${batchId} –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏`, 'info');
        }

        function moveBatch(batchId) {
            showToast(`–ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏ ${batchId}`, 'info');
        }

        function adjustQuantity(batchId) {
            showToast(`–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–∞—Ä—Ç–∏–∏ ${batchId}`, 'info');
        }

        function createPurchaseRequest(materialId) {
            showToast(`–°–æ–∑–¥–∞–Ω–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –∑–∞–∫—É–ø–∫—É –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–∞ ${materialId}`, 'success');
        }

        function adjustReorderPoint(batchId) {
            showToast(`–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ç–æ—á–∫–∏ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø–∞—Ä—Ç–∏–∏ ${batchId}`, 'info');
        }

        function generatePurchaseRequests() {
            showToast('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∑–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤', 'success');
        }

        function unblockMaterial(batchId) {
            showToast(`–ú–∞—Ç–µ—Ä–∏–∞–ª –ø–∞—Ä—Ç–∏–∏ ${batchId} —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω`, 'success');
        }

        function scrapMaterial(batchId) {
            showToast(`–ú–∞—Ç–µ—Ä–∏–∞–ª –ø–∞—Ä—Ç–∏–∏ ${batchId} —Å–ø–∏—Å–∞–Ω –∫–∞–∫ –±—Ä–∞–∫`, 'warning');
        }

        function requestRetest(batchId) {
            showToast(`–ó–∞–ø—Ä–æ—à–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–∞—Ä—Ç–∏–∏ ${batchId}`, 'info');
        }

        function massUnblock() {
            showToast('–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞', 'success');
        }

        function filterMovements() {
            showToast('–§–∏–ª—å—Ç—Ä –¥–≤–∏–∂–µ–Ω–∏–π –ø—Ä–∏–º–µ–Ω–µ–Ω', 'success');
        }

        function exportMovements() {
            showToast('–≠–∫—Å–ø–æ—Ä—Ç –¥–≤–∏–∂–µ–Ω–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
        }

        function showCreateStocktakingModal() {
            showToast('–ú–æ–¥–∞–ª —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–Ω–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–π –≤–µ—Ä—Å–∏–∏', 'info');
        }

        function selectStocktakingPlan(planId) {
            document.querySelectorAll('.stocktaking-plan').forEach(plan => {
                plan.classList.remove('active');
            });
            event.target.closest('.stocktaking-plan').classList.add('active');
            
            showToast(`–í—ã–±—Ä–∞–Ω –ø–ª–∞–Ω –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏ ${planId}`, 'info');
        }

        // =============================================
        // PRODUCTION PAGE FUNCTIONS
        // =============================================

        // Sample data for production
        let productionData = {
            oeeMetrics: {
                availability: 92.1,
                performance: 89.5,
                quality: 98.2,
                oee: 80.9,
                changes: {
                    availability: 2.1,
                    performance: -1.2,
                    quality: 0.8,
                    oee: 1.7
                }
            },
            productionJobs: [
                {
                    id: 'job-156',
                    number: 'JOB-2024/0156',
                    orderId: 'ord-001',
                    productName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î 30–º–∫–º',
                    lineId: 'extrusion-1',
                    status: 'running',
                    plannedQuantity: 1250,
                    producedQuantity: 850,
                    wasteQuantity: 15,
                    priority: 1,
                    startTime: '2024-01-18 08:00:00',
                    assignedOperators: ['operator-001', 'operator-002'],
                    parameters: {
                        temperature_zones: [180, 185, 190, 185],
                        screw_speed: 45,
                        line_speed: 78,
                        film_thickness: 30,
                        sleeve_width: 600
                    }
                },
                {
                    id: 'job-157',
                    number: 'JOB-2024/0157',
                    orderId: 'ord-002',
                    productName: '–ü–ª–µ–Ω–∫–∞ –ü–í–î —Ü–≤–µ—Ç–Ω–∞—è',
                    lineId: 'extrusion-2',
                    status: 'setup',
                    plannedQuantity: 800,
                    producedQuantity: 0,
                    wasteQuantity: 0,
                    priority: 2,
                    startTime: null,
                    assignedOperators: ['operator-003'],
                    parameters: null
                },
                {
                    id: 'job-158',
                    number: 'JOB-2024/0158',
                    orderId: 'ord-003',
                    productName: '–õ–∞–º–∏–Ω–∞—Ü–∏—è –º–µ—Ç–∞–ª–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è',
                    lineId: 'lamination-1',
                    status: 'running',
                    plannedQuantity: 500,
                    producedQuantity: 225,
                    wasteQuantity: 4,
                    priority: 1,
                    startTime: '2024-01-18 10:30:00',
                    assignedOperators: ['operator-004'],
                    parameters: {
                        adhesive_rate: 2.5,
                        lamination_speed: 25,
                        bond_strength: 2.8
                    }
                },
                {
                    id: 'job-159',
                    number: 'JOB-2024/0159',
                    orderId: 'ord-004',
                    productName: '–ü–µ—á–∞—Ç—å –ª–æ–≥–æ—Ç–∏–ø–∞ 4+0',
                    lineId: 'flexo-1',
                    status: 'setup',
                    plannedQuantity: 2000,
                    producedQuantity: 0,
                    wasteQuantity: 0,
                    priority: 3,
                    startTime: null,
                    assignedOperators: ['operator-005', 'operator-006'],
                    parameters: null
                },
                {
                    id: 'job-160',
                    number: 'JOB-2024/0160',
                    orderId: 'ord-005',
                    productName: '–≠—Ç–∏–∫–µ—Ç–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ',
                    lineId: 'digital-1',
                    status: 'running',
                    plannedQuantity: 10000,
                    producedQuantity: 7800,
                    wasteQuantity: 30,
                    priority: 1,
                    startTime: '2024-01-18 07:00:00',
                    assignedOperators: ['operator-007'],
                    parameters: {
                        print_speed: 850,
                        ink_viscosity: { cyan: 18, magenta: 19, yellow: 17, black: 20 },
                        registration: 0.05
                    }
                }
            ],
            productionLines: {
                'extrusion-1': {
                    id: 'extrusion-1',
                    name: '–≠–∫—Å—Ç—Ä—É–∑–∏—è 1',
                    department: 'extrusion',
                    status: 'running',
                    currentJobId: 'job-156',
                    shiftTime: '5—á 23–º',
                    speed: { current: 78, planned: 80 },
                    wasteRate: 1.2,
                    efficiency: 97.5
                },
                'extrusion-2': {
                    id: 'extrusion-2',
                    name: '–≠–∫—Å—Ç—Ä—É–∑–∏—è 2',
                    department: 'extrusion',
                    status: 'setup',
                    currentJobId: 'job-157',
                    setupTime: '35 –º–∏–Ω',
                    setupProgress: 85,
                    operator: '–ü–µ—Ç—Ä–æ–≤ –ê.–ò.'
                },
                'extrusion-3': {
                    id: 'extrusion-3',
                    name: '–≠–∫—Å—Ç—Ä—É–∑–∏—è 3',
                    department: 'extrusion',
                    status: 'idle',
                    currentJobId: null,
                    idleReason: '–û–∂–∏–¥–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞',
                    idleDetails: '–ú–ê–¢-003 - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç',
                    idleTime: '2—á 15–º',
                    plannedStart: '14:30'
                },
                'extrusion-4': {
                    id: 'extrusion-4',
                    name: '–≠–∫—Å—Ç—Ä—É–∑–∏—è 4',
                    department: 'extrusion',
                    status: 'stopped',
                    currentJobId: null,
                    maintenanceReason: '–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û',
                    maintenanceDetails: '–ó–∞–º–µ–Ω–∞ —ç–∫—Å—Ç—Ä—É–¥–µ—Ä–Ω–æ–≥–æ —á–µ—Ä–≤—è–∫–∞',
                    maintenanceTime: '6—á 45–º',
                    maintenanceProgress: 75
                },
                'lamination-1': {
                    id: 'lamination-1',
                    name: '–õ–∞–º–∏–Ω–∞—Ü–∏—è 1',
                    department: 'lamination',
                    status: 'running',
                    currentJobId: 'job-158',
                    shiftTime: '3—á 45–º',
                    speed: { current: 25, planned: 30 },
                    bondStrength: 2.8,
                    wasteRate: 0.8,
                    efficiency: 83.3
                },
                'flexo-1': {
                    id: 'flexo-1',
                    name: '–§–ª–µ–∫—Å–æ 1',
                    department: 'printing',
                    status: 'setup',
                    currentJobId: 'job-159',
                    setupReason: '–°–º–µ–Ω–∞ —Ñ–æ—Ä–º –ø–µ—á–∞—Ç–∏',
                    setupDetails: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫—Ä–∞—Å–æ–∫',
                    setupProgress: 92,
                    colorCount: 4
                },
                'digital-1': {
                    id: 'digital-1',
                    name: '–¶–∏—Ñ—Ä–æ–≤–∞—è 1',
                    department: 'printing',
                    status: 'running',
                    currentJobId: 'job-160',
                    shiftTime: '7—á 12–º',
                    speed: 850,
                    quality: 99.2,
                    wasteRate: 0.3,
                    efficiency: 95.8
                }
            },
            alerts: [
                {
                    id: 'alert-001',
                    type: 'critical',
                    title: '–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –±—Ä–∞–∫–∞',
                    message: '–õ–∏–Ω–∏—è –≠–∫—Å—Ç—Ä—É–∑–∏—è 1: –±—Ä–∞–∫ –¥–æ—Å—Ç–∏–≥ 2.5% (–Ω–æ—Ä–º–∞ 1.5%)',
                    lineId: 'extrusion-1',
                    timestamp: '2024-01-18 13:45:00',
                    acknowledged: false,
                    actions: ['stop_line', 'check_quality', 'adjust_parameters']
                },
                {
                    id: 'alert-002',
                    type: 'warning',
                    title: '–°–Ω–∏–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –ª–∏–Ω–∏–∏',
                    message: '–õ–∞–º–∏–Ω–∞—Ü–∏—è 1: —Å–∫–æ—Ä–æ—Å—Ç—å —Å–Ω–∏–∂–µ–Ω–∞ –¥–æ 25 –º/–º–∏–Ω (–ø–ª–∞–Ω 30 –º/–º–∏–Ω)',
                    lineId: 'lamination-1',
                    timestamp: '2024-01-18 13:30:00',
                    acknowledged: false,
                    actions: ['check_materials', 'adjust_speed', 'maintenance_check']
                },
                {
                    id: 'alert-003',
                    type: 'warning',
                    title: '–ú–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è',
                    message: '–ú–ê–¢-003 (–ö–ª–µ–π –ø–æ–ª–∏—É—Ä–µ—Ç–∞–Ω–æ–≤—ã–π): –æ—Å—Ç–∞—Ç–æ–∫ 25 –∫–≥',
                    lineId: null,
                    timestamp: '2024-01-18 13:15:00',
                    acknowledged: false,
                    actions: ['order_material', 'reschedule_jobs']
                },
                {
                    id: 'alert-004',
                    type: 'info',
                    title: '–°–º–µ–Ω–∞ –∑–∞–¥–∞–Ω–∏—è',
                    message: '–¶–∏—Ñ—Ä–æ–≤–∞—è 1: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –∑–∞–∫–∞–∑ JOB-2024/0161',
                    lineId: 'digital-1',
                    timestamp: '2024-01-18 13:00:00',
                    acknowledged: true,
                    actions: []
                },
                {
                    id: 'alert-005',
                    type: 'info',
                    title: '–ü–ª–∞–Ω–æ–≤–æ–µ –¢–û –∑–∞–≤–µ—Ä—à–µ–Ω–æ',
                    message: '–≠–∫—Å—Ç—Ä—É–∑–∏—è 4: –∑–∞–º–µ–Ω–∞ —á–µ—Ä–≤—è–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –Ω–∞ 75%',
                    lineId: 'extrusion-4',
                    timestamp: '2024-01-18 12:30:00',
                    acknowledged: true,
                    actions: []
                }
            ]
        };

        // Current alert filter
        let currentAlertFilter = 'all';

        // Main production page loader
        function loadProductionPage() {
            updateOEEMetrics();
            loadProductionAlerts();
        }

        // Update OEE metrics display
        function updateOEEMetrics() {
            const metrics = productionData.oeeMetrics;
            
            document.getElementById('availabilityMetric').textContent = `${metrics.availability}%`;
            document.getElementById('performanceMetric').textContent = `${metrics.performance}%`;
            document.getElementById('qualityMetric').textContent = `${metrics.quality}%`;
            document.getElementById('oeeMetric').textContent = `${metrics.oee}%`;

            // Update change indicators
            const changes = metrics.changes;
            document.getElementById('availabilityChange').textContent = 
                `${changes.availability > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(changes.availability)}%`;
            document.getElementById('performanceChange').textContent = 
                `${changes.performance > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(changes.performance)}%`;
            document.getElementById('qualityChange').textContent = 
                `${changes.quality > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(changes.quality)}%`;
            document.getElementById('oeeChange').textContent = 
                `${changes.oee > 0 ? '‚Üë' : '‚Üì'} ${Math.abs(changes.oee)}%`;

            // Update change classes
            document.getElementById('availabilityChange').className = 
                `oee-change ${changes.availability > 0 ? 'positive' : 'negative'}`;
            document.getElementById('performanceChange').className = 
                `oee-change ${changes.performance > 0 ? 'positive' : 'negative'}`;
            document.getElementById('qualityChange').className = 
                `oee-change ${changes.quality > 0 ? 'positive' : 'negative'}`;
            document.getElementById('oeeChange').className = 
                `oee-change ${changes.oee > 0 ? 'positive' : 'negative'}`;
        }

        // Show production line details
        function showProductionLineDetails(lineId) {
            const line = productionData.productionLines[lineId];
            const job = productionData.productionJobs.find(j => j.id === line.currentJobId);
            
            let modalContent = `
                <div class="line-details-modal">
                    <h3>${line.name} - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <div class="line-status-section">
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${getLineStatusText(line.status)}</p>
            `;

            if (job) {
                const progress = Math.round((job.producedQuantity / job.plannedQuantity) * 100);
                modalContent += `
                    <p><strong>–¢–µ–∫—É—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ:</strong> ${job.number}</p>
                    <p><strong>–ü—Ä–æ–¥—É–∫—Ç:</strong> ${job.productName}</p>
                    <p><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> ${progress}% (${job.producedQuantity}/${job.plannedQuantity})</p>
                    <p><strong>–ë—Ä–∞–∫:</strong> ${job.wasteQuantity} –µ–¥–∏–Ω–∏—Ü</p>
                `;
            }

            if (line.status === 'running' && line.speed) {
                modalContent += `
                    <p><strong>–°–∫–æ—Ä–æ—Å—Ç—å:</strong> ${line.speed.current}/${line.speed.planned} –º/–º–∏–Ω</p>
                    <p><strong>–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> ${line.efficiency}%</p>
                `;
            }

            if (line.status === 'setup') {
                modalContent += `
                    <p><strong>–ù–∞–ª–∞–¥–∫–∞:</strong> ${line.setupReason || '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'}</p>
                    <p><strong>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:</strong> ${line.setupProgress}%</p>
                `;
            }

            modalContent += `
                    </div>
                </div>
            `;

            showToast(`–î–µ—Ç–∞–ª–∏ –ª–∏–Ω–∏–∏ ${line.name} –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏`, 'info');
        }

        // Load production alerts
        function loadProductionAlerts() {
            const alertsList = document.getElementById('productionAlertsList');
            if (!alertsList) return;

            const filteredAlerts = productionData.alerts.filter(alert => {
                if (currentAlertFilter === 'all') return true;
                return alert.type === currentAlertFilter;
            });

            alertsList.innerHTML = filteredAlerts.map(alert => `
                <div class="alert-item ${alert.type}" data-alert-id="${alert.id}">
                    <div class="alert-icon">${getAlertIcon(alert.type)}</div>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-message">${alert.message}</div>
                        <div class="alert-meta">
                            <span>–í—Ä–µ–º—è: ${formatDateTime(alert.timestamp)}</span>
                            ${alert.lineId ? `<span>–õ–∏–Ω–∏—è: ${productionData.productionLines[alert.lineId]?.name || alert.lineId}</span>` : ''}
                            <span>–°—Ç–∞—Ç—É—Å: ${alert.acknowledged ? '–ü—Ä–∏–Ω—è—Ç–æ' : '–ù–æ–≤–æ–µ'}</span>
                        </div>
                    </div>
                    <div class="alert-actions">
                        ${!alert.acknowledged ? `<button class="alert-action-btn primary" onclick="acknowledgeAlert('${alert.id}')">–ü—Ä–∏–Ω—è—Ç—å</button>` : ''}
                        ${alert.actions.map(action => 
                            `<button class="alert-action-btn" onclick="executeAlertAction('${alert.id}', '${action}')">${getActionLabel(action)}</button>`
                        ).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Filter production alerts
        function filterProductionAlerts(filterType) {
            currentAlertFilter = filterType;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadProductionAlerts();
        }

        // Production line actions
        function startProductionLine(lineId) {
            showToast(`–ó–∞–ø—É—Å–∫ –ª–∏–Ω–∏–∏ ${lineId}`, 'success');
            // Here would be actual API call to start the line
        }

        function pauseProductionLine(lineId) {
            showToast(`–ü–∞—É–∑–∞ –ª–∏–Ω–∏–∏ ${lineId}`, 'warning');
            // Here would be actual API call to pause the line
        }

        function stopProductionLine(lineId) {
            showToast(`–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–Ω–∏–∏ ${lineId}`, 'error');
            // Here would be actual API call to stop the line
        }

        function showLineSettings(lineId) {
            showToast(`–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏–Ω–∏–∏ ${lineId} –±—É–¥—É—Ç –æ—Ç–∫—Ä—ã—Ç—ã –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏`, 'info');
            // Here would open line settings modal
        }

        function showMaintenanceInfo(lineId) {
            const line = productionData.productionLines[lineId];
            showToast(`–¢–û –ª–∏–Ω–∏–∏ ${line.name}: ${line.maintenanceDetails} (${line.maintenanceProgress}%)`, 'info');
        }

        // Alert actions
        function acknowledgeAlert(alertId) {
            const alert = productionData.alerts.find(a => a.id === alertId);
            if (alert) {
                alert.acknowledged = true;
                loadProductionAlerts();
                showToast('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ', 'success');
            }
        }

        function executeAlertAction(alertId, action) {
            const actionLabels = {
                'stop_line': '–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–Ω–∏–∏',
                'check_quality': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞',
                'adjust_parameters': '–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤',
                'check_materials': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤',
                'adjust_speed': '–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏',
                'maintenance_check': '–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è',
                'order_material': '–ó–∞–∫–∞–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∞',
                'reschedule_jobs': '–ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π'
            };
            
            showToast(`–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${actionLabels[action] || action}`, 'success');
        }

        // Utility functions
        function getLineStatusText(status) {
            const statusTexts = {
                'running': 'üü¢ –†–∞–±–æ—Ç–∞–µ—Ç',
                'setup': 'üü° –ù–∞–ª–∞–¥–∫–∞',
                'idle': 'üî¥ –ü—Ä–æ—Å—Ç–æ–π',
                'stopped': '‚ö´ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞'
            };
            return statusTexts[status] || status;
        }

        function getAlertIcon(type) {
            const icons = {
                'critical': 'üî¥',
                'warning': 'üü°',
                'info': 'üîµ'
            };
            return icons[type] || 'üì¢';
        }

        function getActionLabel(action) {
            const labels = {
                'stop_line': '–°—Ç–æ–ø',
                'check_quality': 'QC',
                'adjust_parameters': '–ù–∞—Å—Ç—Ä–æ–π–∫–∞',
                'check_materials': '–ú–∞—Ç–µ—Ä–∏–∞–ª—ã',
                'adjust_speed': '–°–∫–æ—Ä–æ—Å—Ç—å',
                'maintenance_check': '–¢–û',
                'order_material': '–ó–∞–∫–∞–∑–∞—Ç—å',
                'reschedule_jobs': '–ü–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å'
            };
            return labels[action] || action;
        }

        // Removed duplicate DOMContentLoaded - merged into main init

        // =============================================
        // MPSYSTEM LINE ACTIONS (Legacy)
        // =============================================

        function showLineDetails_Legacy(lineId) {
            showToast(`–î–µ—Ç–∞–ª–∏ –ª–∏–Ω–∏–∏ ${lineId} –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ`, 'info');
        }

        function pauseLine(lineId) {
            showToast(`–õ–∏–Ω–∏—è ${lineId} –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø–∞—É–∑—É`, 'warning');
        }

        function adjustPriority(lineId) {
            showToast(`–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ª–∏–Ω–∏–∏ ${lineId} –∏–∑–º–µ–Ω–µ–Ω`, 'info');
        }

        function startLine(lineId) {
            showToast(`–õ–∏–Ω–∏—è ${lineId} –∑–∞–ø—É—â–µ–Ω–∞`, 'success');
        }

        function checkMaterials(lineId) {
            showToast(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è –ª–∏–Ω–∏–∏ ${lineId}`, 'info');
        }

        function completeMaintenance(lineId) {
            showToast(`–ù–∞–ª–∞–¥–∫–∞ –ª–∏–Ω–∏–∏ ${lineId} –∑–∞–≤–µ—Ä—à–µ–Ω–∞`, 'success');
        }

        function scheduleDelay(lineId) {
            showToast(`–ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ª–∏–Ω–∏–∏ ${lineId} –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞`, 'warning');
        }

        function rushTest(lineId) {
            showToast(`–¢–µ—Å—Ç –¥–ª—è ${lineId} —É—Å–∫–æ—Ä–µ–Ω`, 'info');
        }

        function viewResults(lineId) {
            showToast(`–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ${lineId}`, 'info');
        }

        function prepareForLamination(lineId) {
            showToast(`–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ª–∞–º–∏–Ω–∞—Ü–∏–∏ –¥–ª—è ${lineId}`, 'info');
        }

        function checkQueue(lineId) {
            showToast(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è ${lineId}`, 'info');
        }

        function checkColors(lineId) {
            showToast(`–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è ${lineId}`, 'info');
        }

        function adjustColors(lineId) {
            showToast(`–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è ${lineId}`, 'info');
        }

        function orderMaterial(material) {
            showToast(`–ó–∞–∫–∞–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ ${material} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω`, 'success');
        }

        function escalateOrder(orderNumber) {
            showToast(`–ó–∞–∫–∞–∑ ${orderNumber} —ç—Å–∫–∞–ª–∏—Ä–æ–≤–∞–Ω`, 'warning');
        }

        function scheduleQC(batchNumber) {
            showToast(`–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –ø–∞—Ä—Ç–∏–∏ ${batchNumber} –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω`, 'info');
        }

        function prepareMaintenance(lineId) {
            showToast(`–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¢–û –ª–∏–Ω–∏–∏ ${lineId}`, 'info');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize MPSYSTEM
            await updateDashboardStats();
            updateCurrentTime();
            loadOrders();
            loadInventory();
            loadProduction();
            
            // UC-D001: Load initial dashboard data
            await updateDashboardMetrics();
            await loadProductionLinesFromAPI();
            await loadCriticalAlertsFromAPI();
            
            // Auto-update time every second
            setInterval(updateCurrentTime, 1000);
            
            // UC-D001: Auto-update dashboard every 30 seconds (as per –¢–ó requirement)
            setInterval(async function() {
                const dashboardTab = document.querySelector('#dashboard.active');
                if (dashboardTab) {
                    console.log('üîÑ UC-D001: Auto-updating dashboard (30s interval)');
                    await updateDashboardMetrics();
                    await loadProductionLinesFromAPI();
                    await loadCriticalAlertsFromAPI();
                }
            }, 30000);

            // Setup filter handlers for planning page
            const queueFilter = document.getElementById('queueFilter');
            const queueSort = document.getElementById('queueSort');
            
            if (queueFilter) {
                queueFilter.addEventListener('change', renderOrdersQueue);
            }
            if (queueSort) {
                queueSort.addEventListener('change', renderOrdersQueue);
            }
        });

        // UC-D002: Close modals on outside click
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                if (e.target.id === 'lineDetailsModal') {
                    hideLineDetails();
                } else {
                    hideModal(e.target.id);
                }
            }
        });
    </script>
</body>
</html>