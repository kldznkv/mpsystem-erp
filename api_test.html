<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPSYSTEM ERP - API Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #1e293b;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }

        .status-indicator.connected {
            background: #dcfce7;
            color: #16a34a;
            border: 1px solid #16a34a;
        }

        .status-indicator.disconnected {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #dc2626;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button:hover {
            background: #f1f5f9;
        }

        .tab-button.active {
            background: #3b82f6;
            color: white;
            border-bottom-color: #1d4ed8;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            margin-bottom: 20px;
            color: #1e293b;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .response-area {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .response-area pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
        }

        .file-upload {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #3b82f6;
            background: #f8fafc;
        }

        .file-upload.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .results-table th {
            background: #f1f5f9;
            font-weight: 600;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .error {
            background: #fee2e2;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .success {
            background: #dcfce7;
            color: #16a34a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ MPSYSTEM ERP - API Test Interface</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</p>
            <div id="apiStatus" class="status-indicator disconnected">üî¥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('materials')">üì¶ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</button>
            <button class="tab-button" onclick="showTab('suppliers')">üë• –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</button>
            <button class="tab-button" onclick="showTab('batches')">üè∑Ô∏è –ü–∞—Ä—Ç–∏–∏</button>
            <button class="tab-button" onclick="showTab('inventory')">üìä –û—Å—Ç–∞—Ç–∫–∏</button>
            <button class="tab-button" onclick="showTab('import')">üì§ –ò–º–ø–æ—Ä—Ç CSV</button>
        </div>

        <!-- Materials Tab -->
        <div id="materials" class="tab-content active">
            <div class="form-section">
                <h3>–°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</h3>
                <form id="materialForm" class="form-grid">
                    <div class="form-group">
                        <label for="materialCode">–ö–æ–¥ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</label>
                        <input type="text" id="materialCode" name="code" required placeholder="GR-PVD-001">
                    </div>
                    <div class="form-group">
                        <label for="materialName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="materialName" name="name" required placeholder="–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π">
                    </div>
                    <div class="form-group">
                        <label for="materialType">–¢–∏–ø –º–∞—Ç–µ—Ä–∏–∞–ª–∞</label>
                        <select id="materialType" name="type" required>
                            <option value="granulate_ldpe">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î</option>
                            <option value="granulate_hdpe">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ù–î</option>
                            <option value="granulate_pp">–ì—Ä–∞–Ω—É–ª—è—Ç –ü–ü</option>
                            <option value="ink_printing">–ö—Ä–∞—Å–∫–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏</option>
                            <option value="adhesive_pu">–ö–ª–µ–π –ü–£</option>
                            <option value="adhesive_acrylic">–ö–ª–µ–π –∞–∫—Ä–∏–ª–æ–≤—ã–π</option>
                            <option value="solvent">–†–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—å</option>
                            <option value="additive">–î–æ–±–∞–≤–∫–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="materialUnit">–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è</label>
                        <select id="materialUnit" name="unit" required>
                            <option value="–∫–≥">–∫–≥</option>
                            <option value="–ª">–ª</option>
                            <option value="–º">–º</option>
                            <option value="—à—Ç">—à—Ç</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="materialDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="materialDescription" name="description" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="materialCost">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</label>
                        <input type="number" id="materialCost" name="standard_cost" step="0.01" placeholder="245.50">
                    </div>
                    <div class="form-group">
                        <label for="materialMinStock">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫</label>
                        <input type="number" id="materialMinStock" name="min_stock_level" step="0.01" placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label for="materialReorderPoint">–¢–æ—á–∫–∞ –ø–µ—Ä–µ–∑–∞–∫–∞–∑–∞</label>
                        <input type="number" id="materialReorderPoint" name="reorder_point" step="0.01" placeholder="2000">
                    </div>
                </form>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="createMaterial()">–°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
                    <button class="btn btn-secondary" onclick="getMaterials()">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    <button class="btn btn-secondary" onclick="getLowStockMaterials()">–ù–∏–∑–∫–∏–µ –æ—Å—Ç–∞—Ç–∫–∏</button>
                </div>
            </div>
            <div id="materialResults" class="response-area" style="display: none;"></div>
        </div>

        <!-- Suppliers Tab -->
        <div id="suppliers" class="tab-content">
            <div class="form-section">
                <h3>–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</h3>
                <form id="supplierForm" class="form-grid">
                    <div class="form-group">
                        <label for="supplierCode">–ö–æ–¥ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</label>
                        <input type="text" id="supplierCode" name="code" required placeholder="SUP001">
                    </div>
                    <div class="form-group">
                        <label for="supplierName">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</label>
                        <input type="text" id="supplierName" name="name" required placeholder="Dow Chemical Europe">
                    </div>
                    <div class="form-group">
                        <label for="supplierContact">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                        <input type="text" id="supplierContact" name="contact_person" placeholder="John Smith">
                    </div>
                    <div class="form-group">
                        <label for="supplierEmail">Email</label>
                        <input type="email" id="supplierEmail" name="email" placeholder="john.smith@company.com">
                    </div>
                    <div class="form-group">
                        <label for="supplierPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="supplierPhone" name="phone" placeholder="+7-495-123-4567">
                    </div>
                    <div class="form-group">
                        <label for="supplierAddress">–ê–¥—Ä–µ—Å</label>
                        <textarea id="supplierAddress" name="address" rows="3" placeholder="–ê–¥—Ä–µ—Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞"></textarea>
                    </div>
                </form>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="createSupplier()">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</button>
                    <button class="btn btn-secondary" onclick="getSuppliers()">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                </div>
            </div>
            <div id="supplierResults" class="response-area" style="display: none;"></div>
        </div>

        <!-- Batches Tab -->
        <div id="batches" class="tab-content">
            <div class="form-section">
                <h3>–ü—Ä–∏–Ω—è—Ç—å –ø–∞—Ä—Ç–∏—é (–ø–æ—Å—Ç–∞–≤–∫—É)</h3>
                <form id="batchForm" class="form-grid">
                    <div class="form-group">
                        <label for="batchNumber">–ù–æ–º–µ—Ä –ø–∞—Ä—Ç–∏–∏</label>
                        <input type="text" id="batchNumber" name="batch_number" required placeholder="240119-001">
                    </div>
                    <div class="form-group">
                        <label for="batchMaterial">ID –º–∞—Ç–µ—Ä–∏–∞–ª–∞</label>
                        <input type="number" id="batchMaterial" name="material_id" required placeholder="1">
                    </div>
                    <div class="form-group">
                        <label for="batchSupplier">ID –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞</label>
                        <input type="number" id="batchSupplier" name="supplier_id" required placeholder="1">
                    </div>
                    <div class="form-group">
                        <label for="batchQuantity">–ü–æ–ª—É—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" id="batchQuantity" name="received_quantity" step="0.01" required placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label for="batchProductionDate">–î–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</label>
                        <input type="date" id="batchProductionDate" name="production_date">
                    </div>
                    <div class="form-group">
                        <label for="batchReceivedDate">–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</label>
                        <input type="date" id="batchReceivedDate" name="received_date" required>
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <h4>–î–æ–∫—É–º–µ–Ω—Ç—ã –∫–∞—á–µ—Å—Ç–≤–∞:</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px;">
                            <label><input type="checkbox" name="has_coa"> CoA (Certificate of Analysis)</label>
                            <label><input type="checkbox" name="has_tds"> TDS (Technical Data Sheet)</label>
                            <label><input type="checkbox" name="has_sds"> SDS (Safety Data Sheet)</label>
                            <label><input type="checkbox" name="has_doc"> DoC (Declaration of Compliance)</label>
                            <label><input type="checkbox" name="has_cmr"> CMR (Transport Document)</label>
                        </div>
                    </div>
                </form>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="createBatch()">–ü—Ä–∏–Ω—è—Ç—å –ø–∞—Ä—Ç–∏—é</button>
                    <button class="btn btn-secondary" onclick="getBatches()">–ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä—Ç–∏–∏</button>
                    <button class="btn btn-secondary" onclick="getPendingQualityBatches()">–û–∂–∏–¥–∞—é—â–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è</button>
                </div>
            </div>
            <div id="batchResults" class="response-area" style="display: none;"></div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory" class="tab-content">
            <div class="form-section">
                <h3>–ó–∞–ø—Ä–æ—Å—ã –æ—Å—Ç–∞—Ç–∫–æ–≤</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="warehouseFilter">–§–∏–ª—å—Ç—Ä –ø–æ —Å–∫–ª–∞–¥—É (ID)</label>
                        <input type="number" id="warehouseFilter" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label for="materialFilter">–§–∏–ª—å—Ç—Ä –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É (ID)</label>
                        <input type="number" id="materialFilter" placeholder="1">
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="getInventory()">–ü–æ–ª—É—á–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏</button>
                    <button class="btn btn-secondary" onclick="getWarehouseStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–ª–∞–¥–æ–≤</button>
                </div>
            </div>
            <div id="inventoryResults" class="response-area" style="display: none;"></div>
        </div>

        <!-- Import Tab -->
        <div id="import" class="tab-content">
            <div class="form-section">
                <h3>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>–¢–∏–ø –∏–º–ø–æ—Ä—Ç–∞</label>
                        <select id="importType">
                            <option value="materials">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</option>
                            <option value="suppliers">–ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="hasHeader" checked> –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏</label>
                    </div>
                </div>
                
                <div class="file-upload" id="fileUpload" onclick="document.getElementById('csvFile').click()">
                    <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleFileSelect(this)">
                    <p>üìÅ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ CSV —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</p>
                    <p style="font-size: 14px; color: #6b7280;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã .csv</p>
                </div>
                
                <div id="fileInfo" style="display: none; margin-top: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                    <p><strong>–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:</strong> <span id="fileName"></span></p>
                    <p><strong>–†–∞–∑–º–µ—Ä:</strong> <span id="fileSize"></span></p>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="importCSV()" id="importBtn" disabled>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                </div>
                
                <div style="margin-top: 30px;">
                    <h4>–§–æ—Ä–º–∞—Ç CSV –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤:</h4>
                    <pre style="background: #f8fafc; padding: 15px; border-radius: 8px; font-size: 13px;">code,name,type,unit,description,min_stock_level,standard_cost
GR-PVD-001,–ì—Ä–∞–Ω—É–ª—è—Ç –ü–í–î –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π,granulate_ldpe,–∫–≥,–û–ø–∏—Å–∞–Ω–∏–µ,1000,245.50</pre>
                    
                    <h4>–§–æ—Ä–º–∞—Ç CSV –¥–ª—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤:</h4>
                    <pre style="background: #f8fafc; padding: 15px; border-radius: 8px; font-size: 13px;">code,name,contact_person,email,phone,address
SUP001,Dow Chemical Europe,John Smith,john@dow.com,+49-123-456789,Germany</pre>
                </div>
            </div>
            <div id="importResults" class="response-area" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/v1';
        let selectedFile = null;

        // Check API connection status
        async function checkApiStatus() {
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                document.getElementById('apiStatus').textContent = 'üü¢ API –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
                document.getElementById('apiStatus').className = 'status-indicator connected';
            } catch (error) {
                document.getElementById('apiStatus').textContent = 'üî¥ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
                document.getElementById('apiStatus').className = 'status-indicator disconnected';
            }
        }

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // API Functions
        async function apiRequest(endpoint, method = 'GET', data = null, isFormData = false) {
            const url = `${API_BASE}${endpoint}`;
            const options = {
                method,
                headers: isFormData ? {} : {
                    'Content-Type': 'application/json',
                }
            };

            if (data) {
                options.body = isFormData ? data : JSON.stringify(data);
            }

            try {
                const response = await fetch(url, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${result.detail || 'Unknown error'}`);
                }
                
                return result;
            } catch (error) {
                throw error;
            }
        }

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = isError ? 
                `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${data}</div>` :
                `<div class="success">‚úÖ –£—Å–ø–µ—à–Ω–æ</div><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        // Materials functions
        async function createMaterial() {
            const form = document.getElementById('materialForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['standard_cost', 'min_stock_level', 'reorder_point'].includes(key)) {
                        data[key] = parseFloat(value);
                    } else {
                        data[key] = value;
                    }
                }
            }

            try {
                const result = await apiRequest('/warehouse/materials', 'POST', data);
                showResult('materialResults', result);
                form.reset();
            } catch (error) {
                showResult('materialResults', error.message, true);
            }
        }

        async function getMaterials() {
            try {
                const result = await apiRequest('/warehouse/materials');
                showResult('materialResults', result);
            } catch (error) {
                showResult('materialResults', error.message, true);
            }
        }

        async function getLowStockMaterials() {
            try {
                const result = await apiRequest('/warehouse/materials/low-stock');
                showResult('materialResults', result);
            } catch (error) {
                showResult('materialResults', error.message, true);
            }
        }

        // Suppliers functions
        async function createSupplier() {
            const form = document.getElementById('supplierForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) data[key] = value;
            }

            try {
                const result = await apiRequest('/warehouse/suppliers', 'POST', data);
                showResult('supplierResults', result);
                form.reset();
            } catch (error) {
                showResult('supplierResults', error.message, true);
            }
        }

        async function getSuppliers() {
            try {
                const result = await apiRequest('/warehouse/suppliers');
                showResult('supplierResults', result);
            } catch (error) {
                showResult('supplierResults', error.message, true);
            }
        }

        // Batches functions
        async function createBatch() {
            const form = document.getElementById('batchForm');
            const formData = new FormData(form);
            const data = {};
            
            for (let [key, value] of formData.entries()) {
                if (value) {
                    if (['material_id', 'supplier_id'].includes(key)) {
                        data[key] = parseInt(value);
                    } else if (key === 'received_quantity') {
                        data[key] = parseFloat(value);
                    } else if (['production_date', 'received_date'].includes(key)) {
                        data[key] = value + 'T00:00:00';
                    } else {
                        data[key] = value;
                    }
                }
            }

            // Handle checkboxes
            const checkboxes = form.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                data[cb.name] = cb.checked;
            });

            try {
                const result = await apiRequest('/warehouse/batches', 'POST', data);
                showResult('batchResults', result);
                form.reset();
            } catch (error) {
                showResult('batchResults', error.message, true);
            }
        }

        async function getBatches() {
            try {
                const result = await apiRequest('/warehouse/batches');
                showResult('batchResults', result);
            } catch (error) {
                showResult('batchResults', error.message, true);
            }
        }

        async function getPendingQualityBatches() {
            try {
                const result = await apiRequest('/warehouse/batches/pending-quality');
                showResult('batchResults', result);
            } catch (error) {
                showResult('batchResults', error.message, true);
            }
        }

        // Inventory functions
        async function getInventory() {
            let endpoint = '/warehouse/inventory';
            const params = new URLSearchParams();
            
            const warehouseId = document.getElementById('warehouseFilter').value;
            const materialId = document.getElementById('materialFilter').value;
            
            if (warehouseId) params.append('warehouse_id', warehouseId);
            if (materialId) params.append('material_id', materialId);
            
            if (params.toString()) {
                endpoint += '?' + params.toString();
            }

            try {
                const result = await apiRequest(endpoint);
                showResult('inventoryResults', result);
            } catch (error) {
                showResult('inventoryResults', error.message, true);
            }
        }

        async function getWarehouseStats() {
            try {
                const result = await apiRequest('/warehouse/summary/stats');
                showResult('inventoryResults', result);
            } catch (error) {
                showResult('inventoryResults', error.message, true);
            }
        }

        // File upload functions
        function handleFileSelect(input) {
            const file = input.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = (file.size / 1024).toFixed(2) + ' KB';
                document.getElementById('fileInfo').style.display = 'block';
                document.getElementById('importBtn').disabled = false;
            }
        }

        async function importCSV() {
            if (!selectedFile) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }

            const importType = document.getElementById('importType').value;
            const hasHeader = document.getElementById('hasHeader').checked;
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('has_header', hasHeader);
            formData.append('delimiter', ',');

            try {
                const endpoint = `/warehouse/import/${importType}`;
                const result = await apiRequest(endpoint, 'POST', formData, true);
                showResult('importResults', result);
            } catch (error) {
                showResult('importResults', error.message, true);
            }
        }

        // Drag and drop support
        const fileUpload = document.getElementById('fileUpload');
        fileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        });

        fileUpload.addEventListener('dragleave', () => {
            fileUpload.classList.remove('dragover');
        });

        fileUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('csvFile').files = files;
                handleFileSelect(document.getElementById('csvFile'));
            }
        });

        // Set today's date for batch received date
        document.getElementById('batchReceivedDate').value = new Date().toISOString().split('T')[0];

        // Initialize
        checkApiStatus();
        setInterval(checkApiStatus, 30000); // Check every 30 seconds
    </script>
</body>
</html>